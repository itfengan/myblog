<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ReactNativeçš„prop-typeså±žæ€§éªŒè¯é—®é¢˜]]></title>
    <url>%2F2018%2F08%2F02%2FReactNative%E7%9A%84prop-types%E5%B1%9E%E6%80%A7%E9%AA%8C%E8%AF%81%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ React Native åˆ›å»ºçš„ç»„ä»¶æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å‘çš„ç»„ä»¶å¯èƒ½ä¼šç»™é¡¹ç›®ç»„å…¶ä»–åŒäº‹ä½¿ç”¨ã€‚ä½†åˆ«äººå¯èƒ½å¯¹è¿™ä¸ªç»„ä»¶ä¸ç†Ÿæ‚‰ï¼Œå¸¸å¸¸ä¼šå¿˜è®°ä½¿ç”¨æŸäº›å±žæ€§ï¼Œæˆ–è€…æŸäº›å±žæ€§ä¼ é€’çš„æ•°æ®ç±»åž‹æœ‰è¯¯ã€‚ åœ¨å¼€å‘ React Native è‡ªå®šä¹‰ç»„ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡å±žæ€§ç¡®è®¤æ¥å£°æ˜Žè¿™ä¸ªç»„ä»¶éœ€è¦å“ªäº›å±žæ€§ã€‚è¿™æ ·ï¼Œå¦‚æžœåœ¨è°ƒç”¨è¿™ä¸ªè‡ªå®šä¹‰ç»„ä»¶æ—¶æ²¡æœ‰æä¾›ç›¸åº”çš„å±žæ€§ï¼Œåˆ™ä¼šåœ¨æ‰‹æœºä¸Žè°ƒè¯•å·¥å…·ä¸­å¼¹å‡ºè­¦å‘Šä¿¡æ¯ï¼Œå‘ŠçŸ¥å¼€å‘è€…è¯¥ç»„ä»¶éœ€è¦å“ªäº›å±žæ€§ã€‚ æ–°ç‰ˆæœ¬çš„é—®é¢˜React Nativeå·²ç»å‡çº§åˆ°0.51.0äº†ï¼Œç‰ˆæœ¬å‡çº§å¾ˆå¿«ï¼Œä½†æ˜¯å¯¹è€é¡¹ç›®ä¹Ÿä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œå¸¸è§çš„å°±æ˜¯å±žæ€§æ‰¾ä¸åˆ°çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼š ä¸»è¦åŽŸå› æ˜¯éšç€React Nativeçš„å‡çº§ï¼Œç³»ç»ŸåºŸå¼ƒäº†å¾ˆå¤šçš„ä¸œè¥¿ï¼Œè¿‡åŽ»æˆ‘ä»¬å¯ä»¥ç›´æŽ¥ä½¿ç”¨ React.PropTypes æ¥è¿›è¡Œå±žæ€§ç¡®è®¤ï¼Œä¸è¿‡è¿™ä¸ªè‡ª React v15.5 èµ·å°±è¢«ç§»é™¤äº†ï¼Œè½¬è€Œä½¿ç”¨prop-typesåº“æ¥è¿›è¡Œæ›¿æ¢ å¦‚ä½•ä½¿ç”¨å®‰è£…éœ€è¦å…ˆå®‰è£…è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ npm install --save prop-types å®‰è£…æˆåŠŸå¦‚ä¸‹ï¼š å¯¼å…¥import propTypes from &#39;prop-types&#39;; éªŒè¯12345678static propTypes = &#123; title: PropTypes.string, leftIcon: PropTypes.string, rightIcon: PropTypes.string, leftPress: PropTypes.func, rightPress: PropTypes.func, style: PropTypes.object &#125; è¿™æ ·ï¼Œå¦‚æžœåœ¨è°ƒç”¨è¿™ä¸ªè‡ªå®šä¹‰ç»„ä»¶æ—¶æ²¡æœ‰æä¾›ç›¸åº”çš„å±žæ€§ï¼Œåˆ™ä¼šåœ¨æ‰‹æœºä¸Žè°ƒè¯•å·¥å…·ä¸­å¼¹å‡ºè­¦å‘Šä¿¡æ¯ï¼Œå‘ŠçŸ¥å¼€å‘è€…è¯¥ç»„ä»¶éœ€è¦å“ªäº›å±žæ€§ã€‚ å®Œæ•´è¯­æ³•1ï¼Œè¦æ±‚å±žæ€§æ˜¯æŒ‡å®šçš„ JavaScript åŸºæœ¬ç±»åž‹ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.array,å±žæ€§: PropTypes.bool,å±žæ€§: PropTypes.func,å±žæ€§: PropTypes.number,å±žæ€§: PropTypes.object,å±žæ€§: PropTypes.string, 2ï¼Œè¦æ±‚å±žæ€§æ˜¯å¯æ¸²æŸ“èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.node, 3ï¼Œè¦æ±‚å±žæ€§æ˜¯æŸä¸ª React å…ƒç´ ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.element, 4ï¼Œè¦æ±‚å±žæ€§æ˜¯æŸä¸ªæŒ‡å®šç±»çš„å®žä¾‹ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.instanceOf(NameOfAClass), 5ï¼Œè¦æ±‚å±žæ€§å–å€¼ä¸ºç‰¹å®šçš„å‡ ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.oneOf([â€˜value1â€™, â€˜value2â€™]), 6ï¼Œè¦æ±‚å±žæ€§å¯ä»¥ä¸ºæŒ‡å®šç±»åž‹ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.oneOfType([ PropTypes.bool, PropTypes.number, PropTypes.instanceOf(NameOfAClass),]) 7ï¼Œè¦æ±‚å±žæ€§ä¸ºæŒ‡å®šç±»åž‹çš„æ•°ç»„ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.arrayOf(PropTypes.number), 8ï¼Œè¦æ±‚å±žæ€§æ˜¯ä¸€ä¸ªæœ‰ç‰¹å®šæˆå‘˜å˜é‡çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.objectOf(PropTypes.number), 9ï¼Œè¦æ±‚å±žæ€§æ˜¯ä¸€ä¸ªæŒ‡å®šæž„æˆæ–¹å¼çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.shape({ color: PropTypes.string, fontSize: PropTypes.number,}), 10ï¼Œå±žæ€§å¯ä»¥æ˜¯ä»»æ„ç±»åž‹ã€‚ä¾‹å¦‚ï¼š å±žæ€§: PropTypes.any å°†å±žæ€§å£°æ˜Žä¸ºå¿…é¡» ä½¿ç”¨å…³é”®å­— isRequired å£°æ˜Žå®ƒæ˜¯å¿…éœ€çš„ã€‚ å±žæ€§: PropTypes.array.isRequired,å±žæ€§: PropTypes.any.isRequired,å±žæ€§: PropTypes.instanceOf(NameOfAClass).isRequired, æºç ï¼ˆprop-types.jsï¼‰123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * Copyright (c) 2015-present, Facebook, Inc. * * This source code is licensed under the MIT license found in the * LICENSE file in the root directory of this source tree. * * @flow * @nolint * @format */// TODO (bvaughn) Remove this file once flowtype/flow-typed/pull/773 is mergedtype $npm$propTypes$ReactPropsCheckType = ( props: any, propName: string, componentName: string, href?: string,) =&gt; ?Error;declare module 'prop-types' &#123; declare var array: React$PropType$Primitive&lt;Array&lt;any&gt;&gt;; declare var bool: React$PropType$Primitive&lt;boolean&gt;; declare var func: React$PropType$Primitive&lt;Function&gt;; declare var number: React$PropType$Primitive&lt;number&gt;; declare var object: React$PropType$Primitive&lt;Object&gt;; declare var string: React$PropType$Primitive&lt;string&gt;; declare var any: React$PropType$Primitive&lt;any&gt;; declare var arrayOf: React$PropType$ArrayOf; declare var element: React$PropType$Primitive&lt;any&gt;; /* TODO */ declare var instanceOf: React$PropType$InstanceOf; declare var node: React$PropType$Primitive&lt;any&gt;; /* TODO */ declare var objectOf: React$PropType$ObjectOf; declare var oneOf: React$PropType$OneOf; declare var oneOfType: React$PropType$OneOfType; declare var shape: React$PropType$Shape; declare function checkPropTypes&lt;V&gt;( propTypes: $Subtype&lt;&#123;[_: $Keys&lt;V&gt;]: $npm$propTypes$ReactPropsCheckType&#125;&gt;, values: V, location: string, componentName: string, getStack: ?() =&gt; ?string, ): void;&#125; å‚è€ƒ]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeç¢Žç‰‡æ•´ç†ä¹‹æŒ‰å¦žäº¤äº’]]></title>
    <url>%2F2018%2F08%2F02%2FReactNative%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86%E4%B9%8B%E6%8C%89%E5%A6%9E%E4%BA%A4%E4%BA%92%2F</url>
    <content type="text"><![CDATA[ReactNativeçš„Buttonæ˜¯ä¸€ä¸ªç®€å•çš„è·¨å¹³å°æŒ‰é’®ç»„ä»¶ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›ç®€å•çš„å®šåˆ¶ï¼Œä½†æ˜¯æ”¯æŒçš„propsæœ‰é™ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨TouchableXXXä¸€ç³»åˆ—çš„ç»„ä»¶æ¥å®šåˆ¶æˆ‘ä»¬éœ€è¦çš„æŒ‰é’® Button123456789101112131415161718render() &#123; console.log('render') return ( &lt;View style=&#123;styles.content&#125;&gt; &lt;Button //æ³¨æ„ æ²¡æœ‰styleå±žæ€§ï¼Œè®¾ç½®æ— åµç”¨ style=&#123;&#123; backgroundColor:'#ffffff', color:"#00aaaa" &#125;&#125; onPress=&#123;() =&gt; Alert.alert('hello')&#125; // disabled=&#123;true&#125; title="click" color="#00a056" /&gt; &lt;/View&gt; )&#125; æŸ¥çœ‹Props props æè¿° å¿…å¡« onPress ç”¨æˆ·ç‚¹å‡»æ­¤æŒ‰é’®æ—¶æ‰€è°ƒç”¨çš„å¤„ç†å‡½æ•° æ˜¯ title æŒ‰é’®å†…æ˜¾ç¤ºçš„æ–‡æœ¬ æ˜¯ color æ–‡æœ¬çš„é¢œè‰²(iOS)ï¼Œæˆ–æ˜¯æŒ‰é’®çš„èƒŒæ™¯è‰²(Android) å¦ disabled è®¾ç½®ä¸º true æ—¶æ­¤æŒ‰é’®å°†ä¸å¯ç‚¹å‡»ã€‚ å¦ accessibilityLabel ç”¨äºŽç»™æ®‹éšœäººå£«æ˜¾ç¤ºçš„æ–‡æœ¬ å¦ testID ç”¨æ¥åœ¨ç«¯åˆ°ç«¯æµ‹è¯•ä¸­å®šä½æ­¤è§†å›¾ã€‚ å¦ é€šè¿‡ä¸Šé¢çš„å±žæ€§è¡¨æ ¼ï¼Œå¹¶æ²¡æœ‰styleå±žæ€§ï¼ˆå¯ä»¥å¤–éƒ¨åŒ…ä¸€å±‚Viewæ¥å®šåˆ¶ï¼‰ï¼Œå¯ä»¥çŸ¥é“è¿™ä¸ªButtonçš„ç»„ä»¶çš„æ ·å¼æ˜¯æœ‰å±€é™çš„ï¼Œå¹¶ä¸”colorå±žæ€§ï¼Œä¸¤ç«¯å¹¶ä¸ç»Ÿä¸€ï¼ˆä¸€ä¸ªæ˜¯æ–‡æœ¬é¢œè‰²ï¼Œä¸€ä¸ªæ˜¯èƒŒæ™¯è‰²ï¼‰ï¼Œä½¿ç”¨éžå¸¸ç®€å•ï¼Œä¸å†ä»£ç æ¼”ç¤ºäº†ã€‚ TouchableXXXç³»åˆ—ç»„ä»¶TouchableXXXç³»åˆ—ç»„ä»¶æœ‰ä»¥ä¸‹å››ç§ï¼š åç§° æè¿° TouchableWithoutFeedback å“åº”ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¦‚æžœä½ æƒ³åœ¨å¤„ç†ç‚¹å‡»äº‹ä»¶çš„åŒæ—¶ä¸æ˜¾ç¤ºä»»ä½•è§†è§‰åé¦ˆï¼Œä½¿ç”¨å®ƒæ˜¯ä¸ªä¸é”™çš„é€‰æ‹© TouchableHighlight åœ¨TouchableWithoutFeedbackçš„åŸºç¡€ä¸Šæ·»åŠ äº†å½“æŒ‰ä¸‹æ—¶èƒŒæ™¯ä¼šå˜æš—çš„æ•ˆæžœï¼Œå¯ä»¥æŒ‡å®šæŒ‰ä¸‹æŠ¬èµ·çš„é¢œè‰²ç­‰ã€‚ TouchableOpacity ç›¸æ¯”TouchableHighlightåœ¨æŒ‰ä¸‹åŽ»ä¼šä½¿èƒŒæ™¯å˜æš—çš„æ•ˆæžœï¼ŒTouchableOpacityä¼šåœ¨ç”¨æˆ·æ‰‹æŒ‡æŒ‰ä¸‹æ—¶é™ä½ŽæŒ‰é’®çš„é€æ˜Žåº¦ï¼Œè€Œä¸ä¼šæ”¹å˜èƒŒæ™¯çš„é¢œè‰²ã€‚ TouchableNativeFeedback åœ¨Androidä¸Šè¿˜å¯ä»¥ä½¿ç”¨TouchableNativeFeedbackï¼Œå®ƒä¼šåœ¨ç”¨æˆ·æ‰‹æŒ‡æŒ‰ä¸‹æ—¶å½¢æˆç±»ä¼¼æ°´æ³¢çº¹çš„è§†è§‰æ•ˆæžœã€‚æ³¨æ„ï¼Œæ­¤ç»„ä»¶åªæ”¯æŒAndroidã€‚ å››è€…çš„å…³ç³»ï¼Ÿ 1234567891011121314//TouchableHighlightvar TouchableHighlight = React.createClass(&#123; propTypes: &#123; ...TouchableWithoutFeedback.propTypes,//TouchableOpacityvar TouchableOpacity = React.createClass(&#123; mixins: [TimerMixin, Touchable.Mixin, NativeMethodsMixin], propTypes: &#123; ...TouchableWithoutFeedback.propTypes,//TouchableNativeFeedbackvar TouchableNativeFeedback = React.createClass(&#123; propTypes: &#123; ...TouchableWithoutFeedback.propTypes, å¯ä»¥çœ‹å‡ºï¼š å› ä¸ºTouchableWithoutFeedbackæœ‰å…¶å®ƒä¸‰ä¸ªç»„ä»¶çš„å…±åŒå±žæ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸€ä¸‹TouchableWithoutFeedbackã€‚ æŽ¥ä¸‹æ¥åˆ†åˆ«è®°å½•çš„å…·ä½“ä½¿ç”¨ æ³¨æ„ä¸€ç‚¹ï¼š æ— è®ºæ˜¯TouchableWithoutFeedbackè¿˜æ˜¯å…¶ä»–ä¸‰ç§Touchableç»„ä»¶ï¼Œéƒ½æ˜¯åœ¨æ ¹èŠ‚ç‚¹éƒ½æ˜¯åªæ”¯æŒä¸€ä¸ªç»„ä»¶ï¼Œå¦‚æžœä½ éœ€è¦å¤šä¸ªç»„ä»¶åŒæ—¶ç›¸åº”å•å‡»äº‹ä»¶ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªViewå°†å®ƒä»¬åŒ…è£¹ç€ï¼Œå®ƒçš„è¿™ç§æ ¹èŠ‚ç‚¹åªæ”¯æŒä¸€ä¸ªç»„ä»¶çš„ç‰¹æ€§å’ŒScrollViewå¾ˆç±»ä¼¼ã€‚ TouchableWithoutFeedbackä¸€ä¸ªTouchableç³»åˆ—ç»„ä»¶ä¸­æœ€åŸºæœ¬çš„ä¸€ä¸ªç»„ä»·ï¼Œåªå“åº”ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶ä¸ä¼šåšä»»ä½•UIä¸Šçš„æ”¹å˜ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­éœ€è¦ç‰¹åˆ«ç•™æ„ã€‚ ä½¿ç”¨è¯¦æƒ…è¯¦æƒ…ç‚¹å‡»æŸ¥çœ‹ï¼šä¸­æ–‡ç½‘TouchableWithoutFeedback React NativeæŒ‰é’®è¯¦è§£|Touchableç³»åˆ—ç»„ä»¶ä½¿ç”¨è¯¦è§£ æ•´ä½“æ¥è¯´ TouchableWithoutFeedbackï¼šæ— uiå˜åŒ– TouchableHighlightï¼šå®šåˆ¶ç¨‹åº¦è¾ƒé«˜ï¼Œé€æ˜Žåº¦ï¼ŒæŒ‰ä¸‹æŠ¬èµ·é¢œè‰²ç­‰ TouchableOpacityï¼šåªæœ‰é€æ˜Žåº¦åé¦ˆ TouchableNativeFeedbackï¼šæ”¯æŒAndroid 5.0ä»¥ä¸Šçš„Ripperæ•ˆæžœï¼Œä»…æ”¯æŒAndroidè®¾å¤‡ è‡ªå®šä¹‰ButtonGithubåœ°å€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136import React, &#123;Component&#125; from 'react'import &#123; View, Text, StyleSheet, TouchableHighlight,&#125; from 'react-native'// default propsconst backgroundColor = '#000000';const pressBackgroundColor = backgroundColor;const textColor = '#FFFFFF';const pressTextColor = textColor;export default class CommonButton extends Component &#123; // æž„é€  constructor(props) &#123; super(props); // åˆå§‹çŠ¶æ€ this.state = &#123; //é»˜è®¤æ–‡å­— text: this.props.text, //æ˜¯å¦ä¸å¯ç”¨ disabled: false, //æ˜¯å¦æŒ‰ä¸‹ pressed: false, &#125;; this._onPressIn = this._onPressIn.bind(this) this._onPressOut = this._onPressOut.bind(this) &#125; static defaultProps = &#123; //èƒŒæ™¯é¢œè‰² backgroundColor: backgroundColor, //æŒ‰ä¸‹èƒŒæ™¯è‰² pressBackgroundColor: pressBackgroundColor, //æ–‡å­—è‰² textColor: textColor, //æŒ‰ä¸‹æ–‡å­—è‰² pressTextColor: pressTextColor, //æ–‡å­—å¤§å° fontSize: 17, //åœ†è§’ radius: 0, // onPress onPressFunc: null, //onLongPress onLongPressFunc: null, //padding paddingLeft: 0, paddingRight: 0, paddingTop: 0, paddingBottom: 0, //text text: 'æ²¡æœ‰è®¾å®š', width: undefined, height: undefined &#125; setDisabled(isDisabled) &#123; this.setState(&#123; disabled: true, &#125;) &#125; setButtonText(newText) &#123; this.setState(&#123; text: newText, &#125;) &#125; _onPressIn() &#123; this.setState(&#123; pressed: true, &#125;) &#125; _onPressOut() &#123; this.setState(&#123; pressed: false, &#125;) &#125; render() &#123; return ( &lt;View&gt; &lt;TouchableHighlight style=&#123;&#123; width: this.props.width, height: this.props.height, justifyContent: 'center', alignItems: 'center', backgroundColor: this.props.backgroundColor, paddingLeft: this.props.paddingLeft, paddingRight: this.props.paddingRight, paddingTop: this.props.paddingTop, paddingBottom: this.props.paddingBottom, borderRadius: 8, &#125;&#125; activeOpacity=&#123;1&#125; // åº•å±‚çš„é¢œè‰²è¢«éšè—çš„æ—¶å€™è°ƒç”¨ã€‚ onHideUnderlay=&#123;null&#125; //å½“åº•å±‚çš„é¢œè‰²è¢«æ˜¾ç¤ºçš„æ—¶å€™è°ƒç”¨ã€‚ onShowUnderlay=&#123;null&#125; // æœ‰è§¦æ‘¸æ“ä½œæ—¶æ˜¾ç¤ºå‡ºæ¥çš„åº•å±‚çš„é¢œè‰²ã€‚ underlayColor=&#123;this.props.pressBackgroundColor&#125; //disable disabled=&#123;this.state.disabled&#125; //onPressIn onPressIn=&#123;this._onPressIn&#125; //onPressOut onPressOut=&#123;this._onPressOut&#125; //onPress onPress=&#123;this.props.onPressFunc&#125; //onLongPress onLongPress=&#123;this.props.onLongPressFunc&#125; &gt; &lt;View&gt; &lt;Text style=&#123;&#123; //æ–‡å­—é¢œè‰² color: this.state.pressed ? this.props.pressTextColor : this.props.textColor, fontSize: this.props.fontSize &#125;&#125;&gt; &#123;this.state.text&#125; &lt;/Text&gt; &lt;/View&gt; &lt;/TouchableHighlight&gt; &lt;/View&gt; ) &#125;&#125;const styls = StyleSheet.create(&#123; content: &#123;&#125;&#125;) å˜»å˜»(o^^o)]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeç¢Žç‰‡æ•´ç†ä¹‹ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ]]></title>
    <url>%2F2018%2F08%2F01%2FReactNative%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86%E4%B9%8B%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%2F</url>
    <content type="text"><![CDATA[ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€å®šè¦çŸ¥é“çš„ï¼Œè¿™æ ·æ‰çŸ¥é“æ•´ä¸ªç»„ä»¶çš„å·¥ä½œæµç¨‹ï¼ŒçŸ¥é“å“ªäº›æ“ä½œé€‚åˆåœ¨å“ªä¸ªå›žè°ƒä¸­è¿›è¡Œâ€¦â€¦(o^^o) ä¸€ä¸ªæ —å­123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125import React, &#123;Component&#125; from 'react';import &#123; View, Text, StyleSheet,&#125; from 'react-native';export default class App extends Component&lt;Props&gt; &#123; /** * æž„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–éœ€è¦çš„state * @param props */ constructor(props) &#123; super(props); console.log('constructor') // åˆå§‹çŠ¶æ€ this.state = &#123; result: 'ç‚¹å‡»å‰', &#125;; &#125; /** * æè¿°ï¼šæŽ§ä»¶æ¸²æŸ“å‰è§¦å‘ * æ¬¡æ•°ï¼šä¸€æ¬¡ * æŽ¨èï¼š */ componentWillMount() &#123; console.log('componentWillMount') &#125; /** * æè¿°ï¼šæŽ§ä»¶æ¸²æŸ“åŽè§¦å‘ * æ¬¡æ•°ï¼šä¸€æ¬¡ * æŽ¨èï¼š */ componentDidMount() &#123; console.log('componentDidMount') &#125; /** * æè¿°ï¼šç»„ä»¶æŽ¥æ”¶åˆ°æ–°çš„propsæ—¶è¢«è°ƒç”¨ * æ¬¡æ•°ï¼šå¤šæ¬¡ * æŽ¨èï¼š */ componentWillReceiveProps() &#123; console.log('componentWillReceiveProps') &#125; /** * æè¿°ï¼šå½“ç»„ä»¶æŽ¥æ”¶åˆ°æ–°çš„propså’Œstateæ—¶è¢«è°ƒç”¨ * æ¬¡æ•°ï¼šå¤šæ¬¡ * æŽ¨èï¼š */ shouldComponentUpdate() &#123; console.log('shouldComponentUpdate') return true; &#125; /** * æè¿°ï¼šç»„ä»¶é‡æ–°æ¸²æŸ“å®ŒæˆåŽä¼šè°ƒç”¨æ­¤æ–¹æ³• * æ¬¡æ•°ï¼šå¤šæ¬¡ * æŽ¨èï¼š */ componentDidUpdate() &#123; console.log('componentDidUpdate') &#125; /** * æè¿°ï¼šæŽ§ä»¶æ¸²æŸ“åŽè§¦å‘ * æ¬¡æ•°ï¼š1æ¬¡ * æŽ¨èï¼š */ componentDidMount() &#123; console.log('componentDidMount') &#125; /** * æè¿°ï¼šç»„ä»¶å¸è½½å’Œé”€æ¯ä¹‹å‰è¢«è°ƒç”¨ * æ¬¡æ•°ï¼šä¸€æ¬¡ * æŽ¨èï¼šç”¨äºŽæ¸…ç†ä¸€äº›æ— ç”¨çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼šå®šæ—¶å™¨æ¸…é™¤ */ componentWillUnmount() &#123; console.log('componentWillUnmount') &#125; componentWillUpdate() &#123; console.log('componentWillUpdate') &#125; render() &#123; console.log('render') return ( &lt;View style=&#123;styles.content&#125;&gt; &lt;Text style=&#123;styles.text&#125; onPress=&#123; () =&gt; &#123; this.setState(&#123; result: 'ç‚¹å‡»åŽ' &#125;) &#125; &#125;&gt; &#123;this.state.result&#125; &lt;/Text&gt; &lt;/View&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; content: &#123; flex: 1, justifyContent: 'center', alignItems: 'center', &#125;, text: &#123; padding: 50, fontSize: 20, color: '#ffffff', backgroundColor: '#00a056' &#125;&#125;) console 123456789constructorApp.js:39 componentWillMountApp.js:103 renderApp.js:86 componentDidMountApp.js:108 onPress callApp.js:66 shouldComponentUpdateApp.js:100 componentWillUpdateApp.js:103 renderApp.js:76 componentDidUpdate ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé€šè¿‡ä¸Šé¢çš„æ —å­ï¼Œæœ‰çµæ€§çš„å°å“¥å“¥å·²ç»åŸºæœ¬çŒœåˆ°å¤§è‡´çš„ç”Ÿå‘½å‘¨æœŸäº† ä¸‹é¢å†çœ‹çœ‹è¿™å¼ æˆ‘å·æ¥çš„å¸…å›¾ å†ç»“åˆè¿™å¼ é…·è¡¨ ç”Ÿå‘½å‘¨æœŸ è°ƒç”¨æ¬¡æ•° èƒ½å¦ä½¿ç”¨ setSate() æè¿° getDefaultPropsï¼ˆes6:static defaultPropsï¼‰ 1(å…¨å±€è°ƒç”¨ä¸€æ¬¡) å¦ åˆå§‹åŒ–é»˜è®¤å±žæ€§ getInitialState(es6:constructor(props)) 1 å¦ æž„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–éœ€è¦çš„state componentWillMount 1 æ˜¯ æŽ§ä»¶æ¸²æŸ“å‰è§¦å‘ render &gt;=1 å¦ æ¸²æŸ“æŽ§ä»¶çš„æ–¹æ³• componentDidMount 1 æ˜¯ æŽ§ä»¶æ¸²æŸ“åŽè§¦å‘ componentWillReceiveProps &gt;=0 æ˜¯ ç»„ä»¶æŽ¥æ”¶åˆ°æ–°çš„propsæ—¶è¢«è°ƒç”¨ shouldComponentUpdate &gt;=0 å¦ å½“ç»„ä»¶æŽ¥æ”¶åˆ°æ–°çš„propså’Œstateæ—¶è¢«è°ƒç”¨ componentWillUpdate &gt;=0 å¦ propsæˆ–è€…stateæ”¹å˜ï¼Œå¹¶ä¸”æ­¤å‰çš„shouldComponentUpdateæ–¹æ³•è¿”å›žä¸º trueä¼šè°ƒç”¨è¯¥æ–¹æ³• componentDidUpdate &gt;=0 å¦ ç»„ä»¶é‡æ–°æ¸²æŸ“å®ŒæˆåŽä¼šè°ƒç”¨æ­¤æ–¹æ³• å¦å¤–è¿˜æœ‰ä¸€ä¸ªåœºæ™¯éœ€è¦çŸ¥é“çš„ï¼Œä»£ç æˆ‘å°±ä¸è´´äº† çˆ¶ç»„ä»¶ä¸­æœ‰ä¸€ä¸ªå­ç»„ä»¶ï¼Œç‚¹å‡»çˆ¶ç»„ä»¶è°ƒç”¨setStateï¼Œé‚£ä¹ˆçˆ¶å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä½•å›žè°ƒï¼Ÿ 12345678910111213141516171819//åŠ è½½è¿‡ç¨‹constructorApp.js:42 componentWillMountApp.js:107 renderChildComponent.js:26 ChildComponent,constructorChildComponent.js:41 ChildComponent,componentWillMountChildComponent.js:106 ChildComponent,renderChildComponent.js:88 ChildComponent,componentDidMountApp.js:89 componentDidMount//ç‚¹å‡»åŽï¼Œè°ƒç”¨çˆ¶ç»„ä»¶çš„setStateåŽshouldComponentUpdateApp.js:103 componentWillUpdateApp.js:107 renderChildComponent.js:59 ChildComponent,componentWillReceivePropsChildComponent.js:68 ChildComponent,shouldComponentUpdateChildComponent.js:102 ChildComponent,componentWillUpdateChildComponent.js:106 ChildComponent,renderChildComponent.js:78 ChildComponent,componentDidUpdateApp.js:79 componentDidUpdate å¯ä»¥çœ‹åˆ°ï¼š ç»„ä»¶çš„åŠ è½½æ˜¯ä»Žå†…åˆ°å¤–ä¸€çº§ä¸€çº§çš„ï¼Œè¿™ä¸ªå’Œandroidç±»ä¼¼ ä¿®æ”¹çˆ¶ç»„ä»¶stateï¼Œè§¦å‘updateæ•´ä¸ªæµç¨‹ï¼Œä½†æ˜¯ä¸å†æ¬¡è§¦å‘å­ç»„ä»¶çš„constructor æŽ¨èçš„æ“ä½œ constructor()æ–¹æ³•é‡Œåˆå§‹åŒ–state static defaultPropsæŒ‡å®šé»˜è®¤å±žæ€§ componentDidMount()ï¼šè¯¥æ–¹æ³•åœ¨render()æ–¹æ³•åŽè‡ªåŠ¨è°ƒç”¨ï¼Œç½‘ç»œè¯·æ±‚ä¸€èˆ¬æ”¾åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ shouldComponentUpdate()ï¼šè¯¥æ–¹æ³•è¿”å›žä¸€ä¸ªbooleanå€¼ï¼Œç”¨æ¥å†³å®šæ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œé»˜è®¤è¿”å›žtrueï¼Œä½ å¯ä»¥è‡ªå·±é‡å†™æ­¤æ–¹æ³•ï¼Œé€šè¿‡æ¡ä»¶åˆ¤æ–­æ¥å†³å®šä½ æ˜¯å¦éœ€è¦æ›´æ–°ç»„ä»¶ componentWillUnmount()ï¼šåœ¨ç»„ä»¶è¢«ç§»é™¤å‰è°ƒç”¨ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé‡Šæ”¾ä¸€äº›ä¸éœ€è¦çš„èµ„æºï¼Œæ¯”å¦‚åœæ­¢å®šæ—¶å™¨ ä¸è¦åœ¨ constructor æˆ–è€… render é‡Œ setState() constructor å·²å« this.state={} render é‡Œ setState ä¼šé€ æˆsetState -&gt; render -&gt; setState -&gt; render èƒ½åšçš„setStateï¼Œåªè¦æ˜¯renderå‰ï¼Œå°±æ”¾åœ¨componentWillMountï¼ŒrenderåŽï¼Œå°±æ”¾åœ¨ componentDidMountã€‚é€™ä¸¤ä¸ª function æ˜¯ react lifecycle ä¸­ï¼Œæœ€å¸¸ä½¿ç”¨çš„ä¸¤ä¸ª æ›´å¤šä»¥åŽå†æ·»åŠ æ€»ç»“ å‚è€ƒReact-Nativeç”Ÿå‘½å‘¨æœŸçš„è§¦å‘åœºæ™¯å’Œä¸€äº›å°å»ºè®® React Native ä¸­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ React Nativeä¹‹Reacté€Ÿå­¦æ•™ç¨‹(ä¸­)/)]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeç¢Žç‰‡æ•´ç†ä¹‹ref]]></title>
    <url>%2F2018%2F08%2F01%2FReactNative%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86%E4%B9%8Bref%2F</url>
    <content type="text"><![CDATA[æ¦‚è¿° refå±žæ€§æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å±žæ€§ï¼Œå¯ä»¥æŠŠå®ƒæŒ‚è½½åˆ°ä»»ä½•ç»„ä»¶ å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå›žè°ƒå‡½æ•°ï¼ˆä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŸºæœ¬åºŸå¼ƒè¿™ç§ç”¨æ³•ï¼‰ è¿™ä¸ªå›žè°ƒå‡½æ•°åœ¨ç»„ä»¶è¢«æŒ‚è½½åŽç«‹å³è¢«æ‰§è¡Œï¼Œåº”ç”¨åˆ°çš„ç»„ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ å›žè°ƒå‡½æ•°å¯ä»¥ç«‹å³ä½¿ç”¨ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥å°†å‚æ•°çš„ç»„ä»¶å¼•ç”¨ä¿å­˜èµ·æ¥ï¼ŒåŽç»­ä½¿ç”¨ï¼ˆè°ƒç”¨ç»„ä»¶æ–¹æ³•æˆ–è€…èŽ·å–ç»„ä»¶å‚æ•°ï¼‰ refå±žæ€§æŒ‡å®šå›žè°ƒæ–¹æ³•æ —å­ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899import React, &#123;Component&#125; from 'react';import &#123; View, Text, StyleSheet,&#125; from 'react-native';export default class App extends Component&lt;Props&gt; &#123; // æž„é€  constructor(props) &#123; super(props); // åˆå§‹çŠ¶æ€ this.state = &#123; result: 'ç‚¹å‡»å‰' &#125;; &#125; render() &#123; return ( &lt;View style=&#123;styles.content&#125;&gt; &lt;Text style=&#123;styles.button&#125; onPress=&#123; () =&gt; &#123; this._Test.print() &#125; //() =&gt; &#123; // this.setState((prestate, props) =&gt; &#123; // console.warn("setState") // return &#123;result: 'ç‚¹å‡»äº†'&#125; // &#125;) &#125; &#125;&gt;&#123;this.state.result&#125;&lt;/Text&gt; &lt;RefTest ref=&#123; //æŒ‡å®šrefå±žæ€§çš„å›žè°ƒå‡½æ•° (e) =&gt; &#123; console.warn("refçš„å›žè°ƒæ‰§è¡Œäº†ï¼") //å‚æ•°eåˆ™ä¸ºå½“å‰RefTestç»„ä»¶çš„å¼•ç”¨ this._Test = e; &#125; &#125;&gt; &lt;/RefTest&gt; &lt;/View&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; content: &#123; flex: 1, backgroundColor: '#00a056', flexDirection: 'row' &#125;, button: &#123; padding: 30, backgroundColor: '#ffffff', fontSize: 17, alignSelf: 'center' &#125;, text: &#123; padding: 30, backgroundColor: '#ffffff', fontSize: 30, &#125;&#125;)class RefTest extends Component&lt;Props&gt; &#123; // æž„é€  constructor(props) &#123; super(props); // åˆå§‹çŠ¶æ€ this.state = &#123; data: 'old' &#125;; &#125; print() &#123; this.setState((preState, props) =&gt; &#123; return &#123; data: 'new' &#125; &#125;) console.warn("printæ–¹æ³•æ‰§è¡Œäº†ï¼š" + this.state.data) &#125; render() &#123; return ( &lt;View style=&#123;&#123; alignSelf: 'center', left: 10, backgroundColor: '#ffff00', &#125;&#125;&gt; &lt;Text style=&#123;styles.text&#125;&gt; å½“å‰æ•°æ®ï¼š&#123;this.state.data&#125; &lt;/Text&gt; &lt;/View&gt; ); &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼š çˆ¶ç»„ä»¶æ‹¥æœ‰çš„å­ç»„ä»¶ï¼Œå­ç»„ä»¶æœ‰refå±žæ€§ é¦–æ¬¡è¿›å…¥çš„æ—¶å€™ï¼Œç»„ä»¶åˆæ¬¡ç»‘å®š refçš„å›žè°ƒä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œçˆ¶ç»„ä»¶ä¿å­˜è¯¥å¼•ç”¨ ç‚¹å‡»åŽï¼Œä½¿ç”¨ç»„ä»¶å¼•ç”¨ï¼Œè°ƒç”¨ç»„ä»¶æ–¹æ³•print è‹¥ç‚¹å‡»åŽï¼Œçˆ¶ç»„ä»¶setStateï¼Œåˆ™å­ç»„ä»¶ å¸è½½åŽï¼Œé‡æ–°è°ƒç”¨å­ç»„ä»¶Rendï¼ˆï¼‰æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå­ç»„ä»¶çš„refå›žè°ƒä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ï¼ˆå¸è½½ä¸€æ¬¡ï¼ŒæŒ‚è½½ä¸€æ¬¡ï¼‰ éœ€è¦çŸ¥é“çš„ï¼š åœ¨çˆ¶ç»„ä»¶åœ¨å­ç»„ä»¶æŒ‡å®šrefçš„å›žè°ƒä¸­ä¿å­˜å¼•ç”¨å¯¹å­ç»„ä»¶çš„ è¿™ä¸ªå›žè°ƒåœ¨çˆ¶ç»„ä»¶æ¯æ¬¡setStateï¼ˆçˆ¶Renderï¼ˆï¼‰è°ƒç”¨ï¼‰ ç»„ä»¶çš„renderæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œrefæ‰ä¼šè¢«è°ƒç”¨ï¼Œç»„ä»¶æ‰ä¼šè¿”å›žref setStateæ¶‰åŠå…ˆå¸è½½ï¼ŒåŽæŒ‚è½½ï¼Œrefå›žè°ƒæ‰§è¡Œä¸¤æ¬¡]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeç¢Žç‰‡æ•´ç†ä¹‹æ ·å¼]]></title>
    <url>%2F2018%2F07%2F31%2FReactNative%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86%E4%B9%8B%E6%A0%B7%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ•´ç†React Nativeä¸­çš„å¸ƒå±€æ–¹å¼ï¼ŒFlexBoxå¼¹æ€§å¸ƒå±€çš„ä½¿ç”¨ å®½é«˜RNä¸­ï¼Œå°ºå¯¸æ˜¯æ²¡æœ‰å•ä½çš„ï¼Œå®ƒå·²ç»ä»£è¡¨äº†è®¾å¤‡ç‹¬ç«‹åƒç´  123&lt;View style=&#123; &#123;width:100,height:100,margin:40,backgroundColor:'gray'&#125;&#125;&gt; &lt;Text style=&#123; &#123;fontSize:16,margin:20&#125;&#125;&gt;å°ºå¯¸&lt;/Text&gt;&lt;/View&gt; è¿è¡Œåœ¨Androidä¸Šæ—¶ï¼ŒViewçš„é•¿å’Œå®½è¢«è§£é‡Šæˆï¼š100dp 100dpå•ä½æ˜¯dpï¼Œå­—ä½“è¢«è§£é‡Šæˆ16sp å•ä½æ˜¯spï¼Œè¿è¡Œåœ¨iOSä¸Šæ—¶å°ºå¯¸å•ä½è¢«è§£é‡Šç§°äº†ptï¼Œè¿™äº›å•ä½ç¡®ä¿äº†å¸ƒå±€åœ¨ä»»ä½•ä¸åŒdpiçš„æ‰‹æœºå±å¹•ä¸Šæ˜¾ç¤ºä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼› RNå’ŒWeb cssä¸Šçš„FlexBoxçš„åŒºåˆ« flexDirection: React Nativeä¸­é»˜è®¤ä¸ºflexDirection:&#39;column&#39;ï¼Œåœ¨Web CSSä¸­é»˜è®¤ä¸ºflex-direction:&#39;row&#39; alignItems: React Nativeä¸­é»˜è®¤ä¸ºalignItems:&#39;stretch&#39;ï¼Œåœ¨Web CSSä¸­é»˜è®¤align-items:&#39;flex-start&#39; flex: ç›¸æ¯”Web CSSçš„flexæŽ¥å—å¤šå‚æ•°ï¼Œå¦‚:flex: 2 2 10%;ï¼Œä½†åœ¨ React Nativeä¸­flexåªæŽ¥å—ä¸€ä¸ªå‚æ•° ä¸æ”¯æŒå±žæ€§ï¼šalign-contentï¼Œflex-basisï¼Œorderï¼Œflex-basisï¼Œflex-flowï¼Œflex-growï¼Œflex-shrink ä»¥ä¸Šæ˜¯React Nativeä¸­çš„FlexBox å’ŒWeb CSSSä¸ŠFlexBoxçš„ä¸åŒä¹‹å¤„ï¼Œè®°ä½è¿™å‡ ç‚¹ï¼Œä½ å¯ä»¥åƒåœ¨Web CSSSä¸Šä½¿ç”¨FlexBoxä¸€æ ·ï¼Œåœ¨React Nativeä¸­ä½¿ç”¨FlexBoxã€‚ Layout Propsçˆ¶è§†å›¾å±žæ€§ï¼ˆå®¹å™¨å±žæ€§ï¼‰ï¼š flexDirection enum(â€˜rowâ€™, â€˜columnâ€™,â€™row-reverseâ€™,â€™column-reverseâ€™) flexWrap enum(â€˜wrapâ€™, â€˜nowrapâ€™) justifyContent enum(â€˜flex-startâ€™, â€˜flex-endâ€™, â€˜centerâ€™, â€˜space-betweenâ€™, â€˜space-aroundâ€™) alignItems enum(â€˜flex-startâ€™, â€˜flex-endâ€™, â€˜centerâ€™, â€˜stretchâ€™) å­¦ä¹ çˆ¶å®¹å™¨å±žæ€§ä¹‹å‰ï¼Œå…ˆå­¦ä¹ ä¸‹åŸºæœ¬æ¦‚å¿µ å’ŒWebçš„Cssä¸åŒçš„æ˜¯ï¼ŒRNçš„Flexboxé»˜è®¤çš„ä¸»è½´æ˜¯ ç«–ç›´çš„ï¼ˆcolumnï¼‰ flexDirectionflexDirection enum(&#39;row&#39;, &#39;column&#39;,&#39;row-reverse&#39;,&#39;column-reverse&#39;)flexDirectionå±žæ€§å®šä¹‰äº†çˆ¶è§†å›¾ä¸­çš„å­å…ƒç´ æ²¿æ¨ªè½´æˆ–ä¾§è½´æ–¹ç‰‡çš„æŽ’åˆ—æ–¹å¼ã€‚ row: ä»Žå·¦å‘å³ä¾æ¬¡æŽ’åˆ— row-reverse: ä»Žå³å‘å·¦ä¾æ¬¡æŽ’åˆ— column(default): é»˜è®¤çš„æŽ’åˆ—æ–¹å¼ï¼Œä»Žä¸Šå‘ä¸‹æŽ’åˆ— column-reverse: ä»Žä¸‹å‘ä¸ŠæŽ’åˆ— flexWrapflexWrap enum(&#39;wrap&#39;, &#39;nowrap&#39;)flexWrapå±žæ€§å®šä¹‰äº†å­å…ƒç´ åœ¨çˆ¶è§†å›¾å†…æ˜¯å¦å…è®¸å¤šè¡ŒæŽ’åˆ—ï¼Œé»˜è®¤ä¸ºnowrapã€‚ nowrap flexçš„å…ƒç´ åªæŽ’åˆ—åœ¨ä¸€è¡Œä¸Šï¼Œå¯èƒ½å¯¼è‡´æº¢å‡ºã€‚ wrap flexçš„å…ƒç´ åœ¨ä¸€è¡ŒæŽ’åˆ—ä¸ä¸‹æ—¶ï¼Œå°±è¿›è¡Œå¤šè¡ŒæŽ’åˆ—ã€‚ justifyContentjustifyContent enum(&#39;flex-start&#39;, &#39;flex-end&#39;, &#39;center&#39;, &#39;space-between&#39;, &#39;space-around&#39;)justifyContentå±žæ€§å®šä¹‰äº†æµè§ˆå™¨å¦‚ä½•åˆ†é…é¡ºç€çˆ¶å®¹å™¨ä¸»è½´çš„å¼¹æ€§ï¼ˆflexï¼‰å…ƒç´ ä¹‹é—´åŠå…¶å‘¨å›´çš„ç©ºé—´ï¼Œé»˜è®¤ä¸ºflex-startã€‚ flex-start(default) ä»Žè¡Œé¦–å¼€å§‹æŽ’åˆ—ã€‚æ¯è¡Œç¬¬ä¸€ä¸ªå¼¹æ€§å…ƒç´ ä¸Žè¡Œé¦–å¯¹é½ï¼ŒåŒæ—¶æ‰€æœ‰åŽç»­çš„å¼¹æ€§å…ƒç´ ä¸Žå‰ä¸€ä¸ªå¯¹é½ã€‚ flex-end ä»Žè¡Œå°¾å¼€å§‹æŽ’åˆ—ã€‚æ¯è¡Œæœ€åŽä¸€ä¸ªå¼¹æ€§å…ƒç´ ä¸Žè¡Œå°¾å¯¹é½ï¼Œå…¶ä»–å…ƒç´ å°†ä¸ŽåŽä¸€ä¸ªå¯¹é½ã€‚ center ä¼¸ç¼©å…ƒç´ å‘æ¯è¡Œä¸­ç‚¹æŽ’åˆ—ã€‚æ¯è¡Œç¬¬ä¸€ä¸ªå…ƒç´ åˆ°è¡Œé¦–çš„è·ç¦»å°†ä¸Žæ¯è¡Œæœ€åŽä¸€ä¸ªå…ƒç´ åˆ°è¡Œå°¾çš„è·ç¦»ç›¸åŒã€‚ space-between åœ¨æ¯è¡Œä¸Šå‡åŒ€åˆ†é…å¼¹æ€§å…ƒç´ ã€‚ç›¸é‚»å…ƒç´ é—´è·ç¦»ç›¸åŒã€‚æ¯è¡Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸Žè¡Œé¦–å¯¹é½ï¼Œæ¯è¡Œæœ€åŽä¸€ä¸ªå…ƒç´ ä¸Žè¡Œå°¾å¯¹é½ã€‚ space-around åœ¨æ¯è¡Œä¸Šå‡åŒ€åˆ†é…å¼¹æ€§å…ƒç´ ã€‚ç›¸é‚»å…ƒç´ é—´è·ç¦»ç›¸åŒã€‚æ¯è¡Œç¬¬ä¸€ä¸ªå…ƒç´ åˆ°è¡Œé¦–çš„è·ç¦»å’Œæ¯è¡Œæœ€åŽä¸€ä¸ªå…ƒç´ åˆ°è¡Œå°¾çš„è·ç¦»å°†ä¼šæ˜¯ç›¸é‚»å…ƒç´ ä¹‹é—´è·ç¦»çš„ä¸€åŠã€‚ alignItemsalignItems enum(&#39;flex-start&#39;, &#39;flex-end&#39;, &#39;center&#39;, &#39;stretch&#39;)alignItemså±žæ€§ä»¥ä¸Žjustify-contentç›¸åŒçš„æ–¹å¼åœ¨ä¾§è½´æ–¹å‘ä¸Šå°†å½“å‰è¡Œä¸Šçš„å¼¹æ€§å…ƒç´ å¯¹é½ï¼Œé»˜è®¤ä¸ºstretch å­è§†å›¾å±žæ€§ï¼ˆè§„èŒƒè‡ªå·±çš„ï¼‰alignSelfalignSelf enum(&#39;auto&#39;, &#39;flex-start&#39;, &#39;flex-end&#39;, &#39;center&#39;, &#39;stretch&#39;)alignSelfå±žæ€§ä»¥å±žæ€§å®šä¹‰äº†flexå®¹å™¨å†…è¢«é€‰ä¸­é¡¹ç›®çš„å¯¹é½æ–¹å¼ã€‚æ³¨æ„ï¼šalignSelf å±žæ€§å¯é‡å†™çµæ´»å®¹å™¨çš„ alignItems å±žæ€§ã€‚ auto(default) å…ƒç´ ç»§æ‰¿äº†å®ƒçš„çˆ¶å®¹å™¨çš„ align-items å±žæ€§ã€‚å¦‚æžœæ²¡æœ‰çˆ¶å®¹å™¨åˆ™ä¸º â€œstretchâ€ã€‚ stretch å…ƒç´ è¢«æ‹‰ä¼¸ä»¥é€‚åº”å®¹å™¨ã€‚ center å…ƒç´ ä½äºŽå®¹å™¨çš„ä¸­å¿ƒã€‚ flex-start å…ƒç´ ä½äºŽå®¹å™¨çš„å¼€å¤´ã€‚ flex-end å…ƒç´ ä½äºŽå®¹å™¨çš„ç»“å°¾ã€‚ flexflex numberflex å±žæ€§å®šä¹‰äº†ä¸€ä¸ªå¯ä¼¸ç¼©å…ƒç´ çš„èƒ½åŠ›ï¼Œé»˜è®¤ä¸º0ã€‚ å…¶ä»–å±žæ€§ä»¥ä¸‹å±žæ€§æ˜¯React Nativeæ‰€æ”¯æŒçš„é™¤Flexä»¥å¤–çš„å…¶å®ƒå¸ƒå±€å±žæ€§ã€‚ è§†å›¾è¾¹æ¡†å°ºå¯¸å†…éƒ¨è¾¹è·å¤–è¾¹è·è¾¹ç¼˜å®šä½(position)position enum(â€˜absoluteâ€™, â€˜relativeâ€™)å±žæ€§è®¾ç½®å…ƒç´ çš„å®šä½æ–¹å¼ï¼Œä¸ºå°†è¦å®šä½çš„å…ƒç´ å®šä¹‰å®šä½è§„åˆ™ã€‚ absoluteï¼šç”Ÿæˆç»å¯¹å®šä½çš„å…ƒç´ ï¼Œå…ƒç´ çš„ä½ç½®é€šè¿‡ â€œleftâ€, â€œtopâ€, â€œrightâ€ ä»¥åŠ â€œbottomâ€ å±žæ€§è¿›è¡Œè§„å®šã€‚(ç›¸å¯¹äºŽçˆ¶å¸ƒå±€çš„ä½ç½®)ï¼ˆæ³¨æ„ï¼šå¿½ç•¥çˆ¶ç»„ä»¶çš„paddingï¼Œé»˜è®¤ç›´æŽ¥åœ¨çˆ¶ç»„ä»¶çš„å·¦ä¸Šè§’ï¼Œé™¤éžè®¾ç½®å½“å‰ç»„ä»¶çš„leftï¼Œtopï¼Œrightï¼Œbottom,æˆ–è€…marginä¹‹ç±»çš„ï¼‰ relativeï¼šç”Ÿæˆç›¸å¯¹å®šä½çš„å…ƒç´ ï¼Œç›¸å¯¹äºŽå…¶æ­£å¸¸ä½ç½®è¿›è¡Œå®šä½ã€‚å› æ­¤ï¼Œâ€left:20â€ ä¼šå‘å…ƒç´ çš„ LEFT ä½ç½®æ·»åŠ  20 åƒç´ ã€‚ï¼ˆç›¸å¯¹äºŽè‡ªèº«æœ¬åº”è¯¥åœ¨çš„ä½ç½®ï¼‰ ä¾‹å­1: 123456789101112131415161718192021222324252627282930313233343536373839render() &#123; return ( &lt;View style=&#123;&#123; flex: 1, justifyContent: 'center', &#125;&#125;&gt; &lt;TouchableOpacity onPress=&#123;this.loadData&#125;&gt; &lt;View style=&#123;styles.container&#125;&gt; &lt;Image style=&#123;styles.header&#125;/&gt; &lt;Text style=&#123;styles.name&#125;&gt;absolute&lt;/Text&gt; &lt;/View&gt; &lt;/TouchableOpacity&gt; &lt;/View&gt; ); &#125; const styles = StyleSheet.create(&#123; container: &#123; flexDirection: 'row', paddingLeft: 15, paddingRight: 15, paddingTop: 10, paddingBottom: 10, backgroundColor: '#999999' &#125;, header: &#123; width: 100, height: 100, backgroundColor: '#00a056' &#125;, name: &#123; position: 'relative', // left: 15, alignSelf: 'flex-start', fontSize: 13, backgroundColor: '#ffff00', color: '#999999' &#125;&#125;); å‚è€ƒï¼šReact Nativeå¸ƒå±€è¯¦ç»†æŒ‡å—]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeç¢Žç‰‡æ•´ç†ä¹‹ç½‘ç»œè¯·æ±‚]]></title>
    <url>%2F2018%2F07%2F30%2FReactNative%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86%E4%B9%8B%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%2F</url>
    <content type="text"><![CDATA[React Native ä¸­è™½ç„¶ä¹Ÿå†…ç½®äº†XMLHttpRequest ç½‘ç»œè¯·æ±‚Apiï¼ˆä¹Ÿå°±æ˜¯ajaxï¼‰ï¼Œä½†XMLHttpRequest æ˜¯ä¸€ä¸ªè®¾è®¡ç²—ç³™çš„APIï¼Œä¸ç¬¦åˆèŒè´£åˆ†ç¦»çš„åŽŸåˆ™ï¼Œé…ç½®å’Œè°ƒç”¨æ–¹å¼æ¯”è¾ƒæ··ä¹±ï¼Œè€Œä¸”åŸºäºŽäº‹ä»¶çš„å¼‚æ­¥æ¨¡åž‹ä¸å¦‚çŽ°ä»£çš„Promiseå‹å¥½ã€‚æ‰€ä»¥ï¼ŒReact Nativeå®˜æ–¹æŽ¨èä½¿ç”¨Fetch Api FetchåŸºæœ¬ä½¿ç”¨æœ€ç®€å•çš„ä½¿ç”¨ å¦‚æžœåªæ˜¯è¯·æ±‚ä¸€ä¸‹æœåŠ¡å™¨ï¼Œä¸éœ€è¦ä»»ä½•æ“ä½œ 1fetch('http://chenxiaoping.com/demo')æ·»åŠ è¯·æ±‚å¤´ æ·»åŠ è¯·æ±‚å¤´å’Œè¯·æ±‚å‚æ•°ï¼ˆæœåŠ¡ç«¯æ”¯æŒjsonå‚æ•°ï¼‰ 1234567891011fetch('https://mywebsite.com/endpoint/', &#123; method: 'POST', headers: &#123; 'Accept': 'application/json', 'Content-Type': 'application/json', &#125;, body: JSON.stringify(&#123; firstParam: 'yourValue', secondParam: 'yourOtherValue', &#125;)&#125;) æ·»åŠ è¯·æ±‚å¤´å’Œè¯·æ±‚å‚æ•°ï¼ˆæœåŠ¡ç«¯ä¸æ”¯æŒjsonå‚æ•°ï¼‰ 1234567fetch('https://mywebsite.com/endpoint/', &#123; method: 'POST', headers: &#123; 'Content-Type': 'application/x-www-form-urlencoded', &#125;, body: 'key1=value1&amp;key2=value2'&#125;) Responseå¯¹è±¡å‚æ•°è§£æžResponseå¯¹è±¡ä¸­åŒ…å«äº†å¤šç§å±žæ€§ï¼š status (number) ï¼š HTTPè¯·æ±‚çš„å“åº”çŠ¶æ€è¡Œã€‚ statusText (String) ï¼š æœåŠ¡å™¨è¿”å›žçš„çŠ¶æ€æŠ¥å‘Šã€‚ ok (boolean) ï¼šå¦‚æžœè¿”å›ž200è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œåˆ™ä¸ºtrueã€‚ headers (Headers) ï¼š è¿”å›žå¤´éƒ¨ä¿¡æ¯ã€‚ url (String) ï¼šè¯·æ±‚çš„åœ°å€ã€‚ Responseå¯¹è±¡è¿˜æä¾›äº†å¤šç§æ–¹æ³•ï¼š formData()ï¼šè¿”å›žä¸€ä¸ªå¸¦æœ‰FormDataçš„Promiseã€‚ json() ï¼šè¿”å›žä¸€ä¸ªå¸¦æœ‰JSONå¯¹è±¡çš„Promiseã€‚ text()ï¼šè¿”å›žä¸€ä¸ªå¸¦æœ‰æ–‡æœ¬çš„Promiseã€‚ clone() ï¼šå¤åˆ¶ä¸€ä»½responseã€‚ error()ï¼šè¿”å›žä¸€ä¸ªä¸Žç½‘ç»œç›¸å…³çš„é”™è¯¯ã€‚ redirect()ï¼šè¿”å›žäº†ä¸€ä¸ªå¯ä»¥é‡å®šå‘è‡³æŸURLçš„responseã€‚ arrayBuffer()ï¼šè¿”å›žä¸€ä¸ªå¸¦æœ‰ArrayBufferçš„Promiseã€‚ blob() ï¼š è¿”å›žä¸€ä¸ªå¸¦æœ‰Blobçš„Promiseã€‚ è§£æžjsonå’Œä¿®æ”¹jsonæ•°æ® 12345678910111213141516loadData() &#123; return fetch('https://facebook.github.io/react-native/movies.json',) .then((response) =&gt; response.json()) .then((json) =&gt; &#123; json['description']='hello' Alert.alert(json.description) &#125;) .catch((error) =&gt; &#123; this.setState(() =&gt; &#123; return &#123; buttonText: 'doLoad', &#125; &#125;); console.error(error); &#125;) &#125; responseï¼š 1234567891011&#123; "title": "The Basics - Networking", "description": "Your app fetched this from a remote endpoint!", "movies": [ &#123; "id": "1", "title": "Star Wars", "releaseYear": "1977" &#125;, &#123; "id": "2", "title": "Back to the Future", "releaseYear": "1985" &#125;, &#123; "id": "3", "title": "The Matrix", "releaseYear": "1999" &#125;, &#123; "id": "4", "title": "Inception", "releaseYear": "2010" &#125;, &#123; "id": "5", "title": "Interstellar", "releaseYear": "2014" &#125; ]&#125; å¯ä»¥çœ‹åˆ°å¼¹çª—ä¸ºâ€˜helloâ€™ è¶…æ—¶1fetch(input, init).then(function(response) &#123; ... &#125;); å‚æ•° input å®šä¹‰è¦èŽ·å–çš„èµ„æºã€‚è¿™å¯èƒ½æ˜¯ï¼š ä¸€ä¸ª USVString å­—ç¬¦ä¸²ï¼ŒåŒ…å«è¦èŽ·å–èµ„æºçš„ URLã€‚ ä¸€ä¸ª Request å¯¹è±¡ã€‚ init å¯é€‰ ä¸€ä¸ªé…ç½®é¡¹å¯¹è±¡ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¯¹è¯·æ±‚çš„è®¾ç½®ã€‚å¯é€‰çš„å‚æ•°æœ‰ï¼š method: è¯·æ±‚ä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚ GETã€POSTã€‚ headers: è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼Œå½¢å¼ä¸º Headers å¯¹è±¡æˆ– ByteStringã€‚ body: è¯·æ±‚çš„ body ä¿¡æ¯ï¼šå¯èƒ½æ˜¯ä¸€ä¸ª Blobã€BufferSourceã€FormDataã€URLSearchParams æˆ–è€… USVString å¯¹è±¡ã€‚æ³¨æ„ GET æˆ– HEAD æ–¹æ³•çš„è¯·æ±‚ä¸èƒ½åŒ…å« body ä¿¡æ¯ã€‚ mode: è¯·æ±‚çš„æ¨¡å¼ï¼Œå¦‚ corsã€ no-cors æˆ–è€… same-originã€‚ credentials: è¯·æ±‚çš„ credentialsï¼Œå¦‚ omitã€same-origin æˆ–è€… includeã€‚ cache: è¯·æ±‚çš„ cache æ¨¡å¼: default, no-store, reload, no-cache, force-cache, or only-if-cached. æ ¹æœ¬æ‰¾ä¸åˆ° timeout é…ç½® 1234567891011121314151617// è¶…æ—¶ç‰ˆçš„fetch _fetch(fetch, timeout) &#123; return Promise.race([ fetch, new Promise(function (resolve, reject) &#123; setTimeout(() =&gt; reject(new Error('request timeout')), timeout); &#125;) ]); &#125; // ä½¿ç”¨ _fetch(fetch('url'), 1000).then((info)=&gt; &#123; return info.text(); &#125;).then((info)=&gt; &#123; console.log(info); &#125;).catch((err)=&gt; &#123; throw new Error(err); &#125;); ä»£ç ä¸­ç”¨Promise.race()å°†fetchå’Œä¸€ä¸ªæ–°çš„PromiseåŒ…è£…åœ¨äº†ä¸€èµ·,æ–°çš„Promiseå’Œfetchè°çŽ‡å…ˆè¿”å›žå°±æŠŠè¯¥Promiseå®žä¾‹è¿”å›žå€¼ä¼ é€’ç»™ä¸‹é¢çš„.then()æˆ–è€…æ˜¯.catch() è®©fetchä¹Ÿå¯ä»¥timeout å¯ä»¥è®¾ç½®è¶…æ—¶ç‰ˆçš„çš„fetch fetchæ·»åŠ è¶…æ—¶æ—¶é—´åªéœ€å‡ è¡Œä»£ç â€“fetch timeout ç®€å•å°è£…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159export default class FetchUtil &#123; init() &#123; this.url = ''; this.method = 'GET'; this.headers = &#123;&#125;; this.body_type = 'form'; this.bodys = &#123;&#125;; this.credentials = 'omit'; //é»˜è®¤è¿”å›žjsonå¯¹è±¡ this.return_type = 'json'; this.overtime = 0; this.firstThen = undefined; return this; &#125; setUrl(url) &#123; this.url = url; return this; &#125; setMethod(val) &#123; this.method = val; return this; &#125; setBodyType(val) &#123; this.body_type = val; return this; &#125; setReturnType(val) &#123; this.return_type = val; return this; &#125; setOvertime(val) &#123; this.overtime = val; return this; &#125; setHeader(name, val = null) &#123; if (typeof name == 'string') &#123; this.headers[name] = val; &#125; else if (typeof name == 'object') &#123; Object.keys(name).map((index) =&gt; &#123; this.headers[index] = name[index]; &#125;); &#125; return this; &#125; setBody(name, val = null) &#123; if (typeof name == 'string') &#123; this.bodys[name] = val; &#125; else if (typeof name == 'object') &#123; Object.keys(name).map((index) =&gt; &#123; this.bodys[index] = name[index]; &#125;); &#125; return this; &#125; setCookieOrigin() &#123; this.credentials = 'same-origin'; return this; &#125; setCookieCors() &#123; this.credentials = 'include'; return this; &#125; thenStart(then) &#123; this.firstThen = then; return this; &#125; dofetch() &#123; let options = &#123;&#125;; options.method = this.method; options.credentials = this.credentials; options.headers = this.headers; if (&#123;&#125; != this.bodys &amp;&amp; this.method != 'GET') &#123; if ('form' == this.body_type) &#123; this.setHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8"); let data = ''; Object.keys(this.bodys).map((index) =&gt; &#123; let param = encodeURI(this.bodys[index]); data += `$&#123;index&#125;=$&#123;param&#125;&amp;`; &#125;); options.body = data; &#125; else if ('file' == this.body_type) &#123; let data = new FormData(); Object.keys(this.bodys).map((index) =&gt; &#123; data.append(index, this.bodys[index]); &#125;); options.body = data; &#125; else if ('json' == this.body_type) &#123; options.body = JSON.stringify(this.bodys); &#125; &#125; return Promise.race([ fetch(this.url, options), new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; reject(new Error('request timeout')), this.overtime ? this.overtime : 30 * 1000); &#125;) ]).then( (response) =&gt; &#123; if (this.firstThen) &#123; let tempResponse = this.firstThen(response); if (tempResponse) &#123; return tempResponse; &#125; &#125; return response; &#125; ).then( (response) =&gt; &#123; if ('json' == this.return_type) &#123; return response.json(); &#125; else if ('text' == this.return_type) &#123; return response.text(); &#125; else if ('blob' == this.return_type) &#123; return response.blob(); &#125; else if ('formData' == this.return_type) &#123; return response.formData(); &#125; else if ('arrayBuffer' == this.return_type) &#123; return response.arrayBuffer(); &#125; &#125; ); &#125;&#125;//uselet fetchUtil = new FetchUtil(); fetchUtil.init() .setUrl('https://www.google.com/') .setMethod('GET') .setOvertime(15 * 1000) .setHeader(&#123; 'Accept': 'application/json', 'Content-Type': 'application/json' &#125;) .dofetch() .then((response) =&gt; &#123; //è¿™é‡Œçš„responseå·²ç»è¢«è½¬æˆobjectäº† console.warn( typeof response.title); &#125;) .then((data) =&gt; &#123; Alert.alert(data); &#125;) .catch((error) =&gt; &#123; console.warn( '=&gt; catch: ', error); // console.log('=&gt; catch: ', error); &#125;);]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeç¢Žç‰‡æ•´ç†ä¹‹State]]></title>
    <url>%2F2018%2F07%2F28%2FReactNative%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86%E4%B9%8BState%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬ä½¿ç”¨ä¸¤ç§æ•°æ®æ¥æŽ§åˆ¶ä¸€ä¸ªç»„ä»¶ï¼špropså’Œstateã€‚propsæ˜¯åœ¨çˆ¶ç»„ä»¶ä¸­æŒ‡å®šï¼Œè€Œä¸”ä¸€ç»æŒ‡å®šï¼Œåœ¨è¢«æŒ‡å®šçš„ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­åˆ™ä¸å†æ”¹å˜ã€‚ å¯¹äºŽéœ€è¦æ”¹å˜çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨stateã€‚ stateå±žæ€§ä¸»è¦ç”¨æ¥å­˜å‚¨ç»„ä»¶è‡ªèº«éœ€è¦çš„æ•°æ®ï¼Œæ˜¯ç»„ä»¶è‡ªå·±ç§æœ‰çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ä¿®æ”¹ state å±žæ€§çš„å€¼æ¥æ›´æ–°æ•°æ®ï¼ŒReact å†…éƒ¨ä¼šç›‘å¬ state çš„å˜åŒ–ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–å°±ä¼šä¸»åŠ¨è§¦å‘ç»„ä»¶çš„ render() æ–¹æ³•æ¥æ›´æ–° Dom ç»“æž„ stateçš„ä½¿ç”¨ä¸€èˆ¬æ¥è¯´ï¼Œä½ éœ€è¦åœ¨ constructor()æ–¹æ³•ä¸­åˆå§‹åŒ– stateï¼ˆè¿™æ˜¯ES6çš„å†™æ³•ï¼ŒES5 ä¸­ä¸€èˆ¬åœ¨ getInitialState() æ–¹æ³•ä¸­æ¥åˆå§‹åŒ– stateï¼‰ï¼Œç„¶åŽåœ¨éœ€è¦ä¿®æ”¹æ—¶è°ƒç”¨ setState() æ–¹æ³•ã€‚ ä¸è¦ä½¿ç”¨ this.state æ¥ä¿®æ”¹ state å±žæ€§å€¼ï¼Œåº”è¯¥è°ƒç”¨ setState() æ–¹æ³•ï¼Œthis.state æ˜¯æ— æ•ˆçš„ã€‚ setStateï¼ˆï¼‰æ–¹æ³•setState() çš„å®Œæ•´è¡¨è¾¾å¼ï¼š setState(updater, [callback]) setState() æ–¹æ³•ä¼šæŠŠå¯¹ç»„ä»¶ state çš„æ”¹å˜åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”å‘Šè¯‰ React è¿™ä¸ªç»„ä»¶åŠå…¶å­ç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°ï¼šupdater å‡½æ•°setState(updater, callback) æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›ºå®šæ ¼å¼çš„ updater å‡½æ•°ï¼š 1(prevState, props) =&gt; stateChange prevState æ˜¯ä¸€ä¸ªå¯¹ä¹‹å‰çŠ¶æ€ï¼ˆprevious stateï¼‰çš„å¼•ç”¨ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½ç›´æŽ¥ä¿®æ”¹è¿™ä¸ªå‚æ•°çš„å€¼ï¼Œè¦æƒ³ä¿®æ”¹ state çš„å€¼ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ® prevState å’Œ props å‚æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ JavaScript å¯¹è±¡ã€‚ ä¾‹å­1ï¼š 123this.setState((prevState, props) =&gt; &#123; return &#123;counter: prevState.counter + props.step&#125;;&#125;); ä½ ä¹Ÿå¯ä»¥ä¼ ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯å‡½æ•°ï¼Œæ¥ä½œä¸ºsetState(updater, callback) æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒReact ä¼šå°†è¯¥å‚æ•° merge åˆ° state ä¸­ã€‚ ä¾‹å­2: 1this.setState(&#123;quantity: 2&#125;); ç¬¬äºŒä¸ªå‚æ•°ï¼šcallbacksetState(updater, callback) æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•° callback æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚ï¼ˆåŸºæœ¬æ˜¯ç©ºçš„ï¼Œä¸€èˆ¬ä¸è¿™ä¹ˆä½¿ç”¨ï¼‰ ä¸ºäº†æ›´å¥½çš„æ€§èƒ½è¡¨çŽ°ï¼ŒReact å¹¶ä¸èƒ½ä¿è¯ setState() ä¸€è¢«è°ƒç”¨ state å°±èƒ½æ›´æ–°ã€‚æ‰€ä»¥ï¼Œå¦‚æžœåœ¨è°ƒç”¨ setState() ä¹‹åŽï¼Œé©¬ä¸Šå°±è¯»å– this.state çš„å€¼çš„è¯ï¼Œå¯èƒ½ä¼šå‡ºçŽ°è¯¯å·®ã€‚ å› æ­¤ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒæŽ¨èä½¿ç”¨ componentDidUpdate æˆ–è€… setState(updater, callback) æ–¹æ³•çš„ callback æ¥èŽ·å–æœ€æ–°çš„çŠ¶æ€ã€‚ React å®˜æ–¹æ›´æŽ¨èä½¿ç”¨ componentDidUpdate()ï¼Œè€Œä¸æ˜¯ callback æ¥ç›‘å¬ update äº‹ä»¶ï¼ˆæ³¨ï¼š é™¤éž shouldComponentUpdate() æ–¹æ³•è¿”å›ž falseï¼ŒsetState() å°†æ°¸è¿œéƒ½ä¼šå¼•å‘é‡æ–°æ¸²æŸ“ï¼‰ã€‚ ä¾‹å­1: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768import React, &#123;Component&#125; from 'react';import &#123; View, StyleSheet, TouchableOpacity, ToastAndroid, Platform, Text,&#125; from 'react-native';export default class App extends Component&lt;Props&gt; &#123; // æž„é€  constructor(props) &#123; super(props); // åˆå§‹çŠ¶æ€ this.state = &#123; num: 1 &#125;; &#125; shouldComponentUpdate() &#123; //è¿”å›ž false åˆ™setStateä¸åˆ·æ–° return false; &#125; static defaultProps = &#123; add: 100 &#125; componentDidUpdate() &#123; if(Platform.OS=='ios')&#123; return; &#125; ToastAndroid.show(""+this.state.num,ToastAndroid.SHORT) &#125; render() &#123; return ( &lt;View style=&#123;&#123;flex:1,justifyContent:'center',alignItems: 'center'&#125;&#125;&gt; &lt;TouchableOpacity onPress=&#123;() =&gt; &#123; this.setState((prevState, props) =&gt; &#123; return &#123;num: prevState.num + props.add&#125;; &#125;); &#125;&#125; style=&#123;styles.container&#125;&gt; &lt;Text style=&#123;styles.text&#125;&gt;&#123;this.state.num&#125;&lt;/Text&gt; &lt;/TouchableOpacity&gt; &lt;/View&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; container: &#123; backgroundColor: '#00a056', paddingRight: 70, paddingTop: 10, paddingBottom: 10, paddingLeft: 70, shadowColor: '#00a056', shadowOffset: &#123;width: 3, height: 3&#125;, shadowOpacity: 0.5, shadowRadius: 4 &#125;, text: &#123; color: '#ffffff', fontSize: 30, &#125;&#125;) å¦‚ä¸Šå›¾æ•ˆæžœï¼š shouldComponentUpdate ä¸é‡å†™æˆ–è€…è¿”å›žtrueï¼Œåˆ™è±¡å·¦ä¾§iosæ¨¡æ‹Ÿå™¨ä¸€æ ·ï¼Œå¯ä»¥ä¿®æ”¹çŠ¶æ€ è¿”å›žfalseï¼Œåˆ™ä¸é‡å†™ å®˜æ–¹ä¸æŽ¨èæˆ‘ä»¬ä½¿ç”¨setStateçš„ç¬¬äºŒä¸ªå‚æ•°Callbackçš„å½¢å¼èŽ·å–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨componentDidUpdateå›žè°ƒä¸­ï¼ŒèŽ·å–æœ€æ–°çš„State å¦‚ä½•æ­£ç¡®æ“ä½œstateä¸è¦ä½¿ç”¨this.stateæ¥ä¿®æ”¹state12// Wrongthis.state.comment = 'Hello'; è®°ä½ï¼Œthis.state æ˜¯ä¸å¯å˜çš„ã€‚ 1234567891011//äº‹å®žè¯æ˜Žï¼Œå¹¶æ”¹å˜ä¸äº†render() &#123; return ( &lt;View style=&#123;&#123;flex: 1, justifyContent: 'center', alignItems: 'center'&#125;&#125;&gt; &lt;TouchableOpacity onPress=&#123;() =&gt; &#123; this.state.num = 3 &#125;&#125; style=&#123;styles.container&#125;&gt; &lt;Text style=&#123;styles.text&#125;&gt;&#123;this.state.num&#125;&lt;/Text&gt; &lt;/TouchableOpacity&gt; &lt;/View&gt; ) åº”è¯¥è°ƒç”¨ setState() æ–¹æ³•ï¼š 123456789101112131415// Correctthis.setState(&#123;comment: 'Hello'&#125;);//æˆ–è€…this.setState((prevState, props) =&gt; &#123; return &#123;num: prevState.num + props.add&#125;; &#125;);//prevState å¯ä»¥èŽ·å–ä¸Šä¸ªstate æ•°å€¼//props å¯ä»¥èŽ·å–å½“å‰propsæ‰€æœ‰æ•°å€¼ï¼Œå¯ä»¥åšä¸€äº›æ“ä½œ//ä¸è¦è¿™ä¹ˆä½¿ç”¨this.setState((prevState, props) =&gt; &#123; return &#123;num: this.state.num+1&#125;; &#125;);//è€ƒè™‘åˆ°setStateå¯èƒ½æ˜¯å¼‚æ­¥è°ƒç”¨çš„ï¼Œæ‰€ä»¥æŽ¨èä½¿ç”¨prevStateï¼ˆä¸Šä¸€ä¸ªå€¼ï¼‰ï¼Œè€Œä¸æ˜¯ä¾èµ–this.stateæ¥è®¡ç®—æœ€æ–°çš„stateï¼Œè¿™æ ·å¯èƒ½ä¼šæœ‰è¯¯å·® stateçš„æ”¹å˜æ˜¯ä¸€ä¸ªè¦†ç›–ï¼ˆåˆå¹¶ï¼‰è¿‡ç¨‹å½“ä½ è°ƒç”¨ setState() æ–¹æ³•æ—¶ï¼ŒReact ä¼šå°†å°†ä½ å½“å‰æ‰€æä¾›çš„å¯¹è±¡åˆå¹¶åˆ°å½“å‰çš„çŠ¶æ€ä¸­ã€‚ ä¾‹å­1: 12345678910111213141516constructor(props) &#123; super(props); this.state = &#123; posts: [], comments: [] &#125;; &#125;componentDidMount() &#123; fetchComments().then(response =&gt; &#123; this.setState(&#123; comments: response.comments &#125;); &#125;); &#125; â¬†é¢çš„æ —å­ï¼Œstateæ›´æ–°è‡³æ›¿æ¢äº†commentsï¼Œpostsä¸å—å½±å“ stateä¼ é€’ï¼Ÿæ³¨æ„ï¼š çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ä¹‹é—´ä¸èƒ½é€šè¿‡ state æ¥äº¤äº’ï¼Œçˆ¶ç»„ä»¶åªèƒ½å°†è‡ªå·±çš„ state å€¼ä¼ ç»™å­ç»„ä»¶çš„ propsã€‚ è¿™ç§æ•°æ®ä¼ é€’çš„æ–¹å¼é€šå¸¸è¢«ç§°ä¸º â€œè‡ªé¡¶å‘ä¸‹ï¼ˆtop-downï¼‰â€æˆ–è€…â€œå•å‘ï¼ˆunidirectionalï¼‰â€æ•°æ®æµã€‚ ä»»ä½•stateéƒ½æ˜¯ç”±ä¸€ä¸ªç‰¹å®šçš„ç»„ä»¶æ‰€æ‹¥æœ‰çš„ï¼Œä»»ä½•stateæ•°æ®ä¿®æ”¹é»˜è®¤åªä¼šå½±å“å½“å‰ç»„ä»¶ï¼Œ å¯ä»¥é€šè¿‡å›žè°ƒä¼ å€¼ï¼ˆåŽé¢ä¼šæ•´ç†ï¼‰ React Nativeå»ºè®®ç”±é¡¶å±‚çš„çˆ¶ç»„ä»¶å®šä¹‰stateå€¼ï¼Œå¹¶å°†stateå€¼ä½œä¸ºå­ç»„ä»¶çš„propså±žæ€§å€¼ä¼ é€’ç»™å­ç»„ä»¶ï¼Œè¿™æ ·å¯ä»¥ä¿æŒå•ä¸€çš„æ•°æ®ä¼ é€’ã€‚ å‚è€ƒ[ã€1ã€‘React Native] React ä¸­çš„çŠ¶æ€ï¼ˆStateï¼‰]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[^_^å¤æ—¥ï½ž]]></title>
    <url>%2F2018%2F07%2F28%2F%E5%A4%8F%E6%97%A5%2F</url>
    <content type="text"><![CDATA[å¤æ—¥çš„å¤œæ™š å¤æ—¥çš„å¤œæ™šï¼ŒçŒ«ååœ¨åºŠè¾¹ ä½ å¹ç€å¤´å‘ï¼Œä¸è¯´è¯å°±å¾ˆç”œ æƒ³å’Œä½ ä¸€èµ·çœ‹æ˜Ÿç©ºï¼Œåªè°ˆå¤œè‰²å’Œå¾®é£Ž æ²¡æœ‰å·¥ä½œï¼Œæ²¡æœ‰æ—©èµ· åªæœ‰ç”œç”œçš„æ¢¦ å’Œæ¢¦é‡Œçš„ä½  ^_^ ï½ž]]></content>
      <categories>
        <category>Life</category>
      </categories>
      <tags>
        <tag>Life</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rxjava2.0-çŸ¥è¯†ç¢Žç‰‡ï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2018%2F07%2F24%2FRxjava2-0-%E7%9F%A5%E8%AF%86%E7%A2%8E%E7%89%87%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[åŸºäºŽRxjava2.0çš„æ“ä½œç¬¦å°ç»“ ä¸€ï¼šåˆ›å»ºç›¸å…³creatæ“ä½œç¬¦12345678910Observable.create(new Observable.OnSubscribe&lt;String&gt;() &#123; @Override public void call(Subscriber&lt;? super String&gt; subscriber) &#123; subscriber.onNext("item1"); subscriber.onNext("item2"); subscriber.onCompleted(); &#125; &#125;); just123456Observable observable = Observable.just("Hello", "Hi", "Aloha");// å°†ä¼šä¾æ¬¡è°ƒç”¨ï¼š// onNext("Hello");// onNext("Hi");// onNext("Aloha");// onCompleted(); from1234567String[] words = &#123;"Hello", "Hi", "Aloha"&#125;;Observable observable = Observable.from(words);// å°†ä¼šä¾æ¬¡è°ƒç”¨ï¼š// onNext("Hello");// onNext("Hi");// onNext("Aloha");// onCompleted(); intervalæ“ä½œç¬¦ä¸å¤šbbï¼Œçœ‹ä»¥ä¸‹ä»£ç  1234567891011121314151617181920212223242526272829public void rxJava() &#123; Observable.interval(1, TimeUnit.SECONDS) .subscribe(new Consumer&lt;Long&gt;() &#123; public Disposable mDisposable; @Override public void accept(Long aLong) &#123; if (aLong == 10) &#123; mDisposable.dispose(); &#125; System.out.println("è®¡æ—¶å™¨" + aLong); &#125; &#125;, throwable -&gt; &#123; &#125;, () -&gt; &#123; System.out.println("action"); &#125;, disposable -&gt; mDisposable = disposable); &#125;//log07-24 11:24:52.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨007-24 11:24:53.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨107-24 11:24:54.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨207-24 11:24:55.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨307-24 11:24:56.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨407-24 11:24:57.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨507-24 11:24:58.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨607-24 11:24:59.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨707-24 11:25:00.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨807-24 11:25:01.718 12306-12332/com.fengandev.rxjavademo I/System.out: è®¡æ—¶å™¨9 å¯ä»¥ç®€æ˜“çš„å°è£…ï¼ŒèŽ·å–ä¸€ä¸ªå€’è®¡æ—¶Observable 123456789101112131415161718192021222324/** * äº§ç”Ÿä¸€ä¸ªå€’è®¡æ—¶çš„ Observable * @param time * @return */ public Observable&lt;Long&gt; countdown(final long time) &#123; return Observable.interval(1, TimeUnit.SECONDS) .map(new Function&lt;Long, Long&gt;() &#123; @Override public Long apply(@NonNull Long aLong) throws Exception &#123; return time - aLong; &#125; &#125;).take( time + 1 ); &#125;//ä½¿ç”¨ public void rxJava() &#123; countdown(10).subscribe(new Consumer&lt;Long&gt;() &#123; @Override public void accept(Long aLong) throws Exception &#123; System.out.println("å€’è®¡æ—¶"+aLong); &#125; &#125;); &#125; rangeæ“ä½œç¬¦range å‘å°„ç‰¹å®šæ•´æ•°åºåˆ—çš„ Observable range( int start , int end ) //start :å¼€å§‹çš„å€¼ ï¼Œ end ï¼šç»“æŸçš„å€¼ 12345678 Observable.range(0,5) .subscribe(integer -&gt; System.out.println(integer));//log01234 è€è§„çŸ©ï¼ŒåŒ…å‰ä¸åŒ…åŽ emptyå’Œerrorå’Œneverempty Observable observable1=Observable.empty();//ç›´æŽ¥è°ƒç”¨onCompletedã€‚ 1234567891011121314151617181920212223242526272829//Observable observable1=Observable.empty();//ç›´æŽ¥è°ƒç”¨onCompletedã€‚@Test public void testRxJava() &#123; Observable&lt;String&gt; empty = Observable.empty(); empty.subscribe(new Observer&lt;String&gt;() &#123; @Override public void onSubscribe(Disposable d) &#123; System.out.println("onSubscribe"); &#125; @Override public void onNext(String s) &#123; System.out.println("onNext"); &#125; @Override public void onError(Throwable e) &#123; System.out.println("onError"); &#125; @Override public void onComplete() &#123; System.out.println("onComplete"); &#125; &#125;); &#125;//log://onSubscribe//onComplete never Observable observable3=Observable.never();//å•¥éƒ½ä¸åš 123456789101112131415161718192021222324252627@Testpublic void testRxJava() &#123; Observable&lt;String&gt; empty = Observable.never(); empty.subscribe(new Observer&lt;String&gt;() &#123; @Override public void onSubscribe(Disposable d) &#123; System.out.println("onSubscribe"); &#125; @Override public void onNext(String s) &#123; System.out.println("onNext"); &#125; @Override public void onError(Throwable e) &#123; System.out.println("onError"); &#125; @Override public void onComplete() &#123; System.out.println("onComplete"); &#125; &#125;);&#125;//log//onSubscribe error Observable observable2=Observable.error(new RuntimeException());//ç›´æŽ¥è°ƒç”¨onErrorã€‚è¿™é‡Œå¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸ åŠŸèƒ½æ“ä½œmapæ“ä½œç¬¦mapæ“ä½œç¬¦ç®—æ˜¯Rxjavaä¸­æœ€ç®€å•çš„ä¸€ä¸ªæ“ä½œç¬¦äº†ï¼Œåœ¨2.xä¸­çš„ç”¨æ³•å’Œ1.xå·®ä¸å¤šï¼›å®ƒçš„ä½œç”¨å°±æ˜¯å¯¹å‘å°„çš„æ¯ä¸€ä¸ªäº‹ä»¶åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶éƒ½æŒ‰ç…§mapæ“ä½œç¬¦æŒ‡å®šçš„å‡½æ•°åŽ»å˜åŒ–è½¬æ¢ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªæ —å­ðŸŒ° 12345678910111213141516171819202122232425262728@Test public void rxJava() &#123; Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123; @Override public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123; emitter.onNext(1); emitter.onNext(2); emitter.onNext(3); emitter.onComplete(); &#125; &#125;).map(new Function&lt;Integer, String&gt;() &#123; @Override public String apply(Integer integer) throws Exception &#123; Log.e("fengan", "apply----&gt;" + Thread.currentThread().getName()); return "this is value = " + integer; &#125; &#125;).subscribeOn(Schedulers.single())// .observeOn(Schedulers.single()) .subscribe(new Consumer&lt;String&gt;() &#123; @Override public void accept(String s) throws Exception &#123; Log.e("fengan", "accept----&gt;" + Thread.currentThread().getName()); Log.e("fengan", "accept----&gt;" + s); Log.e("fengan","========"); &#125; &#125;); &#125; log 123456789101112apply----&gt;RxSingleScheduler-1accept----&gt;RxSingleScheduler-1accept----&gt;this is value = 1========apply----&gt;RxSingleScheduler-1accept----&gt;RxSingleScheduler-1accept----&gt;this is value = 2========apply----&gt;RxSingleScheduler-1accept----&gt;RxSingleScheduler-1accept----&gt;this is value = 3======== ä»Žè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬èƒ½çœ‹å‡º æˆ‘ä»¬å‘å°„çš„integeräº‹ä»¶ï¼Œè¢«è½¬æ¢ä¸ºStringï¼Œç»§ç»­è¿›è¡Œ æˆ‘ä»¬ä¹Ÿé¡ºä¾¿éªŒè¯äº†ä¸¤ä¸ªé—®é¢˜ï¼ˆåœ¨ç¢Žç‰‡åŒ–2æ•´ç†çš„çº¿ç¨‹è°ƒåº¦ï¼‰ åªæŒ‡å®šsubscribeOnæœªæŒ‡å®šobserveOnçš„æƒ…å†µä¸‹ï¼Œè§‚å¯Ÿè€…çš„äº‹ä»¶çš„æŽ¥å—ï¼ˆä¸‹æ¸¸ï¼‰æŒ‰ç…§subscribeOnæŒ‡å®šçš„çº¿ç¨‹è¿›è¡Œ Schedulers.single()æ˜¯åœ¨æŒ‡å®šçº¿ç¨‹ä¸­æŒ‰ç…§é˜Ÿåˆ—çš„å½¢å¼è¿›è¡Œï¼Œå…ˆè¿›å…ˆå‡ºï¼ˆä½“çŽ°åœ¨ï¼šä¸€ä¸ªäº‹ä»¶å‘å¸ƒå’ŒæŽ¥å—å®Œæ¯•åŽï¼Œæ‰å‘é€ç¬¬äºŒä¸ªäº‹ä»¶ï¼‰ debounceæ“ä½œç¬¦debounceï¼šé˜²æŠ–ï¼› only emit an item from an Observable if a particular time-span has passed without it emitting another item, å½“ä¸€ä¸ªäº‹ä»¶å‘é€å‡ºæ¥ä¹‹åŽï¼Œåœ¨çº¦å®šæ—¶é—´å†…æ²¡æœ‰å†æ¬¡å‘é€è¿™ä¸ªäº‹ä»¶ï¼Œåˆ™å‘å°„è¿™ä¸ªäº‹ä»¶ï¼Œå¦‚æžœå†æ¬¡è§¦å‘äº†ï¼Œåˆ™é‡æ–°è®¡ç®—æ—¶é—´ã€‚ å‚è€ƒé“¾æŽ¥ 123456789101112131415161718192021222324252627 Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123; @Override public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123; // send events with simulated time wait emitter.onNext(1); // skip Thread.sleep(400); emitter.onNext(2); // deliver Thread.sleep(505); emitter.onNext(3); // skip Thread.sleep(100); emitter.onNext(4); // deliver Thread.sleep(605); emitter.onNext(5); // deliver Thread.sleep(510); emitter.onComplete(); &#125; &#125;).debounce(500,TimeUnit.MILLISECONDS) .subscribe(new Consumer&lt;Integer&gt;() &#123; @Override public void accept(Integer integer) throws Exception &#123; System.out.println(integer); &#125; &#125;);//2//4//5 onTerminateDetachæ“ä½œç¬¦Rxjavaå¯¼è‡´å†…å­˜æ³„æ¼çš„é—®é¢˜ ä¸€å¼ å›¾æžå®š-RxJava2çš„çº¿ç¨‹åˆ‡æ¢åŽŸç†å’Œå†…å­˜æ³„éœ²é—®é¢˜ çœ‹å®Œè¿™ä¸¤ä¸ªå‚è€ƒé“¾æŽ¥ï¼ŒåŸºæœ¬ä¹Ÿå°±çŸ¥é“äº†onTerminateDetachçš„ä½¿ç”¨æ–¹æ³•å’Œä½œç”¨ deferæ“ä½œç¬¦åªæœ‰å½“è®¢é˜…è€…è®¢é˜…æ‰åˆ›å»ºObservableï¼Œä¸ºæ¯ä¸ªè®¢é˜…åˆ›å»ºä¸€ä¸ªæ–°çš„Observableã€‚ 1234567891011121314151617@Testpublic void rxjava() &#123; Observable.defer(new Callable&lt;ObservableSource&lt;Integer&gt;&gt;() &#123; @Override public ObservableSource&lt;Integer&gt; call() throws Exception &#123; return Observable.just(1,2,3); &#125; &#125;).subscribe(new Consumer&lt;Integer&gt;() &#123; @Override public void accept(Integer integer) throws Exception &#123; System.out.println(integer); &#125; &#125;);&#125;123 flatMapæ“ä½œç¬¦æŠŠä¸€ä¸ªå‘å°„å™¨Observable é€šè¿‡æŸç§æ–¹æ³•è½¬æ¢ä¸ºå¤šä¸ªObservablesï¼Œç„¶åŽå†æŠŠè¿™äº›åˆ†æ•£çš„Observablesè£…è¿›ä¸€ä¸ªå•ä¸€çš„å‘å°„å™¨Observableã€‚ä½†æœ‰ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒflatMapå¹¶ä¸èƒ½ä¿è¯äº‹ä»¶çš„é¡ºåºï¼Œå¦‚æžœéœ€è¦ä¿è¯ï¼Œéœ€è¦ç”¨åˆ°æˆ‘ä»¬ä¸‹é¢è¦è®²çš„ConcatMapã€‚ 12345678910111213141516171819202122232425@Testpublic void rxJava() &#123; Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123; @Override public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123; emitter.onNext(1); emitter.onNext(2); emitter.onNext(3); emitter.onComplete(); &#125; &#125;).flatMap(new Function&lt;Integer, ObservableSource&lt;String&gt;&gt;() &#123; @Override public ObservableSource&lt;String&gt; apply(Integer integer) throws Exception &#123; List&lt;String&gt; res = new ArrayList&lt;&gt;(); res.add("i am value =" + integer); Log.e("fengan","flatMap size"+res.size()); return Observable.fromIterable(res); &#125; &#125;).subscribe(new Consumer&lt;String&gt;() &#123; @Override public void accept(String s) throws Exception &#123; Log.e("fengan","accept="+s); &#125; &#125;);&#125; log 123456flatMap size1accept=i am value =1 flatMap size1 accept=i am value =2 flatMap size1 accept=i am value =3 ç»“è®º éªŒè¯äº†æˆ‘ä¹‹å‰çš„ä¸€ä¸ªè¯¯åŒºï¼ˆsizeå¤§å°ä¸€ç›´ä¸º1ï¼‰ï¼šè¯¯ä»¥ä¸ºæ‰€æœ‰äº‹ä»¶å‘é€å®Œæ¯•ä¹‹åŽï¼Œåœ¨flatmapç»Ÿä¸€å¤„ç†ï¼Œå…¶å®žä¸æ˜¯ï¼Œäº‹ä»¶æºæ¯å‘å°„ä¸€ä¸ªäº‹ä»¶ï¼Œflatmapå°±å¤„ç†è½¬æ¢ä¸€ä¸ªäº‹ä»¶ flatMapçš„ä½œç”¨æ˜¯ï¼ŒæŽ¥å—ä¸€ä¸ªäº‹ä»¶ï¼Œä½œå‡ºå¤„ç†å®Œä¹‹åŽï¼Œé‡æ–°å‘å°„ä¸€ä¸ªæ–°çš„äº‹ä»¶ åˆšæ‰è¯´åˆ°flatMapå¹¶ä¸èƒ½ä¿è¯äº‹ä»¶çš„é¡ºåºï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­å°±æ˜Žç™½äº† concatMapæ“ä½œç¬¦flatMapæ“ä½œç¬¦å¯ä»¥å°†ä¸€ä¸ªObservableè½¬æ¢ä¸ºå¦ä¸€ä¸ªObservableå‘å°„å‡ºåŽ»,å¹¶ä¸”å¯ä»¥å°†å¤šä¸ªäº‹ä»¶è½¬åŒ–ä¸º1ä¸ªï¼Œä½†æ˜¯æœ€åŽè¾“å‡ºçš„äº‹ä»¶åºåˆ—é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¦‚æžœæƒ³è¦æœ€åŽè¾“å‡ºçš„äº‹ä»¶é¡ºåºå’Œæºæ•°æ®çš„é¡ºåºä¸€è‡´åªè¦æ¢æˆconcatMapå°±å¯ä»¥äº†ã€‚flatMapå’ŒMapæ“ä½œç¬¦çš„ä¸åŒæ˜¯mapä¸€æ¬¡åªèƒ½è½¬æ¢ä¸€ä¸ªäº‹ä»¶ã€‚ å…ˆçœ‹ä¸€ä¸ªflatmapçš„ä½¿ç”¨ä¾‹å­ï¼Œå¦‚ä¸‹ 12345678910111213Observable.create((ObservableOnSubscribe&lt;Integer&gt;) emitter -&gt; &#123; emitter.onNext(1); emitter.onNext(2); emitter.onNext(3); emitter.onComplete(); &#125;).subscribeOn(Schedulers.io()).flatMap((Function&lt;Integer, ObservableSource&lt;String&gt;&gt;) integer -&gt; &#123; List&lt;String&gt; res = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 3; i++) &#123; res.add("I am value " + integer); &#125; int delayTime = (int) (1 + Math.random() * 10); return Observable.fromIterable(res).delay(delayTime, TimeUnit.MILLISECONDS); &#125;).subscribe(s -&gt; Log.e("fengan", "accept=" + s)); log 123456789accept=I am value 3accept=I am value 3accept=I am value 2accept=I am value 2accept=I am value 2accept=I am value 3accept=I am value 1accept=I am value 1accept=I am value 1 å¯è§ä¸æ˜¯æŒ‰ç…§æºæ•°æ®åˆ°é¡ºåºä¸€è‡´ï¼Œè‹¥æƒ³ä¸€è‡´ä½¿ç”¨concatMapå°±å¯ä»¥äº† repeatæ“ä½œç¬¦repeat é‡å¤åœ°å‘å°„æ•°æ® repeat( ) //æ— é™é‡å¤ repeat( int time ) //è®¾å®šé‡å¤çš„æ¬¡æ•° 123456789101112Observable.just(1,2,3) .repeat(3) .subscribe(integer -&gt; System.out.println(integer));123123123 fromArrayå’ŒfromIterbleæ“ä½œç¬¦ä¸€ä¸ªæ˜¯å‘å°„ä¸€ä¸ªæ•°ç»„ä¸€ä¸ªæ˜¯å‘å°„ä¸€ä¸ªé›†åˆ toListå°†æ•°ç»„è½¬æ¢ä¸ºé›†åˆ delayæ“ä½œç¬¦123456789101112public void rxJava() &#123; Observable.just(1, 2, 3) .delay(3, TimeUnit.SECONDS) .observeOn(Schedulers.io()) .subscribe(integer -&gt; &#123; int a = integer; System.out.println(a); &#125;); &#125;//æ³¨æ„ï¼šå»¶è¿Ÿ3ç§’é’Ÿï¼Œç„¶åŽåœ¨å‘å°„æ•°æ®//æ˜¯å»¶è¿Ÿä¸‰ç§’ï¼Œå‘é€1ï¼Œ2ï¼Œ3æ•°æ®//è€Œä¸æ˜¯--å»¶è¿Ÿ3ç§’--å‘é€1--å»¶è¿Ÿ3ç§’---å‘é€2 æ˜¯å»¶è¿Ÿä¸‰ç§’ï¼Œå‘é€1ï¼Œ2ï¼Œ3æ•°æ® è€Œä¸æ˜¯â€“å»¶è¿Ÿ3ç§’â€“å‘é€1â€“å»¶è¿Ÿ3ç§’â€”å‘é€2 è‹¥æƒ³è¾¾åˆ°è¿™ç§æ•ˆæžœï¼Œå¯ä»¥ç±»ä¼¼è¿™ä¹ˆåš 123456789101112public void rxJava() &#123; Observable.just(1, 2, 3) .concatMap(new Function&lt;Integer, ObservableSource&lt;Integer&gt;&gt;() &#123; @Override public ObservableSource&lt;Integer&gt; apply(Integer integer) throws Exception &#123; return Observable.just(integer) .delay(3, TimeUnit.SECONDS); &#125; &#125;) .subscribe(integer -&gt; System.out.println(integer)); &#125;//--å»¶è¿Ÿä¸‰ç§’---å‘é€1---å»¶è¿Ÿä¸‰ç§’---å‘é€2---å»¶è¿Ÿ3ç§’---å‘é€3 doOnNextæ“ä½œç¬¦12345678910111213141516171819202122@Testpublic void testRxJava() &#123; Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123; @Override public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123; emitter.onNext(1); emitter.onNext(2); &#125; &#125;).doOnNext(new Consumer&lt;Integer&gt;() &#123; @Override public void accept(Integer integer) throws Exception &#123; System.out.println("å‰ç½®æ“ä½œ" + integer); integer+=1; &#125; &#125;) .subscribe(System.out::println);&#125;//logå‰ç½®æ“ä½œ11å‰ç½®æ“ä½œ22 åœ¨æ¯æ¬¡ OnNext() æ–¹æ³•è¢«è°ƒç”¨å‰æ‰§è¡Œ ä½¿ç”¨åœºæ™¯ï¼šä»Žç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œåœ¨æ•°æ®è¢«å±•ç¤ºå‰ï¼Œç¼“å­˜åˆ°æœ¬åœ° åˆå¹¶æ“ä½œconcatæ“ä½œç¬¦æŒ‰é¡ºåºè¿žæŽ¥å¤šä¸ªObservablesã€‚éœ€è¦æ³¨æ„çš„æ˜¯Observable.concat(a,b)ç­‰ä»·äºŽa.concatWith(b)ã€‚ 12345Observable&lt;Integer&gt; observable1=Observable.just(1,2,3,4); Observable&lt;Integer&gt; observable2=Observable.just(4,5,6); Observable.concat(observable1,observable2) .subscribe(item-&gt;Log.d("JG",item.toString()));//1,2,3,4,4,5,6 startWithæ“ä½œç¬¦åœ¨æ•°æ®åºåˆ—çš„å¼€å¤´å¢žåŠ ä¸€é¡¹æ•°æ®ã€‚startWithçš„å†…éƒ¨ä¹Ÿæ˜¯è°ƒç”¨äº†concat 123Observable.just(1,2,3,4,5) .startWith(6,7,8) .subscribe(item-&gt;Log.d("JG",item.toString()));//6,7,8,1,2,3,4,5 mergeæ“ä½œç¬¦åˆå¹¶è¢«è§‚å¯Ÿè€… 123456789final String[] aStrings = &#123;"A1", "A2", "A3", "A4"&#125;; final String[] bStrings = &#123;"B1", "B2", "B3"&#125;; final Observable&lt;String&gt; aObservable = Observable.fromArray(aStrings); final Observable&lt;String&gt; bObservable = Observable.fromArray(bStrings); Observable.merge(aObservable, bObservable)//ä½¿ç”¨mergeæ“ä½œç¬¦å°†ä¸¤ä¸ªè¢«è§‚å¯Ÿè€…åˆå¹¶ .subscribe(getObserver());//è¿™é‡Œçš„è§‚å¯Ÿè€…ä¾ç„¶ä¸é‡è¦//"A1", "B1", "A2", "A3", "A4", "B2", "B3" æ“ä½œç¬¦mergeå°†ä¸¤ä¸ªè¢«è§‚å¯Ÿè€…åˆå¹¶,è¿™é‡Œè¦æ³¨æ„mergeä¹‹åŽçš„Observableæ˜¯ä¸èƒ½ä¿è¯å’ŒåŽŸæ¥çš„Observableå‘å°„é¡ºåºç›¸åŒ. Zipæ“ä½œç¬¦zipæˆ‘ä»¬æƒ³åˆ°â€åŽ‹ç¼©â€œï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ“ä½œç¬¦æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œè¯·çœ‹ä¸‹é¢å›¾ç‰‡ 12345678910@Test public void rxJava() &#123; Observable.zip(Observable.just("A", "B", "C"), Observable.just(1,2,3,4,5), new BiFunction&lt;String, Integer, String&gt;() &#123; @Override public String apply(String s, Integer integer) throws Exception &#123; return s+integer; &#125; &#125;).subscribe(s -&gt; System.out.println("value=" + s)); &#125; log 123value=A1value=B2value=C3 ç»“è®ºï¼š zip ç»„åˆäº‹ä»¶çš„è¿‡ç¨‹å°±æ˜¯åˆ†åˆ«ä»Žå‘å°„å™¨Aå’Œå‘å°„å™¨Bå„å–å‡ºä¸€ä¸ªäº‹ä»¶æ¥ç»„åˆï¼Œå¹¶ä¸”ä¸€ä¸ªäº‹ä»¶åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ï¼Œç»„åˆçš„é¡ºåºæ˜¯ä¸¥æ ¼æŒ‰ç…§äº‹ä»¶å‘é€çš„é¡ºåºæ¥è¿›è¡Œçš„ï¼Œæ‰€ä»¥ä¸Šé¢æˆªå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ1æ°¸è¿œæ˜¯å’ŒA ç»“åˆçš„ï¼Œ2æ°¸è¿œæ˜¯å’ŒBç»“åˆçš„ã€‚ æœ€ç»ˆæŽ¥æ”¶å™¨æ”¶åˆ°çš„äº‹ä»¶æ•°é‡æ˜¯å’Œå‘é€å™¨å‘é€äº‹ä»¶æœ€å°‘çš„é‚£ä¸ªå‘é€å™¨çš„å‘é€äº‹ä»¶æ•°ç›®ç›¸åŒï¼Œæ‰€ä»¥ä»£ç ä¸­ï¼Œ4å’Œ5æ˜¯æ²¡æœ‰é…å¯¹çš„ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ³•å‘å°„åˆå¹¶äº‹ä»¶ combineLatestæ“ä½œç¬¦å…ˆçœ‹ä¸€å¼ å›¾ï¼Œæˆ‘æƒ³ä½ åº”è¯¥å·²ç»å¤§è‡´æ˜Žç™½æ„æ€äº† ä½¿ç”¨åœºæ™¯ï¼Œè¡¨å•éªŒè¯ combineLatestæ˜¯RxJavaæœ¬èº«æä¾›çš„ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œç¬¦ï¼Œå®ƒæŽ¥å—ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„Observableå’Œä¸€ä¸ªFuncXé—­åŒ…ã€‚å½“ä¼ å…¥çš„Observableä¸­ä»»æ„çš„ä¸€ä¸ªå‘å°„æ•°æ®æ—¶ï¼ŒcombineLatestå°†æ¯ä¸ªObservableçš„æœ€è¿‘å€¼(Lastest)è”åˆèµ·æ¥ï¼ˆcombineï¼‰ä¼ ç»™FuncXé—­åŒ…è¿›è¡Œå¤„ç†ã€‚è¦ç‚¹åœ¨äºŽï¼š combineLatestæ˜¯ä¼šå­˜å‚¨æ¯ä¸ªObservableçš„æœ€è¿‘çš„å€¼çš„ ä»»æ„ä¸€ä¸ªObservableå‘å°„æ–°å€¼æ—¶éƒ½ä¼šè§¦å‘æ“ä½œ-&gt;â€œcombine all the Observableâ€™s lastest value together and send to Functionâ€ çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥è¯´æ˜Ž 12345678910111213141516171819202122232425262728@Test public void testRxJava() &#123; final String[] aStrings = &#123;"A1", "A2", "A3", "A4"&#125;; final String[] bStrings = &#123;"B1", "B2", "B3"&#125;; final Observable&lt;String&gt; aObservable = Observable.fromArray(aStrings).delay(1,TimeUnit.MILLISECONDS); final Observable&lt;String&gt; bObservable = Observable.fromArray(bStrings); Observable.combineLatest(aObservable, bObservable, new BiFunction&lt;String, String, String&gt;() &#123; @Override public String apply(String s1, String s2) throws Exception &#123; return s1+s2; &#125; &#125;).subscribe(new Consumer&lt;String&gt;() &#123; @Override public void accept(String s) throws Exception &#123; System.out.println(s); &#125; &#125;); &#125;//log//A1B3//A2B3//A3B3//A4B3å¯è§ï¼Œå‘é€A1çš„æ—¶å€™B1 B2 B3éƒ½å·²ç»å‘å°„å®Œæ¯•æ‰€ä»¥ï¼Œå­˜å‚¨æ¯ä¸ªObservableçš„æœ€è¿‘çš„å€¼çš„ï¼Œä¹Ÿå°±æ˜¯B3å½“B1ï¼ŒB2ï¼ŒB3å‘å°„çš„ Aè¢«è§‚å¯Ÿè€…ä¸€ä¸ªéƒ½æ²¡å‘å°„ï¼Œæ‰€ä»¥å¾—è‡³å°‘ä¸¤ä¸ªæ‰ä¼šåˆå¹¶ï¼Œè¿™ä¸ªçœ‹å›¾å¯ä»¥è§£é‡Š ##è¿‡æ»¤æ“ä½œ takeç­‰æ“ä½œç¬¦1234567891011121314151617181920//take å–å‰nä¸ªæ•°æ®Observable.just(1, 2, 3,4,5,6,7) .take(3) .subscribe(System.out::println);//log123//takelast å–åŽnä¸ªæ•°æ® Observable.just(1, 2, 3, 4, 5, 6, 7) .takeLast(3) .subscribe(System.out::println);//log567//first åªå‘é€ç¬¬ä¸€ä¸ªæ•°æ® //last åªå‘é€æœ€åŽä¸€ä¸ªæ•°æ®//skip() è·³è¿‡å‰nä¸ªæ•°æ®å‘é€åŽé¢çš„æ•°æ®//skipLast() è·³è¿‡æœ€åŽnä¸ªæ•°æ®ï¼Œå‘é€å‰é¢çš„æ•°æ® filteræ“ä½œç¬¦é¡¾åæ€ä¹‰ï¼Œè¿‡æ»¤å‘é€çš„äº‹ä»¶ 12345678910111213 @Test public void testRxJava() &#123; Observable.just(1, 2, 3) .filter(integer -&gt; &#123; if (integer==2) &#123; return false; &#125; return true; &#125;).subscribe(System.out::println); &#125;//log13 ofTypeè¿‡æ»¤æŒ‡å®šç±»åž‹çš„æ•°æ®ï¼Œä¸Žfilterç±»ä¼¼ï¼Œ 123456789101112@Testpublic void rxjava() &#123; Observable.just(1,"1",-1) .ofType(Integer.class) .subscribe(new Consumer&lt;Integer&gt;() &#123; @Override public void accept(Integer integer) throws Exception &#123; System.out.println(integer); &#125;//log1-1 firstå’Œlast123456789101112131415161718Observable.just(1, 2, 3) .first(2) .subscribe(new Consumer&lt;Integer&gt;() &#123; @Override public void accept(Integer integer) throws Exception &#123; System.out.println(integer); &#125; &#125;);//1 Observable.just(1, 2, 3) .last(2) .subscribe(new Consumer&lt;Integer&gt;() &#123; @Override public void accept(Integer integer) throws Exception &#123; System.out.println(integer); &#125; &#125;);//3 æœªå®Œå¾…ç»­å‚è€ƒï¼šæ‰‹æŠŠæ‰‹æ•™ä½ ä½¿ç”¨ RxJava 2.0ï¼ˆä¸€ï¼‰ RxJava combineLatestæ“ä½œç¬¦å¤„ç†å¤æ‚è¡¨å•éªŒè¯é—®é¢˜ Android - RxJava2.0 æ“ä½œç¬¦æ•´ç†å½’çº³]]></content>
      <categories>
        <category>Rxjava</category>
      </categories>
      <tags>
        <tag>Rxjava</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rxjava2.0-çŸ¥è¯†ç¢Žç‰‡(äºŒ)]]></title>
    <url>%2F2018%2F07%2F23%2FRxjava2-0-%E7%9F%A5%E8%AF%86%E7%A2%8E%E7%89%87%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Rxjava2.0ä¸­çš„çº¿ç¨‹è°ƒåº¦å°èŠ‚ Schedulerçš„ç§ç±» Schedulers.io( )ï¼š ç”¨äºŽIOå¯†é›†åž‹çš„æ“ä½œï¼Œä¾‹å¦‚è¯»å†™SDå¡æ–‡ä»¶ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œè®¿é—®ç½‘ç»œç­‰ï¼Œå…·æœ‰çº¿ç¨‹ç¼“å­˜æœºåˆ¶ï¼Œåœ¨æ­¤è°ƒåº¦å™¨æŽ¥æ”¶åˆ°ä»»åŠ¡åŽï¼Œå…ˆæ£€æŸ¥çº¿ç¨‹ç¼“å­˜æ± ä¸­ï¼Œæ˜¯å¦æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œå¦‚æžœæœ‰ï¼Œåˆ™å¤ç”¨ï¼Œå¦‚æžœæ²¡æœ‰åˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œå¹¶åŠ å…¥åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå¦‚æžœæ¯æ¬¡éƒ½æ²¡æœ‰ç©ºé—²çº¿ç¨‹ä½¿ç”¨ï¼Œå¯ä»¥æ— ä¸Šé™çš„åˆ›å»ºæ–°çº¿ç¨‹ã€‚ Schedulers.newThread( )ï¼š åœ¨æ¯æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œä¸å…·æœ‰çº¿ç¨‹ç¼“å­˜æœºåˆ¶ï¼Œå› ä¸ºåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¯”å¤ç”¨ä¸€ä¸ªçº¿ç¨‹æ›´è€—æ—¶è€—åŠ›ï¼Œè™½ç„¶ä½¿ç”¨Schedulers.io( )çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨Schedulers.newThread( )ï¼Œä½†æ˜¯ï¼ŒSchedulers.newThread( )çš„æ•ˆçŽ‡æ²¡æœ‰Schedulers.io( )é«˜ã€‚ Schedulers.computation()ï¼š ç”¨äºŽCPU å¯†é›†åž‹è®¡ç®—ä»»åŠ¡ï¼Œå³ä¸ä¼šè¢« I/O ç­‰æ“ä½œé™åˆ¶æ€§èƒ½çš„è€—æ—¶æ“ä½œï¼Œä¾‹å¦‚xml,jsonæ–‡ä»¶çš„è§£æžï¼ŒBitmapå›¾ç‰‡çš„åŽ‹ç¼©å–æ ·ç­‰ï¼Œå…·æœ‰å›ºå®šçš„çº¿ç¨‹æ± ï¼Œå¤§å°ä¸ºCPUçš„æ ¸æ•°ã€‚ä¸å¯ä»¥ç”¨äºŽI/Oæ“ä½œï¼Œå› ä¸ºI/Oæ“ä½œçš„ç­‰å¾…æ—¶é—´ä¼šæµªè´¹CPUã€‚ Schedulers.trampoline()ï¼š åœ¨å½“å‰çº¿ç¨‹ç«‹å³æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œï¼Œåˆ™ä¼šå°†å…¶æš‚åœï¼Œç­‰æ’å…¥è¿›æ¥çš„ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åŽï¼Œå†å°†æœªå®Œæˆçš„ä»»åŠ¡æŽ¥ç€æ‰§è¡Œã€‚ Schedulers.single()ï¼š æ‹¥æœ‰ä¸€ä¸ªçº¿ç¨‹å•ä¾‹(æ³¨æ„æ˜¯å­çº¿ç¨‹)ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½åœ¨è¿™ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå½“æ­¤çº¿ç¨‹ä¸­æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå…¶ä»–ä»»åŠ¡å°†ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ Scheduler.from(@NonNull Executor executor)ï¼š æŒ‡å®šä¸€ä¸ªçº¿ç¨‹è°ƒåº¦å™¨ï¼Œç”±æ­¤è°ƒåº¦å™¨æ¥æŽ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œç­–ç•¥ã€‚ AndroidSchedulers.mainThread()ï¼š åœ¨Android UIçº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡.éœ€è¦æ·»åŠ RxAndroidä¾èµ– æ³¨æ„ æ–¹å¼ å­çº¿ç¨‹ ä¸»çº¿ç¨‹ å¤‡æ³¨ Schedulers.io() yes â€“ çº¿ç¨‹æ±  Schedulers.newThread() yes â€“ åˆ›å»ºæ–°çš„ Schedulers.computation() yes â€“ å ç”¨CPUï¼Œä¸è¦i/oè€—æ—¶ Schedulers.trampoline() yes yes å½“å‰çº¿ç¨‹ Schedulers.single() yes â€“ å›ºå®šä¸€ä¸ªå­çº¿ç¨‹ Scheduler.from(@NonNull Executor executor) yes yes æŒ‡å®šçº¿ç¨‹ AndroidSchedulers.mainThread() â€“ yes ä¸»çº¿ç¨‹ï¼ŒRxAndroid åœ¨RxJava2ä¸­ï¼ŒåºŸå¼ƒäº†RxJava1ä¸­çš„Schedulers.immediate( ) åœ¨RxJava1ä¸­ï¼ŒSchedulers.immediate( )çš„ä½œç”¨ä¸ºåœ¨å½“å‰çº¿ç¨‹ç«‹å³æ‰§è¡Œä»»åŠ¡ï¼ŒåŠŸèƒ½ç­‰åŒäºŽRxJava2ä¸­çš„Schedulers.trampoline( )ï¼Œä¸åŒçš„æ˜¯ï¼ŒSchedulers.trampoline( )æ˜¯åœä¸‹å½“å‰çš„ä»»åŠ¡ï¼Œå…ˆæ‰§è¡Œæ’å…¥è¿›æ¥çš„ä»»åŠ¡ï¼Œç­‰æ‰§è¡Œå®ŒåŽï¼Œå†å°†æš‚åœçš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œä¸‹åŽ»ã€‚ Schedulers.trampoline( )åœ¨RxJava1ä¸­çš„ä½œç”¨æ˜¯å½“å…¶å®ƒæŽ’é˜Ÿçš„ä»»åŠ¡å®ŒæˆåŽï¼Œåœ¨å½“å‰çº¿ç¨‹æŽ’é˜Ÿå¼€å§‹æ‰§è¡ŒæŽ¥åˆ°çš„ä»»åŠ¡ï¼Œæœ‰ç‚¹åƒRxJava2ä¸­çš„Schedulers.single()ï¼Œä½†ä¹Ÿä¸å®Œå…¨ç›¸åŒï¼Œå› ä¸ºSchedulers.single()ä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹è€Œæ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å•ä¾‹ä¸­æŽ’é˜Ÿæ‰§è¡Œä»»åŠ¡. â€‹ â€‹ subscribeOnå’ŒobserveOnä»‹ç»subscribeOnObservable&lt;T&gt; subscribeOn(Scheduler scheduler) subscribeOné€šè¿‡æŽ¥æ”¶ä¸€ä¸ªSchedulerå‚æ•°ï¼Œæ¥æŒ‡å®šå¯¹æ•°æ®çš„å¤„ç†è¿è¡Œåœ¨ç‰¹å®šçš„çº¿ç¨‹è°ƒåº¦å™¨Schedulerä¸Šã€‚ è‹¥å¤šæ¬¡è®¾å®šï¼Œåˆ™åªæœ‰ä¸€æ¬¡èµ·ä½œç”¨ã€‚ observeOnObservable&lt;T&gt; observeOn(Scheduler scheduler) observeOnåŒæ ·æŽ¥æ”¶ä¸€ä¸ªSchedulerå‚æ•°ï¼Œæ¥æŒ‡å®šä¸‹æ¸¸æ“ä½œè¿è¡Œåœ¨ç‰¹å®šçš„çº¿ç¨‹è°ƒåº¦å™¨Schedulerä¸Šã€‚è‹¥å¤šæ¬¡è®¾å®šï¼Œæ¯æ¬¡å‡èµ·ä½œç”¨ã€‚ ä½¿ç”¨å®žä¾‹å®žä¾‹ä¸€ï¼š1234567891011121314151617181920212223242526272829@Testpublic void rxjavaThreadScheuler()&#123; Integer [] nums = &#123;1,2,3&#125;; Observable.fromArray(nums) .observeOn(Schedulers.single()) .subscribeOn(Schedulers.io()) .map(new Function&lt;Integer, String&gt;() &#123; @Override public String apply(Integer integer) throws Exception &#123; System.out.println("mapA"+"Thread="+Thread.currentThread().getName()+"\r\n"+"integer="+integer); return "num"+integer; &#125; &#125;) .map(new Function&lt;String, Integer&gt;() &#123; @Override public Integer apply(String s) throws Exception &#123; System.out.println("mapB"+"Thread="+Thread.currentThread().getName()+"\r\n"+"String="+s); return Integer.parseInt(s.substring(3,s.length())); &#125; &#125;) .subscribe(new Consumer&lt;Integer&gt;() &#123; @Override public void accept(Integer integer) throws Exception &#123; System.out.println("subscribe"+"Thread="+Thread.currentThread().getName()+"\r\n"+"integer="+integer); System.out.println("========"); &#125; &#125;);&#125; 123456789101112131415161718192021mapAThread=RxSingleScheduler-1integer=1mapBThread=RxSingleScheduler-1String=num1subscribeThread=RxSingleScheduler-1integer=1========mapAThread=RxSingleScheduler-1integer=2mapBThread=RxSingleScheduler-1String=num2subscribeThread=RxSingleScheduler-1integer=2========mapAThread=RxSingleScheduler-1integer=3mapBThread=RxSingleScheduler-1String=num3subscribeThread=RxSingleScheduler-1integer=3======== ç»“è®ºï¼š æ‰“å°çš„æ‰€æœ‰çº¿ç¨‹å‡åœ¨Schedulers.single()ä¸­æ‰§è¡Œï¼Œ subscribeOn(Schedulers.io())è²Œä¼¼æ²¡æœ‰ç”Ÿæ•ˆï¼Œå…¶å®ž Observable.fromArray(nums)çš„æ‰§è¡Œçº¿ç¨‹ï¼Œæ˜¯åœ¨Schedulers.io()çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬é€šè¿‡å®žä¾‹äºŒéªŒè¯ å®žä¾‹äºŒï¼š123456789101112131415161718192021222324@Testpublic void rxjavaThreadScheuler() &#123; Integer[] nums = &#123;1, 2, 3&#125;; Observable.create((ObservableOnSubscribe&lt;Integer&gt;) emitter -&gt; &#123; for (Integer integer : nums) &#123; emitter.onNext(integer); System.out.println("emitter.onNext()" + "Thread=" + Thread.currentThread().getName() + "\r\n" + "integer=" + integer); &#125; &#125;) .observeOn(Schedulers.single()) .subscribeOn(Schedulers.io()) .map(integer -&gt; &#123; System.out.println("mapA" + "Thread=" + Thread.currentThread().getName() + "\r\n" + "integer=" + integer); return "num" + integer; &#125;) .map(s -&gt; &#123; System.out.println("mapB" + "Thread=" + Thread.currentThread().getName() + "\r\n" + "String=" + s); return Integer.parseInt(s.substring(3, s.length())); &#125;) .subscribe(integer -&gt; &#123; System.out.println("subscribe" + "Thread=" + Thread.currentThread().getName() + "\r\n" + "integer=" + integer); System.out.println("========"); &#125;);&#125; logcat 1234567891011121314151617181920212223242526272829//å¯è§ï¼Œäº‹ä»¶çš„å‘å¸ƒï¼Œæ˜¯åœ¨.subscribeOn(Schedulers.io())æŒ‡å®šçš„ioçº¿ç¨‹emitter.onNext()Thread=RxCachedThreadScheduler-1integer=1emitter.onNext()Thread=RxCachedThreadScheduler-1integer=2emitter.onNext()Thread=RxCachedThreadScheduler-1integer=3//å…¶ä»–å‡åœ¨.observeOn(Schedulers.single())æŒ‡å®šçš„Singleçº¿ç¨‹mapAThread=RxSingleScheduler-1integer=1mapBThread=RxSingleScheduler-1String=num1subscribeThread=RxSingleScheduler-1integer=1========mapAThread=RxSingleScheduler-1integer=2mapBThread=RxSingleScheduler-1String=num2subscribeThread=RxSingleScheduler-1integer=2========mapAThread=RxSingleScheduler-1integer=3mapBThread=RxSingleScheduler-1String=num3subscribeThread=RxSingleScheduler-1integer=3======== ç»“è®ºï¼š subscribeOn()æŒ‡å®šçš„æ˜¯äº‹ä»¶çš„å‘å¸ƒæ‰§è¡Œçš„çº¿ç¨‹ï¼ŒobserveOn()æŒ‡å®šçš„æ˜¯å„ç§æ“ä½œç¬¦å’Œsubscribeçš„onNextï¼ŒonErrorï¼ŒonCompleteæ‰§è¡Œç­‰çº¿ç¨‹ï¼Œé‚£ä¹ˆè°ƒç”¨å¤šæ¬¡subscribeOn()æˆ–è€…å¤šæ¬¡observeOn()ï¼Œä¼šä»¥å“ªæ¬¡ä¸ºå‡†å‘¢ï¼Œè¯·çœ‹å®žä¾‹ä¸‰ å®žä¾‹ä¸‰ï¼šå¤šæ¬¡åˆ‡æ¢åœºæ™¯1234567891011121314151617181920212223242526272829303132333435363738394041424344public void rxjavaThreadScheuler() &#123; Integer[] nums = &#123;1, 2, 3&#125;; Observable.create((ObservableOnSubscribe&lt;Integer&gt;) emitter -&gt; &#123; for (Integer integer : nums) &#123; emitter.onNext(integer); Log.e("rxjava", "emitter.onNext()---&gt;" + Thread.currentThread().getName()); &#125; emitter.onComplete(); &#125;) .subscribeOn(AndroidSchedulers.mainThread())//æŒ‡å®šä¸»çº¿ç¨‹å‘å¸ƒäº‹ä»¶ .observeOn(Schedulers.single())//åˆ‡æ¢mapA .map(integer -&gt; &#123; Log.e("rxjava", "mapA---&gt;" + Thread.currentThread().getName()); return "num" + integer; &#125;) .observeOn(AndroidSchedulers.mainThread())//åˆ‡æ¢mapB .map(s -&gt; &#123; Log.e("rxjava", "mapBçº¿ç¨‹---&gt;" + Thread.currentThread().getName()); return Integer.parseInt(s.substring(3, s.length())); &#125;) .observeOn(Schedulers.computation())//åˆ‡æ¢Observeræ‰§è¡Œçº¿ç¨‹ .subscribeOn(Schedulers.io())//å†æ­¤æŒ‡å®šå‘å¸ƒçº¿ç¨‹ä¸ºio .subscribe(new Observer&lt;Integer&gt;() &#123; @Override public void onSubscribe(Disposable d) &#123; Log.e("rxjava", "onSubscribe---&gt;" + Thread.currentThread().getName()); &#125; @Override public void onNext(Integer integer) &#123; Log.e("rxjava", "onNext---&gt;" + Thread.currentThread().getName()); &#125; @Override public void onError(Throwable e) &#123; Log.e("rxjava", "onError---&gt;" + Thread.currentThread().getName()); &#125; @Override public void onComplete() &#123; Log.e("rxjava", "onComplete---&gt;" + Thread.currentThread().getName()); &#125; &#125;); &#125; logcat 123456789101112131415rxjava: onSubscribe---&gt;main//Observerçš„onSubscribeå›žè°ƒå’Œå‘å¸ƒäº‹ä»¶çš„çº¿ç¨‹ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡subscribeOn()ï¼Œè‹¥æœªæŒ‡å®šï¼Œåˆ™åœ¨rxjava: emitter.onNext()---&gt;main//ç¬¬ä¸€æ¬¡subscribeOn()rxjava: emitter.onNext()---&gt;mainrxjava: mapA---&gt;RxSingleScheduler-1//æœ€è¿‘ä¸€æ¬¡observeOnï¼ˆï¼‰æŒ‡å®šçº¿ç¨‹ï¼Œè‹¥æœªæŒ‡å®šï¼Œé»˜è®¤å’ŒsubscribeOnçš„ä¸€è‡´ï¼Œè‹¥subscribeOnä¹ŸæœªæŒ‡å®šï¼Œé»˜è®¤æ˜¯Schedulers.trampoline()rxjava: emitter.onNext()---&gt;mainrxjava: mapA---&gt;RxSingleScheduler-1rxjava: mapA---&gt;RxSingleScheduler-1rxjava: mapBçº¿ç¨‹---&gt;main//æœ€è¿‘ä¸€æ¬¡observeOnï¼ˆï¼‰æŒ‡å®šçº¿ç¨‹rxjava: mapBçº¿ç¨‹---&gt;mainrxjava: mapBçº¿ç¨‹---&gt;mainrxjava: onNext---&gt;RxComputationThreadPool-1//Observerçš„onNextï¼Œç”±æœ€è¿‘ä¸€æ¬¡çš„observeOnï¼ˆï¼‰æŒ‡å®šrxjava: onNext---&gt;RxComputationThreadPool-1rxjava: onNext---&gt;RxComputationThreadPool-1rxjava: onComplete---&gt;RxComputationThreadPool-1//Observerçš„onCompleteï¼Œç”±æœ€è¿‘ä¸€æ¬¡çš„observeOnï¼ˆï¼‰ ç»“è®ºï¼š å¤šä¸ªsubscribeOn()ä»¥ç¬¬ä¸€ä¸ªä¸ºä¸» å¤šä¸ªobserveOnï¼ˆï¼‰æŒ‡å®šä»¥ä¸‹æ“ä½œæ‰§è¡Œçº¿ç¨‹ è‹¥ä¸æŒ‡å®šobserveOnï¼ˆï¼‰ï¼Œé»˜è®¤æŒ‰subscribeOn()æŒ‡å®šçš„çº¿ç¨‹ä¸€è‡´ è‹¥ä¸æŒ‡å®šsubscribeOn()ï¼Œé»˜è®¤æ˜¯Schedulers.trampoline()ï¼ˆåœ¨å½“å‰çº¿ç¨‹ï¼Œåœä¸‹ä¹‹å‰ä»»åŠ¡ï¼Œå…ˆæ‰§è¡Œæœ¬æ¬¡ä»»åŠ¡ï¼‰ æ³¨æ„ï¼šObserverçš„onSubscribe(Disposable d)å›žè°ƒï¼Œä»¥subscribeOn()ä¸ºä¸»ï¼Œè€Œä¸æ˜¯ä»¥observeOnï¼ˆï¼‰ä¸ºä¸» å…¶ä»–ä¸‰ä¸ªå›žè°ƒonNextï¼ŒonErrorï¼ŒonCompleteä»¥observeOnï¼ˆï¼‰ä¸ºä¸» å®žä¾‹å››Schedulers.trampoline()ï¼š log 12345678910111213System.out: å‘å°„çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;å‘å°„:0System.out: æŽ¥æ”¶çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;æŽ¥æ”¶:0System.out: å‘å°„çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;å‘å°„:1System.out: æŽ¥æ”¶çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;æŽ¥æ”¶:1System.out: å‘å°„çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;å‘å°„:2System.out: æŽ¥æ”¶çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;æŽ¥æ”¶:2System.out: å‘å°„çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;å‘å°„:3System.out: æŽ¥æ”¶çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;æŽ¥æ”¶:3System.out: å‘å°„çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;å‘å°„:4System.out: æŽ¥æ”¶çº¿ç¨‹:RxCachedThreadScheduler-1----&gt;æŽ¥æ”¶:4//å¯ä»¥çœ‹åˆ°//Schedulers.trampoline()æŒ‡å®šConsumerå›žè°ƒæ‰§è¡Œçº¿ç¨‹å’Œå‘å¸ƒäº‹ä»¶çº¿ç¨‹ä¸€æ ·//Schedulers.trampoline()çš„ä½œç”¨åœ¨å½“å‰çº¿ç¨‹ç«‹å³æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œï¼Œåˆ™ä¼šå°†å…¶æš‚åœï¼Œç­‰æ’å…¥è¿›æ¥çš„ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åŽï¼Œå†å°†æœªå®Œæˆçš„ä»»åŠ¡æŽ¥ç€æ‰§è¡Œã€‚ ç»“è®ºï¼š Schedulers.trampoline()çš„ä½œç”¨åœ¨å½“å‰çº¿ç¨‹ç«‹å³æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œï¼Œåˆ™ä¼šå°†å…¶æš‚åœï¼Œç­‰æ’å…¥è¿›æ¥çš„ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åŽï¼Œå†å°†æœªå®Œæˆçš„ä»»åŠ¡æŽ¥ç€æ‰§è¡Œã€‚ã€æœ¬å®žä¾‹çš„ä½“çŽ°ï¼šå½“observeæŽ¥å—çš„æ—¶å€™ï¼Œäº‹ä»¶åœæ­¢äº†å‘é€ã€‘ å®žä¾‹äº”Schedulers.single() log 1234567891011121314System.out: å‘å°„çº¿ç¨‹:RxSingleScheduler-1----&gt;å‘å°„:0System.out: å‘å°„çº¿ç¨‹:RxSingleScheduler-1----&gt;å‘å°„:1System.out: å‘å°„çº¿ç¨‹:RxSingleScheduler-1----&gt;å‘å°„:2System.out: å¤„ç†çº¿ç¨‹:RxSingleScheduler-1----&gt;å¤„ç†:0System.out: å¤„ç†çº¿ç¨‹:RxSingleScheduler-1----&gt;å¤„ç†:1System.out: å¤„ç†çº¿ç¨‹:RxSingleScheduler-1----&gt;å¤„ç†:2System.out: æŽ¥æ”¶çº¿ç¨‹:RxSingleScheduler-1----&gt;æŽ¥æ”¶:0System.out: æŽ¥æ”¶çº¿ç¨‹:RxSingleScheduler-1----&gt;æŽ¥æ”¶:1System.out: æŽ¥æ”¶çº¿ç¨‹:RxSingleScheduler-1----&gt;æŽ¥æ”¶:2//å‘å¸ƒå’ŒæŽ¥å—éƒ½æ˜¯singleçº¿ç¨‹//æŽ¥æ”¶åœ¨Schedulers.single()çš„çº¿ç¨‹å•ä¾‹ä¸­æŽ’é˜Ÿæ‰§è¡Œï¼Œå½“æ­¤çº¿ç¨‹ä¸­æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå…¶ä»–ä»»åŠ¡å°†ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºä¾æ¬¡æ‰§è¡Œ //æ‰€ä»¥å¯ä»¥è¾¾åˆ°ã€‚ å®Œå…¨å‘å°„---å®Œå…¨å¤„ç†---å®Œå…¨æŽ¥å—çš„æµç¨‹ å‚è€ƒè¿žæŽ¥]]></content>
      <categories>
        <category>Rxjava</category>
      </categories>
      <tags>
        <tag>Rxjava</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rxjava2.0-çŸ¥è¯†ç¢Žç‰‡(ä¸€)]]></title>
    <url>%2F2018%2F07%2F23%2FRxjava2-0-%E7%9F%A5%E8%AF%86%E7%A2%8E%E7%89%87%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Observable.create(ObservableOnSubscribe)å’Œsubscribe()åŸºæœ¬ä½¿ç”¨ Observable.create(ObservableOnSubscribe)çš„ä½¿ç”¨èŽ·å¾—ä¸€ä¸ªObservableæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œé€šè¿‡æˆ‘ä»¬ä¸‹é¢çš„åŠ¨å›¾å¯ä»¥çœ‹åˆ° ä»Šå¤©çš„ç¢Žç‰‡åŒ–æ•´ç†ï¼Œå°±åªæ•´ç†æœ€æ™®é€šçš„ä¸€ç§æ–¹å¼Observable.create(ObservableOnSubscribe) 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * ObservableEmitter:Emitteræ˜¯å‘å°„å™¨çš„æ„æ€ï¼Œ * å®ƒå¯ä»¥å‘å‡ºä¸‰ç§ç±»åž‹çš„äº‹ä»¶ï¼Œ * é€šè¿‡è°ƒç”¨emitterçš„onNext(T value)ã€onComplete()å’ŒonError(Throwable error)å°±å¯ä»¥åˆ†åˆ«å‘å‡ºnextäº‹ä»¶ã€completeäº‹ä»¶å’Œerroräº‹ä»¶ã€‚ * å‘å°„æ»¡è¶³è§„åˆ™ï¼š * 1ï¼ŒObservableå¯ä»¥å‘é€æ— é™ä¸ªonNext, Observerä¹Ÿå¯ä»¥æŽ¥æ”¶æ— é™ä¸ªonNext * 2ï¼Œå‘é€äº†ä¸€ä¸ªonCompleteåŽ, Observableçš„onCompleteæˆ–è€…onErrorä¹‹åŽçš„äº‹ä»¶å°†ä¼šç»§ç»­å‘é€, è€ŒObserveræ”¶åˆ°onComplete/onErroräº‹ä»¶ä¹‹åŽå°†ä¸å†ç»§ç»­æŽ¥æ”¶äº‹ä»¶. * 3ï¼ŒObservableå¯ä»¥å‘é€æ— é™ä¸ªonNextå¯ä»¥ä¸å‘é€onCompleteæˆ–onError. * 4ï¼ŒObservableä¸å¯ä»¥å‘é€å¤šä¸ªonCompleteå’Œå¤šä¸ªonErrorï¼ˆonCompleteå’ŒonErroråŠ ä¸€èµ·åªèƒ½å‘å°„ä¸€æ¬¡ï¼‰ * 5ï¼ŒObservableå‘å°„å¤šä¸ªonCompleteä¸æŠ¥é”™ï¼ˆåªæ”¶åˆ°ç¬¬ä¸€ä¸ªonCompleteå°±ä¸å†æŽ¥å—äº†ï¼‰ã€‚å‘å°„å¤šä¸ªonErrorä¼šæŠ¥é”™ */@Testpublic void rxjava() &#123; Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123; @Override public void subscribe(ObservableEmitter&lt;String&gt; emitter) throws Exception &#123; emitter.onNext("hello"); emitter.onNext("rxjava"); emitter.onComplete(); emitter.onNext("æ— æ³•æŽ¥å—"); &#125; &#125;).subscribe(new Observer&lt;String&gt;() &#123; @Override public void onSubscribe(Disposable d) &#123; System.out.println("onSubscribe"); &#125; @Override public void onNext(String s) &#123; System.out.println("onNext:value=" + s); &#125; @Override public void onError(Throwable e) &#123; System.out.println("onError:error" + e.getMessage()); &#125; @Override public void onComplete() &#123; System.out.println("onComplete"); &#125; &#125;);&#125; logcatï¼š 1234onSubscribeonNext:value=helloonNext:value=rxjavaonComplete å‘é€è§„åˆ™ å‘å°„æ»¡è¶³è§„åˆ™ï¼š 1ï¼ŒObservableå¯ä»¥å‘é€æ— é™ä¸ªonNext, Observerä¹Ÿå¯ä»¥æŽ¥æ”¶æ— é™ä¸ªonNext 2ï¼Œå‘é€äº†ä¸€ä¸ªonCompleteåŽ, Observableçš„onCompleteæˆ–è€…onErrorä¹‹åŽçš„äº‹ä»¶å°†ä¼šç»§ç»­å‘é€, è€ŒObserveræ”¶åˆ°onComplete/onErroräº‹ä»¶ä¹‹åŽå°†ä¸å†ç»§ç»­æŽ¥æ”¶äº‹ä»¶. 3ï¼ŒObservableå¯ä»¥å‘é€æ— é™ä¸ªonNextå¯ä»¥ä¸å‘é€onCompleteæˆ–onError. 4ï¼ŒObservableä¸å¯ä»¥å‘é€å¤šä¸ªonCompleteå’Œå¤šä¸ªonErrorï¼ˆonCompleteå’ŒonErroråŠ ä¸€èµ·åªèƒ½å‘å°„ä¸€æ¬¡ï¼‰ 5ï¼ŒObservableå‘å°„å¤šä¸ªonCompleteä¸æŠ¥é”™ï¼ˆåªæ”¶åˆ°ç¬¬ä¸€ä¸ªonCompleteå°±ä¸å†æŽ¥å—äº†ï¼‰ã€‚å‘å°„å¤šä¸ªonErrorä¼šæŠ¥é”™ è¿™é‡Œçš„ä¸Šæ¸¸å’Œä¸‹æ¸¸å°±åˆ†åˆ«å¯¹åº”ç€RxJavaä¸­çš„Observableå’ŒObserverï¼Œå®ƒä»¬ä¹‹é—´çš„è¿žæŽ¥å°±å¯¹åº”ç€subscribe() ä»¥ä¸Šå‡ ä¸ªè§„åˆ™ç”¨ç¤ºæ„å›¾è¡¨ç¤ºå¦‚ä¸‹: ç¤ºæ„å›¾ åªå‘é€onNextäº‹ä»¶ next å‘é€onCompleteäº‹ä»¶ complete å‘é€onErroräº‹ä»¶ error å‚è€ƒé“¾æŽ¥ onSubscribe(Disposable d)çš„å‚æ•°Disposable12345678910111213141516171819202122232425262728293031323334353637383940414243@Test public void rxjava() &#123; Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123; @Override public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123; emitter.onNext(1); emitter.onNext(2); emitter.onNext(3); emitter.onNext(4); emitter.onNext(5); emitter.onComplete(); &#125; &#125;).subscribe(new Observer&lt;Integer&gt;() &#123; public Disposable mDisposable; @Override public void onSubscribe(Disposable d) &#123; System.out.println("onSubscribe"); this.mDisposable = d; &#125; @Override public void onNext(Integer integer) &#123; if (integer == 3) &#123; System.out.println("onNext:isDisposed=" + mDisposable.isDisposed()); mDisposable.dispose(); System.out.println("onNext:isDisposed=" + mDisposable.isDisposed()); &#125; System.out.println("onNext:valuse=" + integer); &#125; @Override public void onError(Throwable e) &#123; System.out.println("onError"); &#125; @Override public void onComplete() &#123; System.out.println("onComplete"); &#125; &#125;); &#125; logcatï¼š 123456onSubscribeonNext:valuse=1onNext:valuse=2onNext:isDisposed=falseonNext:isDisposed=trueonNext:valuse=3 ç”±ä»£ç å¯çœ‹å‡ºï¼š onSubscribeæ–¹æ³•æœ€å…ˆè°ƒç”¨ï¼Œå¹¶ä¸”åªè°ƒç”¨ä¸€æ¬¡ Disposable.dispose()è°ƒç”¨åŽï¼ŒonNextå°†æŽ¥å—ä¸åˆ°å‘å‡ºçš„4ï¼Œ5äº‹ä»¶ï¼ˆä½†æ˜¯emitter.onNext(4);â€‹ emitter.onNext(5)ç¡®å®žæ‰§è¡Œäº†ï¼› Disposableçš„ç”¨å¤„ä¸æ­¢è¿™äº›, åŽé¢è®²è§£åˆ°äº†çº¿ç¨‹çš„è°ƒåº¦ä¹‹åŽ, æˆ‘ä»¬ä¼šå‘çŽ°å®ƒçš„é‡è¦æ€§.åŽç»­è¡¥å…… subscribe()çš„å¤šä¸ªé‡è½½çš„æ–¹æ³•1234561,public final Disposable subscribe() &#123;&#125;2,public final Disposable subscribe(Consumer&lt;? super T&gt; onNext) &#123;&#125;3,public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError) &#123;&#125; 4,public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError, Action onComplete) &#123;&#125;5,public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError, Action onComplete, Consumer&lt;? super Disposable&gt; onSubscribe) &#123;&#125;6,public final void subscribe(Observer&lt;? super T&gt; observer) &#123;&#125; ä¸å¸¦ä»»ä½•å‚æ•°çš„subscribe() è¡¨ç¤ºä¸‹æ¸¸ä¸å…³å¿ƒä»»ä½•äº‹ä»¶,ä½ ä¸Šæ¸¸å°½ç®¡å‘ä½ çš„æ•°æ®åŽ»å§, ä¸‹æ¸¸æ— æ³•æŽ¥å— å¸¦æœ‰ä¸€ä¸ªConsumerå‚æ•°çš„æ–¹æ³•è¡¨ç¤ºä¸‹æ¸¸åªå…³å¿ƒonNextäº‹ä»¶, å…¶ä»–çš„äº‹ä»¶æˆ‘å‡è£…æ²¡çœ‹è§, å› æ­¤æˆ‘ä»¬å¦‚æžœåªéœ€è¦onNextäº‹ä»¶å¯ä»¥è¿™ä¹ˆå†™ Observerå‚æ•°ï¼Œå¦‚ä¾‹å­ï¼Œæ¯”è¾ƒå®Œæ•´çš„onSubscribeï¼ŒonNextï¼ŒonCompleteï¼ŒonError å¦‚æžœæˆ‘ä»¬ä¸éœ€è¦å…¶ä»–å›žè°ƒï¼Œå¯é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„Consumer çš„å…·ä½“å‚æ•° å‚è€ƒé“¾æŽ¥]]></content>
      <categories>
        <category>Rxjava</category>
      </categories>
      <tags>
        <tag>Rxjava</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SharedPreferencesçš„ç¼ºé™·]]></title>
    <url>%2F2018%2F07%2F19%2FSharedPreferences%E7%9A%84%E7%BC%BA%E9%99%B7%2F</url>
    <content type="text"><![CDATA[SharedPreferencesåœ¨Androidä½¿ç”¨éžå¸¸æ™®éï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹å®ƒçš„ä¸è¶³ä¹‹å¤„å’Œä½¿ç”¨æ³¨æ„äº‹é¡¹ å‰è¨€SharedPreferencesæ˜¯Android SDKæä¾›çš„å·¥å…·ï¼Œå¯ä»¥å­˜å‚¨åº”ç”¨çš„ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šä»¥é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åœ¨/sdcard/data/data/packageName/shared_prefs/è·¯å¾„ä¸‹çš„ä¸€ä¸ªxmlæ–‡ä»¶ä¸­ã€‚å®ƒæä¾›äº†å¤šç§æ•°æ®ç±»åž‹çš„å­˜å‚¨ï¼ŒåŒ…æ‹¬ï¼šintã€longã€booleanã€floatã€Stringä»¥åŠSet&lt;String&gt;ã€‚ ä½¿ç”¨æ–¹å¼ context.getSharedPreference(name, mode); PreferenceManager.getDefaultSharedPreferences(context); è¿™ä¸¤ç§æ–¹å¼å…¶å®žå…·ä½“å®žçŽ°æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯å¼€å‘è€…è‡ªå·±å®šä¹‰åå­—ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨åŒ…å+â€_preferenceâ€ä½œä¸ºå­˜å‚¨æ–‡ä»¶åã€‚ é—®é¢˜è‹¥æˆ‘ä»¬å¤§é‡ä½¿ç”¨PreferenceManager.getDefaultSharedPreferences(context);ï¼Œå°†å„ç§é…ç½®é¡¹å…¨éƒ¨å­˜å‚¨åˆ°ä¸€ä¸ªspä¸­ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šè¯¥æ–‡ä»¶è¿‡å¤§ï¼Œè¯»å–é…ç½®é¡¹è¿‡æ…¢ æ‰€ä»¥æŽ¨èï¼Œæ ¹æ®æƒ…å†µï¼Œå°†ä¸åŒçš„é…ç½®æ–‡ä»¶ä¿å­˜åœ¨ä¸åŒçš„spä¸­ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ä½¿ç”¨é»˜è®¤çš„spï¼Œå¯¼è‡´åŒä¸€ä¸ªspæ–‡ä»¶è¿‡å¤§ ç¬¬ä¸€æ¬¡ä»Žspä¸­èŽ·å–å€¼çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½é˜»å¡žä¸»çº¿ç¨‹ï¼Œä½¿ç•Œé¢å¡é¡¿ã€æŽ‰å¸§ã€‚ è§£æžspçš„æ—¶å€™ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶å¯¹è±¡ï¼Œå¯¼è‡´é¢‘ç¹GCï¼Œå¼•èµ·ç•Œé¢å¡é¡¿ã€‚ è¿™äº›keyå’Œvalueä¼šæ°¸è¿œå­˜åœ¨äºŽå†…å­˜ä¹‹ä¸­ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚ å…¶ä»–æ³¨æ„ è¢«åŠ è½½è¿›æ¥çš„è¿™äº›å¤§å¯¹è±¡ï¼Œä¼šæ°¸è¿œå­˜åœ¨äºŽå†…å­˜ä¹‹ä¸­ï¼Œä¸ä¼šè¢«é‡Šæ”¾ã€‚ ContextImplè¿™ä¸ªç±»ï¼Œåœ¨getSharedPreferenceçš„æ—¶å€™ä¼šæŠŠæ‰€æœ‰çš„spæ”¾åˆ°ä¸€ä¸ªé™æ€å˜é‡é‡Œé¢ç¼“å­˜èµ·æ¥ï¼š staticçš„sSharedPrefsCacheï¼Œå®ƒä¿å­˜äº†ä½ æ‰€æœ‰ä½¿ç”¨çš„sp 1234567891011121314151617@GuardedBy("ContextImpl.class")private static ArrayMap&lt;String, ArrayMap&lt;File, SharedPreferencesImpl&gt;&gt;sSharedPrefsCache;private ArrayMap&lt;File, SharedPreferencesImpl&gt; getSharedPreferencesCacheLocked() &#123; if (sSharedPrefsCache == null) &#123; sSharedPrefsCache = new ArrayMap&lt;&gt;(); &#125; final String packageName = getPackageName(); ArrayMap&lt;File, SharedPreferencesImpl&gt; packagePrefs = sSharedPrefsCache.get(packageName); if (packagePrefs == null) &#123; packagePrefs = new ArrayMap&lt;&gt;(); sSharedPrefsCache.put(packageName, packagePrefs); &#125; return packagePrefs;&#125; å­˜å‚¨JSONç­‰ç‰¹æ®Šç¬¦å·å¾ˆå¤šçš„value åœ¨spé‡Œé¢å­˜jsonæˆ–è€…HTMLï¼›è¿™ä¹ˆåšä¸æ˜¯ä¸å¯ä»¥ï¼Œä½†æ˜¯ï¼Œå¦‚æžœè¿™ä¸ªjsonç›¸å¯¹è¾ƒå¤§ï¼Œé‚£ä¹ˆä¹Ÿä¼šå¼•èµ·spè¯»å–é€Ÿåº¦çš„æ€¥å‰§ä¸‹é™ã€‚ JSONæˆ–è€…HTMLæ ¼å¼å­˜æ”¾åœ¨spé‡Œé¢çš„æ—¶å€™ï¼Œéœ€è¦è½¬ä¹‰ï¼Œè¿™æ ·ä¼šå¸¦æ¥å¾ˆå¤š &amp; è¿™ç§ç‰¹æ®Šç¬¦å·ï¼Œspåœ¨è§£æžç¢°åˆ°è¿™ä¸ªç‰¹æ®Šç¬¦å·çš„æ—¶å€™ä¼šè¿›è¡Œç‰¹æ®Šçš„å¤„ç†ï¼Œå¼•å‘é¢å¤–çš„å­—ç¬¦ä¸²æ‹¼æŽ¥ä»¥åŠå‡½æ•°è°ƒç”¨å¼€é”€ã€‚è€ŒJSONæœ¬æ¥å°±æ˜¯å¯ä»¥ç”¨æ¥åšé…ç½®æ–‡ä»¶çš„ï¼Œä½ å¹²å˜›åˆæŠŠå®ƒæ”¾åœ¨spé‡Œé¢å‘¢ï¼Ÿ å¤šæ¬¡editå¤šæ¬¡apply 12345SharedPreferences sp = getSharedPreferences("test", MODE_PRIVATE);sp.edit().putString("test1", "sss").apply();sp.edit().putString("test2", "sss").apply();sp.edit().putString("test3", "sss").apply();sp.edit().putString("test4", "sss").apply(); æ¯æ¬¡editéƒ½ä¼šåˆ›å»ºä¸€ä¸ªEditorå¯¹è±¡ï¼Œé¢å¤–å ç”¨å†…å­˜ï¼›å½“ç„¶å¤šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ä¹Ÿå½±å“ä¸äº†å¤šå°‘ï¼›ä½†æ˜¯ï¼Œå¤šæ¬¡applyä¹Ÿä¼šå¡ç•Œé¢ä½ é€ å—ï¼Ÿ æœ‰ç«¥éž‹ä¼šè¯´ï¼Œapplyä¸æ˜¯åœ¨åˆ«çš„çº¿ç¨‹äº›ç£ç›˜çš„å—ï¼Œæ€Žä¹ˆå¯èƒ½å¡ç•Œé¢ï¼Ÿæˆ‘å¸¦ä½ ä»”ç»†çœ‹ä¸€ä¸‹æºç ã€‚ 1234567891011121314151617181920212223public void apply() &#123; final MemoryCommitResult mcr = commitToMemory(); final Runnable awaitCommit = new Runnable() &#123; public void run() &#123; try &#123; mcr.writtenToDiskLatch.await(); &#125; catch (InterruptedException ignored) &#123; &#125; &#125; &#125;; QueuedWork.add(awaitCommit); Runnable postWriteRunnable = new Runnable() &#123; public void run() &#123; awaitCommit.run(); QueuedWork.remove(awaitCommit); &#125; &#125;; SharedPreferencesImpl.this.enqueueDiskWrite(mcr, postWriteRunnable); notifyListeners(mcr);&#125; æ³¨æ„ä¸¤ç‚¹ï¼Œç¬¬ä¸€ï¼ŒæŠŠä¸€ä¸ªå¸¦æœ‰awaitçš„runnableæ·»åŠ è¿›äº†QueueWorkç±»çš„ä¸€ä¸ªé˜Ÿåˆ—ï¼›ç¬¬äºŒï¼ŒæŠŠè¿™ä¸ªå†™å…¥ä»»åŠ¡é€šè¿‡enqueueDiskWriteä¸¢ç»™äº†ä¸€ä¸ªåªæœ‰å•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± æ‰§è¡Œã€‚ åˆ°è¿™é‡Œä¸€åˆ‡éƒ½OKï¼Œåœ¨å­çº¿ç¨‹é‡Œé¢å†™å…¥ä¸ä¼šå¡UIã€‚ä½†æ˜¯ï¼Œä½ åŽ»ActivityThreadç±»çš„handleStopActivityé‡Œçœ‹ä¸€çœ‹ï¼š 12345678910private void handleStopActivity(IBinder token, boolean show, int configChanges, int seq) &#123; // çœç•¥æ— å…³ã€‚ã€‚ // Make sure any pending writes are now committed.ï¼ˆç¡®ä¿æ‰€æœ‰å»¶è¿Ÿå†™å…¥å®Œæˆï¼‰ if (!r.isPreHoneycomb()) &#123; QueuedWork.waitToFinish(); &#125; // çœç•¥æ— å…³ã€‚ã€‚&#125; å¦‚æžœåœ¨Activity Stopçš„æ—¶å€™ï¼Œå·²ç»å†™å…¥å®Œæ¯•äº†ï¼Œé‚£ä¹ˆä¸‡äº‹å¤§å‰ï¼Œä¸ä¼šæœ‰ä»»ä½•ç­‰å¾…ï¼Œè¿™ä¸ªå‡½æ•°ä¼šç«‹é©¬è¿”å›žã€‚ä½†æ˜¯ï¼Œå¦‚æžœä½ ä½¿ç”¨äº†å¤ªå¤šæ¬¡çš„applyï¼Œé‚£ä¹ˆæ„å‘³ç€å†™å…¥é˜Ÿåˆ—ä¼šæœ‰å¾ˆå¤šå†™å…¥ä»»åŠ¡ï¼Œè€Œé‚£é‡Œå°±åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å†™ã€‚å½“Appè§„æ¨¡å¾ˆå¤§çš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µç®€ç›´å°±å¤ªå¸¸è§äº† è™½ç„¶applyæ˜¯åœ¨å­çº¿ç¨‹æ‰§è¡Œçš„ï¼Œä½†æ˜¯è¯·ä¸è¦æ— èŠ‚åˆ¶åœ°applyï¼›commitæˆ‘å°±ä¸å¤šè¯´äº†å§ï¼Ÿç›´æŽ¥åœ¨å½“å‰çº¿ç¨‹å†™å…¥ï¼Œå¦‚æžœä½ åœ¨ä¸»çº¿ç¨‹å¹²è¿™ä¸ª SPå¤šè¿›ç¨‹ä¸å¯é  spæœ‰ä¸€ä¸ªè²Œä¼¼å¯ä»¥æä¾›ã€Œè·¨è¿›ç¨‹ã€åŠŸèƒ½çš„FLAGâ€”â€”MODE_MULTI_PROCESS æ–‡æ¡£ä¹Ÿè¯´äº†ï¼Œè¿™çŽ©æ„åœ¨æŸäº›Androidç‰ˆæœ¬ä¸Šä¸å¯é ï¼Œå¹¶ä¸”æœªæ¥ä¹Ÿä¸ä¼šæä¾›ä»»ä½•æ”¯æŒï¼Œè¦æ˜¯ç”¨è·¨è¿›ç¨‹æ•°æ®ä¼ è¾“éœ€è¦ä½¿ç”¨ç±»ä¼¼ContentProviderçš„ä¸œè¥¿ã€‚è€Œä¸”ï¼ŒSharedPreferenceçš„æ–‡æ¡£ä¹Ÿç‰¹åˆ«è¯´æ˜Žï¼š Note: This class does not support use across multiple processes. 12345678910111213141516171819202122@Overridepublic SharedPreferences getSharedPreferences(File file, int mode) &#123; checkMode(mode); SharedPreferencesImpl sp; synchronized (ContextImpl.class) &#123; final ArrayMap&lt;File, SharedPreferencesImpl&gt; cache = getSharedPreferencesCacheLocked(); sp = cache.get(file); if (sp == null) &#123; sp = new SharedPreferencesImpl(file, mode); cache.put(file, sp); return sp; &#125; &#125; if ((mode &amp; Context.MODE_MULTI_PROCESS) != 0 || getApplicationInfo().targetSdkVersion &lt; android.os.Build.VERSION_CODES.HONEYCOMB) &#123; // If somebody else (some other process) changed the prefs // file behind our back, we reload it. This has been the // historical (if undocumented) behavior. sp.startReloadIfChangedUnexpectedly(); &#125; return sp;&#125; è¿™ä¸ªflagä¿è¯äº†å•¥ï¼Ÿä¿è¯äº†åœ¨API 11ä»¥å‰çš„ç³»ç»Ÿä¸Šï¼Œå¦‚æžœspå·²ç»è¢«è¯»å–è¿›å†…å­˜ï¼Œå†æ¬¡èŽ·å–è¿™ä¸ªspçš„æ—¶å€™ï¼Œå¦‚æžœæœ‰è¿™ä¸ªflagï¼Œä¼šé‡æ–°è¯»ä¸€éæ–‡ä»¶ï¼Œä»…æ­¤è€Œå·² æ€»ç»“ ä¸è¦å­˜æ”¾å¤§çš„keyå’Œvalueï¼ä¼šå¼•èµ·ç•Œé¢å¡ã€é¢‘ç¹GCã€å ç”¨å†…å­˜ç­‰ç­‰ æ¯«ä¸ç›¸å…³çš„é…ç½®é¡¹å°±ä¸è¦ä¸¢åœ¨ä¸€èµ·äº†ï¼æ–‡ä»¶è¶Šå¤§è¯»å–è¶Šæ…¢ï¼Œé˜²æ­¢å…¨éƒ¨æ”¾è¿›defalutçš„spï¼ è¯»å–é¢‘ç¹çš„keyå’Œä¸æ˜“å˜åŠ¨çš„keyå°½é‡ä¸è¦æ”¾åœ¨ä¸€èµ·ï¼Œå½±å“é€Ÿåº¦ã€‚ï¼ˆå¦‚æžœæ•´ä¸ªæ–‡ä»¶å¾ˆå°ï¼Œé‚£ä¹ˆå¿½ç•¥å§ï¼Œä¸ºäº†è¿™ç‚¹æ€§èƒ½æ·»åŠ ç»´æŠ¤æˆæœ¬å¾—ä¸å¿å¤±ï¼‰ ä¸è¦ä¹±editå’Œapplyï¼Œæ¯æ¬¡editä¼šåˆ›å»ºæ–°çš„EditorImplå¯¹è±¡ï¼Œå°½é‡æ‰¹é‡ä¿®æ”¹ä¸€æ¬¡æäº¤ï¼ å°½é‡ä¸è¦å­˜æ”¾JSONå’ŒHTMLï¼Œè¿™ç§åœºæ™¯è¯·ç›´æŽ¥ä½¿ç”¨jsonï¼ˆæ–‡ä»¶å­˜å–ï¼‰ï¼ Commitå‘ç”Ÿåœ¨UIçº¿ç¨‹ä¸­ï¼Œapplyå‘ç”Ÿåœ¨å·¥ä½œçº¿ç¨‹ä¸­ï¼Œå¯¹äºŽæ•°æ®çš„æäº¤æœ€å¥½æ˜¯æ‰¹é‡æ“ä½œç»Ÿä¸€æäº¤ã€‚è™½ç„¶applyå‘ç”Ÿåœ¨å·¥ä½œçº¿ç¨‹ï¼ˆä¸ä¼šå› ä¸ºIOé˜»å¡žUIçº¿ç¨‹ï¼‰ä½†æ˜¯å¦‚æžœæ·»åŠ ä»»åŠ¡è¾ƒå¤šä¹Ÿæœ‰å¯èƒ½å¸¦æ¥å…¶ä»–ä¸¥é‡åŽæžœï¼ˆå‚ç…§ActivityThreadæºç ä¸­handleStopActivityæ–¹æ³•å®žçŽ°ï¼‰ã€‚ è·¨è¿›ç¨‹é€šä¿¡ä¸å¯é ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[shadowsocksæœåŠ¡ç«¯éƒ¨ç½²]]></title>
    <url>%2F2018%2F07%2F18%2Fshadowsocks%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[åŸºäºŽUbuntu 16.04çš„ShadowsocksæœåŠ¡ç«¯å®‰è£… å®‰è£…æ­¥éª¤1ï¼Œé¦–å…ˆæ£€æŸ¥ä¸‹Python ç‰ˆæœ¬ï¼Œè¦æœ‰ 2.6 or 2.7.12python --versionPython 2.7.4 2ï¼Œå®‰è£…pythonåŒ…ç®¡ç†å™¨1apt-get install python-pip 3ï¼Œå®‰è£…shadowsocks1pip install shadowsocks 4ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶1vim /etc/shadowsocks/config.json 1234567891011121314&#123; "server":"0.0.0.0", "server_port":8388, "local_address": "127.0.0.1", "local_port":1080, "password":"yourpsw", "timeout":300, "method":"bf-cfb", "fast_open": true, "workers": 10&#125;æ³¨æ„ï¼šserver 0ï¼Œ0ï¼Œ0ï¼Œ0ï¼ˆå…¶ä»–å¯èƒ½å‡ºé—®é¢˜ï¼‰method bf-cfbï¼ˆå…¶ä»–å¯èƒ½å‡ºé—®é¢˜ï¼‰ 5ï¼Œå¼€å¯1sudo ssserver -c /etc/shadowsocks/config.json 6ï¼Œè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ ç¼–è¾‘ 1vim /etc/rc.local ç„¶åŽåœ¨exit 0ä¹‹å‰åŠ å…¥1sudo ssserver -c /etc/shadowsocks/config.json é‡å¯ 1â— reboot é‡å¯åŽæŸ¥çœ‹è¿›ç¨‹ 1ps aux | grep shadowsocks å‚è€ƒï¼šå‚è€ƒ1 å‚è€ƒ2 å‚è€ƒ3]]></content>
      <categories>
        <category>Dev</category>
      </categories>
      <tags>
        <tag>Dev</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlå…³è”é˜¿é‡Œäº‘dms]]></title>
    <url>%2F2018%2F06%2F14%2Fmysql%E5%85%B3%E8%81%94%E9%98%BF%E9%87%8C%E4%BA%91dms%2F</url>
    <content type="text"><![CDATA[å°†è¿œç¨‹æœåŠ¡å™¨ä¸­çš„mysqlç»‘å®šåˆ°é˜¿é‡Œäº‘DMSä¸­ é˜¿é‡Œäº‘DMSç»‘å®šmysql æ•°æ®ç®¡ç†DMSç™»å½•äº‘æœåŠ¡å™¨çš„IPæ®µï¼ˆç»å…¸ç½‘ç»œï¼‰ï¼šDMSçš„ipæ®µ 120.55.177.0/24 121.43.18.0/24 101.37.74.0/24 10.153.176.106/24 10.137.42.136/24 11.193.54.0/24 æ•°æ®ç®¡ç†DMSç™»å½•äº‘æœåŠ¡å™¨çš„IPæ®µï¼ˆVPCï¼‰ï¼š 100.104.175.0/24 100.104.72.0/24 100.104.5.0/24 100.104.205.0/24 æ·»åŠ ç™½åå•1ï¼Œç™»å½•mysqlï¼š 1mysql -h host -u username -p password 2ï¼Œåˆ‡æ¢è‡³mysqlåº“ï¼š 1use mysql; 3 æŸ¥çœ‹å½“å‰å…è®¸ç™»å½•IPåŠç”¨æˆ· 1select Host,User from user; 4 åˆ é™¤ä¸å¿…è¦è€Œè¡¨ä¸­å­˜åœ¨çš„IPå’Œç”¨æˆ· 1DELETE FROM user WHERE User='username' and Host='host'; (hostå€¼ä¸ºâ€œ%â€æˆ–ç©ºè¡¨ç¤ºæ‰€æœ‰IPéƒ½å¯ç™»å½•ï¼Œä¸€èˆ¬æ¥è¯´æ­¤ç±»è¡Œéœ€è¦åˆ æŽ‰) 5 å¢žåŠ éœ€è¦è€Œè¡¨ä¸­æ²¡æœ‰çš„IPå’Œç”¨æˆ· 1GRANT ALL PRIVILEGES ON *.* TO 'username'@'host' IDENTIFIED BY 'password' WITH GRANT OPTION; 6 ä½¿æ›´æ–°çš„é…ç½®ç”Ÿæ•ˆ 1FLUSH PRIVILEGES; ç™»å½•mysqlå¤±è´¥é—®é¢˜é”™è¯¯ ERROR 1045 (28000): Access denied for user â€˜rootâ€™@â€™localhostâ€™ (using password: YES) vim /etc/my.cnf(æ³¨ï¼šwindowsä¸‹ä¿®æ”¹çš„æ˜¯my.ini) 123456789101112131415161718192021[mysqld]sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES# ä¸€èˆ¬é…ç½®é€‰é¡¹basedir = /usr/local/mysqldatadir = /usr/local/mysql/dataport = 3306socket = /tmp/mysql.sockcharacter-set-server=utf8#åœ¨æ­¤æ·»åŠ ã€ä¸»æ„æ˜¯åœ¨[mysqld]å†…éƒ¨ã€‘skip-grant-tablesback_log = 300max_connections = 1000max_connect_errors = 50table_open_cache = 4096max_allowed_packet = 32M#binlog_cache_size = 4M :wq ä¿å­˜ æŽ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦é‡å¯MySQLï¼š å„ä¸ªå¹³å°é‡å¯mysqlçš„æ–¹å¼ 1service mysqld restart é‡å¯ä¹‹åŽè¾“å…¥#mysqlå³å¯è¿›å…¥mysqlã€‚ æŽ¥ä¸‹æ¥å°±æ˜¯ç”¨sqlæ¥ä¿®æ”¹rootçš„å¯†ç  123456mysql&gt; use mysql;mysql&gt; update user set password=password("ä½ çš„æ–°å¯†ç ") where user="root";mysql&gt; flush privileges;mysql&gt; quitåˆ°è¿™é‡Œrootè´¦æˆ·å°±å·²ç»é‡ç½®æˆæ–°çš„å¯†ç äº†ã€‚ 5.ç¼–è¾‘my.cnf,åŽ»æŽ‰åˆšæ‰æ·»åŠ çš„å†…å®¹ï¼Œç„¶åŽé‡å¯MySQLã€‚ æŸ¥çœ‹å½“å‰mysqlç”¨æˆ·è¡¨hostä¸º% ä»£è¡¨ä»»æ„åŸŸåä¸‹éƒ½å¯ä»¥è®¿é—® 12345678910mysql&gt; select Host,User from user;+-----------------+-----------+| Host | User |+-----------------+-----------+| % | dms || 120.55.177.0/24 | dms || localhost | mysql.sys || localhost | root |+-----------------+-----------+4 rows in set (0.00 sec)]]></content>
      <categories>
        <category>Dev</category>
      </categories>
      <tags>
        <tag>Dev</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeç¢Žç‰‡æ•´ç†ä¹‹Props]]></title>
    <url>%2F2018%2F04%2F28%2FReactNative%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86%E4%B9%8BProps%2F</url>
    <content type="text"><![CDATA[propsçš„å±žæ€§éƒ½æ˜¯çˆ¶ç»„ä»¶ä¼ é€’çš„ï¼Œæ‰€ä»¥æ— æ³•ä¿®æ”¹å®ƒï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŒ‡å®šé»˜è®¤propï¼› åŸºæœ¬ä»‹ç»å¤§å¤šæ•°ç»„ä»¶åˆ›å»ºçš„æ—¶å°±å¯ä»¥ä½¿ç”¨å„ç§å‚æ•°æ¥å®šåˆ¶ï¼ˆå¯ä»¥ç†è§£ä¸ºAndroidè‡ªå®šä¹‰Viewçš„ä¼ å€¼ï¼‰ã€‚ä½†è¿™æ˜¯ä¸å‡†ç¡®çš„ï¼Œpropsåœ¨RNä¸­ä»£è¡¨ç€å±žæ€§ï¼Œæ˜¯ä¸ºäº†æè¿°ä¸€ä¸ªç»„ä»¶çš„ç‰¹å¾è€Œå­˜åœ¨ï¼Œå®ƒæ˜¯ç”±çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„ï¼ˆè°ƒç”¨æ–¹ä¼ å…¥ï¼‰è€Œä¸”ä¸€ç»æŒ‡å®šï¼Œåœ¨è¢«æŒ‡å®šçš„ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåˆ™ä¸åœ¨æ”¹å˜ï¼ˆè¿™ä¸Žstateä¸åŒï¼‰ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰å­ç»„ä»¶çš„å±žæ€§ï¼Œä½†ä¸å¯ä»¥æ·»åŠ é»˜è®¤å±žæ€§ï¼ˆå¯ä»¥åœ¨å­ç»„ä»¶ä¸­æ·»åŠ é»˜è®¤å±žæ€§ï¼‰ï¼Œpropsé™¤äº†ä¼ é€’å±žæ€§å€¼ï¼Œè¿˜æœ‰çº¦æŸä½œç”¨â€¦ æ™®é€šä½¿ç”¨ä»¥å¸¸è§çš„åŸºç¡€ç»„ä»¶Imageä¸ºä¾‹ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªå›¾ç‰‡æ—¶ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªåä¸ºsourceçš„ prop æ¥æŒ‡å®šè¦æ˜¾ç¤ºçš„å›¾ç‰‡çš„åœ°å€ï¼Œä»¥åŠä½¿ç”¨åä¸ºstyleçš„ prop æ¥æŽ§åˆ¶å…¶å°ºå¯¸ã€‚ 12345678910111213import React, &#123; Component &#125; from 'react';import &#123; Image &#125; from 'react-native';export default class Bananas extends Component &#123; render() &#123; let pic = &#123; uri: 'https://upload.wikimedia.org/wikipedia/commons/d/de/Bananavarieties.jpg' &#125;; return ( &lt;Image source=&#123;pic&#125; style=&#123;&#123;width: 193, height: 110&#125;&#125; /&gt; ); &#125;&#125; ä»¥ä¸Šå°±æ˜¯propçš„æœ€ç®€å•çš„ç†è§£ï¼ŒåŸºç¡€ç»„ä»¶Imageçš„styleå’Œresourceéƒ½æ˜¯å®ƒçš„propå±žæ€§ è‡ªå®šä¹‰Props123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import React, &#123;Component&#125; from 'react';import &#123; View, StyleSheet, Alert, TouchableOpacity, Text,&#125; from 'react-native';class MyText extends Component &#123; // æž„é€  constructor(props) &#123; super(props); &#125; //æŒ‡å®šé»˜è®¤props static defaultProps = &#123; myText: 'é»˜è®¤å€¼' &#125; render() &#123; return ( &lt;TouchableOpacity onPress=&#123;() =&gt; &#123; Alert.alert('Alert') &#125;&#125;&gt; &lt;Text style=&#123;styles.continer&#125;&gt; hello &#123;this.props.myText&#125;! &lt;/Text&gt; &lt;/TouchableOpacity&gt; ) &#125;&#125;export default class App extends Component&lt;Props&gt; &#123; render() &#123; return ( &lt;View style=&#123;&#123;alignItems: 'center'&#125;&#125;&gt; &lt;MyText myText='æµ‹è¯•'/&gt; &lt;MyText myText='android'/&gt; &lt;MyText myText='ios'/&gt; &#123;/*ä¼ å…¥æœªæŒ‡å®šçš„pros*/&#125; &lt;MyText test='hello'/&gt; &#123;/*æœªä¼ å…¥pros*/&#125; &lt;MyText /&gt; &lt;/View&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; continer: &#123; color: '#ffffff', fontSize: 17, backgroundColor: '#00a056', margin: 20, padding: 10, shadowColor: '#00a056', shadowOffset: &#123;width: 3, height: 3&#125;, shadowOpacity: 0.5, shadowRadius: 4 &#125;&#125;) propsçº¦æŸä½¿ç”¨PropTypes å·²ç»è¢«å–æ¶ˆäº† react nativeå…³äºŽ ä»Žreactä¸­å¼•å…¥PropTypesæŠ¥é”™çš„é—®é¢˜ æ–¹æ³•ä¸­è°ƒç”¨this.propsçš„é—®é¢˜12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061import React, &#123;Component&#125; from 'react';import &#123; View, StyleSheet, Alert, TouchableOpacity, Text,&#125; from 'react-native';class MyText extends Component &#123; // æž„é€  constructor(props) &#123; super(props); &#125; //æŒ‡å®šé»˜è®¤props static defaultProps = &#123; name: 'å†¯è‹±ä¿Š', age: 1, &#125; //ç‚¹å‡»å¼¹å‡ºä¼ å…¥çš„ä¿¡æ¯ _onClickEvent() &#123; Alert.alert(this.props.name, "å¹´çºª" + this.props.age) &#125; render() &#123; return ( &lt;TouchableOpacity onPress=&#123;this._onClickEvent&#125;&gt; &lt;Text style=&#123;styles.continer&#125;&gt; hello &#123;this.props.name&#125;ä½ çš„å¹´çºªæ˜¯&#123;this.props.age&#125;! &lt;/Text&gt; &lt;/TouchableOpacity&gt; ) &#125;&#125;export default class App extends Component&lt;Props&gt; &#123; render() &#123; return ( &lt;View style=&#123;&#123;alignItems: 'center'&#125;&#125;&gt; &lt;MyText name='åˆ˜å¾·åŽ' age=&#123;20&#125;/&gt; &lt;MyText age=&#123;18&#125;/&gt; &lt;MyText name='åˆ˜å¾·åŽ' age=&#123;22&#125;/&gt; &lt;MyText name='åˆ˜å¾·åŽ' age=&#123;30&#125;/&gt; &lt;/View&gt; ) &#125;&#125;const styles = StyleSheet.create(&#123; continer: &#123; color: '#ffffff', fontSize: 17, backgroundColor: '#00a056', margin: 20, padding: 10, shadowColor: '#00a056', shadowOffset: &#123;width: 3, height: 3&#125;, shadowOpacity: 0.5, shadowRadius: 4 &#125;&#125;) React Nativeç»‘å®šthis(bind(this)) ã€React Nativeã€‘React Nativeçš„bindæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647_onClickEvent() &#123; Alert.alert(this.props.name, "å¹´çºª" + this.props.age)&#125;//ä¿®æ”¹ä¸ºï¼šrender() &#123; return ( &lt;TouchableOpacity onPress=&#123;() =&gt; this._onClickEvent()&#125;&gt; &lt;Text style=&#123;styles.continer&#125;&gt; hello &#123;this.props.name&#125;ä½ çš„å¹´çºªæ˜¯&#123;this.props.age&#125;! &lt;/Text&gt; &lt;/TouchableOpacity&gt; )&#125;//æˆ–è€…render() &#123; return ( &lt;TouchableOpacity onPress=&#123;() =&gt;&#123; Alert.alert(this.props.name, "å¹´çºª" + this.props.age) &#125;&#125;&gt; &lt;Text style=&#123;styles.continer&#125;&gt; hello &#123;this.props.name&#125;ä½ çš„å¹´çºªæ˜¯&#123;this.props.age&#125;! &lt;/Text&gt; &lt;/TouchableOpacity&gt; ) &#125;//æˆ–è€…render() &#123; return ( &lt;TouchableOpacity onPress=&#123;this._onClickEvent.bind(this)&#125;&gt; &lt;Text style=&#123;styles.continer&#125;&gt; hello &#123;this.props.name&#125;ä½ çš„å¹´çºªæ˜¯&#123;this.props.age&#125;! &lt;/Text&gt; &lt;/TouchableOpacity&gt; ) &#125;//æˆ–è€… ç®­å¤´å‡½æ•°å®Œæˆbind render() &#123; return ( &lt;TouchableOpacity onPress=&#123;() =&gt; &#123; this._onClickEvent('hello') &#125;&#125;&gt; &lt;Text style=&#123;styles.continer&#125;&gt; hello &#123;this.props.name&#125;ä½ çš„å¹´çºªæ˜¯&#123;this.props.age&#125;! &lt;/Text&gt; &lt;/TouchableOpacity&gt; ) &#125; å…³äºŽReactNativeçš„thisæ›´å¤šå†…å®¹åŽé¢ä¼šå†æ•´ç† å‚è€ƒï¼šReactNativeä¸­æ–‡ç½‘]]></content>
      <categories>
        <category>RN</category>
      </categories>
      <tags>
        <tag>RN</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµ…æžDalvikå’ŒARTçš„åŒºåˆ«]]></title>
    <url>%2F2018%2F03%2F05%2F%E6%B5%85%E6%9E%90Dalvik%E5%92%8CART%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[Dalvikæ˜¯Googleå…¬å¸è‡ªå·±è®¾è®¡ç”¨äºŽAndroidå¹³å°çš„è™šæ‹Ÿæœºï¼ŒDalvikç»è¿‡ä¼˜åŒ–ï¼Œæ›´åŠ é€‚åˆAndroidå¹³å°ï¼ˆå…·ä½“ä¼˜ç‚¹è§ä¸‹é¢å’ŒJVMæ¯”è¾ƒï¼‰ã€‚ 2014å¹´6æœˆè°·æ­ŒI/Oå¤§ä¼šä¸Šï¼ŒAndroid L(5.0)æ”¹åŠ¨å¹…åº¦æ¯”è¾ƒå¤§ï¼Œåˆ é™¤äº†Dalvikï¼Œè€Œæ˜¯ç”¨ARTä»£æ›¿ã€‚ ä¹‹å‰å¯¹æœ¬å—çš„çŸ¥è¯†ç†è§£æ¯”è¾ƒé›¶æ•£ï¼Œå†æ­¤æœ¬æ–‡æ€»ç»“ä¸‹Dalvikå’ŒARTçš„åŽŸç†ï¼Œå’ŒäºŒè€…çš„åŒºåˆ«ï¼Œä»¥åŠJvmå’ŒDalvikçš„åŒºåˆ«ï¼Œä»¥åŠAndroidçš„Apkç¼–è¯‘æ‰“åŒ…çš„æµç¨‹ Dalvikçš„ç›¸å…³çŸ¥è¯† Googleå…¬å¸è‡ªå·±è®¾è®¡ç”¨äºŽAndroidå¹³å°çš„javaè™šæ‹Ÿæœº æ”¯æŒ.dexï¼ˆå³Dalvik Executableï¼‰æ ¼å¼çš„javaåº”ç”¨ç¨‹åºè¿è¡Œ åŸºäºŽå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨CPUçš„ä¸€éƒ¨åˆ†ï¼ˆé€‚åˆå†…å­˜å’Œå¤„ç†å™¨æœ‰é™çš„ç³»ç»Ÿï¼‰ å…è®¸æœ‰é™çš„å†…å­˜åŒæ—¶è¿è¡Œå¤šä¸ªDalvikè™šæ‹Ÿæœºçš„å®žä¾‹ æ¯ä¸ªDalvikåº”ç”¨ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„Linuxè¿›ç¨‹æ‰§è¡Œï¼Œé˜²æ­¢ä¸€ä¸ªç¨‹åºå´©æºƒå¯¼è‡´æ‰€æœ‰ç¨‹åºå´©æºƒ Jvmçš„ç›¸å…³çŸ¥è¯† åŸºäºŽæ ˆï¼ˆå†…å­˜çš„ä¸€éƒ¨åˆ†ï¼‰ javacæŠŠç¨‹åºæºç ç¼–è¯‘æˆJAVAå­—èŠ‚ç åŽï¼ŒJVMé€šè¿‡é€æ¡è§£é‡Šå­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ Dalvikå’ŒJvmçš„åŒºåˆ«ä¸Žè”ç³»å›¾è¡¨åŒºåˆ« æœ¬è´¨ å­—èŠ‚ç æ–‡ä»¶ æ•ˆçŽ‡ Dalvik åŸºäºŽå¯„å­˜å™¨ ä¸€ä¸ª.Dexæ–‡ä»¶ é«˜ Jvm åŸºäºŽæ ˆ å¤šä¸ª.classæ–‡ä»¶ ä½Ž é¦–è¦åŒºåˆ« DVMåŸºäºŽå¯„å­˜å™¨ï¼ŒJvmåŸºäºŽæ ˆï¼ŒåŸºäºŽå¯„å­˜å™¨çš„ç¼–è¯‘èŠ±è´¹æ—¶é—´æ›´çŸ­ï¼ˆåœ¨.dexå­—èŠ‚ç ä¸­ï¼Œå˜é‡ä¼šèµ‹å€¼ç»™65535ä¸ªå¯ç”¨å¯„å­˜å™¨ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼ŒDalvikæŒ‡ä»¤ç›´æŽ¥æ“ä½œè¿™äº›å¯„å­˜å™¨ï¼Œè€Œä¸æ˜¯è®¿é—®å †æ ˆä¸­çš„å…ƒç´ ã€‚ï¼‰ dexå­—èŠ‚ç æ›´é€‚åˆäºŽå†…å­˜å’Œå¤„ç†å™¨é€Ÿåº¦æœ‰é™çš„ç³»ç»Ÿ åŸºäºŽå¯„å­˜å™¨çš„Dalvikå®žçŽ°è™½ç„¶ç‰ºç‰²äº†ä¸€äº›å¹³å°æ— å…³æ€§ï¼Œä½†æ˜¯å®ƒåœ¨ä»£ç çš„æ‰§è¡Œæ•ˆçŽ‡ä¸Šè¦æ›´èƒœä¸€ç­¹ã€‚ æ¯ä¸€ä¸ªAndroid çš„Appæ˜¯ç‹¬ç«‹è·‘åœ¨ä¸€ä¸ªVMä¸­çš„ã€‚å› æ­¤ä¸€ä¸ªApp crashåªä¼šå½±å“åˆ°è‡ªèº«çš„VMï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–ã€‚Dalvikç»è¿‡ä¼˜åŒ–ï¼Œå…è®¸åœ¨æœ‰é™çš„å†…å­˜ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºçš„å®žä¾‹ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ª Dalvikåº”ç”¨ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„Linuxè¿›ç¨‹æ‰§è¡Œã€‚ å­—èŠ‚ç åŒºåˆ« JVMå­—èŠ‚ç ç”±.classç»„æˆï¼Œæ¯ä¸ªjavaæ–‡ä»¶å¯¹åº”ä¸€ä¸ª.class DVMå­—èŠ‚ç åªåŒ…å«ä¸€ä¸ª.dexæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ç¨‹åºä¸­æ‰€æœ‰çš„ç±» Dalvikå¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯å°ã€‚Android SDKä¸­æœ‰ä¸€ä¸ªå«dxçš„å·¥å…·è´Ÿè´£å°†Javaå­—èŠ‚ç è½¬æ¢ä¸ºDalvikå­—èŠ‚ç ã€‚ ç®€å•æ¥è®²ï¼Œdexæ ¼å¼æ–‡ä»¶å°±æ˜¯å°†å¤šä¸ªclassæ–‡ä»¶ä¸­å…¬æœ‰çš„éƒ¨åˆ†ç»Ÿä¸€å­˜æ”¾ï¼ŒåŽ»é™¤å†—ä½™ä¿¡æ¯ã€‚ ARTçš„ç›¸å…³çŸ¥è¯†ï¼ˆAndroid Runtimeï¼‰Android Runtimeï¼ˆç¼©å†™ä¸º ARTï¼‰ï¼Œæ˜¯ä¸€ç§åœ¨Androidæ“ä½œç³»ç»Ÿä¸Šçš„è¿è¡ŒçŽ¯å¢ƒï¼Œç”±Googleå…¬å¸ç ”å‘ï¼Œå¹¶åœ¨2013å¹´ä½œä¸ºAndroid 4.4ç³»ç»Ÿä¸­çš„ä¸€é¡¹æµ‹è¯•åŠŸèƒ½æ­£å¼å¯¹å¤–å‘å¸ƒï¼Œåœ¨Android 5.0åŠåŽç»­Androidç‰ˆæœ¬ä¸­ä½œä¸ºæ­£å¼çš„è¿è¡Œæ—¶åº“å–ä»£äº†ä»¥å¾€çš„Dalvikè™šæ‹Ÿæœºã€‚ARTèƒ½å¤ŸæŠŠåº”ç”¨ç¨‹åºçš„å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œæ˜¯Androidæ‰€ä½¿ç”¨çš„ä¸€ç§æ–°çš„è™šæ‹Ÿæœºã€‚å®ƒä¸ŽDalvikçš„ä¸»è¦ä¸åŒåœ¨äºŽï¼šDalviké‡‡ç”¨çš„æ˜¯JITæŠ€æœ¯ï¼Œè€ŒARTé‡‡ç”¨Ahead-of-timeï¼ˆAOTï¼‰æŠ€æœ¯ã€‚ ARTåŒæ—¶ä¹Ÿæ”¹å–„äº†æ€§èƒ½ã€åžƒåœ¾å›žæ”¶(Garbage Collection)ã€åº”ç”¨ç¨‹åºé™¤é”™ä»¥åŠæ€§èƒ½åˆ†æžã€‚ JITæœ€æ—©åœ¨Android 2.2ç³»ç»Ÿä¸­å¼•è¿›åˆ°Dalvikè™šæ‹Ÿæœºä¸­ï¼Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒJITé€šè¿‡è¿›è¡Œè¿žç»­çš„æ€§èƒ½åˆ†æžæ¥ä¼˜åŒ–ç¨‹åºä»£ç çš„æ‰§è¡Œï¼Œåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒDalvikè™šæ‹Ÿæœºåœ¨ä¸æ–­çš„è¿›è¡Œå°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç çš„å·¥ä½œã€‚ ä¸ŽDalvikè™šæ‹Ÿæœºä¸åŒçš„æ˜¯ï¼ŒARTå¼•å…¥äº†AOTè¿™ç§é¢„ç¼–è¯‘æŠ€æœ¯ï¼Œåœ¨åº”ç”¨ç¨‹åºå®‰è£…çš„è¿‡ç¨‹ä¸­ï¼ŒARTå°±å·²ç»å°†æ‰€æœ‰çš„å­—èŠ‚ç é‡æ–°ç¼–è¯‘æˆäº†æœºå™¨ç ã€‚åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ— éœ€è¿›è¡Œå®žæ—¶çš„ç¼–è¯‘å·¥ä½œï¼Œåªéœ€è¦è¿›è¡Œç›´æŽ¥è°ƒç”¨ã€‚å› æ­¤ï¼ŒARTæžå¤§çš„æé«˜äº†åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆçŽ‡ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†æ‰‹æœºçš„ç”µé‡æ¶ˆè€—ï¼Œæé«˜äº†ç§»åŠ¨è®¾å¤‡çš„ç»­èˆªèƒ½åŠ›ï¼Œåœ¨åžƒåœ¾å›žæ”¶ç­‰æœºåˆ¶ä¸Šä¹Ÿæœ‰äº†è¾ƒå¤§çš„æå‡ã€‚ ä¸ºäº†ä¿è¯å‘ä¸‹å…¼å®¹ï¼ŒARTä½¿ç”¨äº†ç›¸åŒçš„Dalvikå­—èŠ‚ç æ–‡ä»¶ï¼ˆdexï¼‰ï¼Œå³åœ¨åº”ç”¨ç¨‹åºç›®å½•ä¸‹ä¿ç•™äº†dexæ–‡ä»¶ä¾›æ—§ç¨‹åºè°ƒç”¨ç„¶è€Œ.odexæ–‡ä»¶åˆ™æ›¿æ¢æˆäº†å¯æ‰§è¡Œä¸Žå¯é“¾æŽ¥æ ¼å¼ï¼ˆELFï¼‰å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸€æ—¦ä¸€ä¸ªç¨‹åºè¢«ARTçš„dex2oatå‘½ä»¤ç¼–è¯‘ï¼Œé‚£ä¹ˆè¿™ä¸ªç¨‹åºå°†ä¼šæŒ‡é€šè¿‡ELFå¯æ‰§è¡Œæ–‡ä»¶æ¥è¿è¡Œã€‚å› æ­¤ï¼Œç›¸å¯¹äºŽDalvikè™šæ‹Ÿæœºæ¨¡å¼ï¼ŒARTæ¨¡å¼ä¸‹Androidåº”ç”¨ç¨‹åºçš„å®‰è£…éœ€è¦æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ï¼ŒåŒæ—¶ä¹Ÿä¼šå ç”¨æ›´å¤§çš„å‚¨å­˜ç©ºé—´ï¼ˆæŒ‡å†…éƒ¨å‚¨å­˜ï¼Œç”¨äºŽå‚¨å­˜ç¼–è¯‘åŽçš„ä»£ç ï¼‰,ä½†èŠ‚çœäº†å¾ˆå¤šDalvikè™šæ‹Ÿæœºç”¨äºŽå®žæ—¶ç¼–è¯‘çš„æ—¶é—´ã€‚ Googleå…¬å¸åœ¨Android 4.4ä¸­å¸¦æ¥çš„ARTæ¨¡å¼ä»…ä»…æ˜¯ARTçš„ä¸€ä¸ªé¢„è§ˆç‰ˆï¼Œç³»ç»Ÿé»˜è®¤ä»ç„¶ä½¿ç”¨çš„æ˜¯Dalvikè™šæ‹Ÿæœºï¼Œ4.4ä¸Šé¢æä¾›çš„é¢„è§ˆç‰ˆARTç›¸å¯¹äºŽAndroid 5.0ä»¥åŽçš„ARTè¿è¡Œæ—¶åº“æœ‰è¾ƒå¤§çš„ä¸åŒï¼Œå°¤å…¶ä½“çŽ°åœ¨å…¼å®¹æ€§ä¸Šã€‚ æ€»ç»“ä¸€ä¸‹ä¸Šè¯‰å†…å®¹ï¼š Android 4.4ç³»ç»ŸåŽå‡ºçŽ°ï¼ˆé¢„è§ˆç‰ˆï¼‰ï¼Œç³»ç»Ÿé»˜è®¤ä»ç„¶ä½¿ç”¨çš„æ˜¯Dalvikè™šæ‹Ÿæœºï¼Œ5.0ä»¥åŽæ˜¯æ­£å¼ç‰ˆå–ä»£äº†Dalvikè™šæ‹Ÿæœº ARTèƒ½å¤ŸæŠŠåº”ç”¨ç¨‹åºçš„å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œæ˜¯Androidæ‰€ä½¿ç”¨çš„ä¸€ç§æ–°çš„è™šæ‹Ÿæœº ä¸ºäº†ä¿è¯å‘ä¸‹å…¼å®¹ï¼ŒARTä½¿ç”¨äº†ç›¸åŒçš„Dalvikå­—èŠ‚ç æ–‡ä»¶ï¼ˆdexï¼‰ï¼ˆè€Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡dex2oatå·¥å…·ç”ŸæˆOATæ–‡ä»¶ï¼Œå…·ä½“è§ä¸‹é¢åˆ†æžï¼‰ Androidè¿è¡Œæ—¶ARTåŠ è½½OATæ–‡ä»¶è¿‡ç¨‹åˆ†æžæŸ¥çœ‹å…¶ä»–åšå®¢åˆ†æž ARTæ ¸å¿ƒæ˜¯OATæ–‡ä»¶ æ˜¯APKåœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡dex2oatå·¥å…·ç”Ÿæˆä¸€ä¸ªOATæ–‡ä»¶ APKå®‰è£…è¿‡ç¨‹ä¸­ç”Ÿæˆçš„OATæ–‡ä»¶çš„è¾“å…¥åªæœ‰ä¸€ä¸ªDEXæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ¥è‡ªäºŽæ‰“åŒ…åœ¨è¦å®‰è£…çš„APKæ–‡ä»¶é‡Œé¢çš„classes.dexæ–‡ä»¶ï¼ˆå®žé™…ä¸Šï¼Œä¸€ä¸ªOATæ–‡ä»¶æ˜¯å¯ä»¥ç”±è‹¥å¹²ä¸ªDEXç”Ÿæˆçš„ï¼‰ OATæ–‡ä»¶æ˜¯ä¸€ç§Androidç§æœ‰ELF å®ƒä¸ä»…åŒ…å«æœ‰ä»ŽDEXæ–‡ä»¶ç¿»è¯‘è€Œæ¥çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œè¿˜åŒ…å«æœ‰åŽŸæ¥çš„DEXæ–‡ä»¶å†…å®¹ Dalvikå’ŒARTçš„åŒºåˆ«ä¸Žè”ç³» Dalvikå’ŒARTä½¿ç”¨çš„çš„éƒ½æ˜¯.dexå­—èŠ‚ç ï¼Œäº‹å®žä¸Šæˆ‘ä»¬æŠŠapkè§£åŽ‹åŽç¡®å®žåªæœ‰classes.dexæ–‡ä»¶ï¼Œä½†æ˜¯åœ¨ARTè™šæ‹Ÿæœºåœ¨å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡dex2oatå·¥å…·å°†ä¸€ä¸ªæˆ–è€…è¯ºå¹²ä¸ªdexç”Ÿæˆä¸€ä¸ªOATæ–‡ä»¶ ARTï¼ˆAhead-of-time AOTé¢„ç¼–è¯‘æŠ€æœ¯ï¼‰ï¼šåº”ç”¨ç¨‹åºåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼ŒARTå°†æ‰€æœ‰çš„å­—èŠ‚ç é‡æ–°ç¼–è¯‘æˆäº†æœºå™¨ç ï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºè¿è¡Œä¸­æ— éœ€è¿›è¡Œå®žæ—¶ç¼–è¯‘å·¥ä½œï¼Œåªéœ€è¦è¿›è¡Œç›´æŽ¥è°ƒç”¨ï¼Œå› æ­¤ï¼ŒARTæžå¤§çš„æé«˜äº†åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆçŽ‡ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†æ‰‹æœºçš„ç”µé‡æ¶ˆè€—ï¼Œæé«˜äº†ç§»åŠ¨è®¾å¤‡çš„ç»­èˆªèƒ½åŠ›ï¼Œåœ¨åžƒåœ¾å›žæ”¶ç­‰æœºåˆ¶ä¸Šä¹Ÿæœ‰äº†è¾ƒå¤§çš„æå‡ï¼Œä½†æ˜¯å®‰è£…éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼ˆå­˜å‚¨ç¼–è¯‘åŽçš„ä»£ç ï¼‰å’Œæ—¶é—´ï¼ŒèŠ‚çœäº†å¾ˆå¤šDalvikè™šæ‹Ÿæœºç”¨äºŽå®žæ—¶ç¼–è¯‘çš„æ—¶é—´ Dalvikï¼ˆJust-in-time JITå³æ—¶ç¼–è¯‘æŠ€æœ¯ï¼‰ï¼šï¼ˆjvmä¹Ÿæ˜¯JITå³æ—¶ç¼–è¯‘ï¼‰ï¼Œåœ¨Dalvikä¸‹ï¼Œåº”ç”¨æ¯æ¬¡è¿è¡Œéƒ½éœ€è¦é€šè¿‡å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå³æ¯æ¬¡éƒ½è¦ç¼–è¯‘åŠ è¿è¡Œã€‚è™½ç„¶å®‰è£…è¿‡ç¨‹æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯æ‹–æ…¢äº†åº”ç”¨æ¯æ¬¡å¯åŠ¨çš„é€Ÿåº¦ ç¼–è¯‘æŠ€æœ¯ ï¼ˆæ—¶æœºï¼‰å­—èŠ‚ç ç¼–è¯‘æœºå™¨ç  å ç”¨ç©ºé—´ å®‰è£…æ—¶é—´ è¿è¡Œæ•ˆçŽ‡ï¼ˆï¼‰ Dalvik JITï¼ˆå³æ—¶ç¼–è¯‘ï¼‰ é¦–æ¬¡å®‰è£…æ—¶ å° å¿« æ…¢ ART AOTï¼ˆé¢„ç¼–è¯‘æŠ€æœ¯ï¼‰ åº”ç”¨æ¯æ¬¡å¯åŠ¨æ—¶ å¤§ï¼ˆ10-20%ï¼‰ æ»¡ å¿« å‡ å¼ æˆªå›¾æ€»ç»“æŸ¥çœ‹åŽŸæ–‡]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ThreadLocalçš„ç†è§£]]></title>
    <url>%2F2018%2F03%2F02%2FThreadLocal%E7%9A%84%E7%90%86%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ThreadLocalç›¸å…³æ•´ç† JDK1.2æä¾› æ ¹æ®JDKæ–‡æ¡£ä¸­çš„è§£é‡Šï¼š ThreadLocalçš„ä½œç”¨æ˜¯æä¾›çº¿ç¨‹å†…çš„å±€éƒ¨å˜é‡ï¼Œè¿™ç§å˜é‡åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹è®¿é—®æ—¶èƒ½å¤Ÿä¿è¯å„ä¸ªçº¿ç¨‹é‡Œå˜é‡çš„ç‹¬ç«‹æ€§ã€‚ å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹æ”¹å˜è¯¥å˜é‡çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ ThreadLocalçš„ä½¿ç”¨ï¼š å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”¨ThreadLocalå­˜æ”¾äº†ä¸€ä¸ªStringå­—ç¬¦ä¸²ï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹setæ•°å€¼åŽï¼Œåªåœ¨å½“å‰çº¿ç¨‹ç®¡ç”¨ï¼Œæ‰€ä»¥è¯´ï¼Œå¦‚åŒä¸Šè¿°æ‰€è¯´çš„ ä¸€ä¸ªThreadLocalå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº« æ¯ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªThreadLocalçš„set getæ“ä½œåªé’ˆå¯¹å½“å‰çº¿ç¨‹ç®¡ç”¨ ThreadLocalçš„åŽŸç†ä»¥åŠæºç ä»‹ç»å¤§æ¦‚äº†è§£äº†ThreadLocalå¦‚ä½•ä½¿ç”¨ï¼Œé‚£ä¹ˆè¯·é—®ï¼ŒThreadLocalå¦‚ä½•ä¿è¯ä¸åŒçº¿ç¨‹çš„ç‹¬ç«‹æ€§çš„å‘¢ï¼Ÿ ThreadLocalå‡ ä¸ªå†…éƒ¨æ–¹æ³•protected T initialValue()ï¼ˆå¦‚æžœä¸æƒ³åˆå§‹å€¼è¿”å›žnullï¼Œéœ€è¦é‡å†™initialValueæ–¹æ³•ï¼‰123protected T initialValue() &#123; return null;&#125; public T get()ï¼ˆè¯¥æ–¹æ³•è¿”å›žå½“å‰çº¿ç¨‹å˜é‡å‰¯æœ¬ã€‚å¦‚æžœè¿™æ˜¯çº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ™åˆ›å»ºå¹¶åˆå§‹åŒ–æ­¤å‰¯æœ¬ã€‚ï¼‰/** 1234567891011121314151617 * Returns the value in the current thread's copy of this * thread-local variable. If the variable has no value for the * current thread, it is first initialized to the value returned * by an invocation of the &#123;@link #initialValue&#125; method. * * @return the current thread's value of this thread-local */public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) return (T)e.value; &#125; return setInitialValue();&#125; public void set(T value)/** 12345678910111213141516 * Sets the current thread's copy of this thread-local variable * to the specified value. Most subclasses will have no need to * override this method, relying solely on the &#123;@link #initialValue&#125; * method to set the values of thread-locals. * * @param value the value to be stored in the current thread's copy of * this thread-local. */public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value);&#125; ç”±getå’Œsetæºç å¯ä»¥çœ‹å‡ºï¼Œæ•°æ®çš„å­˜å–éƒ½æ˜¯å…ˆèŽ·å–ThreadLocalMapå¯¹è±¡ï¼Œä»ŽThreadLocalMapå­˜å– ThreadLocalMapæ˜¯ä¸€ä¸ªmapï¼Œå®ƒçš„keyï¼Œå°±æ˜¯threadLocalæœ¬èº«ï¼Œå€¼å°±æ˜¯å­˜æ”¾çš„å˜é‡å‰¯æœ¬ æ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæœ¬åœ°å˜é‡çš„mapï¼Œæ¯ä¸ªå¯ä»¥å­˜æ”¾å¤šä¸ªçº¿ç¨‹æœ¬åœ°å˜é‡ï¼ˆå³ä¸åŒçš„ThreadLocalï¼‰ public void remove()ï¼ˆjdk1.5åŽå‡ºçŽ°ï¼‰/** 123456789101112131415* Removes the current thread's value for this thread-local* variable. If this thread-local variable is subsequently* &#123;@linkplain #get read&#125; by the current thread, its value will be* reinitialized by invoking its &#123;@link #initialValue&#125; method,* unless its value is &#123;@linkplain #set set&#125; by the current thread* in the interim. This may result in multiple invocations of the* &lt;tt&gt;initialValue&lt;/tt&gt; method in the current thread.** @since 1.5*/public void remove() &#123; ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) m.remove(this);&#125; é€šè¿‡removeæºç å¯ä»¥çœ‹åˆ°ï¼Œ å…ˆé€šè¿‡ThreadLocalçš„getMapï¼ˆThread.currentThread()ï¼‰æ–¹æ³•æ‹¿åˆ°å½“å‰çº¿ç¨‹çš„ThreadLocalMap ç„¶åŽå†åœ¨å½“å‰çº¿ç¨‹çš„ThreadLocalMapä¸­getï¼Œsetï¼Œremove å…³äºŽremoveéœ€è¦çŸ¥é“çš„å‡ ç‚¹ï¼š ä¸ºä»€ä¹ˆç§»é™¤æŸä¸ªThreadLocalçš„å€¼ï¼š ç›®çš„æ˜¯å‡å°‘å†…å­˜ç¼“å­˜ï¼Œremoveä¹‹åŽå¦‚æžœå†æ¬¡è®¿é—®æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ï¼Œå°†è¿”å›žinitiValueåˆå§‹å€¼ çº¿ç¨‹ç»“æŸåŽï¼Œè¯¥çº¿ç¨‹å¯¹åº”çš„æ‰€æœ‰å±€éƒ¨å˜é‡å°†è‡ªåŠ¨è¢«åžƒåœ¾å›žæ”¶ï¼Œä½†æ˜¯æ˜¾ç¤ºè°ƒç”¨removeæ¸…æ¥šçº¿ç¨‹å±€éƒ¨å˜é‡ä¸æ˜¯å¿…é¡»æ“ä½œï¼Œä½†æ˜¯å¯ä»¥åŠ å¿«å†…å­˜å›žæ”¶çš„é€Ÿåº¦ ThreadLocalå’ŒåŒæ­¥æœºåˆ¶synchonziedçš„åŒºåˆ« ThreadLocalï¼šä»¥ç©ºé—´æ¢æ—¶é—´ synchonziedï¼šä»¥æ—¶é—´æ¢ç©ºé—´ synchonziedåŒæ­¥æœºåˆ¶ï¼š ä¸ºå¤šçº¿ç¨‹å¯¹ç›¸åŒèµ„æºçš„å¹¶å‘è®¿é—®æŽ§åˆ¶ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´çš„æ•°æ®å…±äº«ï¼ŒåŒæ­¥ä¼šå¸¦æ¥å·¨å¤§çš„æ€§èƒ½å¼€é”€ï¼Œæ‰€ä»¥åŒæ­¥æ“ä½œåº”è¯¥æ˜¯ç»†ç²’åº¦çš„ï¼ˆå¯¹è±¡ä¸­çš„ä¸åŒå…ƒç´ ä½¿ç”¨ä¸åŒçš„é”ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡ä¸€ä¸ªé”ï¼‰ï¼Œä»¥æ—¶é—´æ¢ç©ºé—´çš„æ„æ€æ˜¯ï¼šä½¿ç”¨åŒæ­¥çœŸæ­£çš„é£Žé™©æ˜¯å¤æ‚æ€§å’Œå¯èƒ½ç ´åèµ„æºå®‰å…¨,è€Œä¸æ˜¯æ€§èƒ½ã€‚ ThreadLocalçº¿ç¨‹å±€éƒ¨å˜é‡æœºåˆ¶ï¼š ç©ºé—´æ¢å–æ—¶é—´ï¼Œä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ThreadLocalï¼Œæ•°æ®çš„å­˜å–æ˜¯å½“å‰çº¿ç¨‹çš„æ•°æ®å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçº¿ç¨‹åœ¨æŸä¸€æ—¶é—´è®¿é—®åˆ°çš„å¹¶ä¸æ˜¯åŒä¸€å¯¹è±¡ï¼Œæ‰€ä»¥æ•ˆçŽ‡æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯å ç”¨å†…å­˜æ¯”è¾ƒå¤§ï¼Œå½“çº¿ç¨‹ç»“æŸä¹‹åŽï¼Œremoveä¼šåŠ å¿«å†…å­˜çš„å›žæ”¶é€Ÿåº¦ã€‚ Synchronizedç€é‡äºŽçº¿ç¨‹é—´çš„æ•°æ®å…±äº«ï¼Œè€ŒThreadLocalåˆ™ç€é‡äºŽçº¿ç¨‹é—´çš„æ•°æ®éš”ç¦»ã€‚ ThreadLocalçš„å¼Šç«¯ï¼ˆå†…å­˜æ³„éœ²ï¼‰å†…å­˜æ³„éœ²åŽŸå› ThreadLocalMapä½¿ç”¨ThreadLocalçš„å¼±å¼•ç”¨ä½œä¸ºkeyï¼Œå¦‚æžœä¸€ä¸ªThreadLocalæ²¡æœ‰å¤–éƒ¨çš„å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨ç³»ç»ŸGCçš„æ—¶å€™ï¼Œè¿™ä¸ªThreadLocalå°±ä¼šè¢«å›žæ”¶æŽ‰ ThreadLocalè¢«å›žæ”¶æŽ‰ä¹‹åŽï¼Œé‚£ä¹ˆå½“å‰Threadçš„ThreadLocalMapä¸­é—´å°±ä¼šå‡ºçŽ°keyä¸ºnullçš„Entry keyä¸ºnullçš„è¯å°±æ„å‘³ç€ï¼Œæ²¡æœ‰åŠžæ³•è®¿é—®è¿™äº›keyå¯¹åº”çš„å€¼ï¼Œå°±ä¼šå­˜åœ¨ä»¥ä¸‹çš„è¿™æ ·ä¸€ä¸ªå¼ºå¼•ç”¨é“¾ value â€”Entryâ€”TreadLocalMapâ€“Thread å†…å­˜æ³„éœ²è§£å†³ThreadLocalMapçš„è®¾è®¡ä¸­å·²ç»è€ƒè™‘åˆ°è¿™ç§æƒ…å†µï¼Œä¹ŸåŠ ä¸Šäº†ä¸€äº›é˜²æŠ¤æŽªæ–½ï¼šåœ¨ThreadLocalçš„get(),set(),remove()çš„æ—¶å€™éƒ½ä¼šæ¸…é™¤çº¿ç¨‹ThreadLocalMapé‡Œæ‰€æœ‰keyä¸ºnullçš„valueã€‚ ä»¥ä¸‹æ“ä½œä¼šå¯¼è‡´å†…å­˜æ³„éœ² ä½¿ç”¨staticçš„ThreadLocalï¼Œå»¶é•¿äº†ThreadLocalçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¼è‡´æŸä¸ªçº¿ç¨‹Threadç»“æŸåŽï¼Œä½†æ˜¯Threadå†…éƒ¨çš„ThreadLocalMapä¸­å­˜åœ¨è¿™ä¸ªé™æ€çš„ThreadLocalï¼Œå¯¼è‡´ThreadLocalMapæ²¡æ³•è¢«å›žæ”¶ï¼Œå¯¼è‡´è¯¥Threadæ²¡æ³•è¢«å›žæ”¶ åˆ†é…ä½¿ç”¨äº†ThreadLocalåˆä¸å†è°ƒç”¨get(),set(),remove()æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚å› ä¸ºå¦‚ä¸Šæ‰€è¯´ get(),set(),remove()ä¼šæ¸…ç†çº¿ç¨‹ThreadLocalMapé‡Œæ‰€æœ‰keyä¸ºnullçš„value Androidä¸­ThreadLocalçš„ä½“çŽ°Handleræ¶ˆæ¯æœºåˆ¶ç†Ÿæ‚‰Handleræœºåˆ¶çš„éƒ½çŸ¥é“ åœ¨ActivityThreadçš„mainæ–¹æ³•ä¸­Looper.prepareMainLooper();æˆ–è€…åœ¨è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ä¸­Looper.pepare()çš„æ—¶å€™ 123456private static void prepare(boolean quitAllowed) &#123; if (sThreadLocal.get() != null) &#123; throw new RuntimeException("Only one Looper may be created per thread"); &#125; sThreadLocal.set(new Looper(quitAllowed));&#125; åˆ›å»ºäº†ä¸€ä¸ªLooperå¯¹è±¡å¹¶ä½¿ç”¨sThreadLocalçš„setæ–¹æ³•è¿›è¡Œä¿å­˜ å¹¶ä¸”è¿™ä¸ªThreadLocalåœ¨Looperç±»ä¸­æ˜¯é™æ€çš„ï¼Œå¦‚ä¸‹ é‚£å°±æ˜¯è¯´ï¼Œè¿™ä¸ªé™æ€çš„ThreadLocalï¼Œå¯ä»¥ä¾›ä»»ä½•çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯ä»»æ„çº¿ç¨‹ä¸­å–å‡ºæ¥çš„looperï¼Œéƒ½åªæ˜¯çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œéƒ½æ˜¯åœ¨å‰¯æœ¬ æ‰€ä»¥è¯´ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªlooperï¼Œ å¯¹äºŽThreadLocalçš„æ€»ç»“ï¼Œæš‚æ—¶æ•´ç†åˆ°è¿™é‡Œï¼ŒåŽç»­è¡¥å…… â™¨]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[3.Xçš„gradleä¾èµ–implementation]]></title>
    <url>%2F2018%2F01%2F24%2F3-x%E7%9A%84gradle%E4%BE%9D%E8%B5%96implementation%2F</url>
    <content type="text"><![CDATA[ä¾èµ–æ–¹å¼æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬è¿™é‡Œåªå¼„æ¸…æ¥šimplementationå’ŒCompileçš„åŒºåˆ«ï¼Œå°±å¥½äº† implementationå’ŒCompileçš„åŒºåˆ«å…ˆçœ‹ä¸‹å›¾ å‡è®¾ï¼š LibraryAâ€”â€“â€”â€“implementationâ€”â€”â€”LibraryC App Module æ— æ³•ä½¿ç”¨LibraryC LibraryBâ€”â€“â€”â€“compileâ€”â€”â€”LibraryD App Module å¯ä»¥ä½¿ç”¨LibraryD å¥½å¤„ å¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ éšè—å¯¹å¤–ä¸å¿…è¦çš„æŽ¥å£ ä¸ºä»€ä¹ˆèƒ½å¤ŸåŠ å¿«ç¼–è¯‘é€Ÿåº¦å‘¢ è¿™å¯¹äºŽå¤§åž‹é¡¹ç›®å«æœ‰å¤šä¸ªMoudleæ¨¡å—çš„ï¼Œ ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œæ¯”å¦‚æˆ‘ä»¬æ”¹åŠ¨ LibraryC æŽ¥å£çš„ç›¸å…³ä»£ç ï¼Œè¿™æ—¶å€™ç¼–è¯‘åªéœ€è¦å•ç‹¬ç¼–è¯‘LibraryAæ¨¡å—å°±è¡Œï¼Œ å¦‚æžœä½¿ç”¨çš„æ˜¯apiæˆ–è€…æ—§æ—¶ä»£çš„compileï¼Œç”±äºŽApp Moudle ä¹Ÿå¯ä»¥è®¿é—®åˆ° LibraryC,æ‰€ä»¥ App Moudleéƒ¨åˆ†ä¹Ÿéœ€è¦é‡æ–°ç¼–è¯‘ã€‚ å…¶ä»–å‡ ç§æ–¹å¼é¦–å…ˆæ˜¯2.xç‰ˆæœ¬çš„ä¾èµ–æ–¹å¼ï¼š Compile Provided APK Test compile Debug compile Release compile å†æ¥çœ‹çœ‹3.0çš„ Implementation API Compile only Runtime only Unit Test implementation Test implementation Debug implementation Release implementation 2.xç‰ˆæœ¬ä¾èµ–çš„å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„è¯´æ˜Žï¼Œæ‹¬å·é‡Œå¯¹åº”çš„æ˜¯3.0ç‰ˆæœ¬çš„ä¾èµ–æ–¹å¼ã€‚ compileï¼ˆapiï¼‰è¿™ç§æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œä½¿ç”¨è¯¥æ–¹å¼ä¾èµ–çš„åº“å°†ä¼šå‚ä¸Žç¼–è¯‘å’Œæ‰“åŒ…ã€‚å½“æˆ‘ä»¬ä¾èµ–ä¸€äº›ç¬¬ä¸‰æ–¹çš„åº“æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°com.android.supportå†²çªçš„é—®é¢˜ï¼Œå°±æ˜¯å› ä¸ºå¼€å‘è€…ä½¿ç”¨çš„compileä¾èµ–çš„com.android.supportåŒ…ï¼Œè€Œä»–æ‰€ä¾èµ–çš„åŒ…ä¸Žæˆ‘ä»¬æœ¬åœ°æ‰€ä¾èµ–çš„com.android.supportåŒ…ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥All com.android.support libraries must use the exact same version specification (mixing versions can lead to runtime crashesè¿™ä¸ªé”™è¯¯ã€‚ supportåŒ…å†²çª providedï¼ˆcompileOnlyï¼‰åªåœ¨ç¼–è¯‘æ—¶æœ‰æ•ˆï¼Œä¸ä¼šå‚ä¸Žæ‰“åŒ…å¯ä»¥åœ¨è‡ªå·±çš„moudleä¸­ä½¿ç”¨è¯¥æ–¹å¼ä¾èµ–ä¸€äº›æ¯”å¦‚com.android.supportï¼Œgsonè¿™äº›ä½¿ç”¨è€…å¸¸ç”¨çš„åº“ï¼Œé¿å…å†²çªã€‚ apkï¼ˆruntimeOnlyï¼‰åªåœ¨ç”Ÿæˆapkçš„æ—¶å€™å‚ä¸Žæ‰“åŒ…ï¼Œç¼–è¯‘æ—¶ä¸ä¼šå‚ä¸Žï¼Œå¾ˆå°‘ç”¨ã€‚ testCompileï¼ˆtestImplementationï¼‰testCompile åªåœ¨å•å…ƒæµ‹è¯•ä»£ç çš„ç¼–è¯‘ä»¥åŠæœ€ç»ˆæ‰“åŒ…æµ‹è¯•apkæ—¶æœ‰æ•ˆã€‚ debugCompileï¼ˆdebugImplementationï¼‰debugCompile åªåœ¨debugæ¨¡å¼çš„ç¼–è¯‘å’Œæœ€ç»ˆçš„debug apkæ‰“åŒ…æ—¶æœ‰æ•ˆ releaseCompileï¼ˆreleaseImplementationï¼‰Release compile ä»…ä»…é’ˆå¯¹Release æ¨¡å¼çš„ç¼–è¯‘å’Œæœ€ç»ˆçš„Release apkæ‰“åŒ…ã€‚ å‚è€ƒï¼š Android Studio3.xæ–°çš„ä¾èµ–æ–¹å¼ï¼ˆimplementationã€apiã€compileOnlyï¼‰ ###]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è°ˆè°ˆå¯åŠ¨æµç¨‹]]></title>
    <url>%2F2017%2F12%2F29%2F%E8%B0%88%E8%B0%88%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%2F</url>
    <content type="text"></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReactNativeå­¦ä¹ ä¸€]]></title>
    <url>%2F2017%2F12%2F25%2FReactNative%20start%2F</url>
    <content type="text"><![CDATA[ReactNative å­¦ä¹ ä¸€ 1ï¼Œä¸ºä»€ä¹ˆå­¦ä¹ ReactNativeå¥½å¤„ å› ä¸ºçŽ°åœ¨è®¸å¤šä¸»æµçš„åº”ç”¨éƒ½æœ‰React Nativeçš„å½±å­ï¼Œå®ƒå¯¹æ¯”åŽŸç”Ÿå¼€å‘æ›´ä¸ºçµæ´»ï¼Œå¯¹æ¯”H5ä½“éªŒæ›´ä¸ºé«˜æ•ˆï¼Œè€Œä¸”è·¨å¹³å°çš„æ”¯æŒç‰¹æ€§ã€‚ ç›¸å¯¹ionicè¿™ç±»PhoneGapï¼Œå®ƒæ•ˆçŽ‡æ›´é«˜ï¼Œå’ŒåŽŸç”Ÿä¹‹é—´çš„äº¤äº’æ›´æ–¹ä¾¿ã€‚ å¤šä¸ªç‰ˆæœ¬è¿­ä»£åŽçš„ä»Šå¤©ï¼Œå®ƒå·²ç»æ‹¥æœ‰äº†ä¸°å¯Œç¬¬ä¸‰æ–¹æ’ä»¶æ”¯æŒã€‚ React Nativeè§£å†³ä¸äº†çš„ï¼Œå¯ä»¥é€šè¿‡å„ä½ç†Ÿæ‚‰çš„åŽŸç”Ÿæ¥è§£å†³ã€‚ æ›´æ–¹ä¾¿çš„çƒ­æ›´æ–°ã€‚ åå¤„ å°½ç®¡æ˜¯è·¨å¹³å°ï¼Œä½†æ˜¯ä¸åŒå¹³å°Apiçš„ç‰¹æ€§ä¸Žæ˜¾ç¤ºå¹¶ä¸ä¸€å®šä¸€è‡´ã€‚ ç›¸å¯¹å¢žå¤§äº†appçš„ä½“ç§¯ã€‚ è°ƒè¯•â€™ç›¸å¯¹â€˜éº»çƒ¦ã€‚ Androidä¸Šçš„å…¼å®¹æ€§é—®é¢˜ã€‚ æ€»çš„æ¥è¯´React Nativeé€‚åˆä½œä¸ºé¡¹ç›®ä¸­çš„è¡¥å……ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ ¸å¿ƒåŽ»å¼€å‘APPã€‚ 2ï¼Œæ­å»ºå¼€å‘çŽ¯å¢ƒ Webstromï¼ˆå·ç§°webå¼€å‘ç¥žå™¨ï¼Œç›®å‰å¯¹å‰ç«¯çš„äº†è§£æœ‰é™ï¼Œå› ä¸ºå’Œandroid stuidoå¸ˆå‡ºåŒé—¨ï¼Œæ‰€ä»¥ä¸å•†é‡ç›´æŽ¥é€‰ç”¨ä»–ï¼Œå½“ç„¶stomä¹Ÿè¯•äº†è¯•ï¼Œä½†æ˜¯å¿«æ·é”®ä¸å¦‚Webstromç†Ÿæ‚‰ï¼‰ HomeBrewï¼ˆMacç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨ï¼Œç”¨äºŽå®‰è£…NodeJSå’Œä¸€äº›å…¶ä»–å¿…éœ€çš„å·¥å…·è½¯ä»¶ Nodeï¼ˆåŸºäºŽ Chrome V8 å¼•æ“Žçš„ JavaScript è¿è¡ŒçŽ¯å¢ƒï¼‰ Androd Studioï¼ˆå®‰å“è€æœ¬å®¶æ²¡å•¥è¯´çš„ï¼‰ ReactNativeçš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆreact-native-cliï¼ŒReact Nativeçš„å‘½ä»¤è¡Œå·¥å…·ç”¨äºŽæ‰§è¡Œåˆ›å»ºã€åˆå§‹åŒ–ã€æ›´æ–°é¡¹ç›®ã€è¿è¡Œæ‰“åŒ…æœåŠ¡ï¼ˆpackagerï¼‰ç­‰ä»»åŠ¡ è¯¦ç»†æ­å»ºæ­¥éª¤æŸ¥çœ‹ReactNativeä¸­æ–‡ç½‘ ä¸€æ­¥ä¸€æ­¥å®‰è£…å®Œæ¯•åŽï¼Œæ²¡é”™ï¼Œä½ å·²ç»èµ·é£žäº†ï¼› 3ï¼Œåˆ›å»ºä¸€ä¸ªé¡¹ç›® ç»ˆç«¯cdåˆ°ä½ æƒ³åˆå§‹åŒ–é¡¹ç›®çš„æ–‡ä»¶å¤¹ 1react-native init FirstRNApp ç„¶åŽä¼šå‘çŽ°åˆ›å»ºäº†ä¸€ä¸ªFirstRNAppæ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯åˆ›å»ºçš„ç¬¬ä¸€ä¸ªé¡¹ç›® å‡ ä¸ªå…³é”®çš„æ–‡ä»¶ androidæ–‡ä»¶å¤¹ï¼Œå°±æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨android studioæ‰“å¼€çš„androidé¡¹ç›®ã€‚ iosæ–‡ä»¶å¤¹ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨xcodeæ‰“å¼€çš„iosé¡¹ç›®ã€‚ index.android.jsï¼Œè¿™æ˜¯androidçš„React Nativeå…¥å£æ–‡ä»¶ã€‚ index.ios.jsï¼Œè¿™æ˜¯iosçš„React Nativeå…¥å£æ–‡ä»¶ã€‚ package.jsonï¼Œç±»ä¼¼android studioçš„build.gradleï¼Œä½ ä¾èµ–çš„åº“éƒ½å†™åœ¨é‡Œé¢ã€‚ node_moduleæ–‡ä»¶å¤¹ï¼Œä½ ä¾èµ–çš„åº“ä¸‹è½½ä¸‹æ¥éƒ½å­˜æ”¾åœ¨é‡Œé¢ï¼Œå±žäºŽgitçš„å¿½ç•¥æ–‡ä»¶ï¼Œä½ è¦æ‰¾çš„ä¾èµ–åº“æºç ä¹Ÿåœ¨é‡Œé¢ï¼ŒåŒ…æ‹¬Reactå’ŒReact Nativeã€‚ jscodeæ–‡ä»¶å¤¹ï¼Œæ˜¯è‡ªå·±åˆ›å»ºçš„æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾è‡ªå·±å†™çš„jsæ–‡ä»¶ã€‚ éœ€è¦æ³¨æ„çš„ç‚¹package.json ç±»ä¼¼äºŽandroid studioä¸­çš„build.gradleæ·»åŠ è¿œç¨‹ä¾èµ–ï¼Œä¸åŒçš„æ˜¯ï¼Œpackage.jsonå¤§å¤šæ•°æ—¶å€™ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ ¹ç›®å½•é€šè¿‡å‘½ä»¤è¡Œï¼Œnpm install xxxxxx --save å°±å¯ä»¥ä¾èµ–ä¸€ä¸ªåº“äº†ã€‚ installä¹‹åŽï¼Œåº“çš„ä¾èµ–ä¿¡æ¯ï¼Œè‡ªåŠ¨è¢«å†™åˆ°package.jsoné‡Œé¢ï¼Œå¯¹åº”çš„åº“ä¹Ÿä¼šè¢«ä¸‹è½½åˆ°node_moduleæ–‡ä»¶å¤¹ä¸­ï¼Œç±»ä¼¼android studioä¾èµ–åŽæŠŠaaråŒæ­¥åˆ°æœ¬åœ°ã€‚ node_module node_moduleæ˜¯ä¸€ä¸ªå¿½ç•¥æ–‡ä»¶ï¼Œæäº¤çš„æ—¶å€™ä¸éœ€è¦æäº¤åˆ°gitä¸Šï¼Œç±»ä¼¼android studioè¿œç¨‹ä¾èµ–ä¸‹æ¥çš„aarï¼Œä¹Ÿä¸ä¼šæäº¤åˆ°gitä¸Šã€‚å…¶ä»–äººåœ¨ä½¿ç”¨React Nativeé¡¹ç›®æ—¶ï¼Œåªéœ€è¦npm installï¼Œå·¥ç¨‹å°±ä¼šæ ¹æ®package.jsonï¼ŒåŽ»åŒæ­¥ä¸‹è½½å„ä¸ªä¾èµ–åº“åˆ°node_moduleã€‚ æ³¨ï¼šæœ‰æ—¶å€™è¿˜éœ€è¦è¿è¡Œreact-native link æˆ– react-native link xxxï¼Œè¿™æ˜¯å› ä¸ºæœ‰äº›ç¬¬ä¸‰æ–¹åº“æ˜¯é€šè¿‡åŽŸç”Ÿä»£ç åŠ React Nativeå®žçŽ°çš„ï¼Œé€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥è‡ªåŠ¨æŠŠç›¸å…³çš„é…ç½®ä»£ç ï¼Œè‡ªåŠ¨æ·»åŠ åˆ°androidå’Œioså·¥ç¨‹ä¸­ã€‚ è¿è¡Œè¿™ä¸ªé¡¹ç›®ä½œä¸ºå®‰å“ç«¯æœ‰ä¸¤ç§æ–¹å¼ï¼Œiosä¹ŸåŒæ ·æœ‰ä¸¤ç§ cdåˆ°é¡¹ç›®æ ¹ç›®å½• 1react-native run-androidã€react-native run-iosã€‘ æˆ–è€…ç”¨android stuidoç›´æŽ¥æ‰“å¼€é¡¹ç›®ä¸­çš„androidæ–‡ä»¶å¤¹ï¼ˆä¸Šé¢æœ‰è¯´è¿‡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹æ‰“å¼€çš„å®‰å“é¡¹ç›®ï¼‰ é‡åˆ°çš„å°å‘1ï¼Œæ— æ³•ä»Žèµ„äº§çš„index.android.bundleä¸­åŠ è½½è„šæœ¬ã€‚ç¡®ä¿ä½ çš„åŒ…è¢«æ­£ç¡®æ‰“åŒ…æˆ–è€…ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªpackageræœåŠ¡å™¨ æœç´¢äº†ä¸€æ³¢ï¼Œè¿™ä¸ªé”™è¯¯å¾ˆå¸¸è§ï¼Œè§£å†³çš„åŠžæ³•ä¹Ÿå¾ˆå¸¸è§ï¼Œå¦‚ä¸‹ æ‰“å¼€è‡ªå·±çš„é¡¹ç›®æ–‡ä»¶å¤¹,åœ¨Android/app/src/mainç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç©ºçš„assetsæ–‡ä»¶å¤¹ cdåˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰§è¡Œ 1react-native bundle --platform android --dev false --entry-file index.android.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res äº‹å®žè¯æ˜Žå¹¶æ²¡æœ‰è§£å†³æˆ‘çš„é—®é¢˜ è§£å†³æˆ‘çš„é—®é¢˜çš„æ˜¯ä¸‹é¢è¿™è¡Œ 1react-native bundle --platform android --dev false --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res æˆ‘ä»¬å¯ä»¥å›žå¤´çœ‹ä¸Šé¢åˆ›å»ºå®Œé¡¹ç›®çš„æˆªå›¾ï¼Œè€ç‰ˆçš„æ˜¯åˆ†åˆ«æœ‰index.android.jså’Œindex.ios.js è€Œæˆ‘åˆ›å»ºçš„å´æ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œåªæœ‰ä¸€ä¸ªindex.js,ä¿®æ”¹å®Œä¹‹åŽï¼Œæˆ‘ä»¬åˆ›å»ºçš„assetsç›®å½•ä¸‹ä¼šç”Ÿæˆbundleçš„ä¸¤ä¸ªæ–‡ä»¶ è¿è¡ŒæˆåŠŸï¼ˆandroidç«¯ï¼‰ ç›¸å…³èµ„æ–™ [æ‹çŒ«æœˆäº®åšå®¢]https://www.jianshu.com/p/97692b1c451d) ä¸­æ–‡ç½‘ æŠ¥é”™ æœ¬æ–‡ä»…ä½œä¸ªäººå­¦ä¹ æ€»ç»“ï¼Œå¦‚æœ‰å‡ºå…¥ä¸å¤Ÿä¸¥è°¨çš„åœ°æ–¹ï¼Œè¯·è”ç³»æ›´æ”¹ã€‚ ReactNativeæ‰åˆšåˆšèµ·æ­¥å­¦ä¹ ï¼Œéº»çƒ¦å’Œå‘åŽç»­è¿˜ä¼šç»å¸¸ç¢°åˆ°ã€‚ä½†æ˜¯ï¼Œæ—¢ç„¶é€‰æ‹©äº†å­¦ä¹ ï¼Œå°±è¦åšæŒä¸‹æ¥ï¼]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è°ˆè°ˆåŠ å¯†ç®—æ³•]]></title>
    <url>%2F2017%2F12%2F20%2F%E8%B0%88%E8%B0%88%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[åœ¨åº”ç”¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’Œç§»åŠ¨ç«¯è¦é¢‘ç¹çš„è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œæ¶‰åŠåˆ°é‡è¦éšç§ä¿¡æ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦è¿›è¡Œæ•°æ®åŠ å¯†ï¼Œï¼Œå³ä½¿ä¼ è¾“çš„è¿‡ç¨‹ä¸­è¢«æˆªå–ï¼Œä¹Ÿä¸ä¼šä¿¡æ¯æ³„æ¼ã€‚å¯¹äºŽåŠ å¯†ç®—æ³•ï¼Œä¸å°‘å¼€å‘è€…ä¹Ÿæ—©æœ‰è€³é—»ï¼Œä¾‹å¦‚ï¼šBase64ï¼ŒMD5ï¼ŒRSAï¼ŒAESï¼ŒDESåŠ å¯†ç­‰ç­‰ï¼Œä»Šå¤©å°±æ€»ç»“ä¸€ä¸‹åŠ å¯†ç®—æ³• å¯¹ç§°åŠ å¯†å’Œéžå¯¹ç§°åŠ å¯†å¯¹ç§°åŠ å¯†ï¼šå¯¹ç§°åŠ å¯†æ˜¯æœ€å¿«é€Ÿã€æœ€ç®€å•çš„ä¸€ç§åŠ å¯†æ–¹å¼ï¼ŒåŠ å¯†ï¼ˆencryptionï¼‰ä¸Žè§£å¯†ï¼ˆdecryptionï¼‰ç”¨çš„æ˜¯åŒæ ·çš„å¯†é’¥ï¼ˆsecret keyï¼‰ã€‚å¯¹ç§°åŠ å¯†æœ‰å¾ˆå¤šç§ç®—æ³•ï¼Œç”±äºŽå®ƒæ•ˆçŽ‡å¾ˆé«˜ï¼Œæ‰€ä»¥è¢«å¹¿æ³›ä½¿ç”¨åœ¨å¾ˆå¤šåŠ å¯†åè®®çš„æ ¸å¿ƒå½“ä¸­ã€‚ å¯¹ç§°åŠ å¯†é€šå¸¸ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è¾ƒå°çš„å¯†é’¥ï¼Œä¸€èˆ¬å°äºŽ256 bitã€‚å› ä¸ºå¯†é’¥è¶Šå¤§ï¼ŒåŠ å¯†è¶Šå¼ºï¼Œä½†åŠ å¯†ä¸Žè§£å¯†çš„è¿‡ç¨‹è¶Šæ…¢ã€‚å¦‚æžœä½ åªç”¨1 bitæ¥åšè¿™ä¸ªå¯†é’¥ï¼Œé‚£é»‘å®¢ä»¬å¯ä»¥å…ˆè¯•ç€ç”¨0æ¥è§£å¯†ï¼Œä¸è¡Œçš„è¯å°±å†ç”¨1è§£ï¼›ä½†å¦‚æžœä½ çš„å¯†é’¥æœ‰1 MBå¤§ï¼Œé»‘å®¢ä»¬å¯èƒ½æ°¸è¿œä¹Ÿæ— æ³•ç ´è§£ï¼Œä½†åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´ã€‚å¯†é’¥çš„å¤§å°æ—¢è¦ç…§é¡¾åˆ°å®‰å…¨æ€§ï¼Œä¹Ÿè¦ç…§é¡¾åˆ°æ•ˆçŽ‡ï¼Œæ˜¯ä¸€ä¸ªtrade-offã€‚ å¯¹ç§°åŠ å¯†çš„ä¸€å¤§ç¼ºç‚¹æ˜¯å¯†é’¥çš„ç®¡ç†ä¸Žåˆ†é…ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚ä½•æŠŠå¯†é’¥å‘é€åˆ°éœ€è¦è§£å¯†ä½ çš„æ¶ˆæ¯çš„äººçš„æ‰‹é‡Œæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚åœ¨å‘é€å¯†é’¥çš„è¿‡ç¨‹ä¸­ï¼Œå¯†é’¥æœ‰å¾ˆå¤§çš„é£Žé™©ä¼šè¢«é»‘å®¢ä»¬æ‹¦æˆªã€‚çŽ°å®žä¸­é€šå¸¸çš„åšæ³•æ˜¯å°†å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡Œéžå¯¹ç§°åŠ å¯†ï¼Œç„¶åŽä¼ é€ç»™éœ€è¦å®ƒçš„äººã€‚ éžå¯¹ç§°åŠ å¯†ï¼šéžå¯¹ç§°åŠ å¯†ä¸ºæ•°æ®çš„åŠ å¯†ä¸Žè§£å¯†æä¾›äº†ä¸€ä¸ªéžå¸¸å®‰å…¨çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥ï¼ˆpublic keyï¼‰å’Œç§é’¥ï¼ˆprivate keyï¼‰ã€‚ç§é’¥åªèƒ½ç”±ä¸€æ–¹å®‰å…¨ä¿ç®¡ï¼Œä¸èƒ½å¤–æ³„ï¼Œè€Œå…¬é’¥åˆ™å¯ä»¥å‘ç»™ä»»ä½•è¯·æ±‚å®ƒçš„äººã€‚éžå¯¹ç§°åŠ å¯†ä½¿ç”¨è¿™å¯¹å¯†é’¥ä¸­çš„ä¸€ä¸ªè¿›è¡ŒåŠ å¯†ï¼Œè€Œè§£å¯†åˆ™éœ€è¦å¦ä¸€ä¸ªå¯†é’¥ã€‚æ¯”å¦‚ï¼Œä½ å‘é“¶è¡Œè¯·æ±‚å…¬é’¥ï¼Œé“¶è¡Œå°†å…¬é’¥å‘ç»™ä½ ï¼Œä½ ä½¿ç”¨å…¬é’¥å¯¹æ¶ˆæ¯åŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç§é’¥çš„æŒæœ‰äººâ€“é“¶è¡Œæ‰èƒ½å¯¹ä½ çš„æ¶ˆæ¯è§£å¯†ã€‚ä¸Žå¯¹ç§°åŠ å¯†ä¸åŒçš„æ˜¯ï¼Œé“¶è¡Œä¸éœ€è¦å°†ç§é’¥é€šè¿‡ç½‘ç»œå‘é€å‡ºåŽ»ï¼Œå› æ­¤å®‰å…¨æ€§å¤§å¤§æé«˜ã€‚ ç›®å‰æœ€å¸¸ç”¨çš„éžå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯RSAç®—æ³•ï¼Œæ˜¯Rivest, Shamir, å’ŒAdlemanäºŽ1978å¹´å‘æ˜Ž å¯¹ç§°åŠ å¯†å’Œéžå¯¹ç§°åŠ å¯†è™½ç„¶éžå¯¹ç§°åŠ å¯†å¾ˆå®‰å…¨ï¼Œä½†æ˜¯å’Œå¯¹ç§°åŠ å¯†æ¯”èµ·æ¥ï¼Œå®ƒéžå¸¸çš„æ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯è¦ç”¨å¯¹ç§°åŠ å¯†æ¥ä¼ é€æ¶ˆæ¯ï¼Œä½†å¯¹ç§°åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ç”¨éžå¯¹ç§°åŠ å¯†ï¼Œå‚è€ƒç½‘ä¸Šï¼Œçœ‹ä¸‹é¢çš„ä¸€ä¸ªä¾‹å­ï¼š é“å¤´éœ€è¦åœ¨é“¶è¡Œçš„ç½‘ç«™ä¸Šåšä¸€ç¬”äº¤æ˜“ï¼Œä»–çš„æ¸¸è§ˆå™¨ç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ•°ä½œä¸ºå¯¹ç§°å¯†é’¥ é“å¤´çš„æ¸¸è§ˆå™¨å‘é“¶è¡Œè¯·æ±‚éžå¯¹ç§°åŠ å¯†çš„å…¬é’¥ é“¶è¡Œå°†å…¬é’¥å‘é€ç»™é“å¤´ é“å¤´ç”¨è¿™ä¸ªå…¬é’¥å°†è‡ªå·±çš„å¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯† é“å¤´å°†åŠ å¯†åŽçš„å¯¹ç§°å¯†é’¥å‘é€ç»™é“¶è¡Œ é“¶è¡Œç”¨éžå¯¹ç§°åŠ å¯†çš„ç§æœ‰å¯†é’¥å¯¹è¿™ä¸ªå¯¹ç§°å¯†é’¥è¿›è¡Œè§£å¯†èŽ·å–åˆ°é“å¤´çš„å¯¹ç§°å¯†é’¥ é“å¤´ä¸Žé“¶è¡Œå¯ä»¥ä½¿ç”¨å¯¹ç§°å¯†é’¥æ¥å¯¹æ²Ÿé€šçš„å†…å®¹è¿›è¡ŒåŠ å¯†ä¸Žè§£å¯†äº†ã€‚ å¯¹ç§°å’Œéžå¯¹ç§°åŠ å¯†æ€»ç»“ å¯¹ç§°åŠ å¯†åŠ å¯†ä¸Žè§£å¯†ä½¿ç”¨çš„æ˜¯åŒæ ·çš„å¯†é’¥ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«ï¼Œä½†ç”±äºŽéœ€è¦å°†å¯†é’¥åœ¨ç½‘ç»œä¼ è¾“ï¼Œæ‰€ä»¥å®‰å…¨æ€§ä¸é«˜ã€‚ éžå¯¹ç§°åŠ å¯†ä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥ä¸Žç§é’¥ï¼Œæ‰€ä»¥å®‰å…¨æ€§é«˜ï¼Œä½†åŠ å¯†ä¸Žè§£å¯†é€Ÿåº¦æ…¢ã€‚ è§£å†³çš„åŠžæ³•æ˜¯å°†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ä½¿ç”¨éžå¯¹ç§°åŠ å¯†çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åŽå‘é€å‡ºåŽ»ï¼ŒæŽ¥æ”¶æ–¹ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†å¾—åˆ°å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œç„¶åŽåŒæ–¹å¯ä»¥ä½¿ç”¨å¯¹ç§°åŠ å¯†æ¥è¿›è¡Œæ²Ÿé€šã€‚ éžå¯¹ç§°åŠ å¯†ä¾‹å­ RSAï¼ˆå‚è€ƒè¿™é‡Œï¼‰ å¯¹ç§°åŠ å¯†ä¾‹å­ AESï¼ˆå‚è€ƒè¿™é‡Œï¼‰ é¡¹ç›®ä¸­é™¤äº†ç™»é™†ï¼Œæ”¯ä»˜ç­‰æŽ¥å£é‡‡ç”¨rsaéžå¯¹ç§°åŠ å¯†ï¼Œä¹‹å¤–çš„é‡‡ç”¨aeså¯¹ç§°åŠ å¯† é«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆè‹±è¯­ï¼šAdvanced Encryption Standardï¼Œç¼©å†™ï¼šAESï¼‰ è¿™ä¸ªæ ‡å‡†ç”¨æ¥æ›¿ä»£åŽŸå…ˆçš„DES DESï¼ˆå‚è€ƒè¿™é‡Œï¼‰ DESåŠ å¯†ç®—æ³•å‡ºè‡ªIBM è¿‘äº›å¹´ä½¿ç”¨è¶Šæ¥è¶Šå°‘ DESä½¿ç”¨56ä½å¯†é’¥ï¼Œä»¥çŽ°ä»£è®¡ç®—èƒ½åŠ›ï¼Œ24å°æ—¶å†…å³å¯è¢«ç ´è§£ã€‚ AESå’ŒDESå¯¹æ¯” AESå®‰å…¨æ€§ã€æ•ˆçŽ‡ã€çµæ´»æ€§è¦é«˜äºŽDES å¯¹ç§°åŠ å¯†ä¼˜å…ˆé‡‡ç”¨AES å…¶ä»–åŠ å¯† MD5 ç‰¹ç‚¹ï¼šå•å‘åŠ å¯†ç®—æ³•ï¼Œæ˜¯ä¸å¯é€†çš„ä¸€ç§çš„åŠ å¯†æ–¹å¼ åŽ‹ç¼©æ€§ï¼šä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œç®—å‡ºçš„MD5å€¼é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ã€‚ å®¹æ˜“è®¡ç®—ï¼šä»ŽåŽŸæ•°æ®è®¡ç®—å‡ºMD5å€¼å¾ˆå®¹æ˜“ã€‚ æŠ—ä¿®æ”¹æ€§ï¼šå¯¹åŽŸæ•°æ®è¿›è¡Œä»»ä½•æ”¹åŠ¨ï¼Œå“ªæ€•åªä¿®æ”¹1ä¸ªå­—èŠ‚ï¼Œæ‰€å¾—åˆ°çš„MD5å€¼éƒ½æœ‰å¾ˆå¤§åŒºåˆ«ã€‚ å¼ºæŠ—ç¢°æ’žï¼šå·²çŸ¥åŽŸæ•°æ®å’Œå…¶MD5å€¼ï¼Œæƒ³æ‰¾åˆ°ä¸€ä¸ªå…·æœ‰ç›¸åŒMD5å€¼çš„æ•°æ®ï¼ˆå³ä¼ªé€ æ•°æ®ï¼‰æ˜¯éžå¸¸å›°éš¾çš„ã€‚ åŠ å¤§MD5å®‰å…¨æ€§ è¿›è¡Œå¤šæ¬¡MD5åŠ å¯† MD5åŠ ç› ç”¨stringæ˜Žæ–‡çš„hashcodeä½œä¸ºç›ï¼Œç„¶åŽè¿›è¡ŒMD5åŠ å¯† éšæœºç”Ÿæˆä¸€ä¸²å­—ç¬¦ä¸²ä½œä¸ºç›ï¼Œç„¶åŽè¿›è¡ŒMD5åŠ å¯† Base64 å¹³æ—¶å¼€å‘ä¸­é‡è§çš„å„ç§æ•°æ®åŠ å¯†æ–¹å¼ï¼Œæœ€ç»ˆéƒ½ä¼šå¯¹åŠ å¯†åŽçš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡ŒBase64ç¼–ç ï¼Œèµ·åˆ°ä¸€ç§äºŒæ¬¡åŠ å¯†çš„æ•ˆæžœ å…¶å®žå‘¢Base64ä»Žä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´çš„è¯ä¸æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œè€Œæ˜¯ä¸€ç§ç¼–ç ç®—æ³• æ›´å¤š æ‰€ä»¥ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ•°æ®ä¼ é€åŠ å¯†ï¼Œæœ€å¤šä½¿ç”¨çš„æ˜¯éžå¯¹ç§°RSAå’Œå¯¹ç§°AESï¼Œå‚è€ƒè¿™é‡Œ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç­¾å]]></title>
    <url>%2F2017%2F07%2F02%2FAndroid%E7%AD%BE%E5%90%8D%2F</url>
    <content type="text"><![CDATA[ç­¾åæ–‡ä»¶ç”Ÿæˆä¸Žé…ç½® å½“æˆ‘ä»¬ä½¿ç”¨Android Studioè¿è¡Œappï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ¨¡å¼ï¼šdebugå’Œreleaseæ¨¡å¼ï¼Œå¦‚æžœæˆ‘ä»¬æ²¡æœ‰é…ç½®ç­¾åï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤çš„ç­¾åæ–‡ä»¶ï¼ˆä¸€èˆ¬åœ¨Macï¼š/Users/fengan/.android/debug.keystoreï¼‰ï¼Œä¸€èˆ¬æˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®åº”ç”¨çš„ç­¾åæ–‡ä»¶ åˆ›å»ºKeystoreé…ç½®ä¿¡æ¯ç­¾åV1å’ŒV2çš„åŒºåˆ«å¾®ä¿¡å¼€æ”¾å¹³å°å¡«å†™åº”ç”¨ç­¾åçš„èŽ·å–å‚è€ƒï¼šé“¾æŽ¥ä¸€ é“¾æŽ¥äºŒ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[transientå…³é”®å­—çš„ä½œç”¨]]></title>
    <url>%2F2017%2F03%2F15%2Ftransient%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E4%BD%9C%E7%94%A8%2F</url>
    <content type="text"><![CDATA[transientçš„ç›¸å…³çŸ¥è¯†æ•´ç† transientçš„ç›¸å…³çŸ¥è¯†å®˜æ–¹è§£é‡Š1Variables may be marked transient to indicate that they are not part of the persistent state of an object. é‡åˆ°é—®é¢˜æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªå¯¹è±¡åªè¦å®žçŽ°äº†SerializableæŽ¥å£ï¼Œè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œé‚£ä¹ˆåœ¨å®žé™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œè¿™ä¸ªç±»çš„æœ‰äº›å±žæ€§éœ€è¦åºåˆ—å·ï¼Œè€Œå…¶ä»–å±žæ€§ä¸éœ€è¦åºåˆ—åŒ–ï¼Œæ¯”å¦‚è¯´ï¼šä¸€ä¸ªç”¨æˆ·æœ‰ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å¯†ç æˆ–è€…é“¶è¡Œå¡å·ä¹‹ç±»ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸å¸Œæœ›åœ¨ç½‘ç»œæ“ä½œï¼ˆä¸»è¦æ¶‰åŠåˆ°åºåˆ—åŒ–æ“ä½œï¼Œæœ¬åœ°åºåˆ—åŒ–ç¼“å­˜ä¹Ÿé€‚ç”¨ï¼‰ä¸­è¢«ä¼ è¾“ï¼Œè¿™äº›ä¿¡æ¯å¯¹åº”çš„å˜é‡å°±å¯ä»¥åŠ ä¸Štransientå…³é”®å­—ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå­—æ®µçš„ç”Ÿå‘½å‘¨æœŸä»…å­˜äºŽè°ƒç”¨è€…çš„å†…å­˜ä¸­è€Œä¸ä¼šå†™åˆ°ç£ç›˜é‡ŒæŒä¹…åŒ–ã€‚ è§£å†³é—®é¢˜å†æ¬¡ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªå§¿åŠ¿ç‚¹ï¼š çˆ¶ç±»åºåˆ—åŒ– ä¸€ä¸ªæƒ…æ™¯ï¼šä¸€ä¸ªå­ç±»å®žçŽ°äº†SerializableæŽ¥å£ï¼Œå®ƒçš„çˆ¶ç±»éƒ½æ²¡æœ‰å®žçŽ°SerializableæŽ¥å£ï¼Œåºåˆ—åŒ–è¯¥å­ç±»å¯¹è±¡ï¼Œç„¶åŽååºåˆ—åŒ–åŽï¼Œè¾“å‡ºçˆ¶ç±»å®šä¹‰çš„æŸå˜é‡çš„æ•°å€¼ï¼Œè¯¥å˜é‡æ•°å€¼ä¸Žåºåˆ—åŒ–å‰ä¸åŒ è§£å†³ï¼šè¦æƒ³å°†çˆ¶ç±»å¯¹è±¡ä¹Ÿåºåˆ—åŒ–ï¼Œå°±éœ€è¦è®©çˆ¶ç±»ä¹Ÿå®žçŽ°Serializable æŽ¥å£ã€‚å¦‚æžœçˆ¶ç±»ä¸å®žçŽ°çš„è¯çš„ï¼Œå°± éœ€è¦æœ‰é»˜è®¤çš„æ— å‚çš„æž„é€ å‡½æ•°ã€‚åœ¨çˆ¶ç±»æ²¡æœ‰å®žçŽ° Serializable æŽ¥å£æ—¶ï¼Œè™šæ‹Ÿæœºæ˜¯ä¸ä¼šåºåˆ—åŒ–çˆ¶å¯¹è±¡çš„ï¼Œè€Œä¸€ä¸ª Java å¯¹è±¡çš„æž„é€ å¿…é¡»å…ˆæœ‰çˆ¶å¯¹è±¡ï¼Œæ‰æœ‰å­å¯¹è±¡ï¼Œååºåˆ—åŒ–ä¹Ÿä¸ä¾‹å¤–ã€‚æ‰€ä»¥ååºåˆ—åŒ–æ—¶ï¼Œä¸ºäº†æž„é€ çˆ¶å¯¹è±¡ï¼Œåªèƒ½è°ƒç”¨çˆ¶ç±»çš„æ— å‚æž„é€ å‡½æ•°ä½œä¸ºé»˜è®¤çš„çˆ¶å¯¹è±¡ã€‚å› æ­¤å½“æˆ‘ä»¬å–çˆ¶å¯¹è±¡çš„å˜é‡å€¼æ—¶ï¼Œå®ƒçš„å€¼æ˜¯è°ƒç”¨çˆ¶ç±»æ— å‚æž„é€ å‡½æ•°åŽçš„å€¼ã€‚å¦‚æžœä½ è€ƒè™‘åˆ°è¿™ç§åºåˆ—åŒ–çš„æƒ…å†µï¼Œåœ¨çˆ¶ç±»æ— å‚æž„é€ å‡½æ•°ä¸­å¯¹å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦åˆ™çš„è¯ï¼Œçˆ¶ç±»å˜é‡å€¼éƒ½æ˜¯é»˜è®¤å£°æ˜Žçš„å€¼ï¼Œå¦‚ int åž‹çš„é»˜è®¤æ˜¯ 0ï¼Œstring åž‹çš„é»˜è®¤æ˜¯ nullã€‚ Transient å…³é”®å­—çš„ä½œç”¨æ˜¯æŽ§åˆ¶å˜é‡çš„åºåˆ—åŒ–ï¼Œåœ¨å˜é‡å£°æ˜Žå‰åŠ ä¸Šè¯¥å…³é”®å­—ï¼Œå¯ä»¥é˜»æ­¢è¯¥å˜é‡è¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åŽï¼Œtransient å˜é‡çš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œå¦‚ int åž‹çš„æ˜¯ 0ï¼Œå¯¹è±¡åž‹çš„æ˜¯ nullã€‚ ç‰¹æ€§ä½¿ç”¨æ¡ˆä¾‹ æˆ‘ä»¬ç†Ÿæ‚‰ä½¿ç”¨ Transient å…³é”®å­—å¯ä»¥ä½¿å¾—å­—æ®µä¸è¢«åºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¿˜æœ‰åˆ«çš„æ–¹æ³•å—ï¼Ÿæ ¹æ®çˆ¶ç±»å¯¹è±¡åºåˆ—åŒ–çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸éœ€è¦è¢«åºåˆ—åŒ–çš„å­—æ®µæŠ½å–å‡ºæ¥æ”¾åˆ°çˆ¶ç±»ä¸­ï¼Œå­ç±»å®žçŽ° Serializable æŽ¥å£ï¼Œçˆ¶ç±»ä¸å®žçŽ°ï¼Œæ ¹æ®çˆ¶ç±»åºåˆ—åŒ–è§„åˆ™ï¼Œçˆ¶ç±»çš„å­—æ®µæ•°æ®å°†ä¸è¢«åºåˆ—åŒ– ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œattr1ã€attr2ã€attr3ã€attr5 éƒ½ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œæ”¾åœ¨çˆ¶ç±»ä¸­çš„å¥½å¤„åœ¨äºŽå½“æœ‰å¦å¤–ä¸€ä¸ª Child ç±»æ—¶ï¼Œattr1ã€attr2ã€attr3 ä¾ç„¶ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œä¸ç”¨é‡å¤æŠ’å†™ transientï¼Œä»£ç ç®€æ´ã€‚ å‚è€ƒï¼š javaå­¦ä¹ â€”åºåˆ—åŒ–ä¸ŽTransientå…³é”®å­— Transientå…³é”®å­—ä½¿ç”¨åœºæ™¯]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ASä¸­çœ‹ä¸åˆ°æºç é—®é¢˜è§£å†³]]></title>
    <url>%2F2017%2F03%2F13%2FSources-for-%E2%80%98Android-API-xx-Platform%E2%80%99-not-found%2F</url>
    <content type="text"><![CDATA[åœ¨Android Studioç¿»æºç å¤šæ—¶å€™ï¼Œæ˜Žæ˜Žä¸‹è½½äº†å¯¹åº”çš„SDKï¼Œå´ç‚¹è¿›åŽ»éƒ½æ˜¯.classçœ‹ä¸åˆ°æºç ï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹è§£å†³åŠžæ³• é¦–å…ˆç¡®ä¿ä¸‹è½½äº†å¯¹åº”çš„SDK æ‰¾åˆ°ä»¥ä¸‹è·¯å¾„ï¼Œå¹¶æ‰“å¼€æ–‡ä»¶ ~/Library/Preferences/AndroidStudioXXX/options/jdk.table.xml ä¿®æ”¹å‰ ä¿®æ”¹åŽ é‡å¯AS]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Webviewä½¿ç”¨æ€»ç»“]]></title>
    <url>%2F2017%2F03%2F12%2FWebview%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[WebViewç›¸å…³çŸ¥è¯†æ•´ç† WebViewä½¿ç”¨æ€»ç»“å‰è¨€ï¼š æœ€è¿‘ï¼Œä¿®æ”¹äº†é¡¹ç›®ä¸­ç½‘é¡µä¸­ç‚¹å‡»å›¾ç‰‡è·³è½¬æŸ¥çœ‹å¤§å›¾é¡µé¢çš„éœ€æ±‚ï¼Œæ¿€å‘äº†æˆ‘å½’çº³æ€»ç»“WebViewçš„æƒ³æ³•ï¼Œä»Šå¤©å†æ¬¡æ•´ç†ä¸€ä¸‹ã€‚ åŒ…å«ï¼šä½¿ç”¨è¿‡ç¨‹ï¼Œå…³é”®ç±»ï¼Œjsäº¤äº’ï¼Œæ³¨æ„äº‹é¡¹ï¼Œä»¥åŠå‡ ä¸ªå¸¸è§çš„éœ€æ±‚è§£å†³æ€è·¯ç­‰ã€‚ çŒ®ä¸Šä¸€å¼ æ¡†æž¶å›¾ åŸºæœ¬ç®€ä»‹å†…æ ¸åœ¨4.4ä»¥å‰çš„ç‰ˆæœ¬æ˜¯WebKitçš„å†…æ ¸ï¼Œ4.4ä»¥åŽæ‰æ¢æˆchromiumçš„å†…æ ¸ å¯ä½¿ç”¨ç¬¬ä¸‰æ–¹WebViewç»„ä»¶Crosswalkå’ŒTBSæœåŠ¡ï¼Œå…·ä½“åŒºåˆ«åŽé¢å†æ•´ç† ä½œç”¨ æ˜¾ç¤ºå’Œæ¸²æŸ“webé¡µé¢ ç›´æŽ¥åŠ è½½Htmlæ–‡ä»¶ï¼ˆç½‘ç»œæˆ–è€…æœ¬åœ°assertsï¼‰ ä¸Žjsäº’è°ƒ çŠ¶æ€ webView.onResume() ï¼› æ¿€æ´»WebViewä¸ºæ´»è·ƒçŠ¶æ€ï¼Œèƒ½æ­£å¸¸æ‰§è¡Œç½‘é¡µçš„å“åº” webView.onPause()ï¼› å½“é¡µé¢è¢«å¤±åŽ»ç„¦ç‚¹è¢«åˆ‡æ¢åˆ°åŽå°ä¸å¯è§çŠ¶æ€ï¼Œéœ€è¦æ‰§è¡ŒonPauseï¼Œé€šè¿‡onPauseåŠ¨ä½œé€šçŸ¥å†…æ ¸æš‚åœæ‰€æœ‰çš„åŠ¨ä½œï¼Œæ¯”å¦‚DOMçš„è§£æžã€pluginçš„æ‰§è¡Œã€JavaScriptæ‰§è¡Œã€‚ webView.pauseTimers() WebviewåŽå°è€—ç”µçš„é—®é¢˜ å½“åº”ç”¨ç¨‹åº(å­˜åœ¨webview)è¢«åˆ‡æ¢åˆ°åŽå°æ—¶ï¼Œéœ€è¦æš‚åœæ‰€æœ‰webviewçš„layoutï¼Œparsingï¼Œjavascripttimerã€‚é™ä½ŽCPUåŠŸè€—ã€‚ å¯ä»¥è°ƒç”¨æ­¤æ–¹æ³• webView.resumeTimers() æ¢å¤pauseTimersçŠ¶æ€ æ³¨æ„ï¼š ç”±äºŽpauseTimerså’ŒresumeTimersæ˜¯å…¨å±€ç”Ÿæ•ˆçš„, å¹¶ä¸åªå½±å“å•ä¸ªWebView, resumeTimersæ³¨æ„ä¸è¦é—æ¼, å¦åˆ™é—æ¼çš„WebViewä¼šå‡ºçŽ°å¼‚å¸¸. æœ€å¥½åœ¨é‡å†™çš„WebView rootLayout.removeView(webView); webView.destroy(); é”€æ¯Webviewï¼Œåœ¨å…³é—­äº†Activityæ—¶ï¼Œå¦‚æžœWebviewçš„éŸ³ä¹æˆ–è§†é¢‘ï¼Œè¿˜åœ¨æ’­æ”¾ã€‚å°±å¿…é¡»é”€æ¯Webview ä½†æ˜¯æ³¨æ„ï¼šwebviewè°ƒç”¨destoryæ—¶,webviewä»ç»‘å®šåœ¨Activityä¸Š è¿™æ˜¯ç”±äºŽè‡ªå®šä¹‰webviewæž„å»ºæ—¶ä¼ å…¥äº†è¯¥Activityçš„contextå¯¹è±¡ å› æ­¤éœ€è¦å…ˆä»Žçˆ¶å®¹å™¨ä¸­ç§»é™¤webview,ç„¶åŽå†é”€æ¯webview: å‰è¿›å›žé€€ç½‘é¡µ Webview.canGoBack() æ˜¯å¦å¯ä»¥åŽé€€ Webview.goBack() åŽé€€ç½‘é¡µ Webview.canGoForward() æ˜¯å¦å¯ä»¥å‰è¿› Webview.goForward() å‰è¿›ç½‘é¡µ Webview.goBackOrForward(intsteps) ä»¥å½“å‰çš„indexä¸ºèµ·å§‹ç‚¹å‰è¿›æˆ–è€…åŽé€€åˆ°åŽ†å²è®°å½•ä¸­æŒ‡å®šçš„steps å¦‚æžœstepsä¸ºè´Ÿæ•°åˆ™ä¸ºåŽé€€ï¼Œæ­£æ•°åˆ™ä¸ºå‰è¿› å¸¸è§ç”¨æ³•ï¼š é—®é¢˜ åœ¨ä¸åšä»»ä½•å¤„ç†å‰æä¸‹ ï¼Œæµè§ˆç½‘é¡µæ—¶ç‚¹å‡»ç³»ç»Ÿçš„â€œBackâ€é”®,æ•´ä¸ª Browser ä¼šè°ƒç”¨ finish()è€Œç»“æŸè‡ªèº« ç›®æ ‡ ç‚¹å‡»è¿”å›žåŽï¼Œæ˜¯ç½‘é¡µå›žé€€è€Œä¸æ˜¯æŽ¨å‡ºæµè§ˆå™¨ è§£å†³æ–¹æ¡ˆ åœ¨å½“å‰Activityä¸­å¤„ç†å¹¶æ¶ˆè´¹æŽ‰è¯¥ Back äº‹ä»¶ 1234567public boolean onKeyDown(int keyCode, KeyEvent event) &#123; if ((keyCode == KEYCODE_BACK) &amp;&amp; mWebView.canGoBack()) &#123; mWebView.goBack(); return true; &#125; return super.onKeyDown(keyCode, event);&#125; å¸¸ç”¨ç±»WebSettings12345678910111213141516171819202122232425262728293031//å£°æ˜ŽWebSettingså­ç±»WebSettings webSettings = webView.getSettings();//å¦‚æžœè®¿é—®çš„é¡µé¢ä¸­è¦ä¸ŽJavascriptäº¤äº’ï¼Œåˆ™webviewå¿…é¡»è®¾ç½®æ”¯æŒJavascriptwebSettings.setJavaScriptEnabled(true); //æ”¯æŒæ’ä»¶webSettings.setPluginsEnabled(true); //è®¾ç½®è‡ªé€‚åº”å±å¹•ï¼Œä¸¤è€…åˆç”¨webSettings.setUseWideViewPort(true); //å°†å›¾ç‰‡è°ƒæ•´åˆ°é€‚åˆwebviewçš„å¤§å° webSettings.setLoadWithOverviewMode(true); // ç¼©æ”¾è‡³å±å¹•çš„å¤§å°//ç¼©æ”¾æ“ä½œwebSettings.setSupportZoom(true); //æ”¯æŒç¼©æ”¾ï¼Œé»˜è®¤ä¸ºtrueã€‚æ˜¯ä¸‹é¢é‚£ä¸ªçš„å‰æã€‚webSettings.setBuiltInZoomControls(true); //è®¾ç½®å†…ç½®çš„ç¼©æ”¾æŽ§ä»¶ã€‚è‹¥ä¸ºfalseï¼Œåˆ™è¯¥WebViewä¸å¯ç¼©æ”¾webSettings.setDisplayZoomControls(false); //éšè—åŽŸç”Ÿçš„ç¼©æ”¾æŽ§ä»¶//å…¶ä»–ç»†èŠ‚æ“ä½œwebSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); //å…³é—­webviewä¸­ç¼“å­˜ webSettings.setAllowFileAccess(true); //è®¾ç½®å¯ä»¥è®¿é—®æ–‡ä»¶ webSettings.setJavaScriptCanOpenWindowsAutomatically(true); //æ”¯æŒé€šè¿‡JSæ‰“å¼€æ–°çª—å£ webSettings.setLoadsImagesAutomatically(true); //æ”¯æŒè‡ªåŠ¨åŠ è½½å›¾ç‰‡webSettings.setDefaultTextEncodingName("utf-8");//è®¾ç½®ç¼–ç æ ¼å¼//ä¼˜å…ˆä½¿ç”¨ç¼“å­˜: webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); //ç¼“å­˜æ¨¡å¼å¦‚ä¸‹ï¼š //LOAD_CACHE_ONLY: ä¸ä½¿ç”¨ç½‘ç»œï¼Œåªè¯»å–æœ¬åœ°ç¼“å­˜æ•°æ® //LOAD_DEFAULT: ï¼ˆé»˜è®¤ï¼‰æ ¹æ®cache-controlå†³å®šæ˜¯å¦ä»Žç½‘ç»œä¸Šå–æ•°æ®ã€‚ //LOAD_NO_CACHE: ä¸ä½¿ç”¨ç¼“å­˜ï¼Œåªä»Žç½‘ç»œèŽ·å–æ•°æ®. //LOAD_CACHE_ELSE_NETWORKï¼Œåªè¦æœ¬åœ°æœ‰ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸï¼Œæˆ–è€…no-cacheï¼Œéƒ½ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ã€‚ å¸¸è§ç¼“å­˜ç”¨æ³• 123456789101112if (NetStatusUtil.isConnected(getApplicationContext())) &#123; webSettings.setCacheMode(WebSettings.LOAD_DEFAULT);//æ ¹æ®cache-controlå†³å®šæ˜¯å¦ä»Žç½‘ç»œä¸Šå–æ•°æ®ã€‚&#125; else &#123; webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK);//æ²¡ç½‘ï¼Œåˆ™ä»Žæœ¬åœ°èŽ·å–ï¼Œå³ç¦»çº¿åŠ è½½&#125;webSettings.setDomStorageEnabled(true); // å¼€å¯ DOM storage API åŠŸèƒ½webSettings.setDatabaseEnabled(true); //å¼€å¯ database storage API åŠŸèƒ½webSettings.setAppCacheEnabled(true);//å¼€å¯ Application Caches åŠŸèƒ½String cacheDirPath = getFilesDir().getAbsolutePath() + APP_CACAHE_DIRNAME;webSettings.setAppCachePath(cacheDirPath); //è®¾ç½® Application Caches ç¼“å­˜ç›®å½• æ¯ä¸ª Application åªè°ƒç”¨ä¸€æ¬¡ WebSettings.setAppCachePath()ï¼ŒWebSettings.setAppCacheMaxSize() WebViewClientä¸»è¦è¾…åŠ©WebViewå¤„ç†å„ç§é€šçŸ¥ã€è¯·æ±‚äº‹ä»¶12345678910111213141516171819202122232425262728293031323334353637383940new WebViewClient()&#123;// ä½¿å¾—æ‰“å¼€ç½‘é¡µæ—¶ä¸è°ƒç”¨ç³»ç»Ÿæµè§ˆå™¨ï¼Œ è€Œæ˜¯åœ¨æœ¬WebViewä¸­æ˜¾ç¤º @Override public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) &#123; return super.shouldOverrideUrlLoading(view, request); &#125;// å¼€å§‹è½½å…¥é¡µé¢è°ƒç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šä¸€ä¸ªloadingçš„é¡µé¢ï¼Œå‘Šè¯‰ç”¨æˆ·ç¨‹åºåœ¨ç­‰å¾…ç½‘ç»œå“åº”ã€‚ @Override public void onPageStarted(WebView view, String url, Bitmap favicon) &#123; super.onPageStarted(view, url, favicon); &#125;// åœ¨é¡µé¢åŠ è½½ç»“æŸæ—¶è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥å…³é—­loading æ¡ï¼Œåˆ‡æ¢ç¨‹åºåŠ¨ä½œã€‚ @Override public void onPageFinished(WebView view, String url) &#123; super.onPageFinished(view, url); &#125;// åœ¨åŠ è½½é¡µé¢èµ„æºæ—¶ä¼šè°ƒç”¨ï¼Œæ¯ä¸€ä¸ªèµ„æºï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰çš„åŠ è½½éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ã€‚ @Override public void onLoadResource(WebView view, String url) &#123; super.onLoadResource(view, url); &#125;// è¯¥æ–¹æ³•ä¼ å›žäº†é”™è¯¯ç ï¼Œæ ¹æ®é”™è¯¯ç±»åž‹å¯ä»¥è¿›è¡Œä¸åŒçš„é”™è¯¯åˆ†ç±»å¤„ç† @Override public void onReceivedError(WebView view, WebResourceRequest request, WebResourceError error) &#123; super.onReceivedError(view, request, error); &#125;// webViewé»˜è®¤æ˜¯ä¸å¤„ç†httpsè¯·æ±‚çš„ï¼Œé¡µé¢æ˜¾ç¤ºç©ºç™½ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š @Override public void onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) &#123;// super.onReceivedSslError(view, handler, error); handler.proceed(); //è¡¨ç¤ºç­‰å¾…è¯ä¹¦å“åº” // handler.cancel(); //è¡¨ç¤ºæŒ‚èµ·è¿žæŽ¥ï¼Œä¸ºé»˜è®¤æ–¹å¼ // handler.handleMessage(null); //å¯åšå…¶ä»–å¤„ç† &#125; &#125;; WebChromClientè¾…åŠ© WebView å¤„ç† Javascript çš„å¯¹è¯æ¡†,ç½‘ç«™å›¾æ ‡,ç½‘ç«™æ ‡é¢˜ç­‰ç­‰ã€‚ èŽ·å¾—ç½‘é¡µçš„åŠ è½½è¿›åº¦å¹¶æ˜¾ç¤º 12345678910webview.setWebChromeClient(new WebChromeClient()&#123; @Override public void onProgressChanged(WebView view, int newProgress) &#123; if (newProgress &lt; 100) &#123; String progress = newProgress + "%"; progress.setText(progress); &#125; else &#123; &#125; &#125;); onReceivedTitleï¼ˆï¼‰ 123456webview.setWebChromeClient(new WebChromeClient()&#123; @Override public void onReceivedTitle(WebView view, String title) &#123; titleview.setText(title)ï¼› &#125; JSäº¤äº’åŽŸæ–‡ Androidè°ƒJs ä½¿ç”¨å»ºè®® ä¸¤ç§æ–¹æ³•æ··åˆä½¿ç”¨ï¼Œå³Android 4.4ä»¥ä¸‹ä½¿ç”¨æ–¹æ³•1ï¼ŒAndroid 4.4ä»¥ä¸Šæ–¹æ³•2 12345678910111213// Androidç‰ˆæœ¬å˜é‡final int version = Build.VERSION.SDK_INT;// å› ä¸ºè¯¥æ–¹æ³•åœ¨ Android 4.4 ç‰ˆæœ¬æ‰å¯ä½¿ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶éœ€è¿›è¡Œç‰ˆæœ¬åˆ¤æ–­if (version &lt; 18) &#123; mWebView.loadUrl("javascript:callJS()");&#125; else &#123; mWebView.evaluateJavascriptï¼ˆ"javascript:callJS()", new ValueCallback&lt;String&gt;() &#123; @Override public void onReceiveValue(String value) &#123; //æ­¤å¤„ä¸º js è¿”å›žçš„ç»“æžœ &#125; &#125;);&#125; é€šè¿‡loadUrlæ–¹å¼è°ƒç”¨jsHtmlä»£ç  12345678910111213141516171819// æ–‡æœ¬åï¼šjavascript&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Carson_Ho&lt;/title&gt;// JSä»£ç  &lt;script&gt;// Androidéœ€è¦è°ƒç”¨çš„æ–¹æ³• function callJS()&#123; alert("Androidè°ƒç”¨äº†JSçš„callJSæ–¹æ³•"); &#125;&lt;/script&gt; &lt;/head&gt;&lt;/html&gt; Androidä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// è®¾ç½®ä¸ŽJsäº¤äº’çš„æƒé™ webSettings.setJavaScriptEnabled(true); // è®¾ç½®å…è®¸JSå¼¹çª— webSettings.setJavaScriptCanOpenWindowsAutomatically(true); // å…ˆè½½å…¥JSä»£ç  // æ ¼å¼è§„å®šä¸º:file:///android_asset/æ–‡ä»¶å.html mWebView.loadUrl("file:///android_asset/javascript.html"); button = (Button) findViewById(R.id.button); button.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; // å¿…é¡»å¦å¼€çº¿ç¨‹è¿›è¡ŒJSæ–¹æ³•è°ƒç”¨(å¦åˆ™æ— æ³•è°ƒç”¨) mWebView.post(new Runnable() &#123; @Override public void run() &#123; // æ³¨æ„è°ƒç”¨çš„JSæ–¹æ³•åè¦å¯¹åº”ä¸Š // è°ƒç”¨javascriptçš„callJS()æ–¹æ³• mWebView.loadUrl("javascript:callJS()"); &#125; &#125;); &#125; &#125;); // ç”±äºŽè®¾ç½®äº†å¼¹çª—æ£€éªŒè°ƒç”¨ç»“æžœ,æ‰€ä»¥éœ€è¦æ”¯æŒjså¯¹è¯æ¡† // webviewåªæ˜¯è½½ä½“ï¼Œå†…å®¹çš„æ¸²æŸ“éœ€è¦ä½¿ç”¨webviewChromClientç±»åŽ»å®žçŽ° // é€šè¿‡è®¾ç½®WebChromeClientå¯¹è±¡å¤„ç†JavaScriptçš„å¯¹è¯æ¡† //è®¾ç½®å“åº”js çš„Alert()å‡½æ•° mWebView.setWebChromeClient(new WebChromeClient() &#123; @Override public boolean onJsAlert(WebView view, String url, String message, final JsResult result) &#123; AlertDialog.Builder b = new AlertDialog.Builder(MainActivity.this); b.setTitle("Alert"); b.setMessage(message); b.setPositiveButton(android.R.string.ok, new DialogInterface.OnClickListener() &#123; @Override public void onClick(DialogInterface dialog, int which) &#123; result.confirm(); &#125; &#125;); b.setCancelable(false); b.create().show(); return true; &#125; &#125;); &#125; ç‰¹åˆ«æ³¨æ„ï¼šJSä»£ç è°ƒç”¨ä¸€å®šè¦åœ¨ onPageFinishedï¼ˆï¼‰ å›žè°ƒä¹‹åŽæ‰èƒ½è°ƒç”¨ï¼Œå¦åˆ™ä¸ä¼šè°ƒç”¨ã€‚ onPageFinished()å±žäºŽWebViewClientç±»çš„æ–¹æ³•ï¼Œä¸»è¦åœ¨é¡µé¢åŠ è½½ç»“æŸæ—¶è°ƒç”¨ æ‰€ä»¥ä¸€èˆ¬ç­‰onPageFnishedå›žè°ƒä¹‹åŽï¼Œæˆ‘ä»¬æ‰æ˜¾ç¤ºH5çš„é¡µé¢ï¼ŒåŠ è½½æœªå®Œå…¨çš„æ—¶å€™ï¼Œåˆ™æ˜¾ç¤ºloadingé¡µé¢ é€šè¿‡evaluateJavascriptè°ƒç”¨jsä¼˜ç‚¹ è¯¥æ–¹æ³•æ¯”ç¬¬ä¸€ç§æ–¹æ³•æ•ˆçŽ‡æ›´é«˜ã€ä½¿ç”¨æ›´ç®€æ´ã€‚ å› ä¸ºè¯¥æ–¹æ³•çš„æ‰§è¡Œä¸ä¼šä½¿é¡µé¢åˆ·æ–°ï¼Œè€Œç¬¬ä¸€ç§æ–¹æ³•ï¼ˆloadUrl ï¼‰çš„æ‰§è¡Œåˆ™ä¼šã€‚ Android 4.4 åŽæ‰å¯ä½¿ç”¨ 12345678// åªéœ€è¦å°†ç¬¬ä¸€ç§æ–¹æ³•çš„loadUrl()æ¢æˆä¸‹é¢è¯¥æ–¹æ³•å³å¯ mWebView.evaluateJavascriptï¼ˆ"javascript:callJS()", new ValueCallback&lt;String&gt;() &#123; @Override public void onReceiveValue(String value) &#123; //æ­¤å¤„ä¸º js è¿”å›žçš„ç»“æžœ &#125; &#125;);&#125; Jsè°ƒAndroid ç¼“å­˜é—®é¢˜åŽŸæ–‡ å‚è€ƒé“¾æŽ¥Carson_Ho]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµ…æžvolatileå…³é”®å­—]]></title>
    <url>%2F2017%2F03%2F07%2F%E6%B5%85%E6%9E%90volatile%E5%85%B3%E9%94%AE%E5%AD%97%2F</url>
    <content type="text"><![CDATA[åœ¨çœ‹javaå¹¶å‘çš„ä¹¦çš„æ—¶å€™ï¼Œçœ‹åˆ°äº†å…³äºŽjavaçš„å•ä¾‹æ¨¡å¼ä½¿ç”¨äº†volatileå…³é”®å­—ï¼Œä½†æ˜¯å¯¹volatileå…³é”®å­—çš„çœŸæ­£å«ä¹‰ä¸€ç›´å¾ˆæ¨¡ç³Šï¼Œæœ¬æ–‡å°±å°è¯•æµ…æžæ€»ç»“ä¸€ä¸‹volatileçš„ä½œç”¨å’Œå…·ä½“ç”¨æ³•ã€‚ å•ä¾‹æ¨¡å¼ä¸­çš„volatileå…³é”®å­—æŸ¥çœ‹åŽŸæ–‡ 123456789101112131415public class TestInstance &#123; private volatile static TestInstance instance; public static TestInstance getInstance() &#123; //1 if (instance == null) &#123; //2 synchronized (TestInstance.class) &#123;//3 if (instance == null) &#123; //4 instance = new TestInstance();//5 &#125; &#125; &#125; return instance;//6 &#125;&#125; åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¦‚æžœæ²¡æœ‰volatileå…³é”®å­—ï¼Œåœ¨ç¬¬5è¡Œä¼šå‡ºçŽ°é—®é¢˜ instance = new TestInstance();//5 å¯ä»¥åˆ†è§£ä»¥ä¸‹ä¸‰éƒ¨ 1ï¼Œç”³è¯·å†…å­˜ 2ï¼Œé€šè¿‡æž„é€ æ–¹æ³•åˆå§‹åŒ–å¯¹è±¡ 3ï¼Œå°†å¯¹è±¡æŒ‡å‘ç”³è¯·çš„å†…å­˜ ä½†å½“Açº¿ç¨‹è¿›è¡Œç¬¬äº”éƒ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯å› ä¸ºæž„é€ å‡½æ•°é‡Œé¢çš„æ“ä½œå¤ªå¤šï¼Œæ‰€ä»¥Açº¿ç¨‹è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæ¯•ï¼Œä½†å·²ç»è¢«èµ‹å€¼äº†ï¼Œä¹Ÿå°±æ˜¯ä»¥ä¸Šçš„é¡ºåºç”±1-2-3å˜æˆäº†1-3-2ã€‚æ­¤æ—¶Bçº¿ç¨‹è¿›æ¥åˆ¤æ–­TestInstanceä¸ä¸ºnullï¼Œé”™ä»¥ä¸ºå·²ç»å®žä¾‹åŒ–å®Œæ¯•è¿”å›žäº†ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å¯¹è±¡ï¼ˆå› ä¸ºæž„é€ å‡½æ•°æœªå®Œå…¨ï¼Œåˆå§‹è®¾ç½®å€¼æœªå®Œå…¨çš„å¯¹è±¡ï¼‰ï¼Œå°±å‡ºé—®é¢˜äº†ã€‚å¦‚æžœå£°æ˜Žç§°volatileï¼Œ2å’Œ3æ­¥éª¤ä¸ä¼šè¢«æŽ’åº volatileçš„ä½œç”¨ä¸Žç‰¹ç‚¹é€šè¿‡ä¸Šè¯‰å•ä¾‹æ¨¡å¼ä¸­volatileçš„ä½¿ç”¨ï¼Œé‚£ä¹ˆvolatileå…³é”®å­—å…·ä½“çš„ä½œç”¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é¦–å…ˆçœ‹ä¸€å¼ å›¾ ç”±ä¸Šå›¾ï¼Œéœ€è¦çŸ¥é“çš„å‡ ç‚¹ javaå†…å­˜æ¨¡åž‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ Javaå†…å­˜æ¨¡åž‹åˆ†ä¸ºä¸»å†…å­˜ï¼Œå’Œå·¥ä½œå†…å­˜ ä¸»å†…å­˜æ˜¯æ‰€æœ‰çš„çº¿ç¨‹æ‰€å…±äº«çš„ï¼Œå·¥ä½œå†…å­˜æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±æœ‰ä¸€ä¸ªï¼Œä¸æ˜¯å…±äº«çš„ã€‚ çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¢«è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ï¼‰ï¼Œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æŽ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ ä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æŽ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ åŸºäºŽä¸Šè¯‰çš„ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„æè¿°ï¼Œé‚£ä¹ˆ volatileçš„ä½œç”¨ï¼š volatileèµ‹äºˆäº†å˜é‡å¯è§â€”â€”ç¦æ­¢ç¼–è¯‘å™¨å¯¹æˆå‘˜å˜é‡è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨æ¯æ¬¡è¢«çº¿ç¨‹è®¿é—®æ—¶ï¼Œéƒ½å¼ºè¿«ä»Žå†…å­˜ä¸­é‡è¯»è¯¥æˆå‘˜å˜é‡çš„å€¼ï¼›è€Œä¸”ï¼Œå½“æˆå‘˜å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¼ºè¿«çº¿ç¨‹å°†å˜åŒ–å€¼å›žå†™åˆ°å…±äº«å†…å­˜ï¼Œè¿™æ ·åœ¨ä»»ä½•æ—¶åˆ»ä¸¤ä¸ªä¸åŒçº¿ç¨‹æ€»æ˜¯çœ‹åˆ°æŸä¸€æˆå‘˜å˜é‡çš„åŒä¸€ä¸ªå€¼ï¼Œè¿™å°±æ˜¯ä¿è¯äº†å¯è§æ€§ã€‚ â€‹ ä»Žç½‘ä¸Šçœ‹è§äº†ä¸€ç¯‡åšå®¢å¯ä»¥å¾ˆå¥½çš„è¯´æ˜Žï¼Œæˆ‘å°†ç›¸å…³éƒ¨åˆ†æˆªäº†ä¸ªå›¾å¦‚ä¸‹ï¼š å¤šçº¿ç¨‹çš„ä¸‰ä¸ªç‰¹æ€§ç›¸å…³æ–‡ç«  åŽŸå­æ€§ï¼ˆAtomicityï¼‰ 1åŽŸå­æ€§æ˜¯æŒ‡ä¸€ä¸ªåŽŸå­æ“ä½œåœ¨cpuä¸­ä¸å¯ä»¥æš‚åœç„¶åŽå†è°ƒåº¦ï¼Œæ—¢ä¸è¢«ä¸­æ–­æ“ä½œï¼Œè¦ä¸æ‰§è¡Œå®Œæˆï¼Œè¦ä¸å°±ä¸æ‰§è¡Œã€‚åŽŸå­æ“ä½œä¿è¯äº†åŽŸå­æ€§é—®é¢˜ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ši++ä¸æ˜¯åŽŸå­æ“ä½œï¼š x++ï¼ˆåŒ…å«ä¸‰ä¸ªåŽŸå­æ“ä½œï¼‰a.å°†å˜é‡x å€¼å–å‡ºæ”¾åœ¨å¯„å­˜å™¨ä¸­ b.å°†å°†å¯„å­˜å™¨ä¸­çš„å€¼+1 c.å°†å¯„å­˜å™¨ä¸­çš„å€¼èµ‹å€¼ç»™x 1synchronizedå—ä¹‹é—´çš„æ“ä½œä¹Ÿå…·å¤‡åŽŸå­æ€§ å¯è§æ€§(Visibility) 1å¯è§æ€§å°±æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†çº¿ç¨‹å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚æ— è®ºæ˜¯æ™®é€šå˜é‡è¿˜æ˜¯volatileå˜é‡éƒ½æ˜¯å¦‚æ­¤ï¼Œæ™®é€šå˜é‡ä¸Žvolatileå˜é‡çš„åŒºåˆ«æ˜¯volatileçš„ç‰¹æ®Šè§„åˆ™ä¿è¯äº†æ–°å€¼èƒ½ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œä»¥åŠæ¯ä½¿ç”¨å‰ç«‹å³ä»Žå†…å­˜åˆ·æ–°ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥è¯´volatileä¿è¯äº†çº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ï¼Œè€Œæ™®é€šå˜é‡åˆ™ä¸èƒ½ä¿è¯è¿™ä¸€ç‚¹ã€‚ æœ‰åºæ€§(Ordering) 1Javaå†…å­˜æ¨¡åž‹ä¸­çš„ç¨‹åºå¤©ç„¶æœ‰åºæ€§å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå¦‚æžœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æžœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚å‰åŠå¥æ˜¯æŒ‡â€œçº¿ç¨‹å†…è¡¨çŽ°ä¸ºä¸²è¡Œè¯­ä¹‰â€ï¼ŒåŽåŠå¥æ˜¯æŒ‡â€œæŒ‡ä»¤é‡æŽ’åºâ€çŽ°è±¡å’Œâ€œå·¥ä½œå†…å­˜ä¸»ä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿâ€çŽ°è±¡ã€‚ï¼ˆæ¯”å¦‚ä¸Šè¿°å•ä¾‹æ¨¡å¼ä¸­å¯¹è±¡åˆå§‹åŒ–çš„é¡ºåºå¯¹å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ¥è®²å¯èƒ½ä¼šé”™åºï¼‰ volatileå’Œsynchronizedçš„åŒºåˆ«å’Œè”ç³»ç›¸å…³æ–‡ç«  ç”¨æ³•ä¸Šï¼š synchronizedå¾€å¾€ä½œç”¨äºŽæ–¹æ³•æˆ–ä»£ç å— volatileå¾€å¾€ä¿®é¥°å˜é‡ã€‚ å®žçŽ°æœºåˆ¶ï¼š synchronizedæ˜¯åˆ©ç”¨é”å®žçŽ°äº’æ–¥è®¿é—®ï¼Œå¤šçº¿ç¨‹è®¿é—®ä¼šé˜»å¡ž Volatileæ²¡æœ‰åˆ©ç”¨é”ï¼Œè€Œæ˜¯åˆ©ç”¨å†…å­˜å…±äº«ï¼Œå¼ºåˆ¶çº¿ç¨‹æ¯æ¬¡ä»Žä¸»å†…å­˜ä¸­è®²åˆ°å˜é‡ï¼Œè€Œä¸æ˜¯ä»Žçº¿ç¨‹çš„ç§æœ‰å†…å­˜ä¸­è¯»å–å˜é‡ï¼Œå¤šçº¿ç¨‹è®¿é—®ä¸å›žé˜»å¡ž åŒºåˆ«ï¼š syncchronizedä¸ä»…ä¿è¯äº†å¯è§æ€§ï¼Œè¿˜ä¿è¯äº†åŽŸå­æ€§ï¼Œå› ä¸ºåªæœ‰èŽ·å¾—é”å¯¹è±¡çš„çº¿ç¨‹æ‰èƒ½è¿›å…¥åŒæ­¥ä»£ç å—ï¼Œä»Žè€Œä¿è¯åŒæ­¥ä»£ç å—çš„æ‰€æœ‰è¯­å¥å…¨éƒ¨éƒ½èƒ½æ‰§è¡Œã€‚å¤šä¸ªçº¿ç¨‹äº‰æŠ¢syncchronizedé”å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šå‡ºçŽ°é˜»å¡ž volatileåªä¿è¯äº†å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŽŸå­æ€§ï¼Œä¸å¯ä¿è¯åŒæ­¥ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸ä¼šå‘ç”Ÿé˜»å¡ž â€‹ volatileå…³é”®å­—çš„æ­£ç¡®ä½¿ç”¨ï¼ˆä¸€å¥è¯æ¦‚æ‹¬volatileï¼‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹æŸä¸ªå˜é‡åŽï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦çŸ¥é“è¿™ä¸ªå˜é‡ä¿®æ”¹åŽçš„æœ€æ–°çš„å€¼ï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨volatileï¼Œä¿è¯å¤šçº¿ç¨‹è®¿é—®çš„æ˜¯ä¸»å†…å­˜çš„å€¼ï¼Œè€Œä¸æ˜¯è®¿é—®å„è‡ªçº¿ç¨‹çš„å·¥ä½œå†…å­˜çš„å‰¯æœ¬å€¼ï¼ˆå…¶å®žä»ç„¶è®¿é—®çš„æ˜¯å‰¯æœ¬å€¼ï¼Œåªä¸è¿‡å‰¯æœ¬å€¼æœ‰ä¿®æ”¹åŽç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼‰ä¹Ÿå°±æ˜¯è¯´ä¿è¯äº†çº¿ç¨‹çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸èƒ½åƒsyncchronizedä¿è¯åŽŸå­æ€§ï¼Œvolatileæ²¡æœ‰åˆ©ç”¨é”çš„æœºåˆ¶ï¼Œå¤šçº¿ç¨‹è®¿é—®æ—¶ä¸ä¼šå‘ç”Ÿé˜»å¡žï¼Œä¹Ÿå°±æ˜¯è¯´volatileä¿®é¥°çš„å˜é‡å¯ä»¥ä¿è¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¿®æ”¹çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­è®¿é—®ï¼Œä¸€æ—¦è¯¥å˜é‡ä¿®æ”¹å®Œæ¯•ï¼Œå…¶ä»–çº¿ç¨‹å†èŽ·å–çš„ä¸€å®šæ˜¯ä¿®æ”¹åŽçš„æœ€æ–°çš„å€¼ synchronizedåŒæ­¥çš„æ­»é”æ˜¯æ€Žä¹ˆäº§ç”Ÿçš„å¤šçº¿ç¨‹æ­»é”æ¡ˆä¾‹ï¼š ä»€ä¹ˆæ˜¯æ­»é”ï¼š å¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ž,å®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨éƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾.ç”±äºŽçº¿ç¨‹è¢«æ— é™æœŸåœ°é˜»å¡ž,å› æ­¤ç¨‹åºä¸èƒ½æ­£å¸¸è¿è¡Œ å¤šçº¿ç¨‹ç›¸å…³çŸ¥è¯†]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹å®‰å…¨çš„CopyOnWriteArrayList]]></title>
    <url>%2F2017%2F02%2F16%2F%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84CopyOnWriteArrayList%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ç¿»é˜…EventBusæºç ï¼Œåœ¨subscribeæ–¹æ³•ä¸­ï¼Œçœ‹åˆ°äº†CopyOnWriteArrayListè¿™ä¸ªç±»ï¼Œä¸€æ—¶ç«Ÿä¸çŸ¥å…¶åŽŸç†æ˜¯ä»€ä¹ˆï¼Œæœ¬æ–‡ç®€è¦è®°å½•ä¸€ä¸‹CopyOnWriteArrayListçš„ç›¸å…³ä»‹ç» å…ˆçœ‹ä¸€æ®µEventBusçš„subscribeï¼ˆï¼‰çš„ä»£ç  è¿™æ®µä»£ç æ˜¯EventBusä¸­subscribeæ–¹æ³•ï¼Œé‡Œé¢æ¶‰åŠåˆ°äº†subscriptionsByEventTypeçš„éåŽ†è¿‡ç¨‹ä¸­æŒ‰ç…§ä¼˜å…ˆçº§æŽ’åº å…³äºŽEventBusçš„å…·ä½“æºç æˆ‘å°†åœ¨åŽé¢ä¼šæ•´ç†ï¼Œè¿™é‡Œæˆ‘ä»¬åªå…³æ³¨CopyOnWriteArrayListå³å¯ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨éåŽ†çš„è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨äº†subscriptions.add(i,newSubscription)æ¥æŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡ŒæŽ’åºï¼Œæˆ‘ç›¸ä¿¡ä»»ä½•ä¸€ä¸ªæ‡‚javaçš„éƒ½çŸ¥é“å¦‚æžœä½¿ç”¨æ™®é€šArraylistï¼Œéƒ½ä¼šæŠ¥é”™ï¼ˆå¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸‹é¢æ¥è¯å®žä¸€ä¸‹ ä¸ä½¿ç”¨CopyOnWriteArrayListå…ˆå†™ä¸€æ®µä»£ç è¯æ˜ŽCopyOnWriteArrayListç¡®å®žæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ReadThread.java 12345678910111213141516import java.util.List;public class ReadThread implements Runnable &#123; private List&lt;Integer&gt; list; public ReadThread(List&lt;Integer&gt; list) &#123; this.list = list; &#125; @Override public void run() &#123; for (Integer ele : list) &#123; System.out.println("ReadThread:"+ele); &#125; &#125;&#125; WriteThread.java 1234567891011121314import java.util.List;public class WriteThread implements Runnable &#123; private List&lt;Integer&gt; list; public WriteThread(List&lt;Integer&gt; list) &#123; this.list = list; &#125; @Override public void run() &#123; this.list.add(9); &#125;&#125; TestCopyOnWriteArrayList.java 123456789101112131415161718192021222324252627282930313233import java.util.Arrays;import java.util.List;import java.util.concurrent.CopyOnWriteArrayList;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;public class TestCopyOnWriteArrayList &#123; private void test() &#123; //1ã€åˆå§‹åŒ–CopyOnWriteArrayList List&lt;Integer&gt; tempList = Arrays.asList(new Integer [] &#123;1,2&#125;); CopyOnWriteArrayList&lt;Integer&gt; copyList = new CopyOnWriteArrayList&lt;&gt;(tempList); //2ã€æ¨¡æ‹Ÿå¤šçº¿ç¨‹å¯¹listè¿›è¡Œè¯»å’Œå†™ ExecutorService executorService = Executors.newFixedThreadPool(10); executorService.execute(new ReadThread(copyList)); executorService.execute(new WriteThread(copyList)); executorService.execute(new WriteThread(copyList)); executorService.execute(new WriteThread(copyList)); executorService.execute(new ReadThread(copyList)); executorService.execute(new WriteThread(copyList)); executorService.execute(new ReadThread(copyList)); executorService.execute(new WriteThread(copyList)); System.out.println("copyList size:"+copyList.size()); &#125; public static void main(String[] args) &#123; new TestCopyOnWriteArrayList().test(); &#125;&#125; è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ²¡æœ‰æŠ¥å‡º java.util.ConcurrentModificationException è¯´æ˜Žäº†CopyOnWriteArrayListå¹¶å‘å¤šçº¿ç¨‹çš„çŽ¯å¢ƒä¸‹ï¼Œä»ç„¶èƒ½å¾ˆå¥½çš„å·¥ä½œã€‚ CopyOnWriteArrayListå¦‚ä½•åšåˆ°çº¿ç¨‹å®‰å…¨CopyOnWriteArrayListä½¿ç”¨äº†ä¸€ç§å«å†™æ—¶å¤åˆ¶çš„æ–¹æ³•ï¼Œå½“æœ‰æ–°å…ƒç´ æ·»åŠ åˆ°CopyOnWriteArrayListæ—¶ï¼Œå…ˆä»ŽåŽŸæœ‰çš„æ•°ç»„ä¸­æ‹·è´ä¸€ä»½å‡ºæ¥ï¼Œç„¶åŽåœ¨æ–°çš„æ•°ç»„åšå†™æ“ä½œï¼Œå†™å®Œä¹‹åŽï¼Œå†å°†åŽŸæ¥çš„æ•°ç»„å¼•ç”¨æŒ‡å‘åˆ°æ–°æ•°ç»„ã€‚ å½“æœ‰æ–°å…ƒç´ åŠ å…¥çš„æ—¶å€™ï¼Œå¦‚ä¸‹å›¾ï¼Œåˆ›å»ºæ–°æ•°ç»„ï¼Œå¹¶å¾€æ–°æ•°ç»„ä¸­åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´ ,è¿™ä¸ªæ—¶å€™ï¼Œarrayè¿™ä¸ªå¼•ç”¨ä»ç„¶æ˜¯æŒ‡å‘åŽŸæ•°ç»„çš„ã€‚ å½“å…ƒç´ åœ¨æ–°æ•°ç»„æ·»åŠ æˆåŠŸåŽï¼Œå°†arrayè¿™ä¸ªå¼•ç”¨æŒ‡å‘æ–°æ•°ç»„ã€‚ CopyOnWriteArrayListçš„æºç 12345678910111213141516171819public boolean add(E e) &#123; //1ã€å…ˆåŠ é” final ReentrantLock lock = this.lock; lock.lock(); try &#123; Object[] elements = getArray(); int len = elements.length; //2ã€æ‹·è´æ•°ç»„ Object[] newElements = Arrays.copyOf(elements, len + 1); //3ã€å°†å…ƒç´ åŠ å…¥åˆ°æ–°æ•°ç»„ä¸­ newElements[len] = e; //4ã€å°†arrayå¼•ç”¨æŒ‡å‘åˆ°æ–°æ•°ç»„ setArray(newElements); return true; &#125; finally &#123; //5ã€è§£é” lock.unlock(); &#125;&#125; ç”±äºŽæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯åœ¨æ–°æ•°ç»„è¿›è¡Œçš„ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æžœæœ‰çº¿ç¨‹å¹¶å‘çš„å†™ï¼Œåˆ™é€šè¿‡é”æ¥æŽ§åˆ¶ï¼Œå¦‚æžœæœ‰çº¿ç¨‹å¹¶å‘çš„è¯»ï¼Œåˆ™åˆ†å‡ ç§æƒ…å†µï¼š1ã€å¦‚æžœå†™æ“ä½œæœªå®Œæˆï¼Œé‚£ä¹ˆç›´æŽ¥è¯»å–åŽŸæ•°ç»„çš„æ•°æ®ï¼›2ã€å¦‚æžœå†™æ“ä½œå®Œæˆï¼Œä½†æ˜¯å¼•ç”¨è¿˜æœªæŒ‡å‘æ–°æ•°ç»„ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯è¯»å–åŽŸæ•°ç»„æ•°æ®ï¼›3ã€å¦‚æžœå†™æ“ä½œå®Œæˆï¼Œå¹¶ä¸”å¼•ç”¨å·²ç»æŒ‡å‘äº†æ–°çš„æ•°ç»„ï¼Œé‚£ä¹ˆç›´æŽ¥ä»Žæ–°æ•°ç»„ä¸­è¯»å–æ•°æ®ã€‚ å¯è§ï¼ŒCopyOnWriteArrayListçš„è¯»æ“ä½œæ˜¯å¯ä»¥ä¸ç”¨åŠ é”çš„ã€‚ CopyOnWriteArrayListä½¿ç”¨åœºæ™¯é€šè¿‡ä¸Šé¢çš„åˆ†æžï¼ŒCopyOnWriteArrayList æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š1ã€ç”±äºŽå†™æ“ä½œçš„æ—¶å€™ï¼Œéœ€è¦æ‹·è´æ•°ç»„ï¼Œä¼šæ¶ˆè€—å†…å­˜ï¼Œå¦‚æžœåŽŸæ•°ç»„çš„å†…å®¹æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´young gcæˆ–è€…full gc 2ã€ä¸èƒ½ç”¨äºŽå®žæ—¶è¯»çš„åœºæ™¯ï¼Œåƒæ‹·è´æ•°ç»„ã€æ–°å¢žå…ƒç´ éƒ½éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥è°ƒç”¨ä¸€ä¸ªsetæ“ä½œåŽï¼Œè¯»å–åˆ°æ•°æ®å¯èƒ½è¿˜æ˜¯æ—§çš„,è™½ç„¶CopyOnWriteArrayList èƒ½åšåˆ°æœ€ç»ˆä¸€è‡´æ€§,ä½†æ˜¯è¿˜æ˜¯æ²¡æ³•æ»¡è¶³å®žæ—¶æ€§è¦æ±‚ï¼› CopyOnWriteArrayList åˆé€‚è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œä¸è¿‡è¿™ç±»æ…Žç”¨å› ä¸ºè°ä¹Ÿæ²¡æ³•ä¿è¯CopyOnWriteArrayList åˆ°åº•è¦æ”¾ç½®å¤šå°‘æ•°æ®ï¼Œä¸‡ä¸€æ•°æ®ç¨å¾®æœ‰ç‚¹å¤šï¼Œæ¯æ¬¡add/setéƒ½è¦é‡æ–°å¤åˆ¶æ•°ç»„ï¼Œè¿™ä¸ªä»£ä»·å®žåœ¨å¤ªé«˜æ˜‚äº†ã€‚åœ¨é«˜æ€§èƒ½çš„äº’è”ç½‘åº”ç”¨ä¸­ï¼Œè¿™ç§æ“ä½œåˆ†åˆ†é’Ÿå¼•èµ·æ•…éšœã€‚ æ€æƒ³å¦‚ä¸Šé¢çš„åˆ†æžCopyOnWriteArrayListè¡¨è¾¾çš„ä¸€äº›æ€æƒ³ï¼š1ã€è¯»å†™åˆ†ç¦»ï¼Œè¯»å’Œå†™åˆ†å¼€2ã€æœ€ç»ˆä¸€è‡´æ€§3ã€ä½¿ç”¨å¦å¤–å¼€è¾Ÿç©ºé—´çš„æ€è·¯ï¼Œæ¥è§£å†³å¹¶å‘å†²çª å‚è€ƒæ–‡ç« ï¼š 1]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[retrofitå’ŒåŠ¨æ€ä»£ç†]]></title>
    <url>%2F2017%2F02%2F07%2Fretrofit%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%2F</url>
    <content type="text"><![CDATA[ä»£ç†ç±»åœ¨è¿è¡Œå‰ä¸å­˜åœ¨ï¼Œè¿è¡Œæ—¶ç”±ç¨‹åºåŠ¨æ€ç”Ÿæˆçš„ä»£ç†æ–¹å¼ç§°ä¸ºåŠ¨æ€ä»£ç† å…³äºŽRetrofitSquareå…¬å¸çš„OkHttpç®€ç›´æ˜¯å®Œç¾Žçš„ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“ï¼Œè€Œåœ¨å…¶ä¸Šåˆå°è£…äº†ä¸€å±‚çš„Retrofitåº“ï¼Œä½¿å…¶è°ƒç”¨Restful Apiæ›´æ–¹ä¾¿ ç®€è¿°Retrofitè°ƒç”¨æµç¨‹å› ä¸ºæœ¬ç¯‡åªæ˜¯ç®€è¿°åŠ¨æ€ä»£ç†åœ¨Retrofitçš„ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸è¿‡å¤šæ€»ç»“Retrofitçš„è¯¦ç»†ä½¿ç”¨ï¼Œåœ¨ä¸Šå®¶å…¬å¸çš„é¡¹ç›®éƒ½ç½‘ç»œå±‚ï¼Œç”¨çš„retrofitï¼ŒçŽ°åœ¨è¿™å®¶å…¬å¸çš„é¡¹ç›®å› ä¸ºåˆšå¼€å§‹æ˜¯æˆ‘ç‹¬ç«‹å¼€å‘ï¼Œæ‰€ä»¥ç½‘ç»œå±‚æ¡†æž¶æˆ‘ä¹Ÿæ˜¯ç”¨çš„Retrofitï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œè¯¦ç»†ä½¿ç”¨ï¼Œä»¥åŽå†æ€»ç»“ ç†Ÿæ‚‰Retrofitä½¿ç”¨çš„éƒ½å¯¹ä¸‹é¢å‡ ä¸ªæ­¥éª¤æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼š å®šä¹‰ä¸€ä¸ªApiServiceæŽ¥å£ï¼Œé€šè¿‡æ³¨è§£å¯ä»¥æ ‡è®°è¯·æ±‚æ–¹æ³•ï¼Œè¯·æ±‚å‚æ•°ï¼Œä»¥åŠæ·»åŠ çš„å¤´ä¿¡æ¯ ç„¶åŽåˆ›å»ºRetrofitå¯¹è±¡ï¼Œé€šè¿‡å»ºé€ è€…æ¨¡å¼è®¾ç½®BaseUrlç­‰ä¸€äº›å‚æ•°ï¼Œé€šè¿‡Retrofitå¯¹è±¡createä¸€ä¸ªä½ å®šä¹‰çš„æŽ¥å£å¯¹è±¡ æ‹¿åˆ°æŽ¥å£å¯¹è±¡è°ƒç”¨å…·ä½“çš„æ–¹æ³•å®Œæˆè¯·æ±‚ å…·ä½“çš„ä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š 1234public interface ApiService &#123; @GET("users/&#123;user&#125;/repos") Call&lt;List&lt;Repo&gt;&gt; listRepos(@Path("user") String user);&#125; 1234Retrofit retrofit = new Retrofit.Builder() .baseUrl("https://api.github.com") .build();ApiService service = retrofit.create(ApiService.class); 1Call&lt;List&lt;Repo&gt;&gt; repos = service.listRepos("fengan"); ApiServiceæ˜¯å¦‚ä½•äº§ç”Ÿçš„å› ä¸ºæŽ¥å£æ˜¯ä¸å¯ä»¥ç›´æŽ¥newå‡ºæ¥çš„ï¼Œé‚£ä¹ˆApiServiceæ˜¯å¦‚ä½•äº§ç”Ÿçš„å‘¢ï¼Ÿ ApiService service = retrofit.create(ApiService.class);æ–¹æ³•å†…éƒ¨åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ æ²¡é”™ï¼Œå°±æ˜¯åŠ¨æ€ä»£ç† ä¸ºäº†æ›´å¥½çš„ç†è§£åŠ¨æ€ä»£ç†ï¼Œä¸‹é¢è¿‡ä¸€ä¸‹ç®€æ˜“ç‰ˆçš„Retrofitï¼Œ a v1234567public interface Callback&lt;T&gt; &#123; void onSuccess(Object t); void onFailed(Exception e);&#125; 123456789 /** * çº¦å®šæœ€åŽä¸€ä¸ªå‚æ•°æ˜¯callback */public interface GithubService &#123; @GET("users/&#123;user&#125;/repos") void list&lt;Repos&gt;(@Path("user") String user,Callback&lt;List&lt;Repo&gt;&gt; callback);&#125; ç”¨åˆ°äº†ä¸¤ä¸ªæ³¨è§£ï¼Œä¸€ä¸ªæ˜¯æ–¹æ³•æ³¨è§£ï¼Œä¸€ä¸ªæ˜¯å‚æ•°æ³¨è§£ 123456789@Retention(RetentionPolicy.RUNTIME)@Target(&#123;ElementType.METHOD&#125;)public @interface GET &#123; String value() default "";&#125; 123456789@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.PARAMETER)public @interface Path &#123; String value();&#125; Repoå®žä½“ç±»æ˜¯ä½¿ç”¨GsonFormatæ ¹æ®jsonè‡ªåŠ¨ç”Ÿæˆçš„ã€‚çŽ°å®žä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬åœ¨æž„å»ºRetrofitè¿‡ç¨‹ä¼ å…¥GsonFactory Retrofitè¿™ä¸ªç±»åº”è¯¥æ˜¯ä¸€ä¸ªbuilderæ¨¡å¼ï¼Œé‡Œé¢å¯ä»¥è®¾ç½®baseUrlï¼Œå§‘ä¸”å¿½ç•¥å…¶ä»–æ‰€æœ‰å‚æ•°ã€‚è¿˜æœ‰ä¸€ä¸ªcreateæ–¹æ³• 1234567891011121314151617181920212223public class Retrofit &#123; private String baseUrl; private Retrofit(Builder builder) &#123; this.baseUrl = builder.baseUrl; &#125; public &lt;T&gt; T create(Class&lt;T&gt; clazz) &#123; return null &#125; static class Builder &#123; private String baseUrl; Builder baseUrl(String host) &#123; this.baseUrl = host; return this; &#125; Retrofit build() &#123; return new Retrofit(this); &#125; &#125;&#125; æœ€å…³é”®çš„å°±æ˜¯createè¿™ä¸ªæ–¹æ³•äº†ï¼Œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126public &lt;T&gt; T create(Class&lt;T&gt; clazz) &#123; /** * ç¼“å­˜ä¸­åŽ» */ Object o = serviceMap.get(clazz); /** * å–ä¸åˆ°åˆ™å–æž„é€ ä»£ç†å¯¹è±¡ */ if (o == null) &#123; o = (T) Proxy.newProxyInstance(Retrofit.class.getClassLoader(), new Class[]&#123;clazz&#125;, new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; final Callback&lt;?&gt; callback = (Callback&lt;?&gt;) args[args.length - 1]; final GET get = method.getAnnotation(GET.class); if (get != null) &#123; /** * èŽ·å¾—GETæ³¨è§£çš„å€¼ */ String getValue = get.value(); System.out.println(getValue); /** * èŽ·å¾—æ‰€æœ‰å‚æ•°ä¸Šçš„æ³¨è§£ */ Annotation[][] methodParameterAnnotationArrays = method.getParameterAnnotations(); if (methodParameterAnnotationArrays != null) &#123; int count = methodParameterAnnotationArrays.length; for (int i = 0; i &lt; count; i++) &#123; /** * èŽ·å¾—å•ä¸ªå‚æ•°ä¸Šçš„æ³¨è§£ */ Annotation[] methodParameterAnnotations = methodParameterAnnotationArrays[i]; if (methodParameterAnnotations != null) &#123; for (Annotation methodParameterAnnotation : methodParameterAnnotations) &#123; /** * å¦‚æžœæ˜¯Pathæ³¨è§£ */ if (methodParameterAnnotation instanceof Path) &#123; /** * å–å¾—pathæ³¨è§£ä¸Šçš„å€¼ */ Path path = (Path) methodParameterAnnotation; String pathValue = path.value(); System.out.println(pathValue); /** * è¿™æ˜¯å¯¹åº”çš„å‚æ•°çš„å€¼ */ System.out.println(args[i]); Request.Builder builder = new Request.Builder(); /** * ä½¿ç”¨pathæ³¨è§£æ›¿æ¢getæ³¨è§£ä¸­çš„å€¼ä¸ºå‚æ•°å€¼ */ String result = getValue.replaceAll("\\&#123;" + pathValue + "\\&#125;", (String) args[i]); System.out.println(result); /** * å¼€å§‹æž„é€ è¯·æ±‚ */ Request request = builder.get() .url(baseUrl + "/" + result) .build(); okHttpClient.newCall(request).enqueue(new okhttp3.Callback() &#123; @Override public void onFailure(Call call, IOException e) &#123; /** * å¤±è´¥åˆ™å›žè°ƒå¤±è´¥çš„æ–¹æ³• */ callback.onFailed(e); &#125; @Override public void onResponse(Call call, Response response) throws IOException &#123; if (response.isSuccessful()) &#123; /** * è¯·æ±‚æˆåŠŸ */ String body = response.body().string(); /** * ä½¿ç”¨fastjsonè¿›è¡Œzhuanè½¬æ¢ */ Type type = callback.getClass().getGenericInterfaces()[0]; Object o1 = JSON.parse(body); /** * å›žè°ƒæˆåŠŸ */ callback.onSuccess(o1); &#125; &#125; &#125;); &#125; &#125; &#125; &#125; &#125; &#125; return null; &#125; &#125;); /** * æ‰”åˆ°ç¼“å­˜ä¸­ */ serviceMap.put(clazz, o); &#125; return (T) o; &#125; ç„¶åŽæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®Retrofité‚£æ ·è¿›è¡Œè°ƒç”¨äº† 123456789101112131415Retrofit retrofit = new Retrofit.Builder() .baseUrl("https://api.github.com") .build();GithubService githubService = retrofit.create(GithubService.class);githubService.listRepos("lizhangqu", new Callback&lt;List&lt;Repo&gt;&gt;() &#123; @Override public void onSuccess(Object t) &#123; System.out.println(t); &#125; @Override public void onFailed(Exception e) &#123; &#125;&#125;); retrofitåŠ¨æ€ä»£ç†åŽŸç†åŽŸç†å°±æ˜¯å…ˆæ‹¿åˆ°æœ€åŽä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å›žè°ƒï¼Œå†æ‹¿åˆ°æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼ŒèŽ·å¾—å…·ä½“çš„å€¼ï¼Œç„¶åŽæ‹¿åˆ°é™¤äº†å›žè°ƒä¹‹å¤–çš„å…¶ä»–å‚æ•°ï¼ŒèŽ·å¾—å‚æ•°ä¸Šçš„æ³¨è§£ï¼Œç„¶åŽæ ¹æ®æ³¨è§£å–å¾—å¯¹åº”çš„å€¼ï¼Œè¿˜æœ‰åŽŸæ¥çš„å‚æ•°å€¼ï¼Œå°†æ–¹æ³•ä¸Šçš„æ³¨è§£çš„å€¼ä¸­è¿›è¡Œæ›¿æ¢ã€‚ä½¿ç”¨OkHttpæž„é€ è¯·æ±‚ï¼Œè¯·æ±‚å®ŒæˆåŽæ ¹æ®å°†ç»“æžœè§£æžä¸ºå›žè°ƒä¸­çš„ç±»åž‹ã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ æ‹¦æˆªåˆ°æ–¹æ³•ã€å‚æ•°ï¼Œå†æ ¹æ®æˆ‘ä»¬åœ¨æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼ŒåŽ»æ‹¼æŽ¥ä¸ºä¸€ä¸ªæ­£å¸¸çš„Okhttpè¯·æ±‚ï¼Œç„¶åŽæ‰§è¡Œã€‚ javaä¸­çš„åŠ¨æ€ä»£ç†åœ¨javaçš„åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„ç±»æˆ–æŽ¥å£ï¼Œä¸€ä¸ªæ˜¯ InvocationHandler(Interface)ã€å¦ä¸€ä¸ªåˆ™æ˜¯ Proxy(Class)ï¼Œè¿™ä¸€ä¸ªç±»å’ŒæŽ¥å£æ˜¯å®žçŽ°æˆ‘ä»¬åŠ¨æ€ä»£ç†æ‰€å¿…é¡»ç”¨åˆ°çš„ æ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»è¦å®žçŽ°InvocationHandlerè¿™ä¸ªæŽ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»çš„å®žä¾‹éƒ½å…³è”åˆ°äº†ä¸€ä¸ªhandlerï¼Œå½“æˆ‘ä»¬é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘ä¸ºç”±InvocationHandlerè¿™ä¸ªæŽ¥å£çš„ invoke æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹InvocationHandlerè¿™ä¸ªæŽ¥å£çš„å”¯ä¸€ä¸€ä¸ªæ–¹æ³• invoke æ–¹æ³•ï¼š 12345Object invoke(Object proxy, Method method, Object[] args) throws Throwableproxy: æŒ‡ä»£æˆ‘ä»¬æ‰€ä»£ç†çš„é‚£ä¸ªçœŸå®žå¯¹è±¡method: æŒ‡ä»£çš„æ˜¯æˆ‘ä»¬æ‰€è¦è°ƒç”¨çœŸå®žå¯¹è±¡çš„æŸä¸ªæ–¹æ³•çš„Methodå¯¹è±¡args: æŒ‡ä»£çš„æ˜¯è°ƒç”¨çœŸå®žå¯¹è±¡æŸä¸ªæ–¹æ³•æ—¶æŽ¥å—çš„å‚æ•° Proxyè¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯ç”¨æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡çš„ç±»ï¼Œå®ƒæä¾›äº†è®¸å¤šçš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„å°±æ˜¯ newProxyInstance è¿™ä¸ªæ–¹æ³•ï¼š 1public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å¾—åˆ°ä¸€ä¸ªåŠ¨æ€çš„ä»£ç†å¯¹è±¡ï¼Œå…¶æŽ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªå‚æ•°æ‰€ä»£è¡¨çš„å«ä¹‰ï¼š 12345678public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentExceptionloader: ä¸€ä¸ªClassLoaderå¯¹è±¡ï¼Œå®šä¹‰äº†ç”±å“ªä¸ªClassLoaderå¯¹è±¡æ¥å¯¹ç”Ÿæˆçš„ä»£ç†å¯¹è±¡è¿›è¡ŒåŠ è½½interfaces: ä¸€ä¸ªInterfaceå¯¹è±¡çš„æ•°ç»„ï¼Œè¡¨ç¤ºçš„æ˜¯æˆ‘å°†è¦ç»™æˆ‘éœ€è¦ä»£ç†çš„å¯¹è±¡æä¾›ä¸€ç»„ä»€ä¹ˆæŽ¥å£ï¼Œå¦‚æžœæˆ‘æä¾›äº†ä¸€ç»„æŽ¥å£ç»™å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç†å¯¹è±¡å°±å®£ç§°å®žçŽ°äº†è¯¥æŽ¥å£(å¤šæ€)ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æŽ¥å£ä¸­çš„æ–¹æ³•äº†h: ä¸€ä¸ªInvocationHandlerå¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯å½“æˆ‘è¿™ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…³è”åˆ°å“ªä¸€ä¸ªInvocationHandlerå¯¹è±¡ä¸Š ä½¿ç”¨å¦‚ä¸‹ï¼š å®šä¹‰è¢«ä»£ç†å¯¹è±¡ 123456public interface Subject&#123; public void rent(); public void hello(String str);&#125; 1234567891011121314public class RealSubject implements Subject&#123; @Override public void rent() &#123; System.out.println("I want to rent my house"); &#125; @Override public void hello(String str) &#123; System.out.println("hello: " + str); &#125;&#125; å®šä¹‰åŠ¨æ€ä»£ç†ç±»ï¼Œä»»ä½•åŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»å®žçŽ°InvotionHandlerè¿™ä¸ªæŽ¥å£ï¼Œé‡å†™invokeæ–¹æ³• 123456789101112131415161718192021222324252627282930public class DynamicProxy implements InvocationHandler&#123; // è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®žå¯¹è±¡ private Object subject; // æž„é€ æ–¹æ³•ï¼Œç»™æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®žå¯¹è±¡èµ‹åˆå€¼ public DynamicProxy(Object subject) &#123; this.subject = subject; &#125; @Override public Object invoke(Object object, Method method, Object[] args) throws Throwable &#123; // åœ¨ä»£ç†çœŸå®žå¯¹è±¡å‰æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println("before rent house"); System.out.println("Method:" + method); // å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®žå¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ method.invoke(subject, args); // åœ¨ä»£ç†çœŸå®žå¯¹è±¡åŽæˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println("after rent house"); return null; &#125;&#125; ä½¿ç”¨ 123456789101112131415161718192021222324public class Client&#123; public static void main(String[] args) &#123; // æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®žå¯¹è±¡ Subject realSubject = new RealSubject(); // æˆ‘ä»¬è¦ä»£ç†å“ªä¸ªçœŸå®žå¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›åŽ»ï¼Œæœ€åŽæ˜¯é€šè¿‡è¯¥çœŸå®žå¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•çš„ InvocationHandler handler = new DynamicProxy(realSubject); /* * é€šè¿‡Proxyçš„newProxyInstanceæ–¹æ³•æ¥åˆ›å»ºæˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸‰ä¸ªå‚æ•° * ç¬¬ä¸€ä¸ªå‚æ•° handler.getClass().getClassLoader() ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨handlerè¿™ä¸ªç±»çš„ClassLoaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ * ç¬¬äºŒä¸ªå‚æ•°realSubject.getClass().getInterfaces()ï¼Œæˆ‘ä»¬è¿™é‡Œä¸ºä»£ç†å¯¹è±¡æä¾›çš„æŽ¥å£æ˜¯çœŸå®žå¯¹è±¡æ‰€å®žè¡Œçš„æŽ¥å£ï¼Œè¡¨ç¤ºæˆ‘è¦ä»£ç†çš„æ˜¯è¯¥çœŸå®žå¯¹è±¡ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æŽ¥å£ä¸­çš„æ–¹æ³•äº† * ç¬¬ä¸‰ä¸ªå‚æ•°handlerï¼Œ æˆ‘ä»¬è¿™é‡Œå°†è¿™ä¸ªä»£ç†å¯¹è±¡å…³è”åˆ°äº†ä¸Šæ–¹çš„ InvocationHandler è¿™ä¸ªå¯¹è±¡ä¸Š */ Subject subject = (Subject)Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject .getClass().getInterfaces(), handler); System.out.println(subject.getClass().getName()); subject.rent(); subject.hello("world"); &#125;&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äº‹ä»¶åˆ†å‘å°ç»“]]></title>
    <url>%2F2017%2F01%2F20%2F%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E5%B0%8F%E7%BB%93%2F</url>
    <content type="text"><![CDATA[Androidå¼€å‘ä¸­ï¼Œäº‹ä»¶åˆ†å‘æ˜¯éžå¸¸é‡è¦çš„ï¼Œäº†è§£ç†Ÿæ‚‰æ•´ä¸ªäº‹ä»¶åˆ†å‘è¿‡ç¨‹æœ‰åŠ©äºŽæ›´å¥½çš„åˆ†æžå„ç§ç‚¹å‡»æ»‘åŠ¨å¤±æ•ˆé—®é¢˜,ä¹Ÿæ˜¯ä¸€ä¸ªå®‰å“å¼€å‘å¿…ä¼šçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æ—¶é—´é•¿äº†ï¼Œå¯¹æ•´ä¸ªæµç¨‹å¤šå°‘ä¼šæœ‰äº›æ¨¡ç³Šï¼Œæ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹ ç½‘ä¸Šçœ‹åˆ°ä¸€å¼ å›¾ï¼Œå¯ä»¥å¾ˆè¯¦ç»†çš„æè¿°æ•´ä¸ªäº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹ åŽŸæ–‡çš„é“¾æŽ¥ é—®é¢˜ä¸€ï¼š å½“ViewGroupé‡å†™çš„onInterceptTouchEventï¼Œå¹¶ä¸”å§‹ç»ˆè¿”å›žäº†trueï¼Œé‚£ä¹ˆå­viewå°±æ°¸è¿œæ— æ³•æŽ¥å—åˆ°äº†äº‹ä»¶ ä½†æ˜¯åœ¨å®žé™…å¼€å‘ä¸­å¯èƒ½ä¼šæœ‰è¿™ç§éœ€æ±‚ï¼Œåœ¨æŒ‰ä¸‹ï¼ˆACTION_DOWNï¼‰çš„æ—¶å€™ï¼Œéœ€è¦å­viewè¿›è¡Œæ—¶é—´åé¦ˆï¼Œä½†åœ¨æ»‘åŠ¨ï¼ˆACTION_MOVEï¼‰æˆ–è€…æŠ¬èµ·ï¼ˆACTION_UPï¼‰çš„æ—¶å€™éœ€è¦çˆ¶å¸ƒå±€è¿›è¡Œæ‹¦æˆªæ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨requestDisallInterceptRouchEvent(boolean disallowIntercept)ï¼Œè¯¥æ–¹æ³•åœ¨å­viewä¸­è°ƒç”¨ï¼ŒgetParent().requestDisallInterceptRouchEvent(true)è¯·æ±‚çˆ¶å¸ƒå±€ç¦ç”¨æ‹¦æˆªäº‹ä»¶åŠŸèƒ½ ç›¸å…³èµ„æ–™ å…·ä½“ä¾‹å­ï¼Œåœ¨æˆ‘åšçš„é¡¹ç›®ä¸­ï¼Œåœ¨viewpagerä¸­çš„æ¯ä¸€é¡µfragmentä¸­éƒ½æŠ˜çº¿å›¾ï¼Œviewpageræ˜¯å¯ä»¥å·¦å³åˆ‡æ¢çš„ï¼Œæ¯ä¸€é¡µçš„fragmentä¸­çš„æŠ˜çº¿å›¾ä¹Ÿæ˜¯å¯ä»¥æ‰‹åŠ¿ç¼©æ”¾çš„ï¼Œæ‰€ä»¥è¿™å°±å’Œviewpageræ»‘åŠ¨æœ‰å†²çªï¼Œåˆ©ç”¨requestDisallInterceptRouchEventï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æŠ˜çº¿å›¾æŽ§ä»¶ç»§æ‰¿é¡¹ç›®ä¸­ä½¿ç”¨çš„ï¼ˆé¡¹ç›®ä¸­ä½¿ç”¨çš„mpandroidï¼‰ï¼Œé‡å†™onTouchEventï¼Œå½“æ°´å¹³æ»‘åŠ¨çš„æ—¶å€™ï¼ŒgetParent().requestDisallInterceptRouchEvent(true)ï¼Œè¯·æ±‚çˆ¶å¸ƒå±€ä¸æ‹¦æˆªäº‹ä»¶ï¼Œäº¤ç»™å­viewå¤„ç†ã€‚ ç›¸å…³æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.nongfaziran.workiot.view;import android.annotation.SuppressLint;import android.content.Context;import android.graphics.PointF;import android.util.AttributeSet;import android.view.MotionEvent;import com.github.mikephil.charting.charts.LineChart;/** * Created by fengan on 2018/2/3. * email:fengan1102@gmail.com * è§£å†³æŠ˜çº¿å›¾åœ¨viewpageræ»‘åŠ¨å†²çª */public class LineChartInViewPager extends LineChart &#123; PointF downPoint = new PointF(); public LineChartInViewPager(Context context) &#123; super(context); &#125; public LineChartInViewPager(Context context, AttributeSet attrs) &#123; super(context, attrs); &#125; public LineChartInViewPager(Context context, AttributeSet attrs, int defStyle) &#123; super(context, attrs, defStyle); &#125; @SuppressLint("ClickableViewAccessibility") @Override public boolean onTouchEvent(MotionEvent evt) &#123; switch (evt.getAction()) &#123; case MotionEvent.ACTION_DOWN: downPoint.x = evt.getX(); downPoint.y = evt.getY(); break; case MotionEvent.ACTION_MOVE: if (getScaleX() &gt; 1 &amp;&amp; Math.abs(evt.getX() - downPoint.x) &gt; 5) &#123; getParent().requestDisallowInterceptTouchEvent(true); &#125; break; &#125; return super.onTouchEvent(evt); &#125;&#125; æœªå®Œå¾…ç»­]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è°ˆè°ˆçº¿ç¨‹æ± ]]></title>
    <url>%2F2016%2F12%2F25%2F%E8%B0%88%E8%B0%88%E7%BA%BF%E7%A8%8B%E6%B1%A0%2F</url>
    <content type="text"><![CDATA[çº¿ç¨‹æ± æœ‰å…³çŸ¥è¯†æ•´ç† å‰ç½®çŸ¥è¯†çº¿ç¨‹åŸºæœ¬æ¦‚å¿µï¼Œçº¿ç¨‹åŸºæœ¬æ¦‚å¿µå’ŒAndroidå¯åŠ¨çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼(ç‚¹å‡»æŸ¥çœ‹) new Threadï¼ˆï¼‰çš„å¼Šç«¯ æ€»æ˜¯new Threadï¼ˆï¼‰å¼€å¯çº¿ç¨‹ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œä¼šè¢«å›žæ”¶ï¼Œå¯¼è‡´é¢‘ç¹çš„GC å¤šçº¿ç¨‹ç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼Œå„çº¿ç¨‹ä¹‹é—´äº’ç›¸ç«žäº‰ æ— æ³•å®žçŽ°åœæ­¢çº¿ç¨‹ï¼ˆå¦‚æžœä¸€ä¸ªitemæ»‘å‡ºé¡µé¢ï¼Œåˆ™è¦åœæ­¢è¯¥itemä¸Šå›¾ç‰‡çš„åŠ è½½ï¼Œä½†æ˜¯å¦‚æžœä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œåˆ™æ— æ³•å®žçŽ°çº¿ç¨‹åœæ­¢æ‰§è¡Œï¼‰ ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ æé«˜çº¿ç¨‹çš„å¤ç”¨æ€§ï¼Œé¿å…é¢‘ç¹åˆ›å»ºçº¿ç¨‹è¿›è€Œå¯¼è‡´é¢‘ç¹çš„GC æŽ§åˆ¶çº¿ç¨‹å¹¶å‘æ•°ï¼Œåˆç†åˆ©ç”¨èµ„æº çº¿ç¨‹å¯æŽ§æ€§ï¼Œæ¯”å¦‚å¯ä»¥å®šæ—¶æ‰§è¡Œå’Œå–æ¶ˆæ‰§è¡ŒæŸä¸ªçº¿ç¨‹çš„ä»»åŠ¡ çº¿ç¨‹æ± çš„å®žçŽ° Androidä¸­çš„çº¿ç¨‹æ± å…¶å®žæºäºŽJavaï¼ŒAndroidå¼€å‘ä¸­çº¿ç¨‹æ± çš„ä½¿ç”¨å’ŒJavaä¸­çº¿ç¨‹æ± çš„ä½¿ç”¨åŸºæœ¬ä¸€è‡´ Javaä¸­å’Œçº¿ç¨‹æœ‰å…³çš„ä¸œä¸œå«åšExecutorï¼ŒExecutoræœ¬èº«æ˜¯ä¸€ä¸ªæŽ¥å£ è¿™ä¸ªæŽ¥å£æœ‰ä¸€ä¸ªéžå¸¸æœ‰ç”¨çš„å®žçŽ°ç±»å«åšThreadPoolExecutor Androidä¸­å¸¸ç”¨çš„çº¿ç¨‹æ± éƒ½æ˜¯é€šè¿‡å¯¹ThreadPoolExecutorè¿›è¡Œä¸åŒé…ç½®æ¥å®žçŽ°çš„ ç±»çš„ç»§æ‰¿ç»“æž„ Windowsï¼šCtrl+H Macï¼šControl+H å…³äºŽThreadPoolExecutorThreadPoolExecutoræœ‰å››ä¸ªé‡è½½çš„æž„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œæ¥è¯´è¯´å‚æ•°æœ€å¤šçš„é‚£ä¸€ä¸ªé‡è½½çš„æž„é€ æ–¹æ³•ï¼Œè¿™æ ·å¤§å®¶å°±çŸ¥é“å…¶ä»–æ–¹æ³•å‚æ•°çš„å«ä¹‰äº† æž„é€ å‡½æ•°æºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283/** * Creates a new &#123;@code ThreadPoolExecutor&#125; with the given initial * parameters and default thread factory. * * @param corePoolSize the number of threads to keep in the pool, even * if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set * @param maximumPoolSize the maximum number of threads to allow in the * pool * @param keepAliveTime when the number of threads is greater than * the core, this is the maximum time that excess idle threads * will wait for new tasks before terminating. * @param unit the time unit for the &#123;@code keepAliveTime&#125; argument * @param workQueue the queue to use for holding tasks before they are * executed. This queue will hold only the &#123;@code Runnable&#125; * tasks submitted by the &#123;@code execute&#125; method. * @param handler the handler to use when execution is blocked * because the thread bounds and queue capacities are reached * @throws IllegalArgumentException if one of the following holds:&lt;br&gt; * &#123;@code corePoolSize &lt; 0&#125;&lt;br&gt; * &#123;@code keepAliveTime &lt; 0&#125;&lt;br&gt; * &#123;@code maximumPoolSize &lt;= 0&#125;&lt;br&gt; * &#123;@code maximumPoolSize &lt; corePoolSize&#125; * @throws NullPointerException if &#123;@code workQueue&#125; * or &#123;@code handler&#125; is null */public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler) &#123; this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, Executors.defaultThreadFactory(), handler);&#125;/** * Creates a new &#123;@code ThreadPoolExecutor&#125; with the given initial * parameters. * * @param corePoolSize the number of threads to keep in the pool, even * if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set * @param maximumPoolSize the maximum number of threads to allow in the * pool * @param keepAliveTime when the number of threads is greater than * the core, this is the maximum time that excess idle threads * will wait for new tasks before terminating. * @param unit the time unit for the &#123;@code keepAliveTime&#125; argument * @param workQueue the queue to use for holding tasks before they are * executed. This queue will hold only the &#123;@code Runnable&#125; * tasks submitted by the &#123;@code execute&#125; method. * @param threadFactory the factory to use when the executor * creates a new thread * @param handler the handler to use when execution is blocked * because the thread bounds and queue capacities are reached * @throws IllegalArgumentException if one of the following holds:&lt;br&gt; * &#123;@code corePoolSize &lt; 0&#125;&lt;br&gt; * &#123;@code keepAliveTime &lt; 0&#125;&lt;br&gt; * &#123;@code maximumPoolSize &lt;= 0&#125;&lt;br&gt; * &#123;@code maximumPoolSize &lt; corePoolSize&#125; * @throws NullPointerException if &#123;@code workQueue&#125; * or &#123;@code threadFactory&#125; or &#123;@code handler&#125; is null */public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler;&#125; è¿™é‡Œæ˜¯7ä¸ªå‚æ•°(æˆ‘ä»¬åœ¨å¼€å‘ä¸­ç”¨çš„æ›´å¤šçš„æ˜¯5ä¸ªå‚æ•°çš„æž„é€ æ–¹æ³•)ï¼ŒOKï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹è¿™é‡Œä¸ƒä¸ªå‚æ•°çš„å«ä¹‰ï¼š corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°é‡ keepAliveTimeï¼šéžæ ¸å¿ƒçº¿ç¨‹çš„è¶…æ—¶æ—¶é•¿ï¼Œå½“ç³»ç»Ÿä¸­éžæ ¸å¿ƒçº¿ç¨‹é—²ç½®æ—¶é—´è¶…è¿‡keepAliveTimeä¹‹åŽï¼Œåˆ™ä¼šè¢«å›žæ”¶ã€‚å¦‚æžœThreadPoolExecutorçš„allowCoreThreadTimeOutå±žæ€§è®¾ç½®ä¸ºtrueï¼Œåˆ™è¯¥å‚æ•°ä¹Ÿè¡¨ç¤ºæ ¸å¿ƒçº¿ç¨‹çš„è¶…æ—¶æ—¶é•¿ unitï¼šç¬¬ä¸‰ä¸ªå‚æ•°çš„å•ä½ï¼Œæœ‰çº³ç§’ã€å¾®ç§’ã€æ¯«ç§’ã€ç§’ã€åˆ†ã€æ—¶ã€å¤©ç­‰ workQueueï¼šçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—å­˜å‚¨å·²ç»è¢«æäº¤ï¼Œä½†æ˜¯å°šæœªæ‰§è¡Œçš„ä»»åŠ¡ï¼Œå­˜å‚¨åœ¨è¿™é‡Œçš„ä»»åŠ¡æ˜¯ç”±ThreadPoolExecutorçš„executeæ–¹æ³•æäº¤æ¥çš„ã€‚ threadFactory ä¸ºçº¿ç¨‹æ± æä¾›åˆ›å»ºæ–°çº¿ç¨‹çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å³å¯ handler æ‹’ç»ç­–ç•¥ï¼Œå½“çº¿ç¨‹æ— æ³•æ‰§è¡Œæ–°ä»»åŠ¡æ—¶ï¼ˆä¸€èˆ¬æ˜¯ç”±äºŽçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°æœ€å¤§æ•°æˆ–è€…çº¿ç¨‹æ± å…³é—­å¯¼è‡´çš„ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“çº¿ç¨‹æ± æ— æ³•å¤„ç†æ–°çº¿ç¨‹æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªRejectedExecutionExceptionã€‚ å…³äºŽworkQueue workQueueæ˜¯ä¸€ä¸ªBlockingQueueç±»åž‹ BlockingQueueæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ— ä»ŽBlockingQueueä¸­å–æ•°æ®æ—¶ï¼Œ å¦‚æžœBlockingQueueæ˜¯ç©ºçš„ï¼Œåˆ™å–æ•°æ®çš„æ“ä½œä¼šè¿›å…¥åˆ°é˜»å¡žçŠ¶æ€ å½“BlockingQueueä¸­æœ‰äº†æ–°æ•°æ®æ—¶ï¼Œè¿™ä¸ªå–æ•°æ®çš„æ“ä½œåˆä¼šè¢«é‡æ–°å”¤é†’ å¦‚æžœBlockingQueueä¸­çš„æ•°æ®å·²ç»æ»¡äº†ï¼Œå¾€BlockingQueueä¸­å­˜æ•°æ®çš„æ“ä½œåˆä¼šè¿›å…¥é˜»å¡žçŠ¶æ€(ç›´åˆ°BlockingQueueä¸­åˆæœ‰æ–°çš„ç©ºé—´ï¼Œå­˜æ•°æ®çš„æ“ä½œåˆä¼šè¢«å†²æ´—å”¤é†’ BlockingQueueçš„ç§ç±» ArrayBlockingQueue:è¿™ä¸ªè¡¨ç¤ºä¸€ä¸ªè§„å®šäº†å¤§å°çš„BlockingQueueï¼ŒArrayBlockingQueueçš„æž„é€ å‡½æ•°æŽ¥å—ä¸€ä¸ªintç±»åž‹çš„æ•°æ®ï¼Œè¯¥æ•°æ®è¡¨ç¤ºBlockingQueueçš„å¤§å°ï¼Œå­˜å‚¨åœ¨ArrayBlockingQueueä¸­çš„å…ƒç´ æŒ‰ç…§FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„æ–¹å¼æ¥è¿›è¡Œå­˜å–ã€‚ LinkedBlockingQueue:è¿™ä¸ªè¡¨ç¤ºä¸€ä¸ªå¤§å°ä¸ç¡®å®šçš„BlockingQueueï¼Œåœ¨LinkedBlockingQueueçš„æž„é€ æ–¹æ³•ä¸­å¯ä»¥ä¼ ä¸€ä¸ªintç±»åž‹çš„æ•°æ®ï¼Œè¿™æ ·åˆ›å»ºå‡ºæ¥çš„LinkedBlockingQueueæ˜¯æœ‰å¤§å°çš„ï¼Œä¹Ÿå¯ä»¥ä¸ä¼ ï¼Œä¸ä¼ çš„è¯ï¼ŒLinkedBlockingQueueçš„å¤§å°å°±ä¸ºInteger.MAX_VALUE PriorityBlockingQueue:è¿™ä¸ªé˜Ÿåˆ—å’ŒLinkedBlockingQueueç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯PriorityBlockingQueueä¸­çš„å…ƒç´ ä¸æ˜¯æŒ‰ç…§FIFOæ¥æŽ’åºçš„ï¼Œè€Œæ˜¯æŒ‰ç…§å…ƒç´ çš„Comparatoræ¥å†³å®šå­˜å–é¡ºåºçš„ï¼ˆè¿™ä¸ªåŠŸèƒ½ä¹Ÿåæ˜ äº†å­˜å…¥PriorityBlockingQueueä¸­çš„æ•°æ®å¿…é¡»å®žçŽ°äº†ComparatoræŽ¥å£ï¼‰ã€‚ SynchronousQueue:è¿™ä¸ªæ˜¯åŒæ­¥Queueï¼Œå±žäºŽçº¿ç¨‹å®‰å…¨çš„BlockingQueueçš„ä¸€ç§ï¼Œåœ¨SynchronousQueueä¸­ï¼Œç”Ÿäº§è€…çº¿ç¨‹çš„æ’å…¥æ“ä½œå¿…é¡»è¦ç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹çš„ç§»é™¤æ“ä½œï¼ŒSynchronouså†…éƒ¨æ²¡æœ‰æ•°æ®ç¼“å­˜ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•å¯¹SynchronousQueueè¿›è¡Œè¯»å–æˆ–è€…éåŽ†å…¶ä¸­çš„æ•°æ®ï¼Œå…ƒç´ åªæœ‰åœ¨ä½ è¯•å›¾å–èµ°çš„æ—¶å€™æ‰æœ‰å¯èƒ½å­˜åœ¨ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…äº’ç›¸ç­‰å¾…ï¼Œç­‰åˆ°å¯¹æ–¹ä¹‹åŽç„¶åŽå†ä¸€èµ·ç¦»å¼€ã€‚ ThreadPoolExecutoçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡æ—¶ï¼šexecuteä¸€ä¸ªçº¿ç¨‹ä¹‹åŽï¼š å¦‚æžœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°æœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™ä¼šç«‹é©¬å¯ç”¨ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹åŽ»æ‰§è¡Œ å¦‚æžœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å·²ç»è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¸”workQueueæœªæ»¡ï¼Œåˆ™å°†æ–°çº¿ç¨‹æ”¾å…¥workQueueä¸­ç­‰å¾…æ‰§è¡Œ å¦‚æžœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å·²ç»è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ä½†æœªè¶…è¿‡éžæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¸”workQueueå·²æ»¡ï¼Œåˆ™å¼€å¯ä¸€ä¸ªéžæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ å¦‚æžœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å·²ç»è¶…è¿‡éžæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™æ‹’ç»æ‰§è¡Œè¯¥ä»»åŠ¡ å¦‚ä½•é…ç½®è¿™äº›å‚æ•°ï¼ˆå‚è€ƒAsycTaskï¼‰ æ ¸å¿ƒçº¿ç¨‹æ•°ä¸ºæ‰‹æœºCPUæ•°é‡+1ï¼ˆcpuæ•°é‡èŽ·å–æ–¹å¼Runtime.getRuntime().availableProcessors()ï¼‰ æœ€å¤§çº¿ç¨‹æ•°ä¸ºæ‰‹æœºCPUæ•°é‡Ã—2+1 çº¿ç¨‹é˜Ÿåˆ—çš„å¤§å°ä¸º128 ç³»ç»Ÿå¸®æˆ‘ä»¬é…ç½®å¥½çš„çº¿ç¨‹æ± å››ç§å¯¹æ¯” FixedThreadPool æ ¸å¿ƒçº¿ç¨‹æ•°é‡å›ºå®šçš„çº¿ç¨‹æ±  1ExecutorService fixedThreadPool = Executors.newFixedThreadPool(3); æºç ï¼š 12345public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());&#125; æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ä¸€æ · FixedThreadPoolä¸­æ²¡æœ‰éžæ ¸å¿ƒçº¿ç¨‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯æ ¸å¿ƒçº¿ç¨‹ çº¿ç¨‹çš„è¶…æ—¶æ—¶é—´ä¸º0 æ ¸å¿ƒçº¿ç¨‹å³ä½¿åœ¨æ²¡æœ‰ä»»åŠ¡å¯æ‰§è¡Œçš„æ—¶å€™ä¹Ÿä¸ä¼šè¢«é”€æ¯ï¼ˆè¿™æ ·å¯è®©FixedThreadPoolæ›´å¿«é€Ÿçš„å“åº”è¯·æ±‚ï¼‰ LinkedBlockingQueueå´æ²¡æœ‰å‚æ•°ï¼Œè¿™è¯´æ˜Žçº¿ç¨‹é˜Ÿåˆ—çš„å¤§å°ä¸ºInteger.MAX_VALUEï¼ˆ2çš„31æ¬¡æ–¹å‡1) æ‰€æœ‰çš„æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œæ–°çš„ä»»åŠ¡åªèƒ½è¿›å…¥çº¿ç¨‹é˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°æœ‰çº¿ç¨‹è¢«ç©ºé—²å‡ºæ¥ SingleThreadExecutor singleThreadExecutorå’ŒFixedThreadPoolå¾ˆåƒï¼Œä¸åŒçš„å°±æ˜¯SingleThreadExecutorçš„æ ¸å¿ƒçº¿ç¨‹æ•°åªæœ‰1 â€‹ 123456public static ExecutorService newSingleThreadExecutor() &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;())); &#125; æœ€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥é¿å…æˆ‘ä»¬åŽ»å¤„ç†çº¿ç¨‹åŒæ­¥é—®é¢˜ åªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œç¡®ä¿æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨åŒä¸€çº¿ç¨‹ä¸­æŒ‰é¡ºåºå®Œæˆã€‚å› æ­¤ä¸éœ€è¦å¤„ç†çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚ FixedThreadPoolçš„å‚æ•°ä¼ ä¸ª1æ•ˆæžœä¸€æ · CachedThreadPool æœ€å¤§çš„ä¼˜åŠ¿æ˜¯å®ƒå¯ä»¥æ ¹æ®ç¨‹åºçš„è¿è¡Œæƒ…å†µè‡ªåŠ¨æ¥è°ƒæ•´çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ 12345public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());&#125; CachedThreadPoolä¸­æ˜¯æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹çš„ï¼Œä½†æ˜¯å®ƒçš„æœ€å¤§çº¿ç¨‹æ•°å´ä¸ºInteger.MAX_VALUE å®ƒæ˜¯æœ‰çº¿ç¨‹è¶…æ—¶æœºåˆ¶çš„ï¼Œè¶…æ—¶æ—¶é—´ä¸º60ç§’ æœ€å¤§çº¿ç¨‹æ•°ä¸ºæ— é™å¤§ æ·»åŠ ä¸€ä¸ªæ–°ä»»åŠ¡è¿›æ¥çš„æ—¶å€™ï¼Œå¦‚æžœçº¿ç¨‹æ± ä¸­æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œåˆ™ç”±è¯¥ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œæ–°ä»»åŠ¡ æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ CachedThreadPoolä¸­æ²¡æœ‰æ–°ä»»åŠ¡çš„æ—¶å€™ï¼Œå®ƒé‡Œè¾¹æ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šå› ä¸ºè¶…æ—¶è€Œè¢«ç»ˆæ­¢ ä»»åŠ¡é˜Ÿåˆ—SynchronousQueueç›¸å½“äºŽä¸€ä¸ªç©ºé›†åˆï¼Œå¯¼è‡´ä»»ä½•ä»»åŠ¡éƒ½ä¼šè¢«ç«‹å³æ‰§è¡Œ å¯ä»¥åœ¨æœ‰å¤§é‡ä»»åŠ¡è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨CachedThreadPool ScheduleThreadPool å…·æœ‰å®šæ—¶å®šæœŸæ‰§è¡Œä»»åŠ¡åŠŸèƒ½çš„çº¿ç¨‹æ±  12345public ScheduledThreadPoolExecutor(int corePoolSize) &#123; super(corePoolSize, Integer.MAX_VALUE, DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS, new DelayedWorkQueue());&#125; æ ¸å¿ƒçº¿ç¨‹æ•°é‡æ˜¯å›ºå®šçš„ éžæ ¸å¿ƒçº¿ç¨‹æ˜¯æ— ç©·å¤§,å½“éžæ ¸å¿ƒçº¿ç¨‹é—²ç½®æ—¶ï¼Œåˆ™ä¼šè¢«ç«‹å³å›žæ”¶ã€‚ æ”¯æŒå»¶è¿Ÿæ‰§è¡Œä»»åŠ¡ï¼›å®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼›å»¶è¿Ÿå®šæ—¶æ‰§è¡Œä»»åŠ¡ çº¿ç¨‹æ± çš„å…¶ä»–åŠŸèƒ½ shutDownï¼ˆï¼‰ï¼šå…³é—­çº¿ç¨‹æ± ï¼Œä¸å½±å“å·²ç»æäº¤çš„ä»»åŠ¡ shutDownNowï¼ˆï¼‰ï¼šå…³é—­çº¿ç¨‹æ± ï¼Œå¹¶å°è¯•ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ allowCoreThreadTimeOut(boolean value)ï¼šå…è®¸æ ¸å¿ƒçº¿ç¨‹é—²ç½®è¶…æ—¶è¢«å›žæ”¶ submitï¼šä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨executeæ¥æäº¤ä»»åŠ¡ï¼Œä½†æ˜¯æœ‰æ—¶å€™å¯èƒ½ä¹Ÿä¼šç”¨åˆ°submitï¼Œä½¿ç”¨submitçš„å¥½å¤„æ˜¯submitæœ‰è¿”å›žå€¼ çº¿ç¨‹æ± ç®€å•å°è£…ThreadPoolManager.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273import java.util.concurrent.Executors;import java.util.concurrent.LinkedBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * Created by fengan on 2017/12/25. * email:fengan1102@gmail.com */public class ThreadPoolManager &#123; private static ThreadPoolManager Instance; private final ThreadPoolExecutor threadPoolExecutor; private ThreadPoolManager() &#123;//æ ¸å¿ƒçº¿ç¨‹æ•°é‡//æœ€å¤§çº¿ç¨‹æ•°é‡//éžæ ¸å¿ƒçº¿ç¨‹çš„è¶…æ—¶æ—¶é•¿//æ—¶é—´å•ä½//ç¼“å†²é˜Ÿåˆ—ï¼Œç”¨äºŽå­˜æ”¾ç­‰å¾…ä»»åŠ¡ï¼ŒLinkedçš„å…ˆè¿›å…ˆå‡º//åˆ›å»ºçº¿ç¨‹çš„å·¥åŽ‚//ç”¨æ¥å¯¹è¶…å‡ºmaximumPoolSizeçš„ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ threadPoolExecutor = new ThreadPoolExecutor(corePoolSize,//æ ¸å¿ƒçº¿ç¨‹æ•°é‡ maximumPoolSize,//æœ€å¤§çº¿ç¨‹æ•°é‡ keepAliveTime,//éžæ ¸å¿ƒçº¿ç¨‹çš„è¶…æ—¶æ—¶é•¿ unit,//æ—¶é—´å•ä½ new LinkedBlockingQueue&lt;Runnable&gt;(),//ç¼“å†²é˜Ÿåˆ—ï¼Œç”¨äºŽå­˜æ”¾ç­‰å¾…ä»»åŠ¡ï¼ŒLinkedçš„å…ˆè¿›å…ˆå‡º Executors.defaultThreadFactory(), //åˆ›å»ºçº¿ç¨‹çš„å·¥åŽ‚ new ThreadPoolExecutor.AbortPolicy() //ç”¨æ¥å¯¹è¶…å‡ºmaximumPoolSizeçš„ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ ); threadPoolExecutor.allowCoreThreadTimeOut(true);//è®¾ç½®æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶æ—¶é—´å¯ç”¨ &#125; public static ThreadPoolManager getInstance() &#123; if (Instance == null) &#123; synchronized (ThreadPoolManager.class) &#123; if (Instance == null) &#123; Instance = new ThreadPoolManager(); &#125; &#125; &#125; return Instance; &#125; //å½“å‰è®¾å¤‡å¯ç”¨å¤„ç†å™¨æ ¸å¿ƒæ•°*2 + 1,èƒ½å¤Ÿè®©cpuçš„æ•ˆçŽ‡å¾—åˆ°æœ€å¤§ç¨‹åº¦æ‰§è¡Œï¼ˆæœ‰ç ”ç©¶è®ºè¯çš„ï¼‰ private final int corePoolSize = Runtime.getRuntime().availableProcessors() * 2 + 1; //æœ€å¤§çº¿ç¨‹æ•°ç­‰äºŽæ ¸å¿ƒçº¿ç¨‹æ•° private final int maximumPoolSize = corePoolSize; //è¶…æ—¶æ—¶é—´ï¼Œ1å°æ—¶ private final long keepAliveTime = 1; private final TimeUnit unit = TimeUnit.HOURS; /** * æ‰§è¡Œä»»åŠ¡ */ public void execute(Runnable runnable) &#123; if (runnable == null) return; threadPoolExecutor.execute(runnable); &#125; /** * ä»Žçº¿ç¨‹æ± ä¸­ç§»é™¤ä»»åŠ¡ */ public void remove(Runnable runnable) &#123; if (runnable == null) return; threadPoolExecutor.remove(runnable); &#125;&#125; å†æ¬¡æ¯”è¾ƒå››ç§å¸¸è§çš„çº¿ç¨‹æ± è¯¦ç»†æ¯”è¾ƒä¸ç®¡å“ªç§çº¿ç¨‹æ± ï¼Œéƒ½æ˜¯é ThreadPoolExecutorçš„ä¸ƒä¸ªå‚æ•°çš„æž„é€ æ¥å®žçŽ°çš„ æ ¸å¿ƒçº¿ç¨‹ æœ€å¤§çº¿ç¨‹ ç‰¹ç‚¹ FixThreadPool æœ‰ æ— ï¼ˆéžæ ¸å¿ƒçº¿ç¨‹ï¼‰ ä¸ä¼šè¢«å›žæ”¶ åªæœ‰å›ºå®šæ•°é‡çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œçº¿ç¨‹éƒ½æ´»åŠ¨æ—¶ï¼Œæ–°ä»»åŠ¡ç­‰å¾… SingleThreadPool 1 æ— ï¼ˆéžæ ¸å¿ƒçº¿ç¨‹ï¼‰ ä¸ä¼šè¢«å›žæ”¶ æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨ç»Ÿä¸€çº¿ç¨‹æ‰§è¡Œï¼Œä¸éœ€è¦å¤„ç†çº¿ç¨‹åŒæ­¥é—®é¢˜ CachedThreadPool æ—  Integer.MAX_VALUE è¶…æ—¶æ—¶é—´60ç§’ ä»»ä½•ä»»åŠ¡ç«‹å³æ‰§è¡Œ ScheduledThreadPool æœ‰ Integer.MAX_VALUE éžæ ¸å¿ƒçº¿ç¨‹é—²ç½®ï¼Œç«‹å³å›žæ”¶ å¯ä»¥å»¶è¿Ÿå’Œå®šæ—¶æ‰§è¡Œ ç›¸å…³èµ„æ–™ï¼š å‚è€ƒ1 å‚è€ƒ2 å‚è€ƒ3]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AsyncTaskçš„å¼Šç«¯]]></title>
    <url>%2F2016%2F12%2F20%2FAsyncTask%E7%BC%BA%E9%99%B7%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[Androidå¼€å‘ä¸­ï¼ŒAsyncTaskå¯ä»¥æ›¿ä»£Handlerå’ŒThreadæ¥å¤„ç†åŽå°æ“ä½œå’Œé€šçŸ¥Uiåˆ·æ–°ï¼Œé€‚ç”¨äºŽå¤„ç†å¼‚æ­¥æ•°æ®ï¼Œå¹¶å°†æ›´æ–°Uiçš„åœºæ™¯ï¼ŒAsyncTaské€‚ç”¨äºŽåŽå°æ“ä½œåªæœ‰å‡ ç§’çš„çŸ­æ—¶æ“ä½œã€‚ä½†æ˜¯AsyncTaskæœ¬èº«å­˜åœ¨å¾ˆå¤šç³Ÿç³•çš„é—®é¢˜ï¼Œå¦‚æžœä½¿ç”¨ä¸­ä¸æ³¨æ„ï¼Œå°†ä¼šå½±å“ç¨‹åºçš„å¥å£®æ€§ã€‚ AsyncTaskå’ŒHandlerå¯¹æ¯”æ³¨æ„ï¼šæŒ‰ç…§Androidå®˜æ–¹æ–‡æ¡£æ”¯å‡º,AsyncTaskè¢«æŽ¨èä¸ºå¤„ç†çŸ­æ—¶é—´(10ç§’ä»¥å†…)çš„æ“ä½œ,å³æœ¬åœ°çš„è½»é‡IOæ“ä½œ.ä¸é€‚åˆä½¿ç”¨ç½‘ç»œè¿™æ ·æ—¶é—´ä¸å®šçš„æ“ä½œ. å…±åŒç‚¹éƒ½æ˜¯ä¸ºäº†è§£å†³è€—æ—¶æ“ä½œçš„é—®é¢˜ï¼Œä¸»è¦åŒºåˆ«åœ¨äºŽä¸€ä¸ªæµç¨‹å®Œå–„ï¼Œæ‹¿æ¥å°±ç”¨ï¼ˆAsyncTaskï¼‰ï¼Œä¸€ä¸ªåå‘è‡ªä¸»å®šåˆ¶ï¼Œæ‰©å±•æ€§é«˜ï¼ˆHandler+Threadï¼‰ã€‚ AsyncTaskæ¯”Handlerè½»é‡çº§ï¼Œå¯¹å—ï¼Ÿ é€šè¿‡çœ‹æºç ï¼Œå‘çŽ°AsyncTaskå®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè€Œç½‘ä¸Šçš„è¯´æ³•æ˜¯AsyncTaskæ¯”handlerè¦è½»é‡çº§ï¼Œæ˜¾ç„¶ä¸Šä¸å‡†ç¡®çš„ï¼Œåªèƒ½è¿™æ ·è¯´ï¼ŒAsyncTaskåœ¨ä»£ç ä¸Šæ¯”handlerè¦è½»é‡çº§åˆ«ï¼Œè€Œå®žé™…ä¸Šè¦æ¯”handleræ›´è€—èµ„æºï¼Œå› ä¸ºAsyncTaskåº•å±‚æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼è€ŒHandlerä»…ä»…å°±æ˜¯å‘é€äº†ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿žçº¿ç¨‹éƒ½æ²¡æœ‰å¼€ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœå¼‚æ­¥ä»»åŠ¡çš„æ•°æ®ç‰¹åˆ«åºžå¤§ï¼ŒAsyncTaskè¿™ç§çº¿ç¨‹æ± ç»“æž„çš„ä¼˜åŠ¿å°±ä½“çŽ°å‡ºæ¥äº†ã€‚ AsyncTaskå®žçŽ°çš„åŽŸç†,å’Œé€‚ç”¨çš„ä¼˜ç¼ºç‚¹ AsyncTask,æ˜¯androidæä¾›çš„è½»é‡çº§çš„å¼‚æ­¥ç±»,å¯ä»¥ç›´æŽ¥ç»§æ‰¿AsyncTask,åœ¨ç±»ä¸­å®žçŽ°å¼‚æ­¥æ“ä½œ,å¹¶æä¾›æŽ¥å£åé¦ˆå½“å‰å¼‚æ­¥æ‰§è¡Œçš„ç¨‹åº¦(å¯ä»¥é€šè¿‡æŽ¥å£å®žçŽ°UIè¿›åº¦æ›´æ–°),æœ€åŽåé¦ˆæ‰§è¡Œçš„ç»“æžœç»™UIä¸»çº¿ç¨‹. ä½¿ç”¨çš„ä¼˜ç‚¹: l ç®€å•,å¿«æ· l è¿‡ç¨‹å¯æŽ§ ä½¿ç”¨çš„ç¼ºç‚¹: l åœ¨ä½¿ç”¨å¤šä¸ªå¼‚æ­¥æ“ä½œçš„åŒæ—¶ï¼Œå…±åŒè¿›è¡ŒUiå˜æ›´æ—¶,å°±å˜å¾—å¤æ‚èµ·æ¥. l æœ€å¤§å¹¶å‘æ•°ä¸è¶…è¿‡5 Handlerå¼‚æ­¥å®žçŽ°çš„åŽŸç†å’Œé€‚ç”¨çš„ä¼˜ç¼ºç‚¹ åœ¨Handler å¼‚æ­¥å®žçŽ°æ—¶,æ¶‰åŠåˆ° Handler, Looper, Message,Threadå››ä¸ªå¯¹è±¡ï¼Œå®žçŽ°å¼‚æ­¥çš„æµç¨‹æ˜¯ä¸»çº¿ç¨‹å¯åŠ¨Threadï¼ˆå­çº¿ç¨‹ï¼‰Ã thread(å­çº¿ç¨‹)è¿è¡Œå¹¶ç”ŸæˆMessage-Ã LooperèŽ·å–Messageå¹¶ä¼ é€’ç»™HandlerÃ Handleré€ä¸ªèŽ·å–Looperä¸­çš„Messageï¼Œå¹¶è¿›è¡ŒUIå˜æ›´ã€‚ ä½¿ç”¨çš„ä¼˜ç‚¹ï¼š l ç»“æž„æ¸…æ™°ï¼ŒåŠŸèƒ½å®šä¹‰æ˜Žç¡® l å¯¹äºŽå¤šä¸ªåŽå°ä»»åŠ¡æ—¶ï¼Œç®€å•ï¼Œæ¸…æ™° ä½¿ç”¨çš„ç¼ºç‚¹ï¼š l åœ¨å•ä¸ªåŽå°å¼‚æ­¥å¤„ç†æ—¶ï¼Œæ˜¾å¾—ä»£ç è¿‡å¤šï¼Œç»“æž„è¿‡äºŽå¤æ‚ï¼ˆç›¸å¯¹æ€§ï¼‰ AsyncTaskçš„ä½¿ç”¨ï¼š å¿…é€‰æ–¹æ³•ï¼š 1ï¼Œ doinbackground(paramsâ€¦) åŽå°æ‰§è¡Œï¼Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œéƒ½å¯ä»¥æ”¾åœ¨è¿™é‡Œã€‚ æ³¨æ„è¿™é‡Œä¸èƒ½ç›´æŽ¥æ“ä½œUIã€‚æ­¤æ–¹æ³•åœ¨åŽå°çº¿ç¨‹æ‰§è¡Œï¼Œå®Œæˆä»»åŠ¡çš„ä¸»è¦å·¥ä½œ ï¼Œé€šå¸¸éœ€è¦è¾ƒé•¿çš„æ—¶é—´ã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥è°ƒç”¨ Public progress(progressâ€¦)æ¥æ›´æ–°ä»»åŠ¡çš„è¿›åº¦ã€‚ 2ï¼Œ onpostexecute(result)ç›¸å½“äºŽhandlerå¤„ç†UIçš„æ–¹å¼ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨åœ¨ doinbackgroundå¾—åˆ°çš„ç»“æžœå¤„ç†æ“ä½œUIã€‚æ­¤æ–¹æ³•åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä»»åŠ¡æ‰§è¡Œçš„ç»“æžœä½œä¸ºæ­¤æ–¹æ³•çš„å‚æ•°è¿”å›žã€‚ å¯é€‰æ–¹æ³•ï¼š 1ï¼Œ onprogressupdate(progressâ€¦) å¯ä»¥ä½¿ç”¨è¿›åº¦æ¡å¢žåŠ ç”¨æˆ·ä½“éªŒåº¦ã€‚æ­¤æ–¹æ³•åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œç”¨æˆ·æ˜¾ç¤ºä»»åŠ¡æ‰§è¡Œçš„è¿›åº¦ã€‚ 2ï¼Œ onpreExecute() è¿™é‡Œæ˜¯æœ€æ–°ç”¨æˆ·è°ƒç”¨excuteæ—¶çš„æŽ¥å£ï¼Œå½“ä»»åŠ¡æ‰§è¡Œä¹‹å‰å¼€å§‹è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†ã€‚ 3ï¼Œ onCancelled() ç”¨æˆ·è°ƒç”¨å–æ¶ˆæ—¶ï¼Œè¦åšçš„æ“ä½œ AsyncTaskä¸‰ä¸ªçŠ¶æ€ï¼š pending,running,finished ä½¿ç”¨AsyncTaskç±»ï¼Œéµå®ˆçš„å‡†åˆ™ï¼š 1ï¼Œ Taskçš„å®žä¾‹å¿…é¡»åœ¨UI threadä¸­åˆ›å»ºï¼› 2ï¼Œ Executeæ–¹æ³•å¿…é¡»åœ¨UI threadä¸­è°ƒç”¨ 3ï¼Œ ä¸è¦æ‰‹åŠ¨çš„è°ƒç”¨onPfreexecute()ï¼ŒonPostExecute(result) Doinbackground(paramsâ€¦),onProgressupdate(progressâ€¦)è¿™å‡ ä¸ªæ–¹æ³•ï¼› 4ï¼Œ è¯¥taskåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦åˆ™å¤šæ¬¡è°ƒç”¨æ—¶å°†ä¼šå‡ºçŽ°å¼‚å¸¸; AsyncTaskç¼ºé™·æ€»ç»“ï¼š ç”Ÿå‘½å‘¨æœŸ å¾ˆå¤šå¼€å‘è€…ä¼šè®¤ä¸ºåœ¨ä¸€ä¸ªActivityä¸­åˆ›å»ºçš„AsyncTaskä¼šéšç€Activityé”€æ¯è€Œé”€æ¯ï¼Œäº‹å®žå¹¶éžå¦‚æ­¤ï¼ŒAsyncTaskä¼šéšç€doInBackgroundï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ‰é”€æ¯ï¼Œç„¶åŽï¼Œcancelï¼ˆï¼‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆonCancelä¼šæ‰§è¡Œï¼›å¦åˆ™æ‰§è¡ŒpostExecuteæ–¹æ³•ä¼šæ‰§è¡Œã€‚å¦‚æžœåœ¨AsyncTaskæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå°±é”€æ¯äº†Activityï¼ŒAsyncTaskå¯èƒ½ä¼šå´©æºƒï¼Œå› ä¸ºå®ƒæƒ³è¦å¤„ç†çš„viewå·²ç»ä¸å­˜åœ¨äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ€»æ˜¯å¿…é¡»ç¡®ä¿åœ¨é”€æ¯æ´»åŠ¨ä¹‹å‰å–æ¶ˆä»»åŠ¡ã€‚æ€»ä¹‹ï¼Œæˆ‘ä»¬ä½¿ç”¨AsyncTaskéœ€è¦ç¡®ä¿AsyncTaskæ­£ç¡®åœ°å–æ¶ˆã€‚ å¦å¤–ï¼Œå³ä½¿æˆ‘ä»¬æ­£ç¡®åœ°è°ƒç”¨äº†cancle() ä¹Ÿæœªå¿…èƒ½çœŸæ­£åœ°å–æ¶ˆä»»åŠ¡ã€‚å› ä¸ºå¦‚æžœåœ¨doInBackgroudé‡Œæœ‰ä¸€ä¸ªä¸å¯ä¸­æ–­çš„æ“ä½œï¼Œæ¯”å¦‚BitmapFactory.decodeStream()ï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œä¼šç»§ç»­ä¸‹åŽ»ã€‚ å†…å­˜æ³„æ¼ å¦‚æžœAsyncTaskæœªå£°æ˜Žæˆé™æ€ï¼Œåˆ™ä¼šæŒæœ‰å¤–éƒ¨ç±»Activityçš„å¼•ç”¨ï¼Œå½“Activityé”€æ¯ä¹‹åŽï¼ŒAsyncTaskè¿˜åœ¨æ‰§è¡Œï¼Œå®ƒå°†åœ¨å†…å­˜ä¸­ä¾æ—§ä¿æŒè¿™ä¸ªå¼•ç”¨ï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼ ç»“æžœä¸¢å¤± å½“å±å¹•æ—‹è½¬Activityé”€æ¯é‡æ–°åˆ›å»ºï¼ˆæœªé…ç½®android:configChanges=â€orientation|screenSizeâ€çš„æƒ…å†µï¼‰ä¹‹å‰è¿è¡Œçš„AsyncTaskä¼šæŒæœ‰ä¹‹å‰Activityçš„å¼•ç”¨ï¼Œè¿™æ—¶è°ƒç”¨onPostExecute()å†åŽ»æ›´æ–°ç•Œé¢å°†ä¸å†ç”Ÿæ•ˆã€‚ å¹¶è¡Œè¿˜æ˜¯ä¸²è¡Œ å½“æƒ³è¦ä¸²è¡Œæ‰§è¡Œæ—¶ï¼Œç›´æŽ¥æ‰§è¡Œexecute()æ–¹æ³•ï¼Œå¦‚æžœéœ€è¦å¹¶è¡Œæ‰§è¡Œï¼Œåˆ™è¦æ‰§è¡ŒexecuteOnExecutor(Executor)ã€‚]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹åŽŸåž‹æ¨¡å¼]]></title>
    <url>%2F2016%2F12%2F19%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[åŽŸåž‹è®¾è®¡æ¨¡å¼çš„æ˜¯ä¸€ç§åˆ›å»ºåž‹çš„è®¾è®¡æ¨¡å¼ï¼Œå¦‚æžœåˆ›å»ºè¿‡ç¨‹ç¬”è®°å¤æ‚è€—æ—¶çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŽŸåž‹è®¾è®¡æ¨¡å¼ï¼›é€šè¿‡å…‹éš†å·²æœ‰çš„å¯¹è±¡æ¥èŽ·å–ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä½ å¯ä»¥ç›´æŽ¥ä½¿ç”¨å®ƒï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å…‹éš†å¯¹è±¡çš„éƒ¨åˆ†å±žæ€§å†ä½¿ç”¨ï¼Œä½¿å¾—æˆ‘ä»¬çš„ç¨‹åºæ›´åŠ é«˜æ•ˆ ä½¿ç”¨åœºæ™¯ å¦‚æžœä¸€ä¸ªç±»çš„åˆå§‹åŒ–éœ€è¦å¾ˆå¤šèµ„æºï¼Œè¿™ä¸ªèµ„æºåŒ…æ‹¬æ•°æ®æˆ–è€…ç¡¬ä»¶èµ„æºç­‰ï¼Œé€šè¿‡åŽŸåž‹æ‹·è´å·²æœ‰çš„å¯¹è±¡æ¥é¿å…è¿™äº›æ¶ˆè€— é€šè¿‡newäº§ç”Ÿçš„ä¸€ä¸ªå¯¹è±¡éœ€è¦éžå¸¸ç¹ççš„æ•°æ®å‡†å¤‡æˆ–è€…æƒé™ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨åŽŸåž‹æ¨¡å¼ã€‚ ä¸€ä¸ªå¯¹è±¡éœ€è¦æä¾›ç»™å…¶ä»–å¯¹è±¡è®¿é—®ï¼Œè€Œä¸”å„ä¸ªè°ƒç”¨è€…å¯èƒ½éƒ½éœ€è¦ä¿®æ”¹å…¶å€¼æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŽŸåž‹æ¨¡å¼æ‹·è´å¤šä¸ªå¯¹è±¡ä¾›è°ƒç”¨è€…ä½¿ç”¨ï¼Œå³ä¿æŠ¤æ€§æ‹·è´ã€‚ å¦‚ä½•å®žçŽ°é¦–å…ˆæˆ‘ä»¬å¾—å®žçŽ°CloneableæŽ¥å£ï¼Œå¤å†™cloneæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.it.fengan.designpattern.pattern;/** * Created by fengan on 2017/12/22. * email:fengan1102@gmail.com */public class Worker implements Cloneable &#123; private String name; private String des; private double money; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getDes() &#123; return des; &#125; public void setDes(String des) &#123; this.des = des; &#125; public double getMoney() &#123; return money; &#125; public void setMoney(double money) &#123; this.money = money; &#125; @Override public String toString() &#123; return "Worker&#123;" + "name='" + name + '\'' + ", des='" + des + '\'' + ", money=" + money + '&#125;'; &#125; @Override public Worker clone() &#123; Worker worker = null; try &#123; worker = (Worker) super.clone(); worker.money = this.money; worker.name = this.name; worker.des = this.des; &#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace(); &#125; return worker; &#125;&#125; æ³¨æ„ cloneè¿™ä¸ªæ–¹æ³•ä¸æ˜¯CloneableæŽ¥å£ä¸­çš„ï¼ˆCloneableæ˜¯ä¸€ä¸ªç©ºæŽ¥å£ï¼‰ cloneæ˜¯Objectä¸­çš„æ–¹æ³• Cloneableæ˜¯ä¸€ä¸ªæ ‡è¯†æŽ¥å£ï¼Œå®ƒè¡¨æ˜Žè¿™ä¸ªç±»çš„å¯¹è±¡æ˜¯å¯ä»¥æ‹·è´çš„ å¦‚æžœæ²¡æœ‰å®žçŽ°CloneableæŽ¥å£å´è°ƒç”¨äº†clone()å‡½æ•°å°†æŠ›å‡ºå¼‚å¸¸ã€‚ æµ…æ‹·è´å’Œæ·±æ‹·è´æµ…æ‹·è´ 12345678910@Override protected User clone() &#123; User user = null; try&#123; user = (User)super.clone(); &#125; catch (CloneNotSupportedException e)&#123; e.printStackTrace(); &#125; return user; &#125; é‚£ä¹ˆåœ¨å®žçŽ°cloneæ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸ªé—®é¢˜ï¼Œåƒä¸Šé¢é‚£æ ·ï¼Œç›´æŽ¥è°ƒç”¨ 1user = (User)super.clone(); è¿™æ ·åªæ˜¯ç®€å•çš„æ‹·è´äº†å¯¹è±¡ï¼Œå®žé™…ä¸Šå¹¶ä¸æ˜¯å°†åŽŸå§‹æ–‡æ¡£çš„æ‰€æœ‰å­—æ®µéƒ½é‡æ–°æž„é€ äº†ä¸€ä»½ï¼Œè€Œæ˜¯å‰¯æœ¬æ–‡æ¡£çš„å­—æ®µå¼•ç”¨åŽŸå§‹æ–‡æ¡£çš„å­—æ®µã€‚ æ·±æ‹·è´ 123456789101112@Override public WordDocument clone() &#123; try &#123; WordDocument doc = (WordDocument) super.clone(); doc.mText = this.mText; doc.mImages = (ArrayList&lt;String&gt;) this.mImages.clone(); return doc; &#125; catch (CloneNotSupportedException e) &#123; &#125; return null; &#125; Androidä¸­çš„åº”ç”¨Intenetæºç  123456789101112131415161718192021222324252627282930313233343536373839* * &lt;p&gt;These are the possible flags that can be used in the Intent via * &#123;@link #setFlags&#125; and &#123;@link #addFlags&#125;. See &#123;@link #setFlags&#125; for a list * of all possible flags. */public class Intent implements Parcelable, Cloneable &#123; ... @Override public Object clone() &#123; return new Intent(this); &#125; public Intent(Intent o) &#123; this.mAction = o.mAction; this.mData = o.mData; this.mType = o.mType; this.mPackage = o.mPackage; this.mComponent = o.mComponent; this.mFlags = o.mFlags; this.mContentUserHint = o.mContentUserHint; if (o.mCategories != null) &#123; this.mCategories = new ArraySet&lt;String&gt;(o.mCategories); &#125; if (o.mExtras != null) &#123; this.mExtras = new Bundle(o.mExtras); &#125; if (o.mSourceBounds != null) &#123; this.mSourceBounds = new Rect(o.mSourceBounds); &#125; if (o.mSelector != null) &#123; this.mSelector = new Intent(o.mSelector); &#125; if (o.mClipData != null) &#123; this.mClipData = new ClipData(o.mClipData); &#125; &#125; ...&#125; å¯ä»¥è§åˆ°ï¼Œæˆ‘ä»¬çš„Intentæ˜¯æ·±åº¦æ‹·è´ï¼Œè€Œä¸”æ˜¯ç›´æŽ¥newä¸€ä¸ªçš„æ·±åº¦æ‹·è´ã€‚å¯è§å…¶è®¾è®¡åˆè¡·ä¸æ˜¯å› ä¸ºå…¶ä¸æ˜¯ä¸ºäº†è§£å†³æž„å»ºå¤æ‚å¯¹è±¡çš„èµ„æºæ¶ˆè€—é—®é¢˜ã€‚ æ€»ç»“ åŽŸåž‹æ¨¡å¼æœ¬è´¨ä¸Šå°±æ˜¯å¯¹è±¡æ‹·è´ï¼Œä¸Ž C++ ä¸­çš„æ‹·è´æž„é€ å‡½æ•°æœ‰äº›ç±»ä¼¼ï¼Œå®ƒä»¬ä¹‹é—´å®¹æ˜“å‡ºçŽ°çš„é—®é¢˜ä¹Ÿéƒ½æ˜¯æ·±æ‹·è´ã€æµ…æ‹·è´ã€‚ä½¿ç”¨åŽŸåž‹æ¨¡å¼å¯ä»¥è§£å†³æž„å»ºå¤æ‚å¯¹è±¡çš„èµ„æºæ¶ˆè€—é—®é¢˜ï¼Œèƒ½å¤Ÿåœ¨æŸäº›åœºæ™¯ä¸‹æå‡åˆ›å»ºå¯¹è±¡çš„æ•ˆçŽ‡ã€‚è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„é€”å¾„å°±æ˜¯ä¿æŠ¤æ€§æ‹·è´ï¼Œä¹Ÿå°±æ˜¯æŸä¸ªå¯¹è±¡å¯¹å¤–å¯èƒ½æ˜¯åªè¯»çš„ï¼Œä¸ºäº†é˜²æ­¢å¤–éƒ¨å¯¹è¿™ä¸ªåªè¯»å¯¹è±¡ä¿®æ”¹ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡è¿”å›žä¸€ä¸ªå¯¹è±¡æ‹·è´çš„å½¢å¼å®žçŽ°åªè¯»çš„é™åˆ¶ã€‚ ä¼˜ç‚¹ï¼šåŽŸåž‹æ¨¡å¼æ˜¯åœ¨å†…å­˜ä¸­äºŒè¿›åˆ¶æµçš„æ‹·è´ï¼Œè¦æ¯”ç›´æŽ¥ new ä¸€ä¸ªå¯¹è±¡æ€§èƒ½å¥½å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯è¦åœ¨ä¸€ä¸ªå¾ªçŽ¯ä½“å†…äº§ç”Ÿå¤§é‡çš„å¯¹è±¡æ—¶ï¼ŒåŽŸåž‹æ¨¡å¼å¯ä»¥æ›´å¥½æ»´ä½“çŽ°å…¶ä¼˜ç‚¹ã€‚ ç¼ºç‚¹ï¼šè¿™æ—¢æ˜¯å®ƒçš„ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ï¼Œç›´æŽ¥åœ¨å†…å­˜ä¸­æ‹·è´ï¼Œæž„é€ å‡½æ•°æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œåœ¨å®žé™…å¼€å‘ä¸­åº”è¯¥æ³¨æ„è¿™ä¸ªæ½œåœ¨é—®é¢˜]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼]]></title>
    <url>%2F2016%2F12%2F19%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰ä¾èµ–äºŽå®ƒçš„å¯¹è±¡éƒ½èƒ½å¾—åˆ°é€šçŸ¥å¹¶å¯ä»¥è‡ªåŠ¨ä½œå‡ºå¤„ç† æ¯”å¦‚è¯´ï¼šæŠ¥çº¸çš„è®¢é˜…ï¼Œä¸€æ—¦è®¢é˜…ï¼Œå½“æœ‰æ–°çš„æŠ¥çº¸å‘å¸ƒï¼Œæ‰€æœ‰çš„è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ åŸºæœ¬æ¦‚å¿µç»„æˆ è§‚å¯Ÿè€…ï¼šObserverï¼Œä¹Ÿå«è®¢é˜…è€…ï¼Œå³Subscriberï¼ˆRxjavaï¼‰ è¢«è§‚å¯Ÿè€…ï¼šObservable javaä¸­çš„ä½“çŽ°javaä¸­æä¾›äº†Observableå’ŒObserveæŽ¥å£ä¾›æˆ‘ä»¬å¿«é€Ÿå®žçŽ°è¿™ç§æ¨¡å¼ ä»£ç å®žçŽ° å‡å¦‚æœ‰ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªå®žä½“ç±» 12345678910111213141516171819202122public class Weather &#123; private String description; public Weather(String description) &#123; this.description = description; &#125; public String getDescription() &#123; return description; &#125; public void setDescription(String description) &#123; this.description = description; &#125; @Override public String toString() &#123; return "Weather&#123;" + "description='" + description + '\'' + '&#125;'; &#125;&#125; å®šä¹‰è§‚å¯Ÿè€…æŽ¥å£ï¼ˆå› ä¸ºè§‚å¯Ÿè€…å¯èƒ½æœ‰å¾ˆå¤šç±»åž‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰æˆä¸€ä¸ªæŽ¥å£ï¼Œå¦‚æžœæƒ³è¦è®¢é˜…è¿™ä¸ªäº‹ä»¶ï¼Œå®žçŽ°è¿™ä¸ªæŽ¥å£å³å¯ï¼Œå¦å¤–ä¸€èˆ¬è®¢é˜…ä¹‹åŽï¼Œåœ¨å®žçŽ°æŽ¥å£ä¸­çš„æ–¹æ³•çš„å‚æ•°ä¸­ä¼šæ‹¿åˆ°å‘å¸ƒçš„æ•°æ®ï¼Œæ•°æ®çš„ç±»åž‹ä¸å›ºå®šæ‰€ä»¥è¿™ä¸ªè§‚å¯Ÿè€…æŽ¥å£éœ€è¦å®šä¹‰èŒƒåž‹ï¼‰ 123public interface Observer&lt;T&gt; &#123; void onUpdate(Observable&lt;T&gt; observable,T data);&#125; å®šä¹‰è¢«è§‚å¯Ÿè€…å¯¹è±¡ï¼ˆå¯ä»¥è®¾è®¡æˆå•ä¾‹æ¨¡å¼ï¼Œç±»ä¼¼EventBusï¼Œå†…éƒ¨ç»´æŒä¸€ä¸ªé›†åˆï¼Œç”¨æ¥ä¿å­˜è§‚å¯Ÿè€…å¯¹è±¡ï¼›registeræ–¹æ³•å’Œunregisteræ–¹æ³•ç”¨æ¥å°†è§‚å¯Ÿè€…å¯¹è±¡ä»Žé›†åˆä¸­æ·»åŠ å’Œç§»é™¤å‡ºæ¥ï¼Œpostæ–¹æ³•ç”¨æ¥å‘å¸ƒï¼Œå¾ªçŽ¯éåŽ†é›†åˆï¼Œä¾æ¬¡è°ƒç”¨è§‚å¯Ÿè€…çš„ç›¸å…³å›žè°ƒæ–¹æ³•ï¼Œå¹¶å°†å‘å¸ƒçš„å‚æ•°ä¼ å…¥ï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.it.fengan.designpattern.pattern;import java.util.ArrayList;import java.util.List;/** * Created by fengan on 2017/12/12. * email:fengan1102@gmail.com */public class Observable&lt;T&gt; &#123; private static Observable observable; private Observable() &#123; &#125; public static Observable getInstance() &#123; if (observable == null) &#123; synchronized (Observable.class) &#123; if (observable == null) &#123; observable = new Observable(); &#125; &#125; &#125; return observable; &#125; private List&lt;Observer&gt; observers = new ArrayList&lt;&gt;(); public void register(Observer&lt;T&gt; observer) &#123; if (observer == null) &#123; throw new RuntimeException("observer error"); &#125; synchronized (Observable.class) &#123; if (!observers.contains(observer)) &#123; observers.add(observer); &#125; &#125; &#125; public void unregister(Observer&lt;T&gt; observer) &#123; observers.remove(observer); &#125; public void post(T data) &#123; for (Observer observer : observers) &#123; observer.onUpdate(this, data); &#125; &#125;&#125; æ³¨å†Œå’Œåæ³¨å†Œè¿‡ç¨‹ 1234567891011121314151617181920212223@Test public void testObserver() &#123; Observer&lt;Weather&gt; objectObserver1 = new Observer&lt;Weather&gt;()&#123; @Override public void onUpdate(Observable&lt;Weather&gt; observable, Weather data) &#123; Log.e("testObserver", "objectObserver1:data=" + data.toString()); &#125; &#125;; Observer&lt;Weather&gt; objectObserver2 = new Observer&lt;Weather&gt;()&#123; @Override public void onUpdate(Observable&lt;Weather&gt; observable, Weather data) &#123; Log.e("testObserver", "objectObserver2:data=" + data.toString()); &#125; &#125;; Observable observable = Observable.getInstance(); observable.register(objectObserver1); observable.register(objectObserver2); Weather weather = new Weather("æ™´å¤©"); observable.post(weather); observable.unregister(objectObserver2); observable.post(weather); &#125; logcatè¾“å‡º 12312-19 15:18:44.780 2004-2036/? E/testObserver: objectObserver1:data=Weather&#123;description='æ™´å¤©'&#125;12-19 15:18:44.780 2004-2036/? E/testObserver: objectObserver2:data=Weather&#123;description='æ™´å¤©'&#125;12-19 15:18:44.780 2004-2036/? E/testObserver: objectObserver1:data=Weather&#123;description='æ™´å¤©'&#125; Androidä¸­çš„åº”ç”¨ ä¸€å¯¹ä¸€çš„è§‚å¯Ÿè€…ï¼ˆä¸€èˆ¬ç§°ä¹‹ä¸ºå›žè°ƒï¼Œåªæœ‰ä¸€ä¸ªè§‚å¯Ÿè€…ï¼‰ 1234567Button btn=new Button(this);btn.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; Log.e("TAG","click"); &#125;&#125;); åªè¦æ˜¯setç³»åˆ—çš„è®¾ç½®ç›‘å¬å™¨çš„æ–¹æ³•æœ€å¤šéƒ½åªèƒ½ç®—å›žè°ƒï¼Œä½†æ˜¯æœ‰ä¸€äº›ç›‘å¬å™¨å¼addè¿›åŽ»çš„ï¼Œè¿™ç§å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼äº†ï¼ˆæ¯”å¦‚RecyclerViewä¸­çš„addOnScrollListeneræ–¹æ³•ï¼‰ RecycleView.java 123456789101112131415161718192021222324252627282930313233343536373839private List&lt;OnScrollListener&gt; mScrollListeners;/** * Add a listener that will be notified of any changes in scroll state or position. * * &lt;p&gt;Components that add a listener should take care to remove it when finished. * Other components that take ownership of a view may call &#123;@link #clearOnScrollListeners()&#125; * to remove all attached listeners.&lt;/p&gt; * * @param listener listener to set or null to clear */public void addOnScrollListener(OnScrollListener listener) &#123; if (mScrollListeners == null) &#123; mScrollListeners = new ArrayList&lt;&gt;(); &#125; mScrollListeners.add(listener);&#125;/** * Remove a listener that was notified of any changes in scroll state or position. * * @param listener listener to set or null to clear */public void removeOnScrollListener(OnScrollListener listener) &#123; if (mScrollListeners != null) &#123; mScrollListeners.remove(listener); &#125;&#125;/** * Remove all secondary listener that were notified of any changes in scroll state or position. */public void clearOnScrollListeners() &#123; if (mScrollListeners != null) &#123; mScrollListeners.clear(); &#125;&#125; Androidçš„å¹¿æ’­æœºåˆ¶ï¼Œå…¶æœ¬è´¨ä¹Ÿæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè¿™é‡Œä¸ºäº†ç®€å•æ–¹ä¾¿ï¼Œç›´æŽ¥æ‹¿æœ¬åœ°å¹¿æ’­çš„ä»£ç è¯´æ˜Žï¼Œå³LocalBroadcastManager 1234LocalBroadcastManager localBroadcastManager=LocalBroadcastManager.getInstance(this);localBroadcastManager.registerReceiver(BroadcastReceiver receiver, IntentFilter filter);localBroadcastManager.unregisterReceiver(BroadcastReceiver receiver);localBroadcastManager.sendBroadcast(Intent intent) å¼€æºåº“ï¼ˆEventBusï¼‰ è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸‰ä¸ªå…¸åž‹æ–¹æ³•å®ƒéƒ½å…·æœ‰ï¼Œå³æ³¨å†Œï¼Œå–æ¶ˆæ³¨å†Œï¼Œå‘é€äº‹ä»¶ 1234EventBus.getDefault().register(Object subscriber);EventBus.getDefault().unregister(Object subscriber);EventBus.getDefault().post(Object event); é‡é‡çº§çš„åº“ï¼Œå®ƒå°±æ˜¯RxJava åˆ›å»ºä¸€ä¸ªè¢«è§‚å¯Ÿè€… 123456789Observable&lt;String&gt; myObservable = Observable.create( new Observable.OnSubscribe&lt;String&gt;() &#123; @Override public void call(Subscriber&lt;? super String&gt; sub) &#123; sub.onNext("Hello, world!"); sub.onCompleted(); &#125; &#125; ); åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œä¹Ÿå°±æ˜¯è®¢é˜…è€… 12345678910Subscriber&lt;String&gt; mySubscriber = new Subscriber&lt;String&gt;() &#123; @Override public void onNext(String s) &#123; System.out.println(s); &#125; @Override public void onCompleted() &#123; &#125; @Override public void onError(Throwable e) &#123; &#125; &#125;; è§‚å¯Ÿè€…è¿›è¡Œäº‹ä»¶çš„è®¢é˜… 1myObservable.subscribe(mySubscriber);]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2F2016%2F12%2F16%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ç­–ç•¥æ¨¡å¼å±žäºŽå¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ï¼Œå…¶ç”¨æ„æ˜¯é’ˆå¯¹ä¸€ç»„ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…åˆ°å…·æœ‰å…¬å…±æŽ¥å£çš„ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä»Žè€Œåœ¨ä¸å½±å“å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹å¯ä»¥åˆ‡æ¢ç›¸åº”çš„ç®—æ³•ã€‚ æœªä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¡ˆä¾‹12345678910111213141516171819202122232425262728293031323334public class TravelStrategy &#123; enum Strategy&#123; WALK,PLANE,SUBWAY &#125; private Strategy strategy; public TravelStrategy(Strategy strategy)&#123; this.strategy=strategy; &#125; public void travel()&#123; if(strategy==Strategy.WALK)&#123; print("walk"); &#125;else if(strategy==Strategy.PLANE)&#123; print("plane"); &#125;else if(strategy==Strategy.SUBWAY)&#123; print("subway"); &#125; &#125; public void print(String str)&#123; System.out.println("å‡ºè¡Œæ—…æ¸¸çš„æ–¹å¼ä¸ºï¼š"+str); &#125; public static void main(String[] args) &#123; TravelStrategy walk=new TravelStrategy(Strategy.WALK); walk.travel(); TravelStrategy plane=new TravelStrategy(Strategy.PLANE); plane.travel(); TravelStrategy subway=new TravelStrategy(Strategy.SUBWAY); subway.travel(); &#125;&#125; é€šè¿‡switchæˆ–è€…ifè¯­å¥ï¼Œæ¥åˆ¤æ–­é€‰æ‹©å“ªä¸€ç§ç­–ç•¥ç®—æ³•ï¼Œä¸€æ—¦ç­–ç•¥å¢žåŠ æˆ–è€…å‡å°‘ä¿®æ”¹ï¼Œå°±ä¸å¾—ä¸å¢žåŠ æ–°çš„è¯­å¥ï¼Œè¿™å°±è¿èƒŒäº†é¢å‘å¯¹è±¡çš„åŽŸåˆ™ä¹‹ä¸€ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚ ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¡ˆä¾‹å®šä¹‰ç­–ç•¥æŽ¥å£ï¼ˆæŠ½è±¡ç­–ç•¥ï¼‰ 123public interface Strategy &#123; void travel();&#125; å°†ä¸åŒçš„ç®—æ³•å°è£…åˆ°å®žçŽ°è¯¥ç­–ç•¥æŽ¥å£çš„å…·ä½“çš„ç±»ä¸­ï¼ˆå…·ä½“ç­–ç•¥ï¼‰ 12345678public class WalkStrategy implements Strategy&#123; @Override public void travel() &#123; System.out.println("walk"); &#125;&#125; 12345678public class PlaneStrategy implements Strategy&#123; @Override public void travel() &#123; System.out.println("plane"); &#125;&#125; 12345678public class SubwayStrategy implements Strategy&#123; @Override public void travel() &#123; System.out.println("subway"); &#125;&#125; ç­–ç•¥çŽ¯å¢ƒï¼ˆæŒæœ‰æŠ½è±¡ç­–ç•¥å¼•ç”¨çš„çŽ¯å¢ƒç±»ï¼‰ 1234567891011121314151617public class TravelContext &#123; Strategy strategy; public Strategy getStrategy() &#123; return strategy; &#125; public void setStrategy(Strategy strategy) &#123; this.strategy = strategy; &#125; public void travel() &#123; if (strategy != null) &#123; strategy.travel(); &#125; &#125;&#125; å…·ä½“ä½¿ç”¨ 1234567891011public class Main &#123; public static void main(String[] args) &#123; TravelContext travelContext=new TravelContext(); travelContext.setStrategy(new PlaneStrategy()); travelContext.travel(); travelContext.setStrategy(new WalkStrategy()); travelContext.travel(); travelContext.setStrategy(new SubwayStrategy()); travelContext.travel(); &#125;&#125; è‹¥æƒ³å¢žåŠ æ–°çš„ç­–ç•¥ï¼ˆæ·»åŠ æ–°çš„ç­–ç•¥å®žçŽ°ç±»å³å¯ï¼‰ 12345678public class BikeStrategy implements Strategy&#123; @Override public void travel() &#123; System.out.println("bike"); &#125;&#125; 123TravelContext travelContext=new TravelContext(); travelContext.setStrategy(new BikeStrategy()); travelContext.travel(); æ€»ç»“ é¢å‘å¯¹è±¡çš„å¯¹ä¿®æ”¹å°é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾ã€‚ Androidæºç ä¸­çš„ä½¿ç”¨ å±žæ€§åŠ¨ç”»çš„æ’å€¼å™¨ ç­–ç•¥æŽ¥å£ 12345public interface TypeEvaluator&lt;T&gt; &#123; public T evaluate(float fraction, T startValue, T endValue);&#125; å¤šä¸ªç­–ç•¥å®žçŽ°ä¾‹å¦‚ 1234567public class IntEvaluator implements TypeEvaluator&lt;Integer&gt; &#123; public Integer evaluate(float fraction, Integer startValue, Integer endValue) &#123; int startInt = startValue; return (int)(startInt + fraction * (endValue - startInt)); &#125;&#125; 1234567public class FloatEvaluator implements TypeEvaluator&lt;Number&gt; &#123; public Float evaluate(float fraction, Number startValue, Number endValue) &#123; float startFloat = startValue.floatValue(); return startFloat + fraction * (endValue.floatValue() - startFloat); &#125;&#125; å…¶ä»–ç•¥â€¦ å…¶ä»–ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ä¾‹å¦‚ï¼šä¸€ä¸ªç”µå•†ç±»å¹³å°ç­‰è´­ç‰©è½¦ç³»ç»Ÿï¼Œé™¤äº†æŠŠè´§å“çš„å•ä»·ä¹˜ä»¥æ•°é‡ä¹‹å¤–ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›ä¼˜æƒ æ´»åŠ¨ã€‚æ¯”å¦‚è¯´ï¼Œå¯¹é«˜çº§ä¼šå‘˜æä¾›5æŠ˜ä¼˜æƒ ï¼Œå¯¹ä¸­çº§ä¼šå‘˜æä¾›7æŠ˜ä¼˜æƒ ï¼Œå¯¹åˆçº§ä¼šå‘˜æä¾›9æŠ˜ä¼˜æƒ  é‚£ä¹ˆè¿™å°±æ¶‰åŠåˆ°äº†ä¸‰ç§ç®—æ³• é¦–å…ˆå®šä¹‰æŠ˜æ‰£æŠ½æ ·ç­–ç•¥æŽ¥å£ 12345678public interface MemberStrategy &#123; /** * è®¡ç®—å›¾ä¹¦çš„ä»·æ ¼ * @param booksPrice å›¾ä¹¦çš„åŽŸä»· * @return è®¡ç®—å‡ºæ‰“æŠ˜åŽçš„ä»·æ ¼ */ public double calcPrice(double booksPrice);&#125; åˆçº§ä¼šå‘˜æŠ˜æ‰£ç­–ç•¥ 12345678910public class PrimaryMemberStrategy implements MemberStrategy &#123; @Override public double calcPrice(double booksPrice) &#123; System.out.println("å¯¹äºŽåˆçº§ä¼šå‘˜çš„9æŠ˜æŠ˜æ‰£"); return booksPrice*0.9; &#125;&#125; 123456789public class AdvancedMemberStrategy implements MemberStrategy &#123; @Override public double calcPrice(double booksPrice) &#123; System.out.println("å¯¹äºŽé«˜çº§ä¼šå‘˜çš„æŠ˜æ‰£ä¸º5æŠ˜"); return booksPrice * 0.5; &#125;&#125; 12345678910public class IntermediateMemberStrategy implements MemberStrategy &#123; @Override public double calcPrice(double booksPrice) &#123; System.out.println("å¯¹äºŽä¸­çº§ä¼šå‘˜çš„æŠ˜æ‰£ä¸º7æŠ˜"); return booksPrice * 0.7; &#125;&#125; ç­–ç•¥çŽ¯å¢ƒç±» 1234567891011121314151617181920public class Price &#123; //æŒæœ‰ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥å¯¹è±¡ private MemberStrategy strategy; /** * æž„é€ å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥å¯¹è±¡ * @param strategy å…·ä½“çš„ç­–ç•¥å¯¹è±¡ */ public Price(MemberStrategy strategy)&#123; this.strategy = strategy; &#125; /** * è®¡ç®—å›¾ä¹¦çš„ä»·æ ¼ * @param booksPrice å›¾ä¹¦çš„åŽŸä»· * @return è®¡ç®—å‡ºæ‰“æŠ˜åŽçš„ä»·æ ¼ */ public double quote(double booksPrice)&#123; return this.strategy.calcPrice(booksPrice); &#125;&#125; å®¢æˆ·ç«¯çš„ä½¿ç”¨ 12345678910111213public class Client &#123; public static void main(String[] args) &#123; //é€‰æ‹©å¹¶åˆ›å»ºéœ€è¦ä½¿ç”¨çš„ç­–ç•¥å¯¹è±¡ MemberStrategy strategy = new AdvancedMemberStrategy(); //åˆ›å»ºçŽ¯å¢ƒ Price price = new Price(strategy); //è®¡ç®—ä»·æ ¼ double quote = price.quote(300); System.out.println("å›¾ä¹¦çš„æœ€ç»ˆä»·æ ¼ä¸ºï¼š" + quote); &#125;&#125; å¯ä»¥çœ‹å‡º ç­–ç•¥æ¨¡å¼çš„é‡å¿ƒä¸æ˜¯æä¾›ç®—æ³•ï¼Œè€Œæ˜¯å¯¹å¤šç§ç®—æ³•çš„å°è£… å„ä¸ªç®—æ³•ç›¸å¯¹ç‹¬ç«‹å¹³ç­‰ ç®—æ³•å¯ä»¥ç›¸äº’åˆ‡æ¢ï¼Œä½†åœ¨åŒä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨ä¸€ç§ç­–ç•¥ é¢å‘å¯¹è±¡çš„ï¼šå¯¹ä¿®æ”¹å°é—­ï¼Œå¯¹æ‹“å±•å¼€æ”¾ é¿å…ä½¿ç”¨switchå’Œifå¤šé‡æ¡ä»¶è¯­å¥ï¼Œæ–¹ä¾¿ç»´æŠ¤ ç¼ºç‚¹ï¼šå®¢æˆ·ç«¯äº‹å…ˆçŸ¥é“æœ‰å¤šå°‘ç§ç­–ç•¥ï¼Œå¹¶ä¸”æ¯ä¸ªç­–ç•¥çš„åŒºåˆ«]]></content>
      <categories>
        <category>Design Pattern</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼]]></title>
    <url>%2F2016%2F12%2F15%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å»ºé€ è€…æ¨¡å¼ï¼Œå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æž„å»ºä¸Žå®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—æž„å»ºè¿‡ç¨‹å¯ä»¥ä»¥åˆ†éƒ¨è¿›è¡Œçš„é“¾å¼è°ƒç”¨æ¥å®Œæˆ è‹¥ä¸ç”¨Buildæ¨¡å¼å®šä¹‰ä¸€ä¸ªPersonç±»1234567891011121314151617181920212223242526272829303132333435363738public class Person &#123; private String name; private int age; private double height; private double weight; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public double getHeight() &#123; return height; &#125; public void setHeight(double height) &#123; this.height = height; &#125; public double getWeight() &#123; return weight; &#125; public void setWeight(double weight) &#123; this.weight = weight; &#125;&#125; å¯èƒ½ä¼šå®šä¹‰ä¸€ä¸ªæž„é€ æ–¹æ³•ã€‚123456public Person(String name, int age, double height, double weight) &#123; this.name = name; this.age = age; this.height = height; this.weight = weight;&#125; å¯¹åº”ä¸åŒçš„éœ€æ±‚ï¼Œå¯èƒ½ä¼šå®šä¹‰å¥½å‡ ç§æž„é€ æ–¹æ³•1234567891011121314public Person(String name) &#123; this.name = name;&#125;public Person(String name, int age) &#123; this.name = name; this.age = age;&#125;public Person(String name, int age, double height) &#123; this.name = name; this.age = age; this.height = height;&#125; ä½¿ç”¨çš„æ—¶å€™å°±å˜æˆè¿™æ ·äº†12345Person p1=new Person();Person p2=new Person("å¼ ä¸‰");Person p3=new Person("æŽå››",18);Person p4=new Person("çŽ‹äº”",21,180);Person p5=new Person("èµµå…­",17,170,65.4); è¿™æ ·çš„åå¤„ï¼š æž„é€ å‡½æ•°æœ‰å¤šä¸ªå‚æ•°ï¼Œä¸å¥½ç¡®å®šæ¯ä¸ªå‚æ•°å…·ä½“æ„æ€ï¼Œå¯è¯»æ€§ä¸å¼º è‹¥å‚æ•°è¾ƒå¤šçš„æ—¶å€™ï¼Œéº»çƒ¦ è‹¥ä½¿ç”¨Builderæ¨¡å¼å…·ä½“ä»£ç å®žçŽ°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172public class Person &#123; private String name; private int age; private double height; private double weight; privatePerson(Builder builder) &#123; this.name=builder.name; this.age=builder.age; this.height=builder.height; this.weight=builder.weight; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public double getHeight() &#123; return height; &#125; public void setHeight(double height) &#123; this.height = height; &#125; public double getWeight() &#123; return weight; &#125; public void setWeight(double weight) &#123; this.weight = weight; &#125; static class Builder&#123; private String name; private int age; private double height; private double weight; public Builder name(String name)&#123; this.name=name; return this; &#125; public Builder age(int age)&#123; this.age=age; return this; &#125; public Builder height(double height)&#123; this.height=height; return this; &#125; public Builder weight(double weight)&#123; this.weight=weight; return this; &#125; public Person build()&#123; return new Person(this); &#125; &#125;&#125; å¤§æ¦‚æµç¨‹ å®šä¹‰é™æ€Builderç±» Builderç±»ä¸­å£°æ˜Žå’Œå¤–éƒ¨ç±»ä¸€æ ·çš„å˜é‡ å®šä¹‰å¤šä¸ªsetæ–¹æ³•ï¼Œè¿”å›žç»“æžœä¸ºBuilderæœ¬èº«ï¼ˆthisï¼‰ Builderç±»ä¸­å¢žåŠ buildï¼ˆï¼‰æ–¹æ³•ï¼Œè¿”å›žå¤–éƒ¨ç±»Personå¯¹è±¡ å¤–éƒ¨ç±»Personä¸­å£°æ˜Žä¸€ä¸ªå‚æ•°ä¸ºBuilderçš„æž„é€ å‡½æ•° ä½¿ç”¨1234567Person.Builder builder=new Person.Builder();Person person=builder .name("å¼ ä¸‰") .age(18) .height(178.5) .weight(67.4) .build(); Androidä¸­å“ªäº›åœ°æ–¹ä½¿ç”¨åˆ°Builderæ¨¡å¼å¯¹è¯æ¡†çš„åˆ›å»ºï¼ŒAlertDialog123456789101112131415161718AlertDialog.Builder builder=new AlertDialog.Builder(this);AlertDialog dialog=builder.setTitle("æ ‡é¢˜") .setIcon(android.R.drawable.ic_dialog_alert) .setView(R.layout.myview) .setPositiveButton(R.string.positive, new DialogInterface.OnClickListener() &#123; @Override public void onClick(DialogInterface dialog, int which) &#123; &#125; &#125;) .setNegativeButton(R.string.negative, new DialogInterface.OnClickListener() &#123; @Override public void onClick(DialogInterface dialog, int which) &#123; &#125; &#125;) .create();dialog.show();]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼ä¹‹å•ä¾‹æ¨¡å¼]]></title>
    <url>%2F2016%2F12%2F15%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[Androidä¸­å•ä¾‹æ¨¡å¼æ•´ç†è®°å½• ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ ä½¿ç”¨æ—¶ï¼Œå•ä¾‹æ¨¡å¼çš„å¯¹è±¡åªæœ‰ä¸€ä¸ªå®žä¾‹å­˜åœ¨ï¼Œä¸å…è®¸è‡ªç”±çš„æž„é€ å¯¹è±¡ å•ä¾‹æ¨¡å¼ä½¿ç”¨åœºæ™¯ ç¡®ä¿æŸä¸ªç±»åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®žä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®žä¾‹ â€¦ â€¦ å¦‚ä½•ä½¿ç”¨å•ä¾‹ ç§æœ‰æž„é€ å‡½æ•°ï¼Œç¦æ­¢å¤–éƒ¨ä½¿ç”¨æž„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ é€šè¿‡ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–è€…æžšä¸¾æ¥æä¾›è¿”å›žå•ä¾‹å®žä¾‹ ç¡®ä¿å•ä¾‹ç±»çš„å¯¹è±¡åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¸ä¼šé‡æ–°æž„å»ºå¯¹è±¡ ç¡®ä¿åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªå®žä¾‹ å•ä¾‹æ¨¡å¼åˆ†ç±» 1,é¥¿æ±‰å¼1234567891011public class Singleton &#123; private static Singleton instance = new Singleton(); private Singleton() &#123; &#125; private Singleton getInstance() &#123; return instance; &#125; &#125; 2,æ‡’æ±‰å¼12345678910111213public class Singleton &#123; private static Singleton instance ; private Singleton() &#123; &#125; private synchronized Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼çš„åŒºåˆ« é¥¿æ±‰å¼ï¼šåœ¨å£°æ˜Žé™æ€å¯¹è±¡çš„æ—¶å€™å°±åˆå§‹åŒ– æ‡’æ±‰å¼ï¼šå£°æ˜Žä¸€ä¸ªé™æ€å˜é‡ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceçš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ– â€‹ ä¼˜ç‚¹ï¼šå•ä¾‹åœ¨ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ï¼Œä¸€å®šç¨‹åº¦ä¸ŠèŠ‚çº¦äº†èµ„æº â€‹ ç¼ºç‚¹ï¼šç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™ä¼šåˆå§‹åŒ–ï¼Œååº”ç¨æ…¢ï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯æ¯æ¬¡è°ƒç”¨getInstanceéƒ½è¿›è¡ŒåŒæ­¥ï¼Œé€ æˆäº†ä¸å¿…è¦çš„åŒæ­¥å¼€é”€ï¼Œä¸€èˆ¬ä¸ä»‹æ„è¿™ä¹ˆç”¨ã€‚ 3,Double check lockï¼ˆDCLï¼‰123456789101112131415public class Singleton &#123; private static Singleton instance; private Singleton() &#123; &#125; private synchronized Singleton getInstance() &#123; if (instance == null) &#123; synchronized (Singleton.class) &#123; instance = new Singleton(); &#125; &#125; return instance; &#125;&#125; DCL : ä»‹ç»DCL åœ¨getInstance æ–¹æ³•ä¸­ å¯¹instance è¿›è¡Œä¸¤æ¬¡åˆ¤ç©ºï¼šç›¸ä¿¡å¾ˆå¤šäººå¯¹æ­¤éƒ½æœ‰äº›ç–‘æƒ‘ã€‚ä¸ºä»€ä¹ˆè¦åˆ¤æ–­ä¸¤æ¬¡ï¼Œç¬¬ä¸€ä¸ªåˆ¤ç©ºæ˜¯ä¸ºäº†é¿å…ä¸å¿…è¦çš„åŒæ­¥ï¼Œç¬¬äºŒå±‚åˆ¤æ–­æ˜¯ä¸ºäº†åœ¨null æƒ…å†µä¸‹åˆ›å»ºå®žä¾‹ã€‚instance=new Singleton(); è¯­å¥çœ‹èµ·æ¥æ˜¯æœ‰ä»£ç ï¼Œå•å®žé™…æ˜¯ä¸€ä¸ªåŽŸå­æ“ä½œï¼Œæœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆå¤šæ¡æ±‡ç¼–æŒ‡ä»¤ï¼Œå¤§è‡´åšäº†ä¸‰ä»¶äº‹ï¼š 1.ç»™Singleton åˆ†é…å†…å­˜ 2.è°ƒç”¨Singleton çš„æž„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æˆå‘˜å­—æ®µ 3.å°†instance å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ­¤æ—¶instance å°±ä¸æ˜¯null äº†ï¼‰ä½†æ˜¯jdk 1.5 ä»¥åŽjava ç¼–è¯‘å™¨å…è®¸ä¹±åºæ‰§è¡Œ ã€‚æ‰€ä»¥æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯1-3-2 æˆ–è€… 1-2-3.å¦‚æžœæ˜¯å‰è€…å…ˆæ‰§è¡Œ3 çš„è¯ åˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹ï¼Œinstance æ­¤æ—¶ å·²ç»æ˜¯éžç©ºäº†ï¼Œæ­¤çº¿ç¨‹å°±ä¼šç›´æŽ¥å–èµ°instance ï¼Œç›´æŽ¥ä½¿ç”¨ï¼Œè¿™æ ·å°±å›žå‡ºé”™ã€‚DCL å¤±æ•ˆã€‚è§£å†³æ–¹æ³• SUN å®˜æ–¹å·²ç»ç»™æˆ‘ä»¬äº†ã€‚å°†instance å®šä¹‰æˆ privatevolatilestatic Singleton instance =null: å³å¯DCL çš„ä¼˜ç‚¹ï¼Œèµ„æºåˆ©ç”¨çŽ‡é«˜ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡ŒgetInstance æ—¶æ‰ä¼šè¢«å®žä¾‹åŒ–ï¼Œæ•ˆçŽ‡é«˜ã€‚ç¼ºç‚¹ï¼šç¬¬ä¸€æ¬¡åŠ è½½ååº”æ…¢ï¼Œä¹Ÿç”±äºŽjava å†…å­˜ æ¨¡åž‹çš„åŽŸå› å¶å°”ä¼šå¤±è´¥ï¼Œåœ¨é«˜å¹¶å‘çŽ¯å¢ƒä¸‹ï¼Œæœ‰ä¸€å®šç¼ºé™·ï¼Œè™½ç„¶å‘ç”Ÿæ¦‚çŽ‡å¾ˆå°ã€‚(å¾ˆå¸¸ç”¨) 4.é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼12345678910111213public class Singleton &#123; private Singleton() &#123; &#125; private synchronized Singleton getInstance() &#123; return SingletonHolder.instance; &#125; private static class SingletonHolder &#123; private static final Singleton instance = new Singleton(); &#125;&#125; åŠ è½½singleton ç±»æ—¶ä¸ä¼šåˆå§‹åŒ–instance åªæœ‰åœ¨è°ƒç”¨getInstance æ–¹æ³•æ—¶ï¼Œæ‰ä¼šå¯¼è‡´instance è¢«åˆå§‹åŒ–,è¿™ä¸ªæ–¹æ³•ä¸ä»…èƒ½å¤Ÿç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½å¤Ÿä¿è¯ å•ä¾‹å¯¹è±¡çš„å”¯ä¸€æ€§,åŒæ—¶ä¹Ÿå»¶è¿Ÿäº†å•ä¾‹çš„å®žä¾‹åŒ–ï¼Œæ˜¯æŽ¨èä½¿ç”¨çš„å•ä¾‹æ¨¡å¼å®žçŽ°æ–¹å¼ã€‚ 5ï¼Œé˜²æ­¢ååºåˆ—åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºå¤šä¸ªå¯¹è±¡åŠ å…¥ä¸‹åˆ—æ–¹æ³• 123protected Singleton readResolve() throws ObjectStreamException &#123; return SingletonHolder.instance;&#125; è€Œå½“å®žçŽ°äº†readResolveæ–¹æ³•åŽï¼Œjvmå°±ä¼šæœ‰readResolveè¿”å›žæŒ‡å®šå¯¹è±¡ï¼Œä¹Ÿå°±ä¿è¯äº†å•ä¾‹æ€§ã€‚å®žéªŒè¯æ˜Žï¼Œå¦‚æžœæ²¡æœ‰å£°æ˜ŽreadResolveæ–¹æ³•ï¼Œå­˜å…¥å¯¹è±¡çš„hashcodeå’Œå–å‡ºå¯¹è±¡çš„hashcodeä¸ä¸€è‡´ã€‚ æŽ¨èä¸‹åˆ—æ–¹å¼ï¼ˆå¦‚æžœéœ€è¦åºåˆ—åŒ–çš„è¯ï¼‰ï¼š 1234567891011121314151617public class Singleton implements Serializable &#123; private Singleton() &#123; &#125; private synchronized Singleton getInstance() &#123; return SingletonHolder.instance; &#125; private static class SingletonHolder &#123; private static volatile final Singleton instance = new Singleton(); &#125; protected Singleton readResolve() throws ObjectStreamException &#123; return SingletonHolder.instance; &#125;&#125; 6,volatileå…³é”®å­—çš„ä½¿ç”¨å½“ä¸€ä¸ªå˜é‡å®šä¹‰ä¸º volatile ä¹‹åŽï¼Œå°†å…·å¤‡ä¸¤ç§ç‰¹æ€§ï¼š 1.ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çš„çº¿ç¨‹çš„å¯è§æ€§ï¼Œè¿™é‡Œçš„â€œå¯è§æ€§â€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œvolatile ä¿è¯äº†æ–°å€¼èƒ½ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œä»¥åŠæ¯æ¬¡ä½¿ç”¨å‰ç«‹å³ä»Žä¸»å†…å­˜åˆ·æ–°ã€‚ä½†æ™®é€šå˜é‡åšä¸åˆ°è¿™ç‚¹ï¼Œæ™®é€šå˜é‡çš„å€¼åœ¨çº¿ç¨‹é—´ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜ï¼ˆè¯¦è§ï¼šJavaå†…å­˜æ¨¡åž‹ï¼‰æ¥å®Œæˆã€‚ 2.ç¦æ­¢æŒ‡ä»¤é‡æŽ’åºä¼˜åŒ–ã€‚æœ‰volatileä¿®é¥°çš„å˜é‡ï¼Œèµ‹å€¼åŽå¤šæ‰§è¡Œäº†ä¸€ä¸ªâ€œload addl $0x0, (%esp)â€æ“ä½œï¼Œè¿™ä¸ªæ“ä½œç›¸å½“äºŽä¸€ä¸ªå†…å­˜å±éšœï¼ˆæŒ‡ä»¤é‡æŽ’åºæ—¶ä¸èƒ½æŠŠåŽé¢çš„æŒ‡ä»¤é‡æŽ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªCPUè®¿é—®å†…å­˜æ—¶ï¼Œå¹¶ä¸éœ€è¦å†…å­˜å±éšœï¼›ï¼ˆä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æŽ’åºï¼šæ˜¯æŒ‡CPUé‡‡ç”¨äº†å…è®¸å°†å¤šæ¡æŒ‡ä»¤ä¸æŒ‰ç¨‹åºè§„å®šçš„é¡ºåºåˆ†å¼€å‘é€ç»™å„ç›¸åº”ç”µè·¯å•å…ƒå¤„ç†ï¼‰ã€‚ volatile æ€§èƒ½ï¼š volatile çš„è¯»æ€§èƒ½æ¶ˆè€—ä¸Žæ™®é€šå˜é‡å‡ ä¹Žç›¸åŒï¼Œä½†æ˜¯å†™æ“ä½œç¨æ…¢ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨æœ¬åœ°ä»£ç ä¸­æ’å…¥è®¸å¤šå†…å­˜å±éšœæŒ‡ä»¤æ¥ä¿è¯å¤„ç†å™¨ä¸å‘ç”Ÿä¹±åºæ‰§è¡Œã€‚ 7,Androidæºç æˆ–è€…æ¡†æž¶ä½¿ç”¨ ImageLoader EventBus InputMethodManager AccessibilityManager ActivityManager(è‡ªå®šä¹‰å…³é—­æ‰€æœ‰Activityçš„å·¥å…·ç±»)]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[éšæ»‘åŠ¨æ”¹å˜çš„çš„åŠ¨æ€çŸ©å½¢èƒŒæ™¯]]></title>
    <url>%2F2016%2F10%2F11%2F%E9%9A%8F%E6%BB%91%E5%8A%A8%E6%94%B9%E5%8F%98%E7%9A%84%E7%9A%84%E5%8A%A8%E6%80%81%E7%9F%A9%E5%BD%A2%E8%83%8C%E6%99%AF%2F</url>
    <content type="text"><![CDATA[å¯èƒ½çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜æœ‰ç‚¹æ‡µé€¼,æœ¬å±Œçš„è¡¨è¾¾èƒ½åŠ›æœ‰é™,æœ€è¿‘å·¥ä½œæ¯”è¾ƒæ¸…é—²,æœ‹å‹å…¬å¸æ­£åœ¨åšåˆ°è¿™ä¸ªæ•ˆæžœ,æ‰€ä»¥å°±å¸®åŸºå‹å†™äº†ä¸€ä¸ªå°Demo. githubç§»æ­¥:https://github.com/itfengan/DynamicRectangleView æœ‹å‹å…¬å¸éœ€è¦è¾¾åˆ°çš„æ•ˆæžœ Demoä¸­çš„æ•ˆæžœ ä½¿ç”¨è¿‡ç¨‹layout&lt;com.fengan.dynamicrectangledemo.DynamicRectangleView android:id=&quot;@+id/drv&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;250dp&quot; app:fengan_limit_percent=&quot;0.2&quot; app:fengan_percent=&quot;0.5&quot; &gt;&lt;/com.fengan.dynamicrectangledemo.DynamicRectangleView&gt; code @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); SeekBar seekBar = (SeekBar) findViewById(R.id.sb); final DynamicRectangleView dynamicRectangleView = (DynamicRectangleView) findViewById(R.id.drv); seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() { @Override public void onProgressChanged(SeekBar seekBar, int i, boolean b) { dynamicRectangleView.setPercent((float)i/100); } @Override public void onStartTrackingTouch(SeekBar seekBar) { } @Override public void onStopTrackingTouch(SeekBar seekBar) { } }); findViewById(R.id.btn_scrollview).setOnClickListener(new View.OnClickListener() { @Override public void onClick(View view) { startActivity(new Intent(MainActivity.this,ScrollViewActivity.class)); } }); } attrs.xml(æœ‰çµæ€§çš„å“¥å“¥ä»¬åº”è¯¥çŒœå¾—åˆ°åˆ†åˆ«å¯¹åº”çš„ä»€ä¹ˆæ„æ€å’¯) &lt;resources&gt; &lt;declare-styleable name=&quot;DynamicRectangleView&quot;&gt; &lt;attr name=&quot;fengan_percent&quot; format=&quot;float&quot;/&gt; &lt;attr name=&quot;fengan_limit_percent&quot; format=&quot;float&quot;/&gt; &lt;attr name=&quot;fengan_start_color&quot; format=&quot;color&quot;/&gt; &lt;attr name=&quot;fengan_end_color&quot; format=&quot;color&quot;/&gt; &lt;/declare-styleable&gt; &lt;/resources&gt; fengan_percent:å³ä¾§çŸ­è¾¹å å·¦ä¾§çš„ç™¾åˆ†æ¯” fengan_limit_percent:å½“æ»‘åŠ¨åˆ°æœ€å°çš„ç™¾åˆ†æ¯” fengan_start_color:æ¸å˜è‰²çš„åˆå§‹é¢œè‰²(ps:æœ‹å‹å…¬å¸æ•ˆæžœå›¾æ˜¯æ¸å˜è‰²,å½“ç„¶ä¹Ÿå¯ä»¥ä¸éœ€è¦) fengan_end_color:æ¸å˜è‰²çš„ç»ˆæ­¢é¢œè‰² DynamicRectangleView.java package com.fengan.dynamicrectangledemo; import android.content.Context; import android.content.res.TypedArray; import android.graphics.Canvas; import android.graphics.Color; import android.graphics.LinearGradient; import android.graphics.Paint; import android.graphics.Path; import android.graphics.Shader; import android.util.AttributeSet; import android.util.Log; import android.view.View; /** * Created by fengan on 2017/10/11/011. */ public class DynamicRectangleView extends View { // Default values private final static int DEFAULT_START_COLOR = Color.parseColor(&quot;#88D94600&quot;); private final static int DEFAULT_END_COLOR = Color.parseColor(&quot;#D94600&quot;); private final static float DEFAULT_PERCENT = (float) 0.5;//å³è¾¹é«˜åº¦å å·¦è¾¹é«˜åº¦çš„ç™¾åˆ†æ¯” private final static float DEFAULT_LIMIT_PERCENT = (float) 0.2;//æœ€å°é«˜åº¦å å·¦è¾¹é«˜åº¦çš„ç™¾åˆ†æ¯” private Paint mPaint; private float OriginalRightHeight; private float OriginalLeftHeight; private float currentRightHeight; private float currentLeftHeight; private float minHeight; private float maxHeight; private int mStartColor; private int mEndColor; private float mPercent; private float mLimitPercent; private Path mPath; public DynamicRectangleView(Context context) { this(context, null); } public DynamicRectangleView(Context context, AttributeSet attrs) { this(context, attrs, 0); } public DynamicRectangleView(Context context, AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); // Retrieve attributes from xml final TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.DynamicRectangleView); try { mPercent = typedArray.getFloat(R.styleable.DynamicRectangleView_fengan_percent, DEFAULT_PERCENT); mLimitPercent = typedArray.getFloat(R.styleable.DynamicRectangleView_fengan_percent, DEFAULT_LIMIT_PERCENT); mStartColor = typedArray.getColor(R.styleable.DynamicRectangleView_fengan_start_color, DEFAULT_START_COLOR); mEndColor = typedArray.getColor(R.styleable.DynamicRectangleView_fengan_end_color, DEFAULT_END_COLOR); } finally { typedArray.recycle(); } initView(context); } private void initView(Context context) { mPaint = new Paint(); mPath = new Path(); mPaint.setAntiAlias(true); // mPaint.setColor(Color.RED);//çº¯è‰² } @Override protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) { super.onMeasure(widthMeasureSpec, heightMeasureSpec); } @Override protected void onSizeChanged(int w, int h, int oldw, int oldh) { super.onSizeChanged(w, h, oldw, oldh); OriginalLeftHeight = getMeasuredHeight(); OriginalRightHeight = getMeasuredHeight()*mPercent; minHeight = getMeasuredHeight() *mLimitPercent; maxHeight = OriginalRightHeight; //è®¾ç½®å½“å‰é«˜åº¦ currentRightHeight = OriginalRightHeight; currentLeftHeight = OriginalLeftHeight; // LinearGradient ç¬¬ä¸€ä¸ªå‚æ•°ç¬¬äºŒä¸ªå‚æ•°ä¸º èµ·å§‹ä½ç½®x,y ä¸‰å››å‚æ•°ä¸ºç»ˆç‚¹ä½ç½®x,yã€‚ // å¦‚æžœxä¸å˜åˆ™ä¸ºyè½´æ¸å˜ï¼Œ yä¸å˜åˆ™ä¸ºxè½´æ¸å˜ // ç¬¬äº”ä¸ªå‚æ•°ä¸ºé¢œè‰²æ¸å˜ï¼Œæ­¤å¤„ä¸ºçº¢è‰²æ¸å˜ä¸ºç»¿è‰² // ç¬¬ä¸ƒä¸ªå‚æ•°ä¸ºæ¸å˜æ¬¡æ•°ï¼Œå¯repeat Shader mShader = new LinearGradient(0, 0, maxHeight, maxHeight, new int[]{mStartColor, mEndColor}, null, Shader.TileMode.CLAMP); // Shader.TileModeä¸‰ç§æ¨¡å¼ // REPEAT:æ²¿ç€æ¸å˜æ–¹å‘å¾ªçŽ¯é‡å¤ // CLAMP:å¦‚æžœåœ¨é¢„å…ˆå®šä¹‰çš„èŒƒå›´å¤–ç”»çš„è¯ï¼Œå°±é‡å¤è¾¹ç•Œçš„é¢œè‰² // MIRROR:ä¸ŽREPEATä¸€æ ·éƒ½æ˜¯å¾ªçŽ¯é‡å¤ï¼Œä½†è¿™ä¸ªä¼šå¯¹ç§°é‡å¤ mPaint.setShader(mShader);// ç”¨Shaderä¸­å®šä¹‰å®šä¹‰çš„é¢œè‰²æ¥è¯ } @Override protected void onDraw(Canvas canvas) { super.onDraw(canvas); mPath.reset(); mPath.moveTo(0, 0); mPath.lineTo(getMeasuredWidth(), 0); mPath.lineTo(getMeasuredWidth(), currentRightHeight); mPath.lineTo(0, currentLeftHeight); mPath.close(); canvas.drawPath(mPath, mPaint); } public void setPercent(float percent) { Log.e(&quot;fengan&quot;, &quot;percent=&quot; + percent); currentRightHeight = OriginalRightHeight * (1 - percent); currentLeftHeight = OriginalLeftHeight * (1 - percent); if (currentLeftHeight &lt; minHeight) { currentLeftHeight = minHeight; } if (currentRightHeight &lt; minHeight) { currentRightHeight = minHeight; } postInvalidate(); } }]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gsonå°è£…]]></title>
    <url>%2F2016%2F08%2F21%2FGson%E5%B0%81%E8%A3%85%2F</url>
    <content type="text"><![CDATA[Gsonå°è£… Gsonå°è£…çš„å·¥å…·ç±» javabeanå’Œé›†åˆç›¸äº’è½¬æ¢ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124 /** * Created by fengan on 2017/7/6/006. */ import com.google.gson.Gson; import com.google.gson.JsonArray; import com.google.gson.JsonElement; import com.google.gson.JsonParser; import com.google.gson.reflect.TypeToken; import java.util.ArrayList; import java.util.List; import java.util.Map; public class GsonUtil &#123; private static Gson gson = null; static &#123; if (gson == null) &#123; gson = new Gson(); &#125; &#125; private GsonUtil() &#123; &#125; /** * è½¬æˆjson * * @param object * @return */ public static String GsonString(Object object) &#123; String gsonString = null; if (gson != null) &#123; gsonString = gson.toJson(object); &#125; return gsonString; &#125; /** * è½¬æˆbean * * @param gsonString * @param cls * @return */ public static &lt;T&gt; T GsonToBean(String gsonString, Class&lt;T&gt; cls) &#123; T t = null; if (gson != null) &#123; t = gson.fromJson(gsonString, cls); &#125; return t; &#125; /** * è½¬æˆlist * æ³›åž‹åœ¨ç¼–è¯‘æœŸç±»åž‹è¢«æ“¦é™¤å¯¼è‡´æŠ¥é”™ * * @param gsonString * @param cls * @return */ public static &lt;T&gt; List&lt;T&gt; GsonToList(String gsonString, Class&lt;T&gt; cls) &#123; List&lt;T&gt; list = null; if (gson != null) &#123; list = gson.fromJson(gsonString, new TypeToken&lt;List&lt;T&gt;&gt;() &#123; &#125;.getType()); &#125; return list; &#125; /** * è½¬æˆlist * è§£å†³æ³›åž‹é—®é¢˜ * * @param json * @param cls * @param &lt;T&gt; * @return */ public static &lt;T&gt; List&lt;T&gt; jsonToList(String json, Class&lt;T&gt; cls) &#123; Gson gson = new Gson(); List&lt;T&gt; list = new ArrayList&lt;T&gt;(); JsonArray array = new JsonParser().parse(json).getAsJsonArray(); for (final JsonElement elem : array) &#123; list.add(gson.fromJson(elem, cls)); &#125; return list; &#125; /** * è½¬æˆlistä¸­æœ‰mapçš„ * * @param gsonString * @return */ public static &lt;T&gt; List&lt;Map&lt;String, T&gt;&gt; GsonToListMaps(String gsonString) &#123; List&lt;Map&lt;String, T&gt;&gt; list = null; if (gson != null) &#123; list = gson.fromJson(gsonString, new TypeToken&lt;List&lt;Map&lt;String, T&gt;&gt;&gt;() &#123; &#125;.getType()); &#125; return list; &#125; /** * è½¬æˆmapçš„ * * @param gsonString * @return */ public static &lt;T&gt; Map&lt;String, T&gt; GsonToMaps(String gsonString) &#123; Map&lt;String, T&gt; map = null; if (gson != null) &#123; map = gson.fromJson(gsonString, new TypeToken&lt;Map&lt;String, T&gt;&gt;() &#123; &#125;.getType()); &#125; return map; &#125;&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[viewè¢«è½¯é”®ç›˜æŒ¡ä½å’Œç‚¹å‡»å¤–éƒ¨è½¯é”®ç›˜æ¶ˆå¤±]]></title>
    <url>%2F2016%2F08%2F21%2Fview%E8%A2%AB%E8%BD%AF%E9%94%AE%E7%9B%98%E6%8C%A1%E4%BD%8F%E5%92%8C%E7%82%B9%E5%87%BB%E5%A4%96%E9%83%A8%E8%BD%AF%E9%94%AE%E7%9B%98%E6%B6%88%E5%A4%B1%2F</url>
    <content type="text"><![CDATA[è½¯é”®ç›˜é®æŒ¡å’Œç‚¹å‡»ç©ºç™½åŒºåŸŸå…³é—­é”®ç›˜ éœ€æ±‚ ç™»é™†buttonæŒ¡ä½è¾“å…¥æ¡† è½¯é”®ç›˜å¼¹å‡ºæŒ¡ä½å…¶ä»–æŽ§ä»¶ è½¯é”®ç›˜å¼¹å‡ºï¼Œç‚¹å‡»ç©ºç™½åŒºåŸŸå…³é—­è½¯ä»¶ç›˜ ç‚¹å‡»buttonï¼Œé”®ç›˜å°†buttoné¡¶ä¸ŠåŽ» // æŽ§åˆ¶æ˜¯å¦ç§»åŠ¨å¸ƒå±€ã€‚æ¯”å¦‚åªæœ‰å¯†ç è¾“å…¥æ¡†èŽ·å–åˆ°ç„¦ç‚¹æ—¶æ‰æ‰§è¡Œã€‚ public boolean flag = true; /** * @param act activiryç”¨äºŽèŽ·å–åº•éƒ¨å¯¼èˆªæ é«˜åº¦ã€‚ * @param root æœ€å¤–å±‚å¸ƒå±€ï¼Œéœ€è¦è°ƒæ•´çš„å¸ƒå±€ * @param scrollToView è¢«é”®ç›˜é®æŒ¡çš„scrollToViewï¼Œæ»šåŠ¨root,ä½¿scrollToViewåœ¨rootå¯è§†åŒºåŸŸçš„åº•éƒ¨ */ public void controlKeyboardLayout(Context act, final View root, final View scrollToView) { final int navigationBarHeight = getNavigationBarHeight(act); root.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() { @Override public void onGlobalLayout() { Rect rect = new Rect(); //èŽ·å–rootåœ¨çª—ä½“çš„å¯è§†åŒºåŸŸ root.getWindowVisibleDisplayFrame(rect); //èŽ·å–rootåœ¨çª—ä½“çš„ä¸å¯è§†åŒºåŸŸé«˜åº¦(è¢«å…¶ä»–Viewé®æŒ¡çš„åŒºåŸŸé«˜åº¦) int rootInvisibleHeight = root.getRootView().getHeight() - rect.bottom; //è‹¥ä¸å¯è§†åŒºåŸŸé«˜åº¦å¤§äºŽ100ï¼Œåˆ™é”®ç›˜æ˜¾ç¤º if (rootInvisibleHeight &gt; navigationBarHeight &amp;&amp; flag) { int[] location = new int[2]; //èŽ·å–scrollToViewåœ¨çª—ä½“çš„åæ ‡ scrollToView.getLocationInWindow(location); //è®¡ç®—rootæ»šåŠ¨é«˜åº¦ï¼Œä½¿scrollToViewåœ¨å¯è§åŒºåŸŸ int srollHeight = (location[1] + scrollToView.getHeight()) - rect.bottom; if (root.getScrollY() != 0) {// å¦‚æžœå·²ç»æ»šåŠ¨ï¼Œè¦æ ¹æ®ä¸Šæ¬¡æ»šåŠ¨ï¼Œé‡æ–°è®¡ç®—ä½ç½®ã€‚ srollHeight += root.getScrollY(); } root.scrollTo(0, srollHeight); } else { //é”®ç›˜éšè— root.scrollTo(0, 0); } } }); } è§£å†³æŽ§åˆ¶ç‚¹å‡»å¯é€‰æ‹©çš„åŒºåŸŸè®©è½¯é”®ç›˜æ¶ˆå¤±æˆ–è€…ä¸æ¶ˆå¤± /** * èŽ·å–åº•éƒ¨å¯¼èˆªæ é«˜åº¦ * * @param act * @return */ private int getNavigationBarHeight(Context act) { Resources resources = act.getResources(); int resourceId = resources.getIdentifier(&quot;navigation_bar_height&quot;, &quot;dimen&quot;, &quot;android&quot;); int height = resources.getDimensionPixelSize(resourceId); Log.v(&quot;dbw&quot;, &quot;Navi height:&quot; + height); return height; } //è½¯é”®ç›˜æ¶ˆå¤±çš„ç®¡ç† //regionè½¯é”®ç›˜çš„å¤„ç† /** * æ¸…é™¤editTextçš„ç„¦ç‚¹ * * @param v ç„¦ç‚¹æ‰€åœ¨View * @param ids è¾“å…¥æ¡† */ public void clearViewFocus(View v, int... ids) { if (null != v &amp;&amp; null != ids &amp;&amp; ids.length &gt; 0) { for (int id : ids) { if (v.getId() == id) { v.clearFocus(); break; } } } } /** * éšè—é”®ç›˜ * * @param v ç„¦ç‚¹æ‰€åœ¨View * @param ids è¾“å…¥æ¡† * @return trueä»£è¡¨ç„¦ç‚¹åœ¨editä¸Š */ public boolean isFocusEditText(View v, int... ids) { if (v instanceof EditText) { EditText tmp_et = (EditText) v; for (int id : ids) { if (tmp_et.getId() == id) { return true; } } } return false; } //æ˜¯å¦è§¦æ‘¸åœ¨æŒ‡å®šviewä¸Šé¢,å¯¹æŸä¸ªæŽ§ä»¶è¿‡æ»¤ public boolean isTouchView(View[] views, MotionEvent ev) { if (views == null || views.length == 0) return false; int[] location = new int[2]; for (View view : views) { view.getLocationOnScreen(location); int x = location[0]; int y = location[1]; if (ev.getX() &gt; x &amp;&amp; ev.getX() &lt; (x + view.getWidth()) &amp;&amp; ev.getY() &gt; y &amp;&amp; ev.getY() &lt; (y + view.getHeight())) { return true; } } return false; } //region å³æ»‘è¿”å›žä¸Šçº§ @Override public boolean dispatchTouchEvent(MotionEvent ev) { if (ev.getAction() == MotionEvent.ACTION_DOWN) { if (isTouchView(filterViewByIds(), ev)) return super.dispatchTouchEvent(ev); if (hideSoftByEditViewIds() == null || hideSoftByEditViewIds().length == 0) return super.dispatchTouchEvent(ev); View v = getCurrentFocus(); if (isFocusEditText(v, hideSoftByEditViewIds())) { //éšè—é”®ç›˜ hideInputForce(this); clearViewFocus(v, hideSoftByEditViewIds()); } } return super.dispatchTouchEvent(ev); } /** * ä¼ å…¥EditTextçš„Id * æ²¡æœ‰ä¼ å…¥çš„EditTextä¸åšå¤„ç† * * @return id æ•°ç»„ */ public int[] hideSoftByEditViewIds() { return null; } /** * ä¼ å…¥è¦è¿‡æ»¤çš„View * è¿‡æ»¤ä¹‹åŽç‚¹å‡»å°†ä¸ä¼šæœ‰éšè—è½¯é”®ç›˜çš„æ“ä½œ * * @return id æ•°ç»„ */ public View[] filterViewByIds() { return null; } /** * des:éšè—è½¯é”®ç›˜,è¿™ç§æ–¹å¼å‚æ•°ä¸ºactivity * * @param activity */ public static void hideInputForce(Activity activity) { if (activity == null || activity.getCurrentFocus() == null) return; ((InputMethodManager) activity.getSystemService(INPUT_METHOD_SERVICE)) .hideSoftInputFromWindow(activity.getCurrentFocus() .getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS); } ä»¥ä¸‹Demoå…¨éƒ¨ä»£ç 1234567891011121314public class MainActivity extends AppCompatActivity &#123;private EditText mEt1;private EditText mEt2;@Overrideprotected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Button btn = (Button) findViewById(R.id.btn); mEt1 = (EditText) findViewById(R.id.et1); mEt2 = (EditText) findViewById(R.id.et2); LinearLayout LL = (LinearLayout) findViewById(R.id.LL); controlKeyboardLayout(this,LL,btn);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123// æŽ§åˆ¶æ˜¯å¦ç§»åŠ¨å¸ƒå±€ã€‚æ¯”å¦‚åªæœ‰å¯†ç è¾“å…¥æ¡†èŽ·å–åˆ°ç„¦ç‚¹æ—¶æ‰æ‰§è¡Œã€‚public boolean flag = true;/** * @param act activiryç”¨äºŽèŽ·å–åº•éƒ¨å¯¼èˆªæ é«˜åº¦ã€‚ * @param root æœ€å¤–å±‚å¸ƒå±€ï¼Œéœ€è¦è°ƒæ•´çš„å¸ƒå±€ * @param scrollToView è¢«é”®ç›˜é®æŒ¡çš„scrollToViewï¼Œæ»šåŠ¨root,ä½¿scrollToViewåœ¨rootå¯è§†åŒºåŸŸçš„åº•éƒ¨ */public void controlKeyboardLayout(Context act, final View root, final View scrollToView) &#123; final int navigationBarHeight = getNavigationBarHeight(act); root.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() &#123; @Override public void onGlobalLayout() &#123; Rect rect = new Rect(); //èŽ·å–rootåœ¨çª—ä½“çš„å¯è§†åŒºåŸŸ root.getWindowVisibleDisplayFrame(rect); //èŽ·å–rootåœ¨çª—ä½“çš„ä¸å¯è§†åŒºåŸŸé«˜åº¦(è¢«å…¶ä»–Viewé®æŒ¡çš„åŒºåŸŸé«˜åº¦) int rootInvisibleHeight = root.getRootView().getHeight() - rect.bottom; //è‹¥ä¸å¯è§†åŒºåŸŸé«˜åº¦å¤§äºŽ100ï¼Œåˆ™é”®ç›˜æ˜¾ç¤º if (rootInvisibleHeight &gt; navigationBarHeight &amp;&amp; flag) &#123; int[] location = new int[2]; //èŽ·å–scrollToViewåœ¨çª—ä½“çš„åæ ‡ scrollToView.getLocationInWindow(location); //è®¡ç®—rootæ»šåŠ¨é«˜åº¦ï¼Œä½¿scrollToViewåœ¨å¯è§åŒºåŸŸ int srollHeight = (location[1] + scrollToView.getHeight()) - rect.bottom; if (root.getScrollY() != 0) &#123;// å¦‚æžœå·²ç»æ»šåŠ¨ï¼Œè¦æ ¹æ®ä¸Šæ¬¡æ»šåŠ¨ï¼Œé‡æ–°è®¡ç®—ä½ç½®ã€‚ srollHeight += root.getScrollY(); &#125; root.scrollTo(0, srollHeight); &#125; else &#123; //é”®ç›˜éšè— root.scrollTo(0, 0); &#125; &#125; &#125;);&#125;/** * èŽ·å–åº•éƒ¨å¯¼èˆªæ é«˜åº¦ * * @param act * @return */private int getNavigationBarHeight(Context act) &#123; Resources resources = act.getResources(); int resourceId = resources.getIdentifier("navigation_bar_height", "dimen", "android"); int height = resources.getDimensionPixelSize(resourceId); Log.v("dbw", "Navi height:" + height); return height;&#125;//è½¯é”®ç›˜æ¶ˆå¤±çš„ç®¡ç†//regionè½¯é”®ç›˜çš„å¤„ç†/** * æ¸…é™¤editTextçš„ç„¦ç‚¹ * * @param v ç„¦ç‚¹æ‰€åœ¨View * @param ids è¾“å…¥æ¡† */public void clearViewFocus(View v, int... ids) &#123; if (null != v &amp;&amp; null != ids &amp;&amp; ids.length &gt; 0) &#123; for (int id : ids) &#123; if (v.getId() == id) &#123; v.clearFocus(); break; &#125; &#125; &#125;&#125;/** * éšè—é”®ç›˜ * * @param v ç„¦ç‚¹æ‰€åœ¨View * @param ids è¾“å…¥æ¡† * @return trueä»£è¡¨ç„¦ç‚¹åœ¨editä¸Š */public boolean isFocusEditText(View v, int... ids) &#123; if (v instanceof EditText) &#123; EditText tmp_et = (EditText) v; for (int id : ids) &#123; if (tmp_et.getId() == id) &#123; return true; &#125; &#125; &#125; return false;&#125;//æ˜¯å¦è§¦æ‘¸åœ¨æŒ‡å®šviewä¸Šé¢,å¯¹æŸä¸ªæŽ§ä»¶è¿‡æ»¤public boolean isTouchView(View[] views, MotionEvent ev) &#123; if (views == null || views.length == 0) return false; int[] location = new int[2]; for (View view : views) &#123; view.getLocationOnScreen(location); int x = location[0]; int y = location[1]; if (ev.getX() &gt; x &amp;&amp; ev.getX() &lt; (x + view.getWidth()) &amp;&amp; ev.getY() &gt; y &amp;&amp; ev.getY() &lt; (y + view.getHeight())) &#123; return true; &#125; &#125; return false;&#125;//region å³æ»‘è¿”å›žä¸Šçº§@Overridepublic boolean dispatchTouchEvent(MotionEvent ev) &#123; if (ev.getAction() == MotionEvent.ACTION_DOWN) &#123; if (isTouchView(filterViewByIds(), ev)) return super.dispatchTouchEvent(ev); if (hideSoftByEditViewIds() == null || hideSoftByEditViewIds().length == 0) return super.dispatchTouchEvent(ev); View v = getCurrentFocus(); if (isFocusEditText(v, hideSoftByEditViewIds())) &#123; //éšè—é”®ç›˜ hideInputForce(this); clearViewFocus(v, hideSoftByEditViewIds()); &#125; &#125; return super.dispatchTouchEvent(ev);&#125; 123456789101112131415161718192021222324252627282930313233343536/** * ä¼ å…¥EditTextçš„Id * æ²¡æœ‰ä¼ å…¥çš„EditTextä¸åšå¤„ç† * * @return id æ•°ç»„ */public int[] hideSoftByEditViewIds() &#123; int [] ids = &#123;R.id.et1,R.id.et2&#125;; return ids;&#125;/** * ä¼ å…¥è¦è¿‡æ»¤çš„View * è¿‡æ»¤ä¹‹åŽç‚¹å‡»å°†ä¸ä¼šæœ‰éšè—è½¯é”®ç›˜çš„æ“ä½œ * * @return id æ•°ç»„ */public View[] filterViewByIds() &#123; View [] views = &#123;mEt1,mEt2&#125;;//ç‚¹å‡»è¿™ä¸¤ä¸ªæŽ§ä»¶,è½¯é”®ç›˜ä¸ä¼šæ¶ˆå¤± return views;&#125;/** * des:éšè—è½¯é”®ç›˜,è¿™ç§æ–¹å¼å‚æ•°ä¸ºactivity * * @param activity */public static void hideInputForce(Activity activity) &#123; if (activity == null || activity.getCurrentFocus() == null) return; ((InputMethodManager) activity.getSystemService(INPUT_METHOD_SERVICE)) .hideSoftInputFromWindow(activity.getCurrentFocus() .getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS);&#125;&#125; ä»¥ä¸‹æ˜¯å¸ƒå±€æ–‡ä»¶12345678910111213141516171819202122232425262728293031323334&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;LinearLayoutxmlns:android="http://schemas.android.com/apk/res/android"xmlns:tools="http://schemas.android.com/tools"android:id="@+id/activity_main"android:layout_width="match_parent"android:layout_height="match_parent"android:orientation="vertical"tools:context="fengan.softinputdemo.MainActivity"&gt;&lt;LinearLayout android:id="@+id/LL" android:layout_marginTop="100dp" android:layout_width="match_parent" android:orientation="vertical" android:layout_height="wrap_content"&gt;&lt;EditText android:id="@+id/et1" android:layout_marginTop="60dp" android:background="#ff0" android:layout_width="match_parent" android:layout_height="60dp"/&gt;&lt;EditText android:id="@+id/et2" android:layout_marginTop="20dp" android:background="#ff0" android:layout_width="match_parent" android:layout_height="60dp"/&gt;&lt;Button android:text="è½¯é”®ç›˜æŒ¡ä½button" android:id="@+id/btn" android:layout_marginTop="30dp" android:layout_width="match_parent" android:layout_height="wrap_content"/&gt;&lt;/LinearLayout&gt; å¯ä»¥å°†éšè—æ˜¾ç¤ºçš„ä»£ç å°è£…åˆ°BaseActivity]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°]]></title>
    <url>%2F2016%2F08%2F21%2F%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87%E5%88%B0%E6%9C%AC%E5%9C%B0%2F</url>
    <content type="text"><![CDATA[ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚,å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°,çŸ«æ­£å›¾ç‰‡è§’åº¦ï¼Œé€šçŸ¥å›¾åº“æ›´æ–° æ­¥éª¤ ä½¿ç”¨GildeèŽ·å–å›¾ç‰‡çš„Drawable Drawableè½¬æˆBitmap bigtmapåŽ‹ç¼©å¹¶é€šè¿‡æµå†™å…¥ é€šçŸ¥ç³»ç»Ÿå›¾åº“æ›´æ–° ä»£ç å— ä¿å­˜å›¾ç‰‡,æµå†™å…¥,åŽ‹ç¼© public static void saveImageToGallery(Context context, Bitmap bmp) { File appDir = new File(Environment.getExternalStorageDirectory(), &quot;fengandev&quot;); if (!appDir.exists()) { appDir.mkdir(); } String fileName = System.currentTimeMillis() + &quot;.jpg&quot;; File file = new File(appDir, fileName); try { FileOutputStream fos = new FileOutputStream(file); bmp.compress(Bitmap.CompressFormat.JPEG, 100, fos); fos.flush(); fos.close(); } catch (FileNotFoundException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } // å…¶æ¬¡æŠŠæ–‡ä»¶æ’å…¥åˆ°ç³»ç»Ÿå›¾åº“ try { MediaStore.Images.Media.insertImage(context.getContentResolver(), file.getAbsolutePath(), fileName, null); } catch (FileNotFoundException e) { e.printStackTrace(); } // æœ€åŽé€šçŸ¥å›¾åº“æ›´æ–° context.sendBroadcast(new Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE, Uri.fromFile(new File(file.getPath())))); ToastUtil.showShort(&quot;ä¿å­˜åˆ°&quot; + file.getPath()); }` é€šè¿‡glideå›žè°ƒ,èŽ·å–å›¾ç‰‡Drawable mTvSave.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { showLoadding(); GlideUtils.loadImage(Utils.getContext(), imaUrl), mIvImg,new GlideUtils.ImageLoadListener&lt;String, GlideDrawable&gt;() { @Override public void onLoadingComplete(String uri, ImageView view, GlideDrawable resource) { FileUtils.saveImageToGallery(Utils.getContext(), BitmapUtils.drawableToBitmap(resource)); } @Override public void onLoadingError(String source, Exception e) { showState(&quot;ä¿å­˜å¤±è´¥&quot;,0); } }); } }); åˆ†äº«ä¸€ä¸ªGlideå°è£… Glideå°è£…ç±» public abstract class GlideUtils { /** * ç®€å•å›¾ç‰‡åŠ è½½å›žè°ƒ * * @param &lt;T&gt; å›¾ç‰‡url æˆ–èµ„æºid æˆ– æ–‡ä»¶ * @param &lt;K&gt; è¿”å›žçš„èµ„æº,GlideDrawableæˆ–è€…Bitmapæˆ–è€…GifDrawable,ImageView.setImageRecourseè®¾ç½® */ public interface ImageLoadListener&lt;T, K&gt; { /** * å›¾ç‰‡åŠ è½½æˆåŠŸå›žè°ƒ * * @param uri å›¾ç‰‡url æˆ–èµ„æºid æˆ– æ–‡ä»¶ * @param view ç›®æ ‡è½½ä½“ï¼Œä¸ä¼ åˆ™ä¸ºç©º * @param resource è¿”å›žçš„èµ„æº,GlideDrawableæˆ–è€…Bitmapæˆ–è€…GifDrawable,ImageView.setImageRecourseè®¾ç½® */ void onLoadingComplete(T uri, ImageView view, K resource); /** * å›¾ç‰‡åŠ è½½å¼‚å¸¸è¿”å›ž * * @param source å›¾ç‰‡åœ°å€ã€Fileã€èµ„æºid * @param e å¼‚å¸¸ä¿¡æ¯ */ void onLoadingError(T source, Exception e); } /** * è¯¦ç»†åŠ è½½å›¾ç‰‡åŠ è½½å›žè°ƒ * * @param &lt;T&gt; å›¾ç‰‡url æˆ–èµ„æºid æˆ– æ–‡ä»¶ * @param &lt;K&gt; è¿”å›žçš„èµ„æº */ public interface ImageLoadDetailListener&lt;T, K&gt; { /** * å›¾ç‰‡åŠ è½½æˆåŠŸå›žè°ƒ * * @param uri å›¾ç‰‡url æˆ–èµ„æºid æˆ– æ–‡ä»¶ * @param view ç›®æ ‡è½½ä½“ï¼Œä¸ä¼ åˆ™ä¸ºç©º * @param resource è¿”å›žçš„èµ„æº,GlideDrawableæˆ–è€…Bitmapæˆ–è€…GifDrawable,ImageView.setImageRecourseè®¾ç½® */ void onLoadingComplete(T uri, ImageView view, K resource); /** * å›¾ç‰‡åŠ è½½å¼‚å¸¸è¿”å›ž * * @param source å›¾ç‰‡åœ°å€ã€Fileã€èµ„æºid * @param errorDrawable åŠ è½½é”™è¯¯å ä½å›¾ * @param e å¼‚å¸¸ä¿¡æ¯ */ void onLoadingError(T source, Drawable errorDrawable, Exception e); /** * åŠ è½½å¼€å§‹ * * @param source å›¾ç‰‡æ¥æº * @param placeHolder å¼€å§‹åŠ è½½å ä½å›¾ */ void onLoadingStart(T source, Drawable placeHolder); } /** * æ ¹æ®ä¸Šä¸‹æ–‡å’Œ urlèŽ·å– Glideçš„DrawableTypeRequest * * @param context ä¸Šä¸‹æ–‡ * @param url å›¾ç‰‡è¿žæŽ¥ * @param &lt;T&gt; Contextç±»åž‹ * @param &lt;K&gt; urlç±»åž‹ * @return è¿”å›žDrawableTypeRequst&lt;K&gt; ç±»åž‹ */ private static &lt;T, K&gt; DrawableTypeRequest&lt;K&gt; getDrawableTypeRequest(T context, K url) { DrawableTypeRequest&lt;K&gt; type = null; try { if (context instanceof android.support.v4.app.Fragment) { type = Glide.with((android.support.v4.app.Fragment) context).load(url); } else if (context instanceof android.app.Fragment) { type = Glide.with((android.app.Fragment) context).load(url); } else if (context instanceof Activity) { //åŒ…æ‹¬FragmentActivity type = Glide.with((Activity) context).load(url); } else if (context instanceof Context) { type = Glide.with((Context) context).load(url); } } catch (Exception e) { e.printStackTrace(); } return type; } /** * å›¾ç‰‡åŠ è½½ç›‘å¬ç±» * * @param &lt;T&gt; å›¾ç‰‡é“¾æŽ¥ çš„ç±»åž‹ * @param &lt;K&gt; å›¾ç‰‡èµ„æºè¿”å›žç±»åž‹ * @param &lt;Z&gt; è¿”å›žçš„å›¾ç‰‡url */ private static class GlideListener&lt;T, K, Z&gt; implements RequestListener&lt;T, K&gt; { ImageLoadListener&lt;Z, K&gt; imageLoadListener = null; Z url; ImageView imageView = null; GlideListener(ImageLoadListener&lt;Z, K&gt; imageLoadListener, Z url, ImageView view) { this.imageLoadListener = imageLoadListener; this.url = url; this.imageView = view; } GlideListener(ImageLoadListener&lt;Z, K&gt; imageLoadListener, Z url) { this.imageLoadListener = imageLoadListener; this.url = url; } GlideListener(Z url) { this.url = url; } @Override public boolean onResourceReady(K resource, T model, Target&lt;K&gt; target, boolean isFromMemoryCache, boolean isFirstResource) { if (null != imageLoadListener) { if (imageView != null) { imageLoadListener.onLoadingComplete(url, imageView, resource); } else { imageLoadListener.onLoadingComplete(url, null, resource); } } return false; } @Override public boolean onException(Exception e, T model, Target&lt;K&gt; target, boolean isFirstResource) { //LogUtil.e(&quot;Glideå›¾ç‰‡åŠ è½½å¤±è´¥:&quot;+e + &quot; åœ°å€ä¸º:&quot;+url); if (imageLoadListener != null) { imageLoadListener.onLoadingError(url, e); } return false; } } /** * èŽ·å–å­˜å‚¨å™¨ä¸Šçš„å›¾ç‰‡,å›žè°ƒè¿”å›žGlideDrawable * * @param context ä¸Šä¸‹æ–‡å¹´ * @param file æ–‡ä»¶File * @param imageLoadListener å›žè°ƒç›‘å¬å™¨ */ public static &lt;T&gt; DrawableRequestBuilder&lt;File&gt; loadImage(T context, @NonNull File file, @NonNull ImageLoadListener&lt;File, GlideDrawable&gt; imageLoadListener) { DrawableTypeRequest&lt;File&gt; type = getDrawableTypeRequest(context, file); if (type != null) { return type.listener(new GlideListener&lt;File, GlideDrawable, File&gt;(imageLoadListener, file)); } else { return null; } } /** * èŽ·å–èµ„æºä¸­çš„å›¾ç‰‡ï¼Œå›žè°ƒè¿”å›žGlideDrawable * * @param context ä¸Šä¸‹æ–‡ * @param resourceId èµ„æºid * @param imageLoadListener å›žè°ƒç›‘å¬å™¨ */ public static &lt;T&gt; DrawableRequestBuilder&lt;Integer&gt; loadImage(T context, @DrawableRes int resourceId, @NonNull ImageLoadListener&lt;Integer, GlideDrawable&gt; imageLoadListener) { DrawableTypeRequest&lt;Integer&gt; type = getDrawableTypeRequest(context, resourceId); if (type != null) { return type.listener(new GlideListener&lt;Integer, GlideDrawable, Integer&gt;(imageLoadListener, resourceId)); } else { return null; } } /** * èŽ·å–ç½‘ç»œå›¾ç‰‡ï¼Œå›žè°ƒè¿”å›ž GlideDrawable * * @param context ä¸Šä¸‹æ–‡ * @param url å›¾ç‰‡url * @param imageLoadListener å›žè°ƒç›‘å¬å™¨ */ public static &lt;T&gt; DrawableRequestBuilder&lt;String&gt; loadImage(T context, @NonNull final String url, @NonNull ImageLoadListener&lt;String, GlideDrawable&gt; imageLoadListener) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(context, url); if (type != null) { return type.listener(new GlideListener&lt;String, GlideDrawable, String&gt;(imageLoadListener, url)); } else { return null; } } /** * åŠ è½½å­˜å‚¨å™¨ä¸Šçš„å›¾ç‰‡åˆ°ç›®æ ‡è½½ä½“ * * @param file æ–‡ä»¶File * @param imageView è¦æ˜¾ç¤ºåˆ°çš„å›¾ç‰‡ImageView */ public static Target&lt;GlideDrawable&gt; loadImage(@NonNull final File file, @NonNull ImageView imageView, ImageLoadListener&lt;File, GlideDrawable&gt; imageLoadListener) { return getDrawableTypeRequest(imageView.getContext(), file) .diskCacheStrategy(DiskCacheStrategy.NONE)//ç¦ç”¨ç£ç›˜ç¼“å­˜ .skipMemoryCache(true)//è·³è¿‡å†…å­˜ç¼“å­˜ .dontAnimate() .listener(new GlideListener&lt;File, GlideDrawable, File&gt;(imageLoadListener, file, imageView)) .into(imageView); } /** * åŠ è½½èµ„æºä¸­çš„å›¾ç‰‡åˆ°ç›®æ ‡è½½ä½“ * * @param resourceId èµ„æºid * @param imageView å›¾ç‰‡View */ public static Target&lt;GlideDrawable&gt; loadImage(@DrawableRes int resourceId, @NonNull ImageView imageView, ImageLoadListener&lt;Integer, GlideDrawable&gt; imageLoadListener) { return getDrawableTypeRequest(imageView.getContext(), resourceId) .listener(new GlideListener&lt;Integer, GlideDrawable, Integer&gt;(imageLoadListener, resourceId, imageView)) .into(imageView); } /** * åŠ è½½æˆåœ†å½¢å¤´åƒåˆ°æ™®é€šImageViewï¼Œæœ‰åŠ¨ç”»æ•ˆæžœ * * @param url å›¾ç‰‡url * @param imageView è¦æ˜¾ç¤ºåˆ°çš„ImageView * @param imageLoadListener åŠ è½½å›žè°ƒç›‘å¬å™¨ * @param parms è®¾ç½®å ä½ç¬¦å’ŒåŠ è½½å¤±è´¥å›¾ç‰‡(å¯å˜å‚æ•°é»˜è®¤ä¸¤å¼ ,ç¬¬ä¸€å¼ ä¸ºå ä½ç¬¦,ç¬¬äºŒå¼ æ˜¯é»˜è®¤å›¾ç‰‡) * @return è¿”å›žTarget&lt;GlideDrawable&gt; */ public static Target&lt;GlideDrawable&gt; loadCircleImage(@NonNull String url, @NonNull ImageView imageView, ImageLoadListener&lt;String, GlideDrawable&gt; imageLoadListener, int... parms) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(imageView.getContext(), url); if (parms != null &amp;&amp; parms.length &gt; 0) { type.placeholder(parms[0]); //å ä½ç¬¦ if (parms.length &gt; 1) { type.error(parms[1]); //å›¾ç‰‡åŠ è½½å¤±è´¥æ˜¾ç¤ºå›¾ç‰‡ } } type.transform(new CircleTransform(imageView.getContext())); return type.listener(new GlideListener&lt;String, GlideDrawable, String&gt;(imageLoadListener, url, imageView)) .into(imageView); } /** * åŠ è½½ç½‘ç»œå›¾ç‰‡åˆ°æŒ‡å®šImageviewï¼Œæ”¯æŒCircleImageView * * @param url å›¾ç‰‡url * @param imageView è¦æ˜¾ç¤ºçš„Imageview * @param imageLoadListener å›¾ç‰‡åŠ è½½å›žè°ƒ * @param parms ç¬¬ä¸€ä¸ªæ˜¯errorçš„å›¾ç‰‡ */ public static &lt;T&gt; Target&lt;GlideDrawable&gt; loadImage(T context, @NonNull String url, @NonNull ImageView imageView, ImageLoadListener&lt;String, GlideDrawable&gt; imageLoadListener, int... parms) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(context, url); if (type != null) { type.asBitmap(); if (parms != null &amp;&amp; parms.length &gt; 0) { type.placeholder(parms[0]); //å ä½ç¬¦ if (parms.length &gt; 1) { type.error(parms[1]); //å›¾ç‰‡åŠ è½½å¤±è´¥æ˜¾ç¤ºå›¾ç‰‡ } } //å•å¼ CircleImageViewä¸å…è®¸åŠ¨ç”»ï¼Œä¸ç„¶ä¼šä¸æ˜¾ç¤º, if (imageView instanceof nfzr.zr.nf.nfzr.com.nongfaziran.nfzr.view.CircleImageView) { type.dontAnimate(); } return type .listener(new GlideListener&lt;String, GlideDrawable, String&gt;(imageLoadListener, url, imageView)) .into(imageView); } else { return null; } } /** * åŠ è½½ä¸€å¸§è§†é¢‘ï¼Œæ·»åŠ åœ†è§’ * * @param url å›¾ç‰‡åœ°å€ * @param imageView è¦åŠ è½½åˆ°çš„ImageView */ public static Target&lt;GlideDrawable&gt; loadImageFormVideo(@NonNull String url, @NonNull ImageView imageView) { return getDrawableTypeRequest(imageView.getContext(), url) .override(SizeUtil.dp2px(150), SizeUtil.dp2px(150)) //.placeholder(android.R.drawable.picture_frame) //å ä½å›¾ .dontAnimate() .into(imageView); } public static &lt;T&gt; Target&lt;GlideDrawable&gt; loadImageDetail(final T context, @NonNull final String url, @NonNull final ImageView imageView, final Drawable drawable, final ImageLoadDetailListener&lt;String, GlideDrawable&gt; imageLoadListener) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(context, url); if (type != null) { return type.into(new SimpleTarget&lt;GlideDrawable&gt;() { @Override public void onResourceReady(GlideDrawable resource, GlideAnimation&lt;? super GlideDrawable&gt; glideAnimation) { if (imageView != null &amp;&amp; resource != null) { imageView.setImageDrawable(resource); } if (imageLoadListener != null) { imageLoadListener.onLoadingComplete(url, imageView, resource); } } @Override public void onStart() { super.onStart(); if (drawable != null &amp;&amp; imageView != null) { imageView.setImageDrawable(drawable); } } @Override public void onLoadStarted(Drawable placeholder) { super.onLoadStarted(placeholder); if (imageLoadListener != null) { imageLoadListener.onLoadingStart(url, placeholder); } } @Override public void onLoadFailed(Exception e, Drawable errorDrawable) { super.onLoadFailed(e, errorDrawable); if (imageLoadListener != null) { imageLoadListener.onLoadingError(url, errorDrawable, e); } } }); } else { return null; } } /** * åŠ è½½bitmapï¼Œå›žè°ƒè¿”å›ž Bitmap * * @param context ä¸Šä¸‹æ–‡ * @param url å›¾ç‰‡url * @param imageLoadListener å›¾ç‰‡åŠ è½½ç›‘å¬å™¨ * @param &lt;T&gt; ä¸Šä¸‹æ–‡ç±»åž‹ */ public static &lt;T&gt; BitmapRequestBuilder&lt;String, Bitmap&gt; loadImageBitmap(T context, @NonNull String url,@NonNull ImageLoadListener&lt;String, Bitmap&gt; imageLoadListener) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(context, url); if (type != null) { return type.asBitmap() .listener(new GlideListener&lt;String, Bitmap, String&gt;(imageLoadListener, url)); }else{ return null; } } /** * åŠ è½½GifDrawableï¼Œå›žè°ƒè¿”å›ž GifDrawable * * @param context ä¸Šä¸‹æ–‡ * @param url å›¾ç‰‡url * @param imageLoadListener å›¾ç‰‡åŠ è½½ç›‘å¬å™¨ */ public static &lt;T&gt; GifRequestBuilder&lt;String&gt; loadImageGif(T context, @NonNull String url,@NonNull ImageLoadListener&lt;String, GifDrawable&gt; imageLoadListener) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(context, url); if (type != null) { return type.asGif() .diskCacheStrategy(DiskCacheStrategy.SOURCE) .listener(new GlideListener&lt;String, GifDrawable, String&gt;(imageLoadListener, url)); }else{ return null; } } /** * åŠ è½½Gifçš„ä¸€å¼ å›¾ç‰‡åˆ°ImageView * * @param url å›¾ç‰‡url * @param imageLoadListener å›¾ç‰‡åŠ è½½ç›‘å¬å™¨ * @param imageView * @param drawable ç¼©ç•¥å›¾ï¼Œå¯ä»¥ä¸ºç©º */ public static Target&lt;Bitmap&gt; loadImageGifSingle(@NonNull String url, @NonNull ImageView imageView, ImageLoadListener&lt;String, Bitmap&gt; imageLoadListener, Drawable drawable) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(imageView.getContext(),url); return type.asBitmap() .placeholder(drawable) .diskCacheStrategy(DiskCacheStrategy.SOURCE) .listener(new GlideListener&lt;String, Bitmap, String&gt;(imageLoadListener, url)) .into(imageView); } /** * åŠ è½½gifå›¾ç‰‡åˆ°æŒ‡å®šImageView * * @param url å›¾ç‰‡Url * @param imageView å›¾ç‰‡View * @param imageLoadListener å›¾ç‰‡åŠ è½½ç›‘å¬å™¨ */ public static Target&lt;GifDrawable&gt; loadImageGif(@NonNull String url, @NonNull ImageView imageView, ImageLoadListener&lt;String, GifDrawable&gt; imageLoadListener) { DrawableTypeRequest&lt;String&gt; type = getDrawableTypeRequest(imageView.getContext(),url); return type.asGif() .diskCacheStrategy(DiskCacheStrategy.SOURCE) .listener(new GlideListener&lt;String, GifDrawable, String&gt;(imageLoadListener, url, imageView)) .into(imageView); } /** * é‡Šæ”¾å†…å­˜ * * @param context ä¸Šä¸‹æ–‡ */ public static void clearMemory(Context context) { Glide.get(context).clearMemory(); } /** * å–æ¶ˆæ‰€æœ‰æ­£åœ¨ä¸‹è½½æˆ–ç­‰å¾…ä¸‹è½½çš„ä»»åŠ¡ã€‚ * * @param context ä¸Šä¸‹æ–‡ */ public static void cancelAllTasks(Context context) { Glide.with(context).pauseRequests(); } /** * æ¢å¤æ‰€æœ‰ä»»åŠ¡ */ public static void resumeAllTasks(Context context) { Glide.with(context).resumeRequests(); } /** * æ¸…é™¤ç£ç›˜ç¼“å­˜ * * @param context ä¸Šä¸‹æ–‡ */ public static void clearDiskCache(final Context context) { new Thread(new Runnable() { @Override public void run() { Glide.get(context).clearDiskCache(); } }).start(); } /** * æ¸…é™¤æ‰€æœ‰ç¼“å­˜ * * @param context ä¸Šä¸‹æ–‡ */ public static void cleanAll(Context context) { clearDiskCache(context); clearMemory(context); } public class CircleTransform extends BitmapTransformation { public CircleTransform(Context context) { super(context); } @Override protected Bitmap transform(BitmapPool pool, Bitmap toTransform, int outWidth, int outHeight) { return circleCrop(pool, toTransform); } private static Bitmap circleCrop(BitmapPool pool, Bitmap source) { if (source == null) return null; int size = Math.min(source.getWidth(), source.getHeight()); int x = (source.getWidth() - size) / 2; int y = (source.getHeight() - size) / 2; Bitmap squared = Bitmap.createBitmap(source, x, y, size, size); Bitmap result = pool.get(size, size, Bitmap.Config.ARGB_8888); if (result == null) { result = Bitmap.createBitmap(size, size, Bitmap.Config.ARGB_8888); } Canvas canvas = new Canvas(result); Paint paint = new Paint(); paint.setShader(new BitmapShader(squared, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP)); paint.setAntiAlias(true); float r = size / 2f; canvas.drawCircle(r, r, r, paint); return result; } @Override public String getId() { return getClass().getName(); } } Drawableè½¬bigmap public class BitmapUtils { public static Bitmap drawableToBitmap(Drawable drawable) { Bitmap bitmap = Bitmap.createBitmap( drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight(), drawable.getOpacity() != PixelFormat.OPAQUE ? Bitmap.Config.ARGB_8888 : Bitmap.Config.RGB_565); Canvas canvas = new Canvas(bitmap); //canvas.setBitmap(bitmap); drawable.setBounds(0, 0, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight()); drawable.draw(canvas); return bitmap; } }]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android7.0ä¹‹åº”ç”¨é—´å…±äº«æ–‡ä»¶]]></title>
    <url>%2F2016%2F07%2F23%2FAndroid7-0%E4%B9%8B%E5%BA%94%E7%94%A8%E9%97%B4%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[Android7.0é€‚é…ä¹‹åº”ç”¨é—´å…±äº«æ–‡ä»¶ å‡ºçŽ°é—®é¢˜Android N(API 25),æ‰“å¼€ç›¸å†Œç¼–è¾‘é¡µé¢crash,æŠ¥å‡ºFileUriExposedExceptionå¼‚å¸¸ 123456789android.os.FileUriExposedException: file:////storage/emulated/0/temp/1474956193735.jpg exposed beyond app through Intent.getData()at android.os.StrictMode.onFileUriExposed(StrictMode.java:1799)at android.net.Uri.checkFileUriExposed(Uri.java:2346)at android.content.Intent.prepareToLeaveProcess(Intent.java:8933)at android.content.Intent.prepareToLeaveProcess(Intent.java:8894)at android.app.Instrumentation.execStartActivity(Instrumentation.java:1517)at android.app.Activity.startActivityForResult(Activity.java:4223)...at android.app.Activity.startActivityForResult(Activity.java:4182) æŸ¥æ‰¾åŽŸå› Android Nçš„åº”ç”¨,APIç¦æ­¢å‘åº”ç”¨å¤–å…¬å¼€file://URI,å¦‚æžœä¸€é¡¹åŒ…å«æ–‡ä»¶URIçš„Intentç¦»å¼€åº”ç”¨, åº”ç”¨crashå¹¶æŠ¥FileUriExposedExceptionå¼‚å¸¸ è§£å†³åŠžæ³•è‹¥æƒ³è¦åœ¨åº”ç”¨é—´å…±äº«æ–‡ä»¶,åº”è¯¥å‘é€ä¸€é¡¹content://URI,å¹¶è¯¥URIä¸´æ—¶è®¿é—®æƒé™,è¿›è¡Œæ­¤æŽˆæƒçš„æ–¹å¼æ˜¯é€šè¿‡FileProviderç±» å…·ä½“æ­¥éª¤[1] æ¸…å•æ–‡ä»¶123456789101112131415161718192021222324252627282930 &lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.fengan.providerdemo"&gt; &lt;application android:allowBackup="true" android:icon="@mipmap/ic_launcher" android:label="@string/app_name" android:supportsRtl="true" android:theme="@style/AppTheme"&gt; &lt;activity android:name=".MainActivity"&gt; &lt;intent-filter&gt; &lt;action android:name="android.intent.action.MAIN" /&gt; &lt;category android:name="android.intent.category.LAUNCHER" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;!--authorities="ä½ çš„åŒ…å+fileprovider" --&gt; &lt;provider android:authorities="com.fengan.providerdemo.fileprovider" android:name="android.support.v4.content.FileProvider" android:grantUriPermissions="true" android:exported="false"&gt; &lt;meta-data android:name="android.support.FILE_PROVIDER_PATHS" android:resource="@xml/filepaths"/&gt; &lt;/provider&gt; &lt;/application&gt;&lt;/manifest&gt; [2] resä¸‹xmlæ–‡ä»¶å¤¹æ³¨æ„xmlæ–‡ä»¶åå’Œæ¸…å•æ–‡ä»¶ä¸­@xml/filepathsç›¸åŒxmlæ–‡ä»¶å†…å®¹ 123456 &lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;paths&gt; &lt;!-- external-path:sd ï¼›path:ä½ çš„åº”ç”¨ä¿å­˜æ–‡ä»¶çš„æ ¹ç›®å½•ï¼›nameéšä¾¿å®šä¹‰--&gt; //&lt;external-path path="fengan_imgs/" name="files_path" /&gt; &lt;external-path path="" name="files_path" /&gt;&lt;/paths&gt; æ³¨æ„:path=â€â€,æœ‰ç‰¹æ®Šæ„ä¹‰,å®ƒä»£è¡¨æ›´ç›®å½•,ä¹Ÿå°±æ˜¯è¯´å¯ä»¥å‘åº”ç”¨å…±äº«æ ¹ç›®å½•åŠå…¶å­ç›®å½•ä¸‹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶,å¦‚æžœå°†pathå†™ä¸ºpath=â€fengan_imgs/â€œ,é‚£ä¹ˆåªèƒ½åœ¨fengan_imgs/ç›®å½•ä¸‹æ‰å¯ä»¥åˆ†äº«![3]æ ¸å¿ƒä»£ç å°†Fileè½¬æ¢ä¸ºuri 12345678910111213private static Uri getUriForFile(Context context, File file) &#123; if (context == null || file == null) &#123; throw new NullPointerException(); &#125; Uri uri; if (Build.VERSION.SDK_INT &gt;= 24) &#123; //å’Œandroid:authorities="com.fengan.providerdemo.fileprovider"å¯¹åº” uri = FileProvider.getUriForFile(context.getApplicationContext(), "com.fengan.providerdemo.fileprovider", file); &#125; else &#123; uri = Uri.fromFile(file); &#125; return uri; &#125; Uriçš„schemeç±»åž‹ä¸ºfile,æ”¹æˆäº†åˆFileProvideråˆ›å»ºä¸€ä¸ªcontentç±»åž‹çš„Uriæ‰“å¼€ç›¸æœº,æ‰“å°è¯¥Uriä¸ºcontent://com.fengan.providerdemo/files_path/temp/1474960080319.jpg`ã€‚//å…¶ä¸­camera_photoså°±æ˜¯file_paths.xmlä¸­pathsçš„nameã€‚ 1234567891011121314151617/** * æ‰“å¼€ç›¸æœº * å…¼å®¹7.0 * * @param activity Activity * @param file File * @param requestCode result requestCode */ public static void startActionCapture(Activity activity, File file, int requestCode) &#123; if (activity == null) &#123; return; &#125; Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE); intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION); //æ·»åŠ è¿™ä¸€å¥è¡¨ç¤ºå¯¹ç›®æ ‡åº”ç”¨ä¸´æ—¶æŽˆæƒè¯¥Uriæ‰€ä»£è¡¨çš„æ–‡ä»¶ intent.putExtra(MediaStore.EXTRA_OUTPUT, getUriForFile(activity, file));//æ‹å–ç…§ç‰‡ä¿å­˜åˆ°æŒ‡å®šUri activity.startActivityForResult(intent, requestCode); &#125; æ€»ç»“ é’ˆå¯¹æ¶‰åŠåˆ°ä»ŽAndroidè®¾å¤‡ä¸ŠèŽ·å–ç…§ç‰‡(æ‹ç…§,æˆ–ä»Žç›¸å†Œ,æ–‡ä»¶ä¸­é€‰æ‹©)æ‰“å¼€ç›¸æœº,è£å‰ªå›¾ç‰‡,åŽ‹ç¼©å›¾ç‰‡,å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè½»é‡çº§å¼€æºåº“,TakePhoto! https://github.com/crazycodeboy/TakePhoto/]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[appå¯åŠ¨æµç¨‹ç®€æž]]></title>
    <url>%2F2016%2F03%2F16%2Fapp%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E7%AE%80%E6%9E%90%2F</url>
    <content type="text"><![CDATA[å‰è¨€ Androidç³»ç»Ÿä¸­ï¼Œåº”ç”¨ç¨‹åºæ˜¯ç”±Activityç»„æˆçš„ï¼Œå› æ­¤ï¼Œåº”ç”¨ç¨‹åºçš„å¯åŠ¨è¿‡ç¨‹å®žé™…ä¸Šå°±è¯´åº”ç”¨ç¨‹åºä¸­é»˜è®¤Activityçš„å¯åŠ¨è¿‡ç¨‹ï¼Œæœ¬æ–‡ä¸»è¦æ•´ç†å†·å¯åŠ¨çš„æƒ…å†µã€‚]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webviewä¸­ç‚¹å‡»ç½‘é¡µå›¾ç‰‡è·³è½¬æŸ¥çœ‹å›¾ç‰‡]]></title>
    <url>%2F2016%2F03%2F08%2Fwebview%E4%B8%AD%E7%82%B9%E5%87%BB%E7%BD%91%E9%A1%B5%E5%9B%BE%E7%89%87%E8%B7%B3%E8%BD%AC%E6%9F%A5%E7%9C%8B%E5%9B%BE%E7%89%87%2F</url>
    <content type="text"><![CDATA[å‰è¨€ appä¸­å¾ˆå¤šå›¾æ–‡é¡µé¢ï¼Œç±»ä¼¼æ–°é—»è¯¦æƒ…é¡µï¼Œéƒ½æ˜¯ä¸€ä¸ªH5ç½‘é¡µï¼Œå½“æˆ‘ä»¬ç‚¹å‡»ç½‘é¡µä¸­çš„å›¾ç‰‡ï¼Œå¸Œæœ›è·³è½¬åˆ°ä¸€ä¸ªå¤šå›¾æ¸¸è§ˆçš„é¡µé¢ï¼Œå¹¶ä¸”æ”¯æŒæ‰‹åŠ¿ç¼©æ”¾å’Œä¿å­˜çš„ä¸€äº›åŠŸèƒ½ã€‚ä»Šå¤©ä¸»è¦æ•´ç†ä¸€ä¸‹ç‚¹å‡»ç½‘é¡µä¸­å›¾ç‰‡ï¼Œè·³è½¬åˆ°æŒ‡å®šå›¾ç‰‡çš„æŸ¥çœ‹é¡µé¢å³å¯ï¼Œæ‰‹åŠ¿ç¼©æ”¾å¯ä»¥ä½¿ç”¨photoviewã€‚ åŽŸç†æ•ˆæžœ åŽŸç† é¦–å…ˆç‚¹å‡»h5é¡µé¢ï¼Œè·³è½¬æœ¬åœ°é¡µé¢ï¼Œæ˜¯jsè°ƒç”¨åŽŸç”Ÿä»£ç  Jsé€šè¿‡WebViewè°ƒç”¨Androidä»£ç æœ‰ä¸‰ç§æ–¹å¼ é€šè¿‡WebViewçš„addJavascriptInterfaceï¼ˆï¼‰è¿›è¡Œå¯¹è±¡æ˜ å°„ é€šè¿‡ WebViewClient çš„shouldOverrideUrlLoading ()æ–¹æ³•å›žè°ƒæ‹¦æˆª url é€šè¿‡ WebChromeClient çš„onJsAlert()ã€onJsConfirm()ã€onJsPromptï¼ˆï¼‰æ–¹æ³•å›žè°ƒæ‹¦æˆªJSå¯¹è¯æ¡†alert()ã€confirm()ã€promptï¼ˆï¼‰ æ¶ˆæ¯ é€šè¿‡addJavascriptInterfaceå®šä¹‰jsæŽ¥å£çš„æ–¹å¼æ¯”è¾ƒæ–¹ä¾¿ï¼Œæ‰€ä»¥æœ¬æ–‡é‡‡ç”¨çš„æ˜¯è¿™ç§æ–¹å¼ï¼Œè¯¦ç»†è§ä¸‹åˆ—ä»£ç  å®šä¹‰jsæŽ¥å£ æ‰¾åˆ°ç½‘é¡µä¸­imgæ ‡ç­¾çš„ä»£ç å—ï¼Œè®¾ç½®ç‚¹å‡» ç›¸å…³æƒé™å’Œæ··æ·† ä»£ç å®šä¹‰jsæŽ¥å£1234567891011121314151617181920212223242526272829** * Created by fengan on 2016/3/8. * email:fengan1102@gmail.com * ç‚¹å‡»webviewé¡µé¢å›¾ç‰‡ï¼Œè·³è½¬æŸ¥çœ‹å¤§å›¾é¡µé¢çš„jsæŽ¥å£ * æ£€æŸ¥æ··æ·†æ–‡ä»¶ï¼Œç¡®ä¿æœªè¢«æ··æ·† */public class JavaScriptInterface &#123; private Activity mContext; private ArrayList&lt;String&gt; mImgList = new ArrayList&lt;&gt;(); public JavaScriptInterface(Activity context) &#123; this.mContext = context; &#125;//æ–¹æ³•åè¦å’Œæ‰§è¡Œçš„jsä»£ç ä¸­ä¸€è‡´ @JavascriptInterface public void addImageUrl(String img) &#123; mImgList.add(img); &#125; @JavascriptInterface public void openImage(String img) &#123; if (ClickUtils.noDoubleClick()) &#123; int index = mImgList.indexOf(img); PhotoListAty.startAty(index == -1 ? 0 : index, mImgList, mContext); &#125; &#125;&#125; è‡ªå®šä¹‰WebClient1234567891011121314151617181920212223242526272829303132333435363738394041public class MyWebViewClient extends WebViewClient &#123; @Override public void onPageFinished(WebView view, String url) &#123; view.getSettings().setJavaScriptEnabled(true); super.onPageFinished(view, url); addImageClickListener(view);//å¾…ç½‘é¡µåŠ è½½å®Œå…¨åŽè®¾ç½®å›¾ç‰‡ç‚¹å‡»çš„ç›‘å¬æ–¹æ³• &#125; @Override public void onPageStarted(WebView view, String url, Bitmap favicon) &#123; view.getSettings().setJavaScriptEnabled(true); super.onPageStarted(view, url, favicon); &#125; private void addImageClickListener(WebView webView) &#123; webView.loadUrl("javascript:(function()&#123;" + "var objs = document.getElementsByTagName(\"img\"); " + "for(var i=0;i&lt;objs.length;i++) " + "&#123;" + "window.imagelistener.addImageUrl(objs[i].src); " + " objs[i].onclick=function() " + " &#123; " + " window.imagelistener.openImage(this.src); " + " &#125; " + "&#125;" + "&#125;)()"); &#125; 1234//imagelistenerç”¨äºŽæš´éœ²jsçš„å¯¹è±¡ï¼Œéœ€è¦å¯¹åº” mWebview.getSettings().setJavaScriptEnabled(true); mWebview.addJavascriptInterface(new JavaScriptInterface(this), "imagelistener"); mWebview.setWebViewClient(new MyWebViewClient()); æ³¨æ„äº‹é¡¹æ³¨æ„åœ¨æ··æ·†æ–‡ä»¶ä¸­æ·»åŠ  é¡¹ç›®ä¸­æš´éœ²çš„jsæŽ¥å£ç±»ï¼šMJavascriptInterfaceä¸èƒ½æ··æ·†ï¼Œå…¶è°ƒç”¨çš„æ–¹æ³•çš„å£°æ˜Žä¹Ÿä¸èƒ½æ··æ·†ï¼Œæ‰€ä»¥è¿˜è¦æ·»åŠ å¦‚ä¸‹æ··æ·†è®¾ç½®ä»£ç ï¼ˆä»£ç å› åŒ…åè€Œå˜åŒ–ï¼‰ 123456-keepclassmembers class com.example.administrator.webviewpagescannerapp.other.MJavascriptInterface&#123; public *; &#125; -keepattributes *Annotation* -keepattributes *JavascriptInterface*]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äº§ç”Ÿ65535çš„åŽŸå› å’Œè§£å†³åŠžæ³•]]></title>
    <url>%2F2016%2F03%2F06%2F%E4%BA%A7%E7%94%9F65535%E7%9A%84%E5%8E%9F%E5%9B%A0%E5%92%8C%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%2F</url>
    <content type="text"><![CDATA[Androidå…³äºŽ65535çš„é—®é¢˜ ç†Ÿæ‚‰Androidå¼€å‘çš„éƒ½çŸ¥é“ï¼Œåœ¨ç”ŸæˆDexè¿‡ç¨‹ä¸­ï¼Œæ–¹æ³•æ•°è¶…è¿‡65535å°±ä¼šæŠ¥é”™ï¼Œæœ¬æ–‡åªç®€è¿°ä¸€ä¸‹å¦‚ä½•è§£å†³ï¼Œæ›´é‡è¦çš„æ˜¯ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨DalvikæŒ‡ä»¤é›†ä¸­ï¼Œè°ƒç”¨æ–¹æ³•çš„invoke-kindæŒ‡ä»¤ä¸­ï¼Œmethod reference indexåªç»™äº†16bitsï¼Œæœ€å¤šèƒ½è°ƒç”¨65535ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨ç”Ÿæˆdexæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå½“æ–¹æ³•æ•°è¶…è¿‡65535å°±ä¼šæŠ¥é”™ã€‚å…¶å®žé™¤äº†methodï¼Œfiledå’Œclassçš„indexä¹Ÿæ˜¯16bitsï¼Œæ‰€ä»¥ä¹Ÿä¼šå­˜åœ¨65535çš„é—®é¢˜ï¼Œåªä¸è¿‡methodçš„æ•°é‡ä¸€èˆ¬æ˜¯æœ€å¤šçš„ï¼Œæ‰€ä»¥æœ€å¸¸è§çš„ä¹Ÿæ˜¯æ–¹æ³•æ•°æº¢å‡ºçš„é—®é¢˜ã€‚ å¯¼å…¥multidexåŒ…ï¼Œé…ç½®gradleæ–‡ä»¶multiDexEnabled true implementation &#39;com.android.support:multidex:1.0.2&#39; Applicationä¸­åˆå§‹åŒ– ç»§æ‰¿MultiDexApplication é‡å†™Application çš„attachBaseContextæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨onCreateä¹‹å‰æ‰§è¡Œçš„ 12345678public class MyApplication extends Application&#123; @Override protected void attachBaseContext(Context base) &#123; super.attachBaseContext(base); MultiDex.install(this); &#125; &#125; è¿™æ ·ä¼šç”Ÿæˆclasses.dex classes2.dex classes3.dex â€¦å¤šä¸ªdexæ–‡ä»¶ ä¸ºå•¥ä¼šæœ‰65536çš„é™åˆ¶ä¸€ä¸ª dex æ–‡ä»¶çš„æ–¹æ³•å¼•ç”¨æ•°ä¸èƒ½å¤§äºŽ 64kï¼Œ64k çš„å‡†ç¡®å€¼æ˜¯ï¼ˆ64 * 1024 = 65536ï¼‰ã€‚ invoke-kind ï¼ˆè°ƒç”¨å„ç±»æ–¹æ³•ï¼‰æŒ‡ä»¤ä¸­ï¼Œæ–¹æ³•å¼•ç”¨ç´¢å¼•æ•°æ˜¯ 16 ä½çš„ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šè°ƒç”¨ 2^16 = 65536 ä¸ªæ–¹æ³•ï¼Œè¿™å°±æ˜¯ DexFormat ä¸­ MAX_MEMBER_IDX ä¸º 0xFFFF çš„åŽŸå› ã€‚ è¯¦ç»†åŽŸå› æŸ¥çœ‹]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å›žé¡¾é›†åˆä½“ç³»]]></title>
    <url>%2F2015%2F12%2F26%2F%E5%9B%9E%E9%A1%BE%E9%9B%86%E5%90%88%E4%BD%93%E7%B3%BB%2F</url>
    <content type="text"><![CDATA[é›†åˆä½“ç³»æ•´ç† å‰è¨€ é¢å‘å¯¹è±¡è¯­è¨€å¯¹äº‹ç‰©çš„ä½“çŽ°éƒ½æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿å¯¹å¤šä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå°±éœ€è¦å¯¹å¯¹è±¡è¿›è¡Œå­˜å‚¨ æ•°ç»„è™½ç„¶å¯ä»¥å­˜å‚¨å¯¹è±¡ï¼Œä½†æ˜¯é•¿åº¦ä¸Šå›ºå®šçš„ é›†åˆçš„é•¿åº¦æ˜¯å¯å˜çš„ æ•°ç»„ä¸­å¯ä»¥å­˜å‚¨åŸºæœ¬æ•°æ®ç±»åž‹ é›†åˆä¸­åªèƒ½å­˜å‚¨å¯¹è±¡ é›†åˆä½“ç³»å›¾ IteratoræŽ¥å£ IteratoræŽ¥å£ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºŽéåŽ†é›†åˆä¸­å…ƒç´ çš„æŽ¥å£ ä¸»è¦åŒ…å«hashNext(),next(),remove()ä¸‰ç§æ–¹æ³• å®ƒçš„ä¸€ä¸ªå­æŽ¥å£LinkedIteratoråœ¨å®ƒçš„åŸºç¡€ä¸Šåˆæ·»åŠ äº†ä¸‰ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯add(),previous(),hasPrevious() IteratoræŽ¥å£ï¼Œé‚£ä¹ˆåœ¨éåŽ†é›†åˆä¸­å…ƒç´ çš„æ—¶å€™ï¼Œåªèƒ½å¾€åŽéåŽ†ï¼Œè¢«éåŽ†åŽçš„å…ƒç´ ä¸ä¼šåœ¨éåŽ†åˆ°ï¼Œé€šå¸¸æ— åºé›†åˆå®žçŽ°çš„éƒ½æ˜¯è¿™ä¸ªæŽ¥å£ï¼Œæ¯”å¦‚HashSetï¼ŒHashMap å…ƒç´ æœ‰åºçš„é›†åˆï¼Œå®žçŽ°çš„ä¸€èˆ¬éƒ½æ˜¯LinkedIteratoræŽ¥å£ï¼Œå®žçŽ°è¿™ä¸ªæŽ¥å£çš„é›†åˆå¯ä»¥åŒå‘éåŽ†ï¼Œæ—¢å¯ä»¥é€šè¿‡next()è®¿é—®ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆå¯ä»¥é€šè¿‡previous()è®¿é—®å‰ä¸€ä¸ªå…ƒç´ ï¼Œæ¯”å¦‚ArrayListã€‚ CollectionæŽ¥å£ Collectionæ˜¯é›†åˆç±»æ ¹æŽ¥å£ï¼Œè¡ç”Ÿå‡ºä¸¤ä¸ªå­ç±»æŽ¥å£Listå’ŒSet Collectionå®šä¹‰äº†é›†åˆæ¡†æž¶çš„å…±æ€§åŠŸèƒ½ ListæŽ¥å£Listé‡Œå­˜æ”¾çš„å¯¹è±¡æ˜¯æœ‰åºçš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯ä»¥é‡å¤çš„ï¼ŒListå…³æ³¨çš„æ˜¯ç´¢å¼•ï¼Œæ‹¥æœ‰ä¸€ç³»åˆ—å’Œç´¢å¼•ç›¸å…³çš„æ–¹æ³•ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«ã€‚å› ä¸ºå¾€listé›†åˆé‡Œæ’å…¥æˆ–åˆ é™¤æ•°æ®æ—¶ï¼Œä¼šä¼´éšç€åŽé¢æ•°æ®çš„ç§»åŠ¨ï¼Œæ‰€æœ‰æ’å…¥åˆ é™¤æ•°æ®é€Ÿåº¦æ…¢ã€‚ ArrayListï¼šçº¿ç¨‹ä¸å®‰å…¨ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œå…ƒç´ æœ‰åºï¼Œå¯é‡å¤ Vectorï¼šçº¿ç¨‹å®‰å…¨ï¼Œä½†é€Ÿåº¦æ…¢ï¼Œå·²è¢«ArrayListæ›¿ä»£ LinkedListï¼šé“¾è¡¨ç»“æž„ï¼Œå¢žåˆ é€Ÿåº¦å¿« LinkedListç»å¸¸ç”¨åœ¨å¢žåˆ æ“ä½œè¾ƒå¤šè€ŒæŸ¥è¯¢æ“ä½œå¾ˆå°‘çš„æƒ…å†µä¸‹ï¼ŒArrayListåˆ™ç›¸å SetæŽ¥å£Seté‡Œå­˜æ”¾çš„å¯¹è±¡æ˜¯æ— åºï¼ˆå­˜å…¥å’Œå–å‡ºçš„é¡ºåºä¸ä¸€å®šä¸€è‡´ï¼‰ï¼Œä¸èƒ½é‡å¤çš„ï¼Œé›†åˆä¸­çš„å¯¹è±¡ä¸æŒ‰ç‰¹å®šçš„æ–¹å¼æŽ’åºï¼Œåªæ˜¯ç®€å•åœ°æŠŠå¯¹è±¡åŠ å…¥é›†åˆä¸­ã€‚ HashSetï¼šï¼š åº•å±‚æ•°æ®ç»“æž„æ˜¯å“ˆå¸Œè¡¨ã€‚æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ä¸åŒæ­¥ é€šè¿‡å…ƒç´ çš„ä¸¤ä¸ªæ–¹æ³•ï¼ŒhashCodeå’Œequalsæ¥ä¿è¯å”¯ä¸€æ€§ å¦‚æžœå…ƒç´ çš„HashCodeå€¼ç›¸åŒï¼Œæ‰ä¼šåˆ¤æ–­equalsæ˜¯å¦ä¸ºtrueã€‚ å¦‚æžœå…ƒç´ çš„hashcodeå€¼ä¸åŒï¼Œä¸ä¼šè°ƒç”¨equalsã€‚ æ— åº TreeSetï¼š æœ‰åº çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¯ä»¥å¯¹Seté›†åˆä¸­çš„å…ƒç´ è¿›è¡ŒæŽ’åº é€šè¿‡compareToæˆ–è€…compareæ–¹æ³•æ¥ä¿è¯å…ƒç´ çš„å”¯ä¸€æ€§ï¼Œå…ƒç´ ä»¥äºŒå‰æ ‘çš„å½¢å¼å­˜æ”¾ã€‚ MapæŽ¥å£ Mapæä¾›äº†ä¸€ç§æ˜ å°„å…³ç³»ï¼Œå…ƒç´ æ˜¯ä»¥é”®å€¼å¯¹ï¼ˆkey-valueï¼‰çš„å½¢å¼å­˜å‚¨çš„ï¼Œèƒ½æ ¹æ®keyå¿«é€ŸæŸ¥æ‰¾valueï¼› Mapä¸­çš„é”®å€¼å¯¹ä»¥Entryç±»åž‹çš„å¯¹è±¡å®žä¾‹å½¢å¼å­˜åœ¨ï¼› keyå€¼ä¸èƒ½é‡å¤ï¼Œvalueå€¼å¯ä»¥é‡å¤ï¼› HashMapåº•å±‚æ˜¯å“ˆå¸Œè¡¨æ•°æ®ç»“æž„ï¼Œå…è®¸ä½¿ç”¨ null å€¼å’Œ null é”®ï¼Œè¯¥é›†åˆæ˜¯ä¸åŒæ­¥çš„ã€‚å°†hashtableæ›¿ä»£ï¼Œjdk1.2.æ•ˆçŽ‡é«˜ã€‚ HashMapåŽŸç†ï¼š HashMapåº•å±‚å°±æ˜¯ä¸€ä¸ªæ•°ç»„ç»“æž„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹åˆæ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚å½“æ–°å»ºä¸€ä¸ªHashMapçš„æ—¶å€™ï¼Œå°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ã€‚ æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹åˆæ˜¯ä¸€ä¸ªEntryï¼Œå…¶ä¸­åŒ…å«äº†keyå’Œvalueï¼Œä¹Ÿå°±æ˜¯é”®å€¼å¯¹ï¼Œå¦å¤–è¿˜åŒ…å«äº†ä¸€ä¸ªnextçš„EntryæŒ‡é’ˆ å› ä¸ºæŒæœ‰ä¸‹ä¸€ä¸ªEntryæŒ‡é’ˆï¼Œæ‰€ä»¥æž„æˆé“¾è¡¨ å¾€HashMapä¸­putå…ƒç´ çš„æ—¶å€™ï¼Œå…ˆæ ¹æ®keyçš„hashCodeé‡æ–°è®¡ç®—hashå€¼ æ ¹æ®hashå€¼å¾—åˆ°è¿™ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼ˆå³ä¸‹æ ‡ï¼‰ å¦‚æžœæ•°ç»„è¯¥ä½ç½®ä¸Šå·²ç»å­˜æ”¾æœ‰å…¶ä»–å…ƒç´ äº†ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªä½ç½®ä¸Šçš„å…ƒç´ å°†ä»¥é“¾è¡¨çš„å½¢å¼å­˜æ”¾ï¼Œæ–°åŠ å…¥çš„æ”¾åœ¨é“¾å¤´ï¼Œæœ€å…ˆåŠ å…¥çš„æ”¾åœ¨é“¾å°¾ã€‚ å¦‚æžœæ•°ç»„è¯¥ä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œå°±ç›´æŽ¥å°†è¯¥å…ƒç´ æ”¾åˆ°æ­¤æ•°ç»„ä¸­çš„è¯¥ä½ç½®ä¸Š ä»ŽHashMapä¸­getå…ƒç´ æ—¶ï¼Œé¦–å…ˆè®¡ç®—keyçš„hashCodeï¼Œæ‰¾åˆ°æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„æŸä¸€å…ƒç´ ï¼Œç„¶åŽé€šè¿‡keyçš„equalsæ–¹æ³•åœ¨å¯¹åº”ä½ç½®çš„é“¾è¡¨ä¸­æ‰¾åˆ°éœ€è¦çš„å…ƒç´ ã€‚ ä¸€å¥è¯åŽŸç†æ€»ç»“ï¼šç®€å•æ¥è¯´ï¼ŒHashMapåœ¨åº•å±‚å°†key-valueå½“ä½œä¸€ä¸ªæ•´ä½“å¤„ç†ï¼Œè¿™ä¸ªæ•´ä½“å°±æ˜¯ä¸€ä¸ªEntryå¯¹è±¡ã€‚HashMapåº•å±‚é‡‡ç”¨ä¸€ä¸ªEntry[]æ•°ç»„æ¥ä¿å­˜æ‰€æœ‰çš„key-valueï¼Œæ¯ä¸ªEntryåŒ…å«äº†key-valueï¼Œè¿˜åŒ…å«äº†nextçš„EntryæŒ‡é’ˆï¼Œå› æ­¤æž„æˆä¸€ä¸ªé“¾è¡¨ã€‚å½“è¦å­˜å‚¨ä¸€ä¸ªEntryå¯¹è±¡æ—¶ï¼Œä¼šæ ¹æ®hashç®—æ³•å†³å®šåœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œå†æ ¹æ®equalsæ–¹æ³•ï¼Œå†³å®šå…¶åœ¨è¯¥æ•°ç»„ä½ç½®ä¸Šçš„é“¾è¡¨çš„å­˜å‚¨ä½ç½®ï¼›åœ¨éœ€è¦å–å‡ºä¸€ä¸ªEntryæ—¶ï¼Œä¹Ÿä¼šæ ¹æ®hashç®—æ³•æ‰¾åˆ°å…¶åœ¨è¿™ä¸ªæ•°ç»„çš„å­˜å‚¨ä½ç½®ï¼Œå†æ ¹æ®equelæ–¹æ³•ï¼Œä»Žè¯¥ä½ç½®æ‰¾åˆ°å¯¹åº”çš„Entryå¯¹è±¡ã€‚ hashmapä¸¤ç§éåŽ†æ–¹å¼ç¬¬ä¸€ç§ï¼š 1234567Map map = new HashMap(); Iterator iter = map.entrySet().iterator(); while (iter.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter.next(); Object key = entry.getKey(); Object val = entry.getValue(); &#125; ç¬¬äºŒç§ï¼š 123456 Map map = new HashMap(); Iterator iter = map.keySet().iterator(); while (iter.hasNext()) &#123; Object key = iter.next(); Object val = map.get(key); &#125; æµ…æžConcurrentHashMap public V get(Object key)ä¸æ¶‰åŠåˆ°é”ï¼Œä¹Ÿå°±æ˜¯è¯´èŽ·å¾—å¯¹è±¡æ—¶æ²¡æœ‰ä½¿ç”¨é”ï¼› putã€removeæ–¹æ³•è¦ä½¿ç”¨é”ï¼Œä½†å¹¶ä¸ä¸€å®šæœ‰é”äº‰ç”¨ï¼ŒåŽŸå› åœ¨äºŽConcurrentHashMapå°†ç¼“å­˜çš„å˜é‡åˆ†åˆ°å¤šä¸ªSegmentï¼Œæ¯ä¸ªSegmentä¸Šæœ‰ä¸€ä¸ªé”ï¼Œåªè¦å¤šä¸ªçº¿ç¨‹è®¿é—®çš„ä¸æ˜¯ä¸€ä¸ªSegmentå°±æ²¡æœ‰é”äº‰ç”¨ï¼Œå°±æ²¡æœ‰å µå¡žï¼Œå„çº¿ç¨‹ç”¨å„è‡ªçš„é”ï¼ŒConcurrentHashMapç¼ºçœæƒ…å†µä¸‹ç”Ÿæˆ16ä¸ªSegmentï¼Œä¹Ÿå°±æ˜¯å…è®¸16ä¸ªçº¿ç¨‹å¹¶å‘çš„æ›´æ–°è€Œå°½é‡æ²¡æœ‰é”äº‰ç”¨ï¼› Hashtableå¯¹get,put,removeéƒ½ä½¿ç”¨äº†åŒæ­¥æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æžœæœ‰çº¿ç¨‹æ­£åœ¨éåŽ†é›†åˆï¼Œå…¶ä»–çš„çº¿ç¨‹å°±æš‚æ—¶ä¸èƒ½ä½¿ç”¨è¯¥é›†åˆäº†ï¼Œè¿™æ ·æ— ç–‘å°±å¾ˆå®¹æ˜“å¯¹æ€§èƒ½å’Œåžåé‡é€ æˆå½±å“ã€‚è€ŒConcurrentHashMapåˆ™ä¸åŒï¼Œå®ƒåªå¯¹put,removeæ“ä½œä½¿ç”¨äº†åŒæ­¥æ“ä½œï¼Œgetæ“ä½œå¹¶ä¸å½±å“ Hashtableåœ¨ä½¿ç”¨iteratoréåŽ†çš„æ—¶å€™ï¼Œå¦‚æžœå…¶ä»–çº¿ç¨‹ï¼ŒåŒ…æ‹¬æœ¬çº¿ç¨‹å¯¹Hashtableè¿›è¡Œäº†putï¼Œremoveç­‰æ›´æ–°æ“ä½œçš„è¯ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œä½†å¦‚æžœä½¿ç”¨ConcurrentHashMapçš„è¯ï¼Œå°±ä¸ç”¨è€ƒè™‘è¿™æ–¹é¢çš„é—®é¢˜äº† æµ…æžHashMapï¼ŒHashTableï¼ŒConcurrentHashMap HashMapå¦‚ä¸Šæ‰€è¯‰ï¼Œä¸åŒæ­¥ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œä¸ä½¿ç”¨ç”¨ä¸Žå¤šçº¿ç¨‹é«˜å¹¶å‘æƒ…å†µä¸‹ Hashtableï¼Œè¢«é—å¼ƒçš„ç±»ï¼Œçº¿ç¨‹å®‰å…¨æ˜¯å› ä¸ºåœ¨æ‰€æœ‰æ–¹æ³•ä¸Šéƒ½åŠ äº†synchronizedæ¥å®žçŽ°çº¿ç¨‹å®‰å…¨ï¼Œå¯¼è‡´å¤šçº¿ç¨‹è®¿é—®æ•ˆçŽ‡ä½Ž Synchronized Mapï¼ˆé€šè¿‡Collections.synchronizedMap()æ¥åŒ…è£…ä¸€ä¸ªhashmapï¼‰å’ŒhashtableåŒºåˆ«ä¸å¤§ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯æ²¡æœ‰è¢«é—å¼ƒ ConcurrentHashMapï¼Œé»˜è®¤å…è®¸16ä¸ªçº¿ç¨‹è¯»å†™è¿™ä¸ªmapï¼Œä¸åƒHashtableå’ŒSynchronized Mapä¸€æ ·ï¼Œæ²¡æœ‰é”æ•´ä¸ªæ•´ä¸ªmapï¼Œè€Œæ˜¯åˆ’åˆ†äº†å¤šä¸ªæ®µï¼ˆSegmentï¼‰ï¼Œåªä¼šé”éœ€è¦æ“ä½œçš„é‚£ä¸€æ®µæ•°æ® ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†åšå®¢ ç‚¹å‡»æŸ¥çœ‹ç›¸å…³åšå®¢ TreeMapåº•å±‚æ˜¯äºŒå‰æ ‘æ•°æ®ç»“æž„ã€‚çº¿ç¨‹ä¸åŒæ­¥ã€‚å¯ä»¥ç”¨äºŽç»™mapé›†åˆä¸­çš„é”®è¿›è¡ŒæŽ’åºã€‚ é›†åˆè¾“å‡ºï¼ˆéåŽ†ï¼‰ Iteratorï¼š è¿­ä»£è¾“å‡ºï¼Œä½¿ç”¨æœ€å¤šçš„è¾“å‡ºæ–¹å¼ ListIteratorï¼šæ˜¯Iteratorçš„å­æŽ¥å£ï¼Œä¸“é—¨ç”¨äºŽè¾“å‡ºListä¸­çš„å†…å®¹ã€‚ foreachè¾“å‡ºï¼šJDK1.5ä¹‹åŽæä¾›çš„æ–°åŠŸèƒ½ï¼Œå¯ä»¥è¾“å‡ºæ•°ç»„æˆ–é›†åˆã€‚ forå¾ªçŽ¯ é›†åˆçš„å·¥å…·ç±»Collections:é›†åˆæ¡†æž¶çš„å·¥å…·ç±»ã€‚é‡Œé¢å®šä¹‰çš„éƒ½æ˜¯é™æ€æ–¹æ³•ã€‚ Collectionså’ŒCollectionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Collectionæ˜¯é›†åˆæ¡†æž¶ä¸­çš„ä¸€ä¸ªé¡¶å±‚æŽ¥å£ï¼Œå®ƒé‡Œé¢å®šä¹‰äº†å•åˆ—é›†åˆçš„å…±æ€§æ–¹æ³•ã€‚ å®ƒæœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å­æŽ¥å£ï¼Œ â€”â€”Listï¼šå¯¹å…ƒç´ éƒ½æœ‰å®šä¹‰ç´¢å¼•ã€‚æœ‰åºçš„ã€‚å¯ä»¥é‡å¤å…ƒç´ ã€‚ â€”â€”Setï¼šä¸å¯ä»¥é‡å¤å…ƒç´ ã€‚æ— åºã€‚ Collectionsæ˜¯é›†åˆæ¡†æž¶ä¸­çš„ä¸€ä¸ªå·¥å…·ç±»ã€‚è¯¥ç±»ä¸­çš„æ–¹æ³•éƒ½æ˜¯é™æ€çš„ã€‚ æä¾›çš„æ–¹æ³•ä¸­æœ‰å¯ä»¥å¯¹listé›†åˆè¿›è¡ŒæŽ’åºï¼ŒäºŒåˆ†æŸ¥æ‰¾ç­‰æ–¹æ³•ã€‚ é€šå¸¸å¸¸ç”¨çš„é›†åˆéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚å› ä¸ºè¦æé«˜æ•ˆçŽ‡ã€‚ å¦‚æžœå¤šçº¿ç¨‹æ“ä½œè¿™äº›é›†åˆæ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å·¥å…·ç±»ä¸­çš„åŒæ­¥æ–¹æ³•ï¼Œå°†çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆï¼Œè½¬æ¢æˆå®‰å…¨çš„ã€‚ æ€»ç»“Listï¼šadd/remove/get/setã€‚ 1ï¼ŒArrayListï¼šå…¶å®žå°±æ˜¯æ•°ç»„ï¼Œå®¹é‡ä¸€å¤§ï¼Œé¢‘ç¹å¢žåˆ å°±æ˜¯å™©æ¢¦ï¼Œé€‚åˆéšæœºæŸ¥æ‰¾ï¼› 2ï¼ŒLinkedListï¼šå¢žåŠ äº†push/[pop|remove|pull]ï¼Œå…¶å®žéƒ½æ˜¯removeFirstï¼› 3ï¼ŒVectorï¼šåŽ†å²é—ç•™äº§ç‰©ï¼ŒåŒæ­¥ç‰ˆçš„ArrayListï¼Œä»£ç å’ŒArrayListå¤ªåƒï¼› 4ï¼ŒStackï¼šç»§æ‰¿è‡ªVectorã€‚Javaé‡Œå…¶å®žæ²¡æœ‰çº¯ç²¹çš„Stackï¼Œå¯ä»¥è‡ªå·±å®žçŽ°ï¼Œç”¨ç»„åˆçš„æ–¹å¼ï¼Œå°è£…ä¸€ä¸‹LinkedListå³å¯ï¼› 5ï¼ŒQueueï¼šæœ¬æ¥æ˜¯å•ç‹¬çš„ä¸€ç±»ï¼Œä¸è¿‡åœ¨SUNçš„JDKé‡Œå°±æ˜¯ç”¨LinkedListæ¥æä¾›è¿™ä¸ªåŠŸèƒ½çš„ï¼Œä¸»è¦æ–¹æ³•æ˜¯offer/pull/peekï¼Œå› æ­¤å½’åˆ°è¿™é‡Œå‘¢ã€‚ Setï¼šadd/removeã€‚å¯ä»¥ç”¨è¿­ä»£å™¨æˆ–è€…è½¬æ¢æˆlistã€‚ 1ï¼ŒHashSetï¼šå†…éƒ¨é‡‡ç”¨HashMapå®žçŽ°çš„ï¼› 2ï¼ŒLinkedHashSetï¼šé‡‡ç”¨LinkedHashMapå®žçŽ°ï¼› 3ï¼ŒTreeSetï¼šTreeMapã€‚ Mapï¼šput/get/removeã€‚ 1ï¼ŒHashMap/HashTableï¼šæ•£åˆ—è¡¨ï¼Œå’ŒArrayListä¸€æ ·é‡‡ç”¨æ•°ç»„å®žçŽ°ï¼Œè¶…è¿‡åˆå§‹å®¹é‡ä¼šå¯¹æ€§èƒ½æœ‰æŸè€—ï¼› 2ï¼ŒLinkedHashMapï¼šç»§æ‰¿è‡ªHashMapï¼Œä½†é€šè¿‡é‡å†™åµŒå¥—ç±»HashMap.Entryå®žçŽ°äº†é“¾è¡¨ç»“æž„ï¼ŒåŒæ ·æœ‰å®¹é‡çš„é—®é¢˜ï¼› 3ï¼ŒPropertiesï¼šæ˜¯ç»§æ‰¿çš„HashTableã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹Arrays.asListï¼Œè¿™ä¸ªæ–¹æ³•çš„å®žçŽ°ä¾èµ–ä¸€ä¸ªåµŒå¥—ç±»ï¼Œè¿™ä¸ªåµŒå¥—ç±»ä¹Ÿå«ArrayListï¼ æ‰‹å†™é›†åˆArrayList1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495/** * æ‰‹å†™ArrayList */ public class MyArrayList&#123; private Object[] value = null; private int size = 0; MyArrayList() &#123; value = new Object[10]; &#125; public boolean add(Object obj)&#123; if(size == value.length) expansion(); value[size++]=obj; return true; &#125; public Object get(int index)&#123; return value[index]; &#125; public void remove(Object obj)&#123; Object[] obj2 = new Object[size]; int index = 0; int id = 0; for (int i = 0; i &lt;= size; i++) &#123; if(!(value[i].toString().equals(obj.toString())))&#123; obj2[index] = value[i]; index ++; &#125;else&#123; id ++ ; if(id == 1) size --; else&#123; obj2[index] = value[i]; index ++; &#125; &#125; &#125; value = obj2; &#125; @SuppressWarnings("null") public void set(int index,Object obj)&#123; Object[] newObj = new Object[size];; for (int i = 0; i &lt; size; i++) &#123; if(i == index) newObj[i] = obj; else newObj[i] = value[i]; &#125; value = newObj; &#125; public int size()&#123; return size; &#125; private boolean expansion() &#123; Object[] temp = new Object[value.length + 5]; temp = value.clone(); /** * æ³¨æ„ï¼šcloneåªå¯¹ä¸€ç»´æ•°ç»„èµ·ä½œç”¨ï¼Œè€Œä¸èƒ½ç”¨äºŽäºŒç»´æ•°ç»„ï¼Œ å› ä¸ºjavaæ²¡æœ‰äºŒç»´æ•°ç»„çš„æ¦‚å¿µï¼Œè€Œåªæœ‰æ•°ç»„çš„æ•°ç»„ï¼ŒäºŒç»´ * æ•°ç»„å­˜å‚¨çš„æ˜¯å‡ ä¸ªä¸€ç»´æ•°ç»„çš„å¼•ç”¨ï¼Œè€Œä½¿ç”¨cloneä¹Ÿåªæ˜¯ æ‹·è´äº†è¿™å‡ ä¸ªå¼•ç”¨ï¼Œè¯´ç™½äº†è¿˜æ˜¯åŽŸæ¥é‚£å‡ ä¸ªä¸€ç»´æ•°ç»„å¯¹è±¡ã€‚ * å¦‚æžœæƒ³ç”¨äºŽäºŒç»´æ•°ç»„ï¼Œé‚£ä¹ˆå°±éåŽ†å…¶ä¸­çš„ä¸€ç»´æ•°ç»„ï¼ŒæŒ¨ä¸ª æ‹·è´ä¸€ç»´æ•°ç»„åˆ°ç›®æ ‡äºŒç»´æ•°ç»„ä¸­çš„ä¸€ç»´æ•°ç»„ä¸‹ã€‚ */ value = temp; return true; &#125; public void clear()&#123; size = 0; value = null; &#125; public static void main(String[] args) &#123; MyArrayList ma = new MyArrayList(); ma.add("hello"); ma.add("world"); ma.add("java"); System.out.println(ma.get(1)); System.out.println(ma.size()); ma.set(1, "new"); System.out.println(ma.get(1)); System.out.println(ma.size()); &#125; &#125; LinkedList 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100public class MyLinkedList&lt;AnyType&gt; &#123; private static class Node&lt;AnyType&gt;&#123; public AnyType data; public Node&lt;AnyType&gt; prev; public Node&lt;AnyType&gt; next; public Node(AnyType d, Node&lt;AnyType&gt; p, Node&lt;AnyType&gt; n)&#123; data = d; prev = p; next = n; &#125; &#125; private int theSize; private int modCount; private Node&lt;AnyType&gt; beginMarker; private Node&lt;AnyType&gt; endMarker; public MyLinkedList()&#123; clear(); &#125; public void clear()&#123; beginMarker = new Node&lt;AnyType&gt;(null, null, null); endMarker = new Node&lt;AnyType&gt;(null, beginMarker, null); beginMarker.next = endMarker; theSize = 0; &#125; public int size()&#123; return theSize; &#125; public boolean add(AnyType x)&#123; add(size(), x); return true; &#125; public void add(int idx, AnyType x)&#123; addBefore(getNode(idx), x); &#125; public AnyType get(int idx)&#123; return getNode(idx).data; &#125; private void addBefore(Node&lt;AnyType&gt; p, AnyType x)&#123; Node&lt;AnyType&gt; newNode = new Node&lt;AnyType&gt;(x, p.prev, p); newNode.prev.next = newNode; p.prev = newNode; theSize++; modCount++; &#125; private Node&lt;AnyType&gt; getNode(int idx)&#123; Node&lt;AnyType&gt; p; if(idx &lt; 0 || idx &gt; size())&#123; System.out.println("IndexOutOfBoundsException"); &#125; if(idx &lt;= size()/2)&#123; System.out.println(idx); p = beginMarker.next; for(int i = 0; i &lt; idx; i++)&#123; p = p.next; &#125; &#125;else&#123; p = endMarker; for(int i = size(); i &gt; idx; i--)&#123; p = p.prev; &#125; &#125; return p; &#125; public boolean find(AnyType x)&#123; Node&lt;AnyType&gt; p = beginMarker.next; for(int i = 0; i &lt; size(); i++)&#123; if(p.data == x)&#123; return true; &#125; p = p.next; &#125; return false; &#125; public String toString()&#123; String s = ""; Node&lt;AnyType&gt; p = beginMarker.next; for(int i = 0; i &lt; size(); i++)&#123; s += p.data +","; p = p.next; &#125; return s; &#125;&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HandlerThread]]></title>
    <url>%2F2015%2F12%2F22%2FHandlerThread%2F</url>
    <content type="text"><![CDATA[HandlerThread HandlerThreadçŸ¥è¯†ç‚¹æ•´ç† å®˜æ–¹ä»‹ç» Handy class for starting a new thread that has a looper. The looper can then be used to create handler classes. Note that start() must still be called. æ„æ€å°±æ˜¯HandlerThreadèƒ½å¤Ÿæ–°å»ºæ‹¥æœ‰Looperçš„çº¿ç¨‹(é™¤äº†ä¸»çº¿ç¨‹,æˆ‘ä»¬æ–°å»ºçº¿ç¨‹æ˜¯éœ€è¦æ‰‹åŠ¨è°ƒç”¨Looper.prepareæ¥åˆå§‹åŒ–looperå’Œmessagequeueçš„),è€Œè¿™ä¸ªlooperèƒ½å¤Ÿæ¥æ–°å»ºå…¶ä»–çš„Handler(æ–°å»ºçš„è¿™ä¸ªhandleræ˜¯å±žäºŽå­çº¿ç¨‹çš„,å¹¶ä¸”looperå’Œmessagequeueéƒ½æ˜¯åˆå§‹åŒ–å¥½äº†çš„) å¦‚ä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223mHandlerThread = new HandlerThread("check-message-coming");//the name of the new thread mHandlerThread.start(); mThreadHandler = new Handler(mHandlerThread.getLooper())//æ‹¥æœ‰å­çº¿ç¨‹looperçš„handler &#123; @Override public void handleMessage(Message msg) &#123; update();//æ¨¡æ‹Ÿæ•°æ®æ›´æ–° if (isUpdateInfo) mThreadHandler.sendEmptyMessage(MSG_UPDATE_INFO); &#125; &#125;; @Override protected void onDestroy() &#123; super.onDestroy(); //é‡Šæ”¾èµ„æº myHandlerThread.quit() ; &#125;//å…¶ä»–çº¿ç¨‹å¯ä»¥æ‹¿mThreadHandlerå‘æ¶ˆæ¯äº†ï¼Œæ¥å®Œæˆå‘è¯¥HandlerThreadçº¿ç¨‹é€šè®¯ mThreadHandleræž„å»ºçš„æ—¶å€™,ä¼ çš„æ˜¯HandlerThreadçš„looperå¯¹è±¡,ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªmThreadHandleræ˜¯å±žäºŽå­çº¿ç¨‹çš„ç®¡ç†çš„,ä»–çš„handlerMessageçš„å›žè°ƒä¸­æ˜¯å¯ä»¥åšè€—æ—¶æ“ä½œçš„(åˆ‡è®°,æ˜¯ä¸èƒ½åšæ›´æ–°UIçš„æ“ä½œçš„,å¦‚éœ€è¦æ›´æ–°,éœ€è¦ç”¨ä¸»çº¿ç¨‹çš„handlerå‘æ¶ˆæ¯æ¥æ›´æ–°,æˆ–è€…ä½¿ç”¨runOnUiThreadæˆ–è€…eventBusç­‰å…¶ä»–æ–¹å¼æ¥åˆ·æ–°ui) é€€å‡ºå¾ªçŽ¯ Looperæ˜¯é€šè¿‡è°ƒç”¨loopæ–¹æ³•é©±åŠ¨ç€æ¶ˆæ¯å¾ªçŽ¯çš„è¿›è¡Œ: ä»ŽMessageQueueä¸­é˜»å¡žå¼åœ°å–å‡ºä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åŽè®©Handlerå¤„ç†è¯¥æ¶ˆæ¯ï¼Œå‘¨è€Œå¤å§‹ï¼Œloopæ–¹æ³•æ˜¯ä¸ªæ­»å¾ªçŽ¯æ–¹æ³•ã€‚ é‚£å¦‚ä½•ç»ˆæ­¢æ¶ˆæ¯å¾ªçŽ¯å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è°ƒç”¨Looperçš„quitæ–¹æ³•æˆ–quitSafelyæ–¹æ³•ï¼ŒäºŒè€…ç¨æœ‰ä¸åŒã€‚ 1234567891011121314151617181920212223242526272829303132333435/** * Quits the looper. * &lt;p&gt; * Causes the &#123;@link #loop&#125; method to terminate without processing any * more messages in the message queue. * &lt;/p&gt;&lt;p&gt; * Any attempt to post messages to the queue after the looper is asked to quit will fail. * For example, the &#123;@link Handler#sendMessage(Message)&#125; method will return false. * &lt;/p&gt;&lt;p class="note"&gt; * Using this method may be unsafe because some messages may not be delivered * before the looper terminates. Consider using &#123;@link #quitSafely&#125; instead to ensure * that all pending work is completed in an orderly manner. * &lt;/p&gt; * * @see #quitSafely */ public void quit() &#123; mQueue.quit(false); &#125; /** * Quits the looper safely. * &lt;p&gt; * Causes the &#123;@link #loop&#125; method to terminate as soon as all remaining messages * in the message queue that are already due to be delivered have been handled. * However pending delayed messages with due times in the future will not be * delivered before the loop terminates. * &lt;/p&gt;&lt;p&gt; * Any attempt to post messages to the queue after the looper is asked to quit will fail. * For example, the &#123;@link Handler#sendMessage(Message)&#125; method will return false. * &lt;/p&gt; */ public void quitSafely() &#123; mQueue.quit(true); &#125; quitï¼ˆï¼‰å’ŒquitSafetyçš„åŒºåˆ« å½“æˆ‘ä»¬è°ƒç”¨Looperçš„quitæ–¹æ³•æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº†MessageQueueä¸­çš„removeAllMessagesLockedæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠMessageQueueæ¶ˆæ¯æ± ä¸­æ‰€æœ‰çš„æ¶ˆæ¯å…¨éƒ¨æ¸…ç©ºï¼Œæ— è®ºæ˜¯å»¶è¿Ÿæ¶ˆæ¯ï¼ˆå»¶è¿Ÿæ¶ˆæ¯æ˜¯æŒ‡é€šè¿‡sendMessageDelayedæˆ–é€šè¿‡postDelayedç­‰æ–¹æ³•å‘é€çš„éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„æ¶ˆæ¯ï¼‰è¿˜æ˜¯éžå»¶è¿Ÿæ¶ˆæ¯ã€‚ å½“æˆ‘ä»¬è°ƒç”¨Looperçš„quitSafelyæ–¹æ³•æ—¶ï¼Œå®žé™…ä¸Šæ‰§è¡Œäº†MessageQueueä¸­çš„removeAllFutureMessagesLockedæ–¹æ³•ï¼Œé€šè¿‡åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•åªä¼šæ¸…ç©ºMessageQueueæ¶ˆæ¯æ± ä¸­æ‰€æœ‰çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œå¹¶å°†æ¶ˆæ¯æ± ä¸­æ‰€æœ‰çš„éžå»¶è¿Ÿæ¶ˆæ¯æ´¾å‘å‡ºåŽ»è®©HandleråŽ»å¤„ç†ï¼ŒquitSafelyç›¸æ¯”äºŽquitæ–¹æ³•å®‰å…¨ä¹‹å¤„åœ¨äºŽæ¸…ç©ºæ¶ˆæ¯ä¹‹å‰ä¼šæ´¾å‘æ‰€æœ‰çš„éžå»¶è¿Ÿæ¶ˆæ¯ã€‚ æ— è®ºæ˜¯è°ƒç”¨äº†quitæ–¹æ³•è¿˜æ˜¯quitSafelyæ–¹æ³•åªä¼šï¼ŒLooperå°±ä¸å†æŽ¥æ”¶æ–°çš„æ¶ˆæ¯ã€‚å³åœ¨è°ƒç”¨äº†Looperçš„quitæˆ–quitSafelyæ–¹æ³•ä¹‹åŽï¼Œæ¶ˆæ¯å¾ªçŽ¯å°±ç»ˆç»“äº†ï¼Œè¿™æ—¶å€™å†é€šè¿‡Handlerè°ƒç”¨sendMessageæˆ–postç­‰æ–¹æ³•å‘é€æ¶ˆæ¯æ—¶å‡è¿”å›žfalseï¼Œè¡¨ç¤ºæ¶ˆæ¯æ²¡æœ‰æˆåŠŸæ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—MessageQueueä¸­ï¼Œå› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—å·²ç»é€€å‡ºäº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯Looperçš„quitæ–¹æ³•ä»ŽAPI Level 1å°±å­˜åœ¨äº†ï¼Œä½†æ˜¯Looperçš„quitSafelyæ–¹æ³•ä»ŽAPI Level 18æ‰æ·»åŠ è¿›æ¥ã€‚ æ€»ç»“ 1. HandlerThreadç»§æ‰¿è‡ªThread,å› æ­¤è°ƒç”¨startæ–¹æ³•,ä¹Ÿæ˜¯æ‰§è¡Œrunæ–¹æ³•,run()æ–¹æ³•çš„é€»è¾‘éƒ½æ˜¯åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œçš„ã€‚ 2. æŸ¥çœ‹HandlerThreadæºç å¯ä»¥çœ‹åˆ°,run()ä¸­ä¸»è¦åšäº†Looper.prepare()å’Œlooper.loop()åˆ›å»ºlooperå’Œmessagequeueå¯¹è±¡å¹¶å¼€å¯æ¶ˆæ¯é˜Ÿåˆ—çš„å¾ªçŽ¯ 3. éœ€è¦æ³¨æ„çš„æ˜¯,å¯¹äºŽç½‘ç»œioæ“ä½œ,HandlerThreadå¹¶ä¸é€‚åˆ,å› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªçº¿ç¨‹,å¾—æŽ’é˜Ÿä¸€ä¸ªä¸€ä¸ªç­‰ç€ã€‚ 4. é¡µé¢æ¶ˆè€—çš„æ—¶å€™,è°ƒç”¨ myHandlerThread.quit() ;looperå°±ä¸åœ¨æŽ¥å—æ–°çš„æ¶ˆæ¯,æ¶ˆæ¯å¾ªçŽ¯ç»“æŸ,è¿™ä¸ªæ—¶å€™å†é€šè¿‡handlerè°ƒç”¨sendMessageæˆ–è€…postç­‰æ–¹æ³•å‘é€æ¶ˆæ¯æ—¶å‡è¿”å›žfalse,è¡¨ç¤ºæ²¡æœ‰æˆåŠŸçš„æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[edittextè¾“å…¥é™åˆ¶]]></title>
    <url>%2F2015%2F12%2F13%2Fedittext%E8%BE%93%E5%85%A5%E9%99%90%E5%88%B6%2F</url>
    <content type="text"><![CDATA[EditTextæ™ºèƒ½é™åˆ¶å°æ•°ç‚¹å‰åŽåˆ†åˆ«ä¿ç•™å‡ ä½ éœ€æ±‚ å¯ä»¥åˆ†åˆ«é™åˆ¶å°æ•°ç‚¹å‰é¢å‡ ä½ï¼Œå’Œå°æ•°ç‚¹åŽå‡ ä½ é¦–ä½è¾“å…¥0æ—¶ï¼Œç¬¬äºŒä½åªèƒ½è¾“å…¥å°æ•°ç‚¹ é¦–ä½è¾“å…¥å°æ•°ç‚¹ï¼Œé»˜è®¤æ˜¾ç¤º0. å˜»å˜»! 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * * @param frontPoint å°æ•°ç‚¹å‰å‡ ä½æ•° * @param behindPoint å°æ•°ç‚¹åŽå‡ ä½æ•° * @param editTexts */public static void setEditTextLimit(final int frontPoint, final int behindPoint, final EditText... editTexts) &#123; if (editTexts != null &amp;&amp; editTexts.length &gt; 0) &#123; for (final EditText editText : editTexts) &#123; editText.addTextChangedListener(new TextWatcher() &#123; @Override public void onTextChanged(CharSequence s, int start, int before, int count) &#123; if (s.length() == frontPoint + 1 &amp;&amp; !s.toString().contains(".")) &#123; editText.setText(s.toString().substring(0, frontPoint)); editText.setSelection(frontPoint); &#125; if (editText.getText().toString().indexOf(".") &gt;= 0) &#123; if (editText.getText().toString().indexOf(".", editText.getText().toString().indexOf(".") + 1) &gt; 0) &#123; editText.setText(editText.getText().toString().substring(0, editText.getText().toString().length() - 1)); editText.setSelection(editText.getText().toString().length()); &#125; &#125; if (s.toString().contains(".")) &#123; if (s.length() - 1 - s.toString().indexOf(".") &gt; behindPoint) &#123; s = s.toString().subSequence(0, s.toString().indexOf(".") + behindPoint+1); editText.setText(s); editText.setSelection(s.length()); &#125; &#125; //ç›´æŽ¥è¾“å…¥ä¸€ä¸ªç‚¹,æ˜¾ç¤º0. if (s.toString().trim().substring(0).equals(".")) &#123; s = "0" + s; editText.setText(s); editText.setSelection(2); &#125; //å½“è¾“å…¥ä¸€ä¸ª0,åŽé¢åªèƒ½è¾“å…¥å°æ•°ç‚¹ if (s.toString().startsWith("0") &amp;&amp; s.toString().trim().length() &gt; 1) &#123; if (!s.toString().substring(1, 2).equals(".")) &#123; editText.setText(s.subSequence(0, 1)); editText.setSelection(1); return; &#125; &#125; &#125; @Override public void beforeTextChanged(CharSequence s, int start, int count, int after) &#123; &#125; @Override public void afterTextChanged(Editable s) &#123; &#125; &#125;); &#125; &#125;&#125; xmlåˆ«å¿˜äº† 1android:inputType="numberDecimal"]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å›¾ç‰‡ä¸Šä¼ ,è§’åº¦ä¸æ­£ç¡®]]></title>
    <url>%2F2015%2F08%2F08%2F%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0-%E8%A7%92%E5%BA%A6%E4%B8%8D%E6%AD%A3%E7%A1%AE%2F</url>
    <content type="text"><![CDATA[éƒ¨åˆ†æœºåž‹ï¼ˆä¸‰æ˜Ÿï¼‰çš„ä¸Šä¼ åŽ,å›¾ç‰‡æ˜¯é»˜è®¤æ—‹è½¬äº†90Â° è§£å†³é—®é¢˜ ç›´æŽ¥è¿›å…¥æ­£é¢˜ å½“æˆ‘ä»¬ä¸Šä¼ å›¾ç‰‡éœ€è¦åšçš„å¤„ç† åŽ‹ç¼© åˆ¤æ–­è§’åº¦æ˜¯å¦æ­£ç¡® å¦‚æžœä¸è§’åº¦ä¸å¯¹,çº æ­£è§’åº¦ å…¶ä»–(åŠ æ°´å°ä»€ä¹ˆçš„çœ‹å…·ä½“éœ€æ±‚) è§£å†³ä»¥ä¸‹ä»£ç å—â€‹ /** * åŽ‹ç¼©å›¾ç‰‡ï¼Œå¤„ç†æŸäº›æ‰‹æœºæ‹ç…§è§’åº¦æ—‹è½¬çš„é—®é¢˜ * @param context * @param filePath * @param file * @param q * @return * @throws FileNotFoundException */ public static File compressImage(Context context, String filePath, File file, int q) throws FileNotFoundException { Bitmap bm = getSmallBitmap(filePath); int degree = readPictureDegree(filePath); LogUtil.e(&quot;fengan&quot;, &quot;degree==&quot; + degree); if (degree != 0) {//æ—‹è½¬ç…§ç‰‡è§’åº¦ bm = rotateBitmap(bm, degree); } FileOutputStream out = new FileOutputStream(file); bm.compress(Bitmap.CompressFormat.JPEG, q, out); return file; }` /** * èŽ·å–å›¾ç‰‡è§’åº¦ * @param path * @return */ public static int readPictureDegree(String path) { int degree = 0; try { ExifInterface exifInterface = new ExifInterface(path); int orientation = exifInterface.getAttributeInt( ExifInterface.TAG_ORIENTATION, ExifInterface.ORIENTATION_NORMAL); switch (orientation) { case ExifInterface.ORIENTATION_ROTATE_90: degree = 90; break; case ExifInterface.ORIENTATION_ROTATE_180: degree = 180; break; case ExifInterface.ORIENTATION_ROTATE_270: degree = 270; break; } } catch (IOException e) { e.printStackTrace(); } return degree; } /** * æ—‹è½¬ç…§ç‰‡ * @param bitmap * @param degress * @return */ public static Bitmap rotateBitmap(Bitmap bitmap, int degress) { if (bitmap != null) { Matrix m = new Matrix(); m.postRotate(degress); bitmap = Bitmap.createBitmap(bitmap, 0, 0, bitmap.getWidth(), bitmap.getHeight(), m, true); return bitmap; } return bitmap; } /** * æ ¹æ®è·¯å¾„èŽ·å¾—çªç ´å¹¶åŽ‹ç¼©è¿”å›žbitmapç”¨äºŽæ˜¾ç¤º * * @return */ public static Bitmap getSmallBitmap(String filePath) { final BitmapFactory.Options options = new BitmapFactory.Options(); options.inJustDecodeBounds = true; BitmapFactory.decodeFile(filePath, options); // Calculate inSampleSize options.inSampleSize = calculateInSampleSize(options, 480, 800); // Decode bitmap with inSampleSize set options.inJustDecodeBounds = false; return BitmapFactory.decodeFile(filePath, options); }]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¥ä½ ä»Šå¤©å¿ƒæƒ…æ„‰å¿«]]></title>
    <url>%2F2015%2F08%2F08%2F%E7%A5%9D%E4%BD%A0%E4%BB%8A%E5%A4%A9%E5%BF%83%E6%83%85%E6%84%89%E5%BF%AB%2F</url>
    <content type="text"><![CDATA[]]></content>
      <categories>
        <category>Life</category>
      </categories>
      <tags>
        <tag>Life</tag>
      </tags>
  </entry>
</search>
